{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/icarus/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/icarus/source/js/insight.js","path":"js/insight.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/css/images/avatar.png","path":"css/images/avatar.png","modified":1,"renderable":1},{"_id":"themes/icarus/source/css/images/logo.png","path":"css/images/logo.png","modified":1,"renderable":1},{"_id":"themes/icarus/source/css/images/thumb-default-small.png","path":"css/images/thumb-default-small.png","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/justified-gallery/jquery.justifiedGallery.min.js","path":"libs/justified-gallery/jquery.justifiedGallery.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/justified-gallery/justifiedGallery.min.css","path":"libs/justified-gallery/justifiedGallery.min.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/styles.css","path":"libs/open-sans/styles.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/source-code-pro/styles.css","path":"libs/source-code-pro/styles.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/css/font-awesome.css","path":"libs/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/css/font-awesome.min.css","path":"libs/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.css","path":"libs/lightgallery/css/lg-fb-comment-box.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.css.map","path":"libs/lightgallery/css/lg-fb-comment-box.css.map","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.min.css","path":"libs/lightgallery/css/lg-fb-comment-box.min.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.min.css","path":"libs/lightgallery/css/lg-transitions.min.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.css.map","path":"libs/lightgallery/css/lg-transitions.css.map","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.css","path":"libs/lightgallery/css/lg-transitions.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.css.map","path":"libs/lightgallery/css/lightgallery.css.map","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.min.css","path":"libs/lightgallery/css/lightgallery.min.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.css","path":"libs/lightgallery/css/lightgallery.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.eot","path":"libs/lightgallery/fonts/lg.eot","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.svg","path":"libs/lightgallery/fonts/lg.svg","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.ttf","path":"libs/lightgallery/fonts/lg.ttf","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.woff","path":"libs/lightgallery/fonts/lg.woff","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/img/loading.gif","path":"libs/lightgallery/img/loading.gif","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/img/video-play.png","path":"libs/lightgallery/img/video-play.png","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/img/vimeo-play.png","path":"libs/lightgallery/img/vimeo-play.png","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/img/youtube-play.png","path":"libs/lightgallery/img/youtube-play.png","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-autoplay.js","path":"libs/lightgallery/js/lg-autoplay.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-autoplay.min.js","path":"libs/lightgallery/js/lg-autoplay.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-fullscreen.js","path":"libs/lightgallery/js/lg-fullscreen.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-fullscreen.min.js","path":"libs/lightgallery/js/lg-fullscreen.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-hash.js","path":"libs/lightgallery/js/lg-hash.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-hash.min.js","path":"libs/lightgallery/js/lg-hash.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-pager.js","path":"libs/lightgallery/js/lg-pager.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-pager.min.js","path":"libs/lightgallery/js/lg-pager.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-share.js","path":"libs/lightgallery/js/lg-share.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-share.min.js","path":"libs/lightgallery/js/lg-share.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-thumbnail.js","path":"libs/lightgallery/js/lg-thumbnail.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-thumbnail.min.js","path":"libs/lightgallery/js/lg-thumbnail.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-video.js","path":"libs/lightgallery/js/lg-video.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-video.min.js","path":"libs/lightgallery/js/lg-video.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-zoom.js","path":"libs/lightgallery/js/lg-zoom.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-zoom.min.js","path":"libs/lightgallery/js/lg-zoom.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lightgallery.js","path":"libs/lightgallery/js/lightgallery.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lightgallery.min.js","path":"libs/lightgallery/js/lightgallery.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/59ZRklaO5bWGqF5A9baEERJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/59ZRklaO5bWGqF5A9baEERJtnKITppOI_IvcXXDNrsc.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/LWCjsQkB6EMdfHrEVqA1KRJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/LWCjsQkB6EMdfHrEVqA1KRJtnKITppOI_IvcXXDNrsc.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNShWV49_lSm1NYrwo-zkhivY.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNShWV49_lSm1NYrwo-zkhivY.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSpX5f-9o1vgP2EXwfjgl7AY.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSpX5f-9o1vgP2EXwfjgl7AY.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSj0LW-43aMEzIO6XUTLjad8.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSj0LW-43aMEzIO6XUTLjad8.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSq-j2U0lmluP9RWlSytm3ho.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSq-j2U0lmluP9RWlSytm3ho.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSqaRobkAwv3vxw3jMhVENGA.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSqaRobkAwv3vxw3jMhVENGA.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSugdm0LZdjqr5-oayXSOefg.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSugdm0LZdjqr5-oayXSOefg.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSv8zf_FOSsgRmwsS7Aa9k2w.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSv8zf_FOSsgRmwsS7Aa9k2w.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/RjgO7rYTmqiVp7vzi-Q5URJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/RjgO7rYTmqiVp7vzi-Q5URJtnKITppOI_IvcXXDNrsc.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/cJZKeOuBrn4kERxqtaUH3VtXRa8TVwTICgirnJhmVJw.woff2","path":"libs/open-sans/fonts/cJZKeOuBrn4kERxqtaUH3VtXRa8TVwTICgirnJhmVJw.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/u-WUoqrET9fUeobQW7jkRRJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/u-WUoqrET9fUeobQW7jkRRJtnKITppOI_IvcXXDNrsc.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBiYE0-AqJ3nfInTTiDXDjU4.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBiYE0-AqJ3nfInTTiDXDjU4.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjTOQ_MqJVwkKsUn0wKzc2I.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjTOQ_MqJVwkKsUn0wKzc2I.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjUj_cnvWIuuBMVgbX098Mw.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjUj_cnvWIuuBMVgbX098Mw.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBkbcKLIaa1LC45dFaAfauRA.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBkbcKLIaa1LC45dFaAfauRA.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBmo_sUJ8uO4YLWRInS22T3Y.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBmo_sUJ8uO4YLWRInS22T3Y.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBo4P5ICox8Kq3LLUNMylGO4.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBo4P5ICox8Kq3LLUNMylGO4.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBr6up8jxqWt8HVA3mDhkV_0.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBr6up8jxqWt8HVA3mDhkV_0.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xozscpT2726on7jbcb_pAhJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/xozscpT2726on7jbcb_pAhJtnKITppOI_IvcXXDNrsc.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasD9V_2ngZ8dMf8fLgjYEouxg.woff2","path":"libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasD9V_2ngZ8dMf8fLgjYEouxg.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasDy2Q8seG17bfDXYR_jUsrzg.woff2","path":"libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasDy2Q8seG17bfDXYR_jUsrzg.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/FontAwesome.otf","path":"libs/font-awesome/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.eot","path":"libs/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.woff","path":"libs/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.woff2","path":"libs/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/jquery/2.1.3/jquery.min.js","path":"libs/jquery/2.1.3/jquery.min.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.ttf","path":"libs/font-awesome/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.svg","path":"libs/font-awesome/fonts/fontawesome-webfont.svg","modified":1,"renderable":1}],"Cache":[{"_id":"themes/icarus/.gitignore","hash":"542aaea07afe90211c6a45c90b7d6879a4503043","modified":1491788469000},{"_id":"themes/icarus/LICENSE","hash":"df00918fa95de563927fd92b26f14c7affdc3052","modified":1491788469000},{"_id":"themes/icarus/README.md","hash":"25c75503f044b817297995a96621c92ce037a098","modified":1491788469000},{"_id":"themes/icarus/_config.yml","hash":"65cd67ca914f08d3a5b0678fa8942fc1cb90a30d","modified":1491967985000},{"_id":"themes/icarus/package.json","hash":"1bc52ef10a33df23e56bd73c927f605019c87d41","modified":1491788469000},{"_id":"source/_posts/androidgoogleplacestutorial.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798580000},{"_id":"source/_posts/boostchatclient.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798683000},{"_id":"source/_posts/boostchatserver.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798699000},{"_id":"source/_posts/imagescrapeversion2.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798564000},{"_id":"source/_posts/javasparkframeworktutorial.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798638000},{"_id":"source/_posts/jekyllblog.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798449000},{"_id":"source/_posts/learningmagentopart1.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798588000},{"_id":"source/_posts/newprojectspage.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798462000},{"_id":"source/_posts/patomicbeta.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798647000},{"_id":"source/_posts/pythonfinance1.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798555000},{"_id":"source/_posts/rubycramprssfeed.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798539000},{"_id":"source/_posts/udpechoinc.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798656000},{"_id":"source/_posts/udpechoincp2.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798672000},{"_id":"source/_posts/writingabookandmisc.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491798572000},{"_id":"source/_posts/androidwatermark.md","hash":"2f3e8aa1ec49018d76f5e1f7c1d09581897c7a1c","modified":1491802193000},{"_id":"source/_posts/boozenet.md","hash":"c30ecbf829d8608d7d36e5e88ccea2cd3cd019a2","modified":1492291590000},{"_id":"source/_posts/buildanapplicationlauncherwithandroid.md","hash":"43945e6b9c929c61bc350724b8fbace8a5e7dc83","modified":1492287786000},{"_id":"source/_posts/imagescrapeversion1.md","hash":"98380f2ae29f45c2cbe42aa6a222cb15c3133453","modified":1492287924000},{"_id":"source/_posts/guestdialer.md","hash":"549f46e26bc2e8bf16074438c93d9a41416d5908","modified":1492231832000},{"_id":"source/_posts/qalite.md","hash":"66c0641238582e9c425d7e5c7e953cabb24032b3","modified":1492292819000},{"_id":"source/_posts/rubyonrailsblogdemo.md","hash":"e4ba5f000116b643ec632d6fb25e74a88cfaa0f7","modified":1491987468000},{"_id":"source/_posts/textbasedrpgpart1.md","hash":"d016766114b86359ba963f27deeabf615c105ad1","modified":1491896348000},{"_id":"source/_posts/textbasedrpgpart2.md","hash":"3fef052e0eb2e9032c89878603be22b185c10620","modified":1491967494000},{"_id":"source/_posts/textbasedrpgpart3.md","hash":"a3f30c4c9b6dfde550f673805a7cae72f41c42de","modified":1492150717000},{"_id":"source/_posts/textbasedrpgpart4.md","hash":"25d503f8a51db11b091f08a8a859a1a764e35def","modified":1492150735000},{"_id":"source/_posts/textbasedrpgpart5.md","hash":"b5baa1d0c6c002fbe46add46ede863e5c13a6345","modified":1492148249000},{"_id":"source/_posts/textbasedrpgpart6.md","hash":"601e0bb0967b9b73aaff944f6093227c915903a7","modified":1492149643000},{"_id":"source/_posts/textbasedrpgpart7.md","hash":"01d7a835fedf00a5bdcc32681a4363e04e27a616","modified":1492150612000},{"_id":"themes/icarus/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1491788469000},{"_id":"themes/icarus/.git/config","hash":"fde0e7c381af5e1c6f07bf907a573f47cbc6a661","modified":1491788469000},{"_id":"themes/icarus/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1491788465000},{"_id":"themes/icarus/.git/index","hash":"21f2f1e23f31ec6d55689805f61ed49815e97d6c","modified":1491788622000},{"_id":"themes/icarus/.git/packed-refs","hash":"afd7a36dcb04bce77e5741908274aebc2297501c","modified":1491788469000},{"_id":"themes/icarus/.github/ISSUE_TEMPLATE.md","hash":"9393fd3dbc943f1544facb66af7fd8b7a5b9ddbb","modified":1491788469000},{"_id":"themes/icarus/languages/en.yml","hash":"ade241498b85503a8953a1deca963222f47067a7","modified":1491788469000},{"_id":"themes/icarus/languages/es.yml","hash":"d7432219be5bee4cb569331378ade61b749688e0","modified":1491788469000},{"_id":"themes/icarus/languages/fr.yml","hash":"cb3e597cbec7e8f458858c457bafd1f3a225083d","modified":1491788469000},{"_id":"themes/icarus/languages/id.yml","hash":"70ec9ab2ac04cf882e81377ca5ad15bf8adceca8","modified":1491788469000},{"_id":"themes/icarus/languages/ja.yml","hash":"ff972961e5f468a695d80d21b62c3e9032cdf561","modified":1491788469000},{"_id":"themes/icarus/languages/ko.yml","hash":"7c4ad4577dc0577ad2ca1c0410507f5e5fadf530","modified":1491788469000},{"_id":"themes/icarus/languages/pt-BR.yml","hash":"3c5d5293575593705b9a2dfa9d97b017eb4bc8c3","modified":1491788469000},{"_id":"themes/icarus/languages/ru.yml","hash":"d1aab2b0c939d0c6020f881d664b660a01ee7327","modified":1491788469000},{"_id":"themes/icarus/languages/tr.yml","hash":"8b7eb6aec264db50dbabea89f680acca256f4cd1","modified":1491788469000},{"_id":"themes/icarus/languages/zh-CN.yml","hash":"3dc8ec524805afd090438be717908750da439204","modified":1491788469000},{"_id":"themes/icarus/languages/zh-TW.yml","hash":"d8d96a0a17c20af11919ce036e87379a6b163db9","modified":1491788469000},{"_id":"themes/icarus/layout/archive.ejs","hash":"c1ecf667f40f34d61ab33eed46bab143eb1af36d","modified":1491788469000},{"_id":"themes/icarus/layout/categories.ejs","hash":"aa95629b770cff8cca9d663aeb6b17928f070de5","modified":1491788469000},{"_id":"themes/icarus/layout/category.ejs","hash":"1d407f9176db84e83062c52ad4755aaea9e74401","modified":1491788469000},{"_id":"themes/icarus/layout/index.ejs","hash":"43e971ebc35657b18e08a049559790348a16666f","modified":1491788469000},{"_id":"themes/icarus/layout/layout.ejs","hash":"6f01b3d46d184a820297f9542497808b152bb09e","modified":1491788469000},{"_id":"themes/icarus/layout/page.ejs","hash":"50170783bac99946ae8af483920568de9b2d9801","modified":1491788469000},{"_id":"themes/icarus/layout/post.ejs","hash":"50170783bac99946ae8af483920568de9b2d9801","modified":1491788469000},{"_id":"themes/icarus/layout/tag.ejs","hash":"f6c220d4e5c231028bc71ddc11aec97d7b5a9943","modified":1491788469000},{"_id":"themes/icarus/layout/tags.ejs","hash":"b0fcea68d7c11e5899bf0375d80997685111653f","modified":1491788469000},{"_id":"themes/icarus/scripts/meta.js","hash":"1993754a2f3dffa283fa0538eb8f056385b69ad4","modified":1491788469000},{"_id":"themes/icarus/scripts/thumbnail.js","hash":"e667a611f9baac270281b765832020d50bf8fb7f","modified":1491788469000},{"_id":"themes/icarus/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1491788465000},{"_id":"themes/icarus/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1491788465000},{"_id":"themes/icarus/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1491788465000},{"_id":"themes/icarus/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1491788465000},{"_id":"themes/icarus/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1491788465000},{"_id":"themes/icarus/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1491788465000},{"_id":"themes/icarus/.git/hooks/pre-rebase.sample","hash":"5885a56ab4fca8075a05a562d005e922cde9853b","modified":1491788465000},{"_id":"themes/icarus/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1491788465000},{"_id":"themes/icarus/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1491788465000},{"_id":"themes/icarus/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1491788465000},{"_id":"themes/icarus/.git/logs/HEAD","hash":"9f53793e1a258bd7a8d84fa08f0188a513530c87","modified":1491788469000},{"_id":"themes/icarus/_source/about/index.md","hash":"2847759c65295fdc47685cc32e10ae30b2f022ae","modified":1491788469000},{"_id":"themes/icarus/_source/categories/index.md","hash":"55bee2cb88da438a2e8b1f29b1d7e954c07a9e60","modified":1491788469000},{"_id":"themes/icarus/_source/tags/index.md","hash":"e999413d6392c34156b5c6e9273f9069f9e6d92d","modified":1491788469000},{"_id":"themes/icarus/layout/comment/counter.ejs","hash":"59abd552086c26cb0a6fd86d18ce380c3b1b3c55","modified":1491788469000},{"_id":"themes/icarus/layout/comment/disqus.ejs","hash":"1b32a90f400dc580f4b8298de75b94429ca6de68","modified":1491788469000},{"_id":"themes/icarus/layout/comment/duoshuo.ejs","hash":"ce46d7410a99b57704da32e9d09071cef6c9fa93","modified":1491788469000},{"_id":"themes/icarus/layout/comment/facebook.ejs","hash":"5ee16430a4435c2fead0275ff83fc98092d73d4c","modified":1491788469000},{"_id":"themes/icarus/layout/comment/index.ejs","hash":"0913444317759c3ff0588ca3aa4a6a89b6595307","modified":1491788469000},{"_id":"themes/icarus/layout/comment/isso.ejs","hash":"4f8b81ff5bb418ec11ce080d515f247bfe436014","modified":1491788469000},{"_id":"themes/icarus/layout/comment/scripts.ejs","hash":"305aa07646ab03e00d8239a811f4ec6f75751e1e","modified":1491788469000},{"_id":"themes/icarus/layout/comment/youyan.ejs","hash":"6fe807992832939caf6c3e7651d052df9520d88e","modified":1491788469000},{"_id":"themes/icarus/layout/common/article.ejs","hash":"9c260a551596f71e93177f2289b5cb1c4bc7d96c","modified":1491788469000},{"_id":"themes/icarus/layout/common/footer.ejs","hash":"cbfe560fcab445d42ceeb5d1beba5957d5be5eaa","modified":1491788469000},{"_id":"themes/icarus/layout/common/head.ejs","hash":"44f30945882afd27c89da2173da501fb1b531488","modified":1491788469000},{"_id":"themes/icarus/layout/common/header.ejs","hash":"738c6a923b2a6de6a81c4892c8a47e03d8b34f88","modified":1491788469000},{"_id":"themes/icarus/layout/common/profile.ejs","hash":"0d5a9622d490652599e3ba3e4077a7d6bb2eb38e","modified":1491788469000},{"_id":"themes/icarus/layout/common/scripts.ejs","hash":"c0a1a9e53f89440c42c325d5bd8c7234652c8937","modified":1491788469000},{"_id":"themes/icarus/layout/common/sidebar.ejs","hash":"6e80fa52d23c9c39bfa357a1e00c26fc8b851b82","modified":1491788469000},{"_id":"themes/icarus/layout/common/thumbnail.ejs","hash":"1b70f8a98cd8650b159bda858dbee38dbdb7f0c5","modified":1491788469000},{"_id":"themes/icarus/layout/common/timeline.ejs","hash":"6420e34e0332c9b6670011519f341340db989343","modified":1491788469000},{"_id":"themes/icarus/layout/plugin/baidu-analytics.ejs","hash":"6a7bee18e666e627e62541a5e30906f87ba1bfe8","modified":1491788469000},{"_id":"themes/icarus/layout/plugin/google-analytics.ejs","hash":"349f08b6521a16e79046b1f94f04317ac74f556e","modified":1491788469000},{"_id":"themes/icarus/layout/plugin/scripts.ejs","hash":"b349c7089a44302eaa8291c0ed13ef815f868a68","modified":1491788469000},{"_id":"themes/icarus/layout/search/baidu.ejs","hash":"3e603a702d20c53fd3bcbeb570a16a86d54781ce","modified":1491788469000},{"_id":"themes/icarus/layout/search/index-mobile.ejs","hash":"50a727ac1dfe3073eb6fa6699ba01e66f4ac41c0","modified":1491788469000},{"_id":"themes/icarus/layout/search/index.ejs","hash":"24935e32e61d4706454b174ea3bed0726ae7fb34","modified":1491788469000},{"_id":"themes/icarus/layout/search/insight.ejs","hash":"130fe3d33ac71da0b50f7fee6a87979f30938a1b","modified":1491788469000},{"_id":"themes/icarus/layout/search/swiftype.ejs","hash":"379e66d2c13526e72e4120c443f95fccf4edef71","modified":1491788469000},{"_id":"themes/icarus/layout/share/addtoany.ejs","hash":"ac180c4c84b73a04d61b17e7dc18c257e20bf59f","modified":1491788469000},{"_id":"themes/icarus/layout/share/bdshare.ejs","hash":"a1e772c5a6f174d585b0c1e574058f75dc8e2898","modified":1491788469000},{"_id":"themes/icarus/layout/share/default.ejs","hash":"ebfb919dc525b3ed61a6a5ee05ee71410eedc541","modified":1491788469000},{"_id":"themes/icarus/layout/share/index.ejs","hash":"2a2c0095b95b11e5692bd8ad6a2337aa644189a2","modified":1491788469000},{"_id":"themes/icarus/layout/share/jiathis.ejs","hash":"21ebaa51e828cba2cefbeeaccb01514643565755","modified":1491788469000},{"_id":"themes/icarus/layout/widget/archive.ejs","hash":"d9ebbb7f6ce2f25df5ae25e4a1fef3c08f7054b9","modified":1491788469000},{"_id":"themes/icarus/layout/widget/category.ejs","hash":"583bda80cf15b3ef11fefbd1b502897dfff40100","modified":1491788469000},{"_id":"themes/icarus/layout/widget/links.ejs","hash":"aad118699718b62c0d3f3cfd6f17a181139a76af","modified":1491788469000},{"_id":"themes/icarus/layout/widget/recent_posts.ejs","hash":"2ca923465275fb38a7ac7d67211d6e94a977e957","modified":1491788469000},{"_id":"themes/icarus/layout/widget/tag.ejs","hash":"3b8ae5953990436893da9d68f910ebe592005659","modified":1491788469000},{"_id":"themes/icarus/layout/widget/tagcloud.ejs","hash":"ca8c7bf555fb6ce4904f2c59160548405c2c8a82","modified":1491788469000},{"_id":"themes/icarus/source/css/_extend.styl","hash":"539e02107f35e8b3bdb9bf160dc212a433a7b60e","modified":1491788469000},{"_id":"themes/icarus/source/css/_variables.styl","hash":"d62af931be6612ec8c3a917836379a8cd92fbce1","modified":1491788469000},{"_id":"themes/icarus/source/css/style.styl","hash":"1716b199dba80b26086f325d69c36fa682465106","modified":1491788469000},{"_id":"themes/icarus/source/js/insight.js","hash":"6ee84c42c2b230ff9e9bf605a444bd671d44f9e3","modified":1491788469000},{"_id":"themes/icarus/source/js/main.js","hash":"93dc932946e2898bf4f39c42af1b27295e886af1","modified":1491788469000},{"_id":"themes/icarus/.git/objects/pack/pack-41016734246655e2b6d642b68b318ddbca05950d.idx","hash":"d964e3414ddef4f0facff0f0e0a25c46590301dc","modified":1491788469000},{"_id":"themes/icarus/.git/refs/heads/master","hash":"8cb36ed5379ce7ea17d93fa1677f95e96ecd7243","modified":1491788469000},{"_id":"themes/icarus/layout/common/post/banner.ejs","hash":"47ced3f03525698c79c6b1c07b48383fb6c496b2","modified":1491788469000},{"_id":"themes/icarus/layout/common/post/category.ejs","hash":"75c9dda2e7ec041943855ca163a6b1c4c8b4f260","modified":1491788469000},{"_id":"themes/icarus/layout/common/post/date.ejs","hash":"45cb0bcad461036cdd1fe2e3fbb5f2f19940025c","modified":1491788469000},{"_id":"themes/icarus/layout/common/post/gallery.ejs","hash":"659f019761116313169148ec61773e7b84abb739","modified":1491788469000},{"_id":"themes/icarus/layout/common/post/nav.ejs","hash":"d7cd611e642327f33dff3963ef869c2b46824a11","modified":1491788469000},{"_id":"themes/icarus/layout/common/post/tag.ejs","hash":"2e966216256321aa0c76fe1b9be689601c76ef31","modified":1491788469000},{"_id":"themes/icarus/layout/common/post/title.ejs","hash":"669ddb46fefa100856588351a7a2d30ad996b755","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/agate.styl","hash":"601eb70448a16b918df132f6fc41e891ae053653","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/androidstudio.styl","hash":"65d09f1b0e81c6a182f549fd3de51e59823c97ae","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/arduino-light.styl","hash":"15e8572585cd708221c513dea4bdd89d8fe56c10","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/arta.styl","hash":"1a5accc115f41d1b669ed708ac6a29abac876599","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/ascetic.styl","hash":"32cff3bef6fac3760fe78f203096477052a90552","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-cave-dark.styl","hash":"bc647b2c1d971d7cc947aa1ed66e9fd115261921","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-cave-light.styl","hash":"a5be0744a7ecf4a08f600ade4cfd555afc67bc15","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-dune-dark.styl","hash":"df50a85a4b14c7ca6e825d665594b91229d0e460","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-dune-light.styl","hash":"931435fbc6f974e8ce9e32722680035d248a9dc1","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-estuary-dark.styl","hash":"d84382bc8298f96730757391d3e761b7e640f406","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-estuary-light.styl","hash":"344276ca9b27e51d4c907f76afe5d13cf8e60bdf","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-forest-dark.styl","hash":"57c154c6045a038dc7df0a25927853e10bf48c4a","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-forest-light.styl","hash":"95228d9f2102fad425536aac44b80b2cba1f5950","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-heath-dark.styl","hash":"b0cf13b2233e7bc38342032d2d7296591a4c2bcf","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-heath-light.styl","hash":"8c8c2e445abef85273be966d59770e9ced6aac21","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-lakeside-dark.styl","hash":"bb0a8c4ad0dd8e3e7de7122ddf268fc42aa94acb","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-lakeside-light.styl","hash":"2c54cb9bdb259ae3b5b29f63ac2469ed34b08578","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-plateau-dark.styl","hash":"09c64f1a7052aec9070c36c0431df25216afaea1","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-plateau-light.styl","hash":"d1a05fdd1ededc9063d181ab25bad55a164aeb4a","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-savanna-dark.styl","hash":"a16c919a1ccf2f845488078fb341381bec46b1f3","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-savanna-light.styl","hash":"f8244c93711c7cb59dd79d2df966806b30d171ea","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-seaside-dark.styl","hash":"ce233a101daea7124cbfcd34add43ccfe2e1e1c7","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-seaside-light.styl","hash":"0597342da6e2d0c5bdcc7d42dabb07322b1a4177","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-sulphurpool-dark.styl","hash":"414b0cfc142f70afe359c16450b651e28bf7325a","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/atelier-sulphurpool-light.styl","hash":"efa52713efc468abeeb2b9299704371583b857de","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/brown-paper.styl","hash":"c2326ba20a5020a66ca7895258d18833327d4334","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/brown-papersq.png","hash":"3a1332ede3a75a3d24f60b6ed69035b72da5e182","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/codepen-embed.styl","hash":"f4dcc84d8e39f9831a5efe80e51923fc3054feb0","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/color-brewer.styl","hash":"2a439d6214430e2f45dd4939b4dfe1fe1a20aa0f","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/dark.styl","hash":"71ce56d311cc2f3a605f6e2c495ccd7236878404","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/darkula.styl","hash":"ad0d5728d21645039c9f199e7a56814170ed3bab","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/docco.styl","hash":"b1c176378bb275f2e8caa759f36294e42d614bf1","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/far.styl","hash":"d9928010ffe71e80b97a5afcba1a4975efdd7372","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/foundation.styl","hash":"bf8ddc94b4ad995b8b8805b5a4cf95004553fdac","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/github-gist.styl","hash":"48211a03d33e7f7ada0b261162bea06676155a71","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/github.styl","hash":"3336aeba324c6d34a6fd41fef9b47bc598f7064c","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/googlecode.styl","hash":"bda816beee7b439814b514e6869dc678822be1bc","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/grayscale.styl","hash":"bf37d8b8d1e602126c51526f0cc28807440228ed","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/highlightjs.styl","hash":"0e198b7a59191c7a39b641a4ddd22c948edb9358","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/hopscotch.styl","hash":"b374c6550b89b4751aedc8fbc3cf98d95bd70ead","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/hybrid.styl","hash":"ea8d7ddc258b073308746385f5cb85aabb8bfb83","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/idea.styl","hash":"a02967cb51c16a34e0ee895d33ded2b823d35b21","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/index.styl","hash":"002d5596f6379cc87dbd43d9145bc764aa666be1","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/ir-black.styl","hash":"693078bbd72a2091ed30f506cc55949600b717af","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/kimbie.dark.styl","hash":"45dbb168f22d739d0109745d2decd66b5f94e786","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/kimbie.light.styl","hash":"61f8baed25be05288c8604d5070afbcd9f183f49","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/magula.styl","hash":"16d323f989b1420a0f72ef989242ece9bf17a456","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/mono-blue.styl","hash":"4c89a6ae29de67c0700585af82a60607e85df928","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/monokai-sublime.styl","hash":"25aa2fc1dbe38593e7c7ebe525438a39574d9935","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/monokai.styl","hash":"5a4fe9f957fd7a368c21b62a818403db4270452f","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/obsidian.styl","hash":"55572bbcfee1de6c31ac54681bb00336f5ae826d","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/paraiso-dark.styl","hash":"f1537bd868579fa018ecdbfd2eb922dcf3ba2cac","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/paraiso-light.styl","hash":"d224d1df0eb3395d9eea1344cee945c228af2911","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/pojoaque.jpg","hash":"c5fe6533b88b21f8d90d3d03954c6b29baa67791","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/pojoaque.styl","hash":"77dae9dc41945359d17fe84dbd317f1b40b2ee33","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/railscasts.styl","hash":"acd620f8bb7ff0e3fe5f9a22b4433ceef93a05e6","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/rainbow.styl","hash":"ce73b858fc0aba0e57ef9fb136c083082746bc1d","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/school-book.png","hash":"711ec983c874e093bb89eb77afcbdf6741fa61ee","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/school-book.styl","hash":"d43560fe519a931ce6da7d57416d7aa148441b83","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/solarized-dark.styl","hash":"702b9299a48c90124e3ac1d45f1591042f2beccc","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/solarized-light.styl","hash":"aa0dd3fd25c464183b59c5575c9bee8756b397f2","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/sunburst.styl","hash":"a0b5b5129547a23865d400cfa562ea0ac1ee3958","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/tomorrow-night-blue.styl","hash":"8b3087d4422be6eb800935a22eb11e035341c4ba","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/tomorrow-night-bright.styl","hash":"0ac6af6ecb446b5b60d6226748e4a6532db34f57","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/tomorrow-night-eighties.styl","hash":"fa57b3bb7857a160fc856dbe319b31e30cc5d771","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/tomorrow-night.styl","hash":"19b3080d4b066b40d50d7e7f297472482b5801fd","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/tomorrow.styl","hash":"15779cf6846725c7c35fc56cac39047d7e0aec1c","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/vs.styl","hash":"959a746f4b37aacb5d1d6ff1d57e0c045289d75d","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/xcode.styl","hash":"5e8532ae8366dcf6a4ef5e4813dc3d42ab3d0a50","modified":1491788469000},{"_id":"themes/icarus/source/css/_highlight/zenburn.styl","hash":"fc5ec840435dad80964d04519d3f882ddc03746a","modified":1491788469000},{"_id":"themes/icarus/source/css/_partial/archive.styl","hash":"d35088c83ddd7a197d6d94e16a2ce3a7e29fa1dc","modified":1491788469000},{"_id":"themes/icarus/source/css/_partial/article.styl","hash":"512b9252e1799b93a17c4ad847b0586814a030b4","modified":1491788469000},{"_id":"themes/icarus/source/css/_partial/comment.styl","hash":"784646796184d4f27918c22395288a2fafbf9554","modified":1491788469000},{"_id":"themes/icarus/source/css/_partial/footer.styl","hash":"484776654e4c1691dc844e6e93786a08855c1c99","modified":1491788469000},{"_id":"themes/icarus/source/css/_partial/header.styl","hash":"1e351f741144135871a3373fe7e969dc961b65e7","modified":1491788469000},{"_id":"themes/icarus/source/css/_partial/insight.styl","hash":"19833cd127f26ad90b06c115f8a96a30e0c0e53b","modified":1491788469000},{"_id":"themes/icarus/source/css/_partial/profile.styl","hash":"fb0170075dc2a41e01dd11bbfdbccbed544c479a","modified":1491788469000},{"_id":"themes/icarus/source/css/_partial/sidebar.styl","hash":"f528ca7064d9fcecd737b9b71c9c54601365d7d3","modified":1491788469000},{"_id":"themes/icarus/source/css/_partial/timeline.styl","hash":"c813b98f4fc45b64d2e07e5d944745a654c8c943","modified":1491788469000},{"_id":"themes/icarus/source/css/_util/grid.styl","hash":"93fb6f1e2f40cd7d88ad0d56dd73d3f9a7bc853e","modified":1491788469000},{"_id":"themes/icarus/source/css/_util/mixin.styl","hash":"c8e1ddfc0fe9108bab592c7a73b73ce9344991fd","modified":1491788469000},{"_id":"themes/icarus/source/css/images/avatar.png","hash":"0d8236dcca871735500e9d06bbdbe0853ed6775b","modified":1491788469000},{"_id":"themes/icarus/source/css/images/logo.png","hash":"e606a0584f98268b2fe92303f3254520862ef659","modified":1491788469000},{"_id":"themes/icarus/source/css/images/thumb-default-small.png","hash":"e8403b97ed9251f9f5207765b0ce796c5000b4ba","modified":1491788469000},{"_id":"themes/icarus/source/libs/justified-gallery/jquery.justifiedGallery.min.js","hash":"b2683e7a872bc109b1756a65188a37cef7d0bd5c","modified":1491788469000},{"_id":"themes/icarus/source/libs/justified-gallery/justifiedGallery.min.css","hash":"13fbcba5e97aa88b748d94d3efc4718475279907","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/styles.css","hash":"5ca6e111046232bde112d33201a60532aee7d3c4","modified":1491788469000},{"_id":"themes/icarus/source/libs/source-code-pro/styles.css","hash":"93c308012738728f906cd4c5cfdb34189e0c712b","modified":1491788469000},{"_id":"themes/icarus/.git/logs/refs/heads/master","hash":"9f53793e1a258bd7a8d84fa08f0188a513530c87","modified":1491788469000},{"_id":"themes/icarus/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1491788469000},{"_id":"themes/icarus/source/libs/font-awesome/css/font-awesome.css","hash":"b5020c3860669185ba3f316fa7332cdf5c06f393","modified":1491788469000},{"_id":"themes/icarus/source/libs/font-awesome/css/font-awesome.min.css","hash":"7cd5a3384333f95c3d37d9488ad82cd6c4b03761","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.css","hash":"844ce27b8488968bccb3e50bb49184ba2aae0625","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.css.map","hash":"51e9df39edf0faa3f38c1bab0c1fa6c922b9edcb","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.min.css","hash":"05830fadb8454f39dcc98c8686eb4d5c24b71fc0","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.min.css","hash":"5c22e2073a4c96d6212c72135391b599e8d1359f","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.css.map","hash":"50c3348638b4d82fa08a449c690e8d2bb593005d","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.css","hash":"7871c28498d74451d6aa438c8d3a1817810a1e19","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.css.map","hash":"3175b4107078674d25798979f7666f4daf31e624","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.min.css","hash":"c9a2e19c932b56f4a2ce30c98910d10b74edb38a","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.css","hash":"bef55316a32e512d5a8940e5d0bfe8bf7a9c5c61","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.eot","hash":"54caf05a81e33d7bf04f2e420736ce6f1de5f936","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.svg","hash":"9a732790adc004b22022cc60fd5f77ec4c8e3e5a","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.ttf","hash":"f6421c0c397311ae09f9257aa58bcd5e9720f493","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.woff","hash":"3048de344dd5cad4624e0127e58eaae4b576f574","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/img/loading.gif","hash":"607810444094b8619fa4efa6273bc2a7e38dd4b4","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/img/video-play.png","hash":"3ea484cdc04d2e4547f80cbf80001dcf248c94ef","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/img/vimeo-play.png","hash":"6190254f2804904a4a1fa1eb390dfd334e416992","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/img/youtube-play.png","hash":"fea6df9d9d43151f9c9d15f000adb30eb3e26fc4","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-autoplay.js","hash":"426bb78b93acfc39d533ea2bab1cec8dc289cf24","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-autoplay.min.js","hash":"d845741bcaf961579622880eb2a445257efad1ac","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-fullscreen.js","hash":"65c47ac65362854ba44b00a010bb01e3630209d8","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-fullscreen.min.js","hash":"b6b9e4022700b7faf2a5a175ba44a3bd938fdd20","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-hash.js","hash":"15d16516c5642d3de1566ff8fc9160136ccaa405","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-hash.min.js","hash":"43f1e1e720ab0e241c19b83aa26bd6848eab8edc","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-pager.js","hash":"8092c692b244bb26343eb03b91bd97deb9dafc9c","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-pager.min.js","hash":"25caa6ff65b1c6dee09941e795ae2633bdbab211","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-share.js","hash":"b7fb5f6474911060a351b0a6fe9dbb9ac3fb22aa","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-share.min.js","hash":"39c615f07c5d3aaa65a2c3068a30fdd6dd5c372d","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-thumbnail.js","hash":"3a6476b6df1d2bef4a21861a78776282a7a11ef1","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-thumbnail.min.js","hash":"18dd7d2909d1bfd6852f031d03e774b4428c512b","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-video.js","hash":"4f99b598f6bb18de9eca8c45c5b4373a03962367","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-video.min.js","hash":"032c001ab045a69856f9c3ed4a2a3bf12a8e310f","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-zoom.js","hash":"a758e2c8fcf710f9ff761da0eea0ab9321f3484d","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-zoom.min.js","hash":"15b49f9728439819ece15e4295cce254c87a4f45","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lightgallery.js","hash":"3cd19b33ba99efd5ba1d167da91720566d274b2c","modified":1491788469000},{"_id":"themes/icarus/source/libs/lightgallery/js/lightgallery.min.js","hash":"956ef9b706755318da69ad0b5d7786339d831251","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/59ZRklaO5bWGqF5A9baEERJtnKITppOI_IvcXXDNrsc.woff2","hash":"c4248ea800bd5608344ce163f5658b57e7ef9410","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2","hash":"e0350190d720a8fec0557ab47b318ec4e4486448","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/LWCjsQkB6EMdfHrEVqA1KRJtnKITppOI_IvcXXDNrsc.woff2","hash":"2c5b039b57f62625e88226a938679ec937431ad1","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNShWV49_lSm1NYrwo-zkhivY.woff2","hash":"22413bb8bfb78608c1e25aa1ed5c1f38557df79f","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSpX5f-9o1vgP2EXwfjgl7AY.woff2","hash":"328a22fe3eec71ad9e5ece4d67dd62e79dab6b7f","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSj0LW-43aMEzIO6XUTLjad8.woff2","hash":"63eb74ef040aade256f2274a7f31a914edddb0ea","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSq-j2U0lmluP9RWlSytm3ho.woff2","hash":"4dc6d7174ea6d89f4c45e43e1bfc3e03d8ffebaf","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSqaRobkAwv3vxw3jMhVENGA.woff2","hash":"415eee05976ab8b2471602a5ddb78a6c58fc21aa","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSugdm0LZdjqr5-oayXSOefg.woff2","hash":"a0b0c389cf46d63c850e61fed572485ff0b68183","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSv8zf_FOSsgRmwsS7Aa9k2w.woff2","hash":"c5f29fed6632efe0aa83318369f0d8c4061b775b","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/RjgO7rYTmqiVp7vzi-Q5URJtnKITppOI_IvcXXDNrsc.woff2","hash":"be201d32a9aa5d186723ebb3c538be691aa8c53a","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/cJZKeOuBrn4kERxqtaUH3VtXRa8TVwTICgirnJhmVJw.woff2","hash":"afc44700053c9a28f9ab26f6aec4862ac1d0795d","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/u-WUoqrET9fUeobQW7jkRRJtnKITppOI_IvcXXDNrsc.woff2","hash":"113978181dcac77baecef6115a9121d8f6e4fc3a","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBiYE0-AqJ3nfInTTiDXDjU4.woff2","hash":"5067c81462c15422853c94d21a1726865a61634f","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjTOQ_MqJVwkKsUn0wKzc2I.woff2","hash":"b366f2fda2e524eb5ef50058eefff249a3b96e6c","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjUj_cnvWIuuBMVgbX098Mw.woff2","hash":"d22904914469be735490e3c8cb093c7862896dd5","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBkbcKLIaa1LC45dFaAfauRA.woff2","hash":"ae80fb3cd16339aa7b5da280ab53975523dcaac2","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBmo_sUJ8uO4YLWRInS22T3Y.woff2","hash":"b85efde42fa3a03c32b1d31c6cd74c622fc7916c","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBo4P5ICox8Kq3LLUNMylGO4.woff2","hash":"e75607ba1417181397c700775b84303d5a2957b9","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBr6up8jxqWt8HVA3mDhkV_0.woff2","hash":"d0b40a7848703556c6631f24e961a98ca5829255","modified":1491788469000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xozscpT2726on7jbcb_pAhJtnKITppOI_IvcXXDNrsc.woff2","hash":"be365eca44760ce3fc9b377c43d4634958479c69","modified":1491788469000},{"_id":"themes/icarus/source/libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasD9V_2ngZ8dMf8fLgjYEouxg.woff2","hash":"942addaec4d3a60af33947a84a3d85f926015947","modified":1491788469000},{"_id":"themes/icarus/source/libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasDy2Q8seG17bfDXYR_jUsrzg.woff2","hash":"b0e0bb5ef78db8b15d430d0b9be9d4329289a310","modified":1491788469000},{"_id":"themes/icarus/source/libs/font-awesome/fonts/FontAwesome.otf","hash":"1b22f17fdc38070de50e6d1ab3a32da71aa2d819","modified":1491788469000},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.eot","hash":"965ce8f688fedbeed504efd498bc9c1622d12362","modified":1491788469000},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.woff","hash":"6d7e6a5fc802b13694d8820fc0138037c0977d2e","modified":1491788469000},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.woff2","hash":"97e438cc545714309882fbceadbf344fcaddcec5","modified":1491788469000},{"_id":"themes/icarus/source/libs/jquery/2.1.3/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1491788469000},{"_id":"themes/icarus/.git/logs/refs/remotes/origin/HEAD","hash":"9f53793e1a258bd7a8d84fa08f0188a513530c87","modified":1491788469000},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.ttf","hash":"61d8d967807ef12598d81582fa95b9f600c3ee01","modified":1491788469000},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.svg","hash":"c0522272bbaef2acb3d341912754d6ea2d0ecfc0","modified":1491788469000},{"_id":"themes/icarus/.git/objects/pack/pack-41016734246655e2b6d642b68b318ddbca05950d.pack","hash":"f0ca0d69454004623dce3a5989433dff02f3bce0","modified":1491788469000}],"Category":[{"name":"tutorial","_id":"cj1jsmr1p000j9uwvzscr59tq"},{"name":"ruby-on-rails","_id":"cj1jsmr23000t9uwv8aqln5zn"}],"Data":[],"Page":[],"Post":[{"_content":"","source":"_posts/androidgoogleplacestutorial.md","raw":"","slug":"androidgoogleplacestutorial","published":1,"date":"2017-04-10T04:29:40.000Z","updated":"2017-04-10T04:29:40.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqyu00009uwvnl98fkkc","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/boostchatclient.md","raw":"","slug":"boostchatclient","published":1,"date":"2017-04-10T04:31:23.000Z","updated":"2017-04-10T04:31:23.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqz000019uwvv8vydicv","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/boostchatserver.md","raw":"","slug":"boostchatserver","published":1,"date":"2017-04-10T04:31:39.000Z","updated":"2017-04-10T04:31:39.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqz300029uwvjj6rrfjl","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/imagescrapeversion2.md","raw":"","slug":"imagescrapeversion2","published":1,"date":"2017-04-10T04:29:24.000Z","updated":"2017-04-10T04:29:24.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqz600039uwvy5hd2f7a","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/javasparkframeworktutorial.md","raw":"","slug":"javasparkframeworktutorial","published":1,"date":"2017-04-10T04:30:38.000Z","updated":"2017-04-10T04:30:38.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqz800049uwvrcume58a","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/jekyllblog.md","raw":"","slug":"jekyllblog","published":1,"date":"2017-04-10T04:27:29.000Z","updated":"2017-04-10T04:27:29.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqza00059uwvtybxak9v","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/learningmagentopart1.md","raw":"","slug":"learningmagentopart1","published":1,"date":"2017-04-10T04:29:48.000Z","updated":"2017-04-10T04:29:48.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqze00069uwv2hzalgne","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/newprojectspage.md","raw":"","slug":"newprojectspage","published":1,"date":"2017-04-10T04:27:42.000Z","updated":"2017-04-10T04:27:42.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqzg00079uwv54y11gds","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/patomicbeta.md","raw":"","slug":"patomicbeta","published":1,"date":"2017-04-10T04:30:47.000Z","updated":"2017-04-10T04:30:47.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqzl00089uwv2e12cs7q","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/pythonfinance1.md","raw":"","slug":"pythonfinance1","published":1,"date":"2017-04-10T04:29:15.000Z","updated":"2017-04-10T04:29:15.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqzn00099uwvmzscstmh","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/rubycramprssfeed.md","raw":"","slug":"rubycramprssfeed","published":1,"date":"2017-04-10T04:28:59.000Z","updated":"2017-04-10T04:28:59.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqzp000a9uwv6xtyt5uv","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/udpechoinc.md","raw":"","slug":"udpechoinc","published":1,"date":"2017-04-10T04:30:56.000Z","updated":"2017-04-10T04:30:56.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqzq000b9uwv1n8s48d1","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/udpechoincp2.md","raw":"","slug":"udpechoincp2","published":1,"date":"2017-04-10T04:31:12.000Z","updated":"2017-04-10T04:31:12.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqzu000c9uwvyq8nwls0","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"","source":"_posts/writingabookandmisc.md","raw":"","slug":"writingabookandmisc","published":1,"date":"2017-04-10T04:29:32.000Z","updated":"2017-04-10T04:29:32.000Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmqzx000d9uwvb02y59zw","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"My Experience Publishing My First Android App, Six Things I Learned","date":"2011-06-04T07:00:00.000Z","_content":"Here are some of the things I learned about developing for the [Android][link_android_dev_home] platform from publishing my first app which I hope will useful to others who want to but haven’t started developing for the Android platform.\n\nIts currently in the free beta mode(with ads) right now as I plan on adding more features later such as the ability to design/store your own logos as preferences and an actual user interface that uses the [action bar design pattern][link_android_dev_actionbar] which is so popular nowadays.\n\n### 1) Not knowing Java is not an excuse. \n\nIf you don’t know any Java but you’re proficient in a C-based or C-styled syntax programming language such as C#, C++, PHP  and or any others then you can easily absorb Java as you browse Android tutorials, read Android dev books and begin to poke around with the Android API. I myself only knew C++ but developing for the Android platform quickly allowed me to dive into Java and learn the fundamentals of such things as proper exception handling(ok I admit that I do use exceptions in C++ but I tend to use my own exception class rather than the standard library one); how garbage collected languages differ from non garbage collected ones, the [Eclipse IDE][link_eclipse_ide], the difference between classes and interfaces, how NULL referenced objects are treated by the JVM, lock based synchronization and much more. In short, developing an Android app was a great introduction to the Java programming language.\n\n### 2) Find a great intro level Android development book to supplement online tutorials.\n\nMost of the time when I started out I found that online tutorials and forum posts were often way too specific and narrowly focused to gain much useful knowledge from as a beginning Android dev. What I mean is that comments were often left out(necessary to understand the design choices) and or the solution posted was just a snippet of functionality and not something your could copy and paste into Eclipse and compile (unless you already knew what you were doing). Although there were a few good exceptions, I was only able to actually make sense of many online tutorials and such after I understood the basics of Android development. This also saves you the embarrassment of annoying people online when you ask questions which could be easily answered by a quick Google search or better yet printed in the first chapter of any of the numerous introductory level Android books.\n\nIf you want to know which ones I read, I found [Teach Yourself Android Application Development in 24 Hours][link_teach_yourself_android_in_24] to be very useful since each chapter(written to be read in 1 hour intervals) was very succinct and got straight to the point. In addition the Q&A sections at the end of the chapters gave me a chance to practice and try out new things and prevented me from just engaging in passive learning. I also used [APress Pro Android 2][link_apress_android_pro_2] which despite its less than stellar 3 out of 5 star rating(4 stars is my usual minimum) on Amazon.com it was a great source for fully functioning mini apps that you can run on your phone and the entire book covered almost all of the Android API.\n\n### 3) Logcat and the DDMS(Dalvik Debug Monitor Server) are your best friends. \n\nWhile developing my first Android app I struggled early on to properly deal with sudden program crashes and JVM out of memory exceptions being triggered. At first I was at lost, until I learned how to properly use the debugging tools which were bundled with the Android SDK installation. This isn’t necessarily a blog post on debugging techniques but here is one great tutorial I found which helped me through some difficult times, or how you should learn to properly \n\n### 4) Start using version control software if you haven’t been doing so.\n\nI’m going to be honest here but prior to becoming comfortable with version control, I would add new features to my existing app by doing the following.\n\n- Create a new project in Eclipse titled “New feature X”\n\n- Copy all necessary files from the existing project over to the new one\n\n- Implement the feature and debug\n\n- If the feature worked, copy and paste it back extra carefully into the original hoping that no squiggly red underlines would show up in the IDE\n\n- ???\n\n- Compile!!!!\n\nAfter a while I just grew tired of the fact that adding new features such as trying out multi-touch zooming and or testing out an alternative layout scheme became so immensely difficult and error prone(copy and pasting into the wrong Java class file and or creating variable naming conflicts). So I did a little research and found a neat tool called that was perfectly suited to my needs, a cool piece of software called [Git][link_git_scm]. Go check it out, it runs well on all the popular OSs and you will just plain grow to appreciate version control as much as I now do. Ok I know [Git][link_git_scm] isn’t the only version control software around, [wikipedia][link_wikipedia_scm] has a list of free ones but its incredibly easy to learn and crazy powerful once you get started(no pun intended) using its advanced capabilities such as [cloning][link_git_cloning].\n\n### 5) Whenever possible, debug on a real handset not the emulator.\n\nThere really isn’t much to say here but until you can actually run your application on a real handset you may never know if your layouts will display properly out in the wild. In addition if anyone you know has a different Android model ask them to try out your app and get some early feedback.\n\n### 6) Start a code journal or something; become influential.\n\nThis might sound a little cheezy or evoke just a “yeah whatever” type of reaction but it pays to set clear deadlines for yourself and to not slack off. Writing an Android application can quickly go from just a weekend hack to a month long ordeal depending on your app. Although you could go to the extreme case and install productivity software to [lock down your web browser during working hours][link_freedom_app], my alternative and the one I highly recommend is to start a code journal. A code journal to me at least is just a real journal(not this blog) where you jot down ideas about features you wish to implement or where you just plain brainstorm new web apps or something.\n\n[link_android_dev_home]: http://developer.android.com/index.html\n[link_android_dev_actionbar]: http://developer.android.com/guide/topics/ui/actionbar.html\n[link_eclipse_ide]: http://www.eclipse.org\n[link_apress_android_pro_2]: http://www.amazon.com/Pro-Android-Sayed-Y-Hashimi/dp/1430226595/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1307061714&amp;sr=1-1\n[link_teach_yourself_android_in_24]: http://www.amazon.com/Teach-Yourself-Android-Application-Development/dp/0321673352\n[link_git_scm]: http://git-scm.com/\n[link_wikipedia_scm]: http://en.wikipedia.org/wiki/List_of_revision_control_software#Free\n[link_git_cloning]: http://www.kernel.org/pub/software/scm/git/docs/git-clone.html\n[link_freedom_app]: https://freedom.to/\n","source":"_posts/androidwatermark.md","raw":"---\ntitle: My Experience Publishing My First Android App, Six Things I Learned\ndate: 2011-06-04\ntags: [java, android, mobile]\n---\nHere are some of the things I learned about developing for the [Android][link_android_dev_home] platform from publishing my first app which I hope will useful to others who want to but haven’t started developing for the Android platform.\n\nIts currently in the free beta mode(with ads) right now as I plan on adding more features later such as the ability to design/store your own logos as preferences and an actual user interface that uses the [action bar design pattern][link_android_dev_actionbar] which is so popular nowadays.\n\n### 1) Not knowing Java is not an excuse. \n\nIf you don’t know any Java but you’re proficient in a C-based or C-styled syntax programming language such as C#, C++, PHP  and or any others then you can easily absorb Java as you browse Android tutorials, read Android dev books and begin to poke around with the Android API. I myself only knew C++ but developing for the Android platform quickly allowed me to dive into Java and learn the fundamentals of such things as proper exception handling(ok I admit that I do use exceptions in C++ but I tend to use my own exception class rather than the standard library one); how garbage collected languages differ from non garbage collected ones, the [Eclipse IDE][link_eclipse_ide], the difference between classes and interfaces, how NULL referenced objects are treated by the JVM, lock based synchronization and much more. In short, developing an Android app was a great introduction to the Java programming language.\n\n### 2) Find a great intro level Android development book to supplement online tutorials.\n\nMost of the time when I started out I found that online tutorials and forum posts were often way too specific and narrowly focused to gain much useful knowledge from as a beginning Android dev. What I mean is that comments were often left out(necessary to understand the design choices) and or the solution posted was just a snippet of functionality and not something your could copy and paste into Eclipse and compile (unless you already knew what you were doing). Although there were a few good exceptions, I was only able to actually make sense of many online tutorials and such after I understood the basics of Android development. This also saves you the embarrassment of annoying people online when you ask questions which could be easily answered by a quick Google search or better yet printed in the first chapter of any of the numerous introductory level Android books.\n\nIf you want to know which ones I read, I found [Teach Yourself Android Application Development in 24 Hours][link_teach_yourself_android_in_24] to be very useful since each chapter(written to be read in 1 hour intervals) was very succinct and got straight to the point. In addition the Q&A sections at the end of the chapters gave me a chance to practice and try out new things and prevented me from just engaging in passive learning. I also used [APress Pro Android 2][link_apress_android_pro_2] which despite its less than stellar 3 out of 5 star rating(4 stars is my usual minimum) on Amazon.com it was a great source for fully functioning mini apps that you can run on your phone and the entire book covered almost all of the Android API.\n\n### 3) Logcat and the DDMS(Dalvik Debug Monitor Server) are your best friends. \n\nWhile developing my first Android app I struggled early on to properly deal with sudden program crashes and JVM out of memory exceptions being triggered. At first I was at lost, until I learned how to properly use the debugging tools which were bundled with the Android SDK installation. This isn’t necessarily a blog post on debugging techniques but here is one great tutorial I found which helped me through some difficult times, or how you should learn to properly \n\n### 4) Start using version control software if you haven’t been doing so.\n\nI’m going to be honest here but prior to becoming comfortable with version control, I would add new features to my existing app by doing the following.\n\n- Create a new project in Eclipse titled “New feature X”\n\n- Copy all necessary files from the existing project over to the new one\n\n- Implement the feature and debug\n\n- If the feature worked, copy and paste it back extra carefully into the original hoping that no squiggly red underlines would show up in the IDE\n\n- ???\n\n- Compile!!!!\n\nAfter a while I just grew tired of the fact that adding new features such as trying out multi-touch zooming and or testing out an alternative layout scheme became so immensely difficult and error prone(copy and pasting into the wrong Java class file and or creating variable naming conflicts). So I did a little research and found a neat tool called that was perfectly suited to my needs, a cool piece of software called [Git][link_git_scm]. Go check it out, it runs well on all the popular OSs and you will just plain grow to appreciate version control as much as I now do. Ok I know [Git][link_git_scm] isn’t the only version control software around, [wikipedia][link_wikipedia_scm] has a list of free ones but its incredibly easy to learn and crazy powerful once you get started(no pun intended) using its advanced capabilities such as [cloning][link_git_cloning].\n\n### 5) Whenever possible, debug on a real handset not the emulator.\n\nThere really isn’t much to say here but until you can actually run your application on a real handset you may never know if your layouts will display properly out in the wild. In addition if anyone you know has a different Android model ask them to try out your app and get some early feedback.\n\n### 6) Start a code journal or something; become influential.\n\nThis might sound a little cheezy or evoke just a “yeah whatever” type of reaction but it pays to set clear deadlines for yourself and to not slack off. Writing an Android application can quickly go from just a weekend hack to a month long ordeal depending on your app. Although you could go to the extreme case and install productivity software to [lock down your web browser during working hours][link_freedom_app], my alternative and the one I highly recommend is to start a code journal. A code journal to me at least is just a real journal(not this blog) where you jot down ideas about features you wish to implement or where you just plain brainstorm new web apps or something.\n\n[link_android_dev_home]: http://developer.android.com/index.html\n[link_android_dev_actionbar]: http://developer.android.com/guide/topics/ui/actionbar.html\n[link_eclipse_ide]: http://www.eclipse.org\n[link_apress_android_pro_2]: http://www.amazon.com/Pro-Android-Sayed-Y-Hashimi/dp/1430226595/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1307061714&amp;sr=1-1\n[link_teach_yourself_android_in_24]: http://www.amazon.com/Teach-Yourself-Android-Application-Development/dp/0321673352\n[link_git_scm]: http://git-scm.com/\n[link_wikipedia_scm]: http://en.wikipedia.org/wiki/List_of_revision_control_software#Free\n[link_git_cloning]: http://www.kernel.org/pub/software/scm/git/docs/git-clone.html\n[link_freedom_app]: https://freedom.to/\n","slug":"androidwatermark","published":1,"updated":"2017-04-10T05:29:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr0y000e9uwvgwxgl6lm","content":"<p>Here are some of the things I learned about developing for the <a href=\"http://developer.android.com/index.html\" target=\"_blank\" rel=\"external\">Android</a> platform from publishing my first app which I hope will useful to others who want to but haven’t started developing for the Android platform.</p>\n<p>Its currently in the free beta mode(with ads) right now as I plan on adding more features later such as the ability to design/store your own logos as preferences and an actual user interface that uses the <a href=\"http://developer.android.com/guide/topics/ui/actionbar.html\" target=\"_blank\" rel=\"external\">action bar design pattern</a> which is so popular nowadays.</p>\n<h3 id=\"1-Not-knowing-Java-is-not-an-excuse\"><a href=\"#1-Not-knowing-Java-is-not-an-excuse\" class=\"headerlink\" title=\"1) Not knowing Java is not an excuse.\"></a>1) Not knowing Java is not an excuse.</h3><p>If you don’t know any Java but you’re proficient in a C-based or C-styled syntax programming language such as C#, C++, PHP  and or any others then you can easily absorb Java as you browse Android tutorials, read Android dev books and begin to poke around with the Android API. I myself only knew C++ but developing for the Android platform quickly allowed me to dive into Java and learn the fundamentals of such things as proper exception handling(ok I admit that I do use exceptions in C++ but I tend to use my own exception class rather than the standard library one); how garbage collected languages differ from non garbage collected ones, the <a href=\"http://www.eclipse.org\" target=\"_blank\" rel=\"external\">Eclipse IDE</a>, the difference between classes and interfaces, how NULL referenced objects are treated by the JVM, lock based synchronization and much more. In short, developing an Android app was a great introduction to the Java programming language.</p>\n<h3 id=\"2-Find-a-great-intro-level-Android-development-book-to-supplement-online-tutorials\"><a href=\"#2-Find-a-great-intro-level-Android-development-book-to-supplement-online-tutorials\" class=\"headerlink\" title=\"2) Find a great intro level Android development book to supplement online tutorials.\"></a>2) Find a great intro level Android development book to supplement online tutorials.</h3><p>Most of the time when I started out I found that online tutorials and forum posts were often way too specific and narrowly focused to gain much useful knowledge from as a beginning Android dev. What I mean is that comments were often left out(necessary to understand the design choices) and or the solution posted was just a snippet of functionality and not something your could copy and paste into Eclipse and compile (unless you already knew what you were doing). Although there were a few good exceptions, I was only able to actually make sense of many online tutorials and such after I understood the basics of Android development. This also saves you the embarrassment of annoying people online when you ask questions which could be easily answered by a quick Google search or better yet printed in the first chapter of any of the numerous introductory level Android books.</p>\n<p>If you want to know which ones I read, I found <a href=\"http://www.amazon.com/Teach-Yourself-Android-Application-Development/dp/0321673352\" target=\"_blank\" rel=\"external\">Teach Yourself Android Application Development in 24 Hours</a> to be very useful since each chapter(written to be read in 1 hour intervals) was very succinct and got straight to the point. In addition the Q&amp;A sections at the end of the chapters gave me a chance to practice and try out new things and prevented me from just engaging in passive learning. I also used <a href=\"http://www.amazon.com/Pro-Android-Sayed-Y-Hashimi/dp/1430226595/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1307061714&amp;sr=1-1\" target=\"_blank\" rel=\"external\">APress Pro Android 2</a> which despite its less than stellar 3 out of 5 star rating(4 stars is my usual minimum) on Amazon.com it was a great source for fully functioning mini apps that you can run on your phone and the entire book covered almost all of the Android API.</p>\n<h3 id=\"3-Logcat-and-the-DDMS-Dalvik-Debug-Monitor-Server-are-your-best-friends\"><a href=\"#3-Logcat-and-the-DDMS-Dalvik-Debug-Monitor-Server-are-your-best-friends\" class=\"headerlink\" title=\"3) Logcat and the DDMS(Dalvik Debug Monitor Server) are your best friends.\"></a>3) Logcat and the DDMS(Dalvik Debug Monitor Server) are your best friends.</h3><p>While developing my first Android app I struggled early on to properly deal with sudden program crashes and JVM out of memory exceptions being triggered. At first I was at lost, until I learned how to properly use the debugging tools which were bundled with the Android SDK installation. This isn’t necessarily a blog post on debugging techniques but here is one great tutorial I found which helped me through some difficult times, or how you should learn to properly </p>\n<h3 id=\"4-Start-using-version-control-software-if-you-haven’t-been-doing-so\"><a href=\"#4-Start-using-version-control-software-if-you-haven’t-been-doing-so\" class=\"headerlink\" title=\"4) Start using version control software if you haven’t been doing so.\"></a>4) Start using version control software if you haven’t been doing so.</h3><p>I’m going to be honest here but prior to becoming comfortable with version control, I would add new features to my existing app by doing the following.</p>\n<ul>\n<li><p>Create a new project in Eclipse titled “New feature X”</p>\n</li>\n<li><p>Copy all necessary files from the existing project over to the new one</p>\n</li>\n<li><p>Implement the feature and debug</p>\n</li>\n<li><p>If the feature worked, copy and paste it back extra carefully into the original hoping that no squiggly red underlines would show up in the IDE</p>\n</li>\n<li><p>???</p>\n</li>\n<li><p>Compile!!!!</p>\n</li>\n</ul>\n<p>After a while I just grew tired of the fact that adding new features such as trying out multi-touch zooming and or testing out an alternative layout scheme became so immensely difficult and error prone(copy and pasting into the wrong Java class file and or creating variable naming conflicts). So I did a little research and found a neat tool called that was perfectly suited to my needs, a cool piece of software called <a href=\"http://git-scm.com/\" target=\"_blank\" rel=\"external\">Git</a>. Go check it out, it runs well on all the popular OSs and you will just plain grow to appreciate version control as much as I now do. Ok I know <a href=\"http://git-scm.com/\" target=\"_blank\" rel=\"external\">Git</a> isn’t the only version control software around, <a href=\"http://en.wikipedia.org/wiki/List_of_revision_control_software#Free\" target=\"_blank\" rel=\"external\">wikipedia</a> has a list of free ones but its incredibly easy to learn and crazy powerful once you get started(no pun intended) using its advanced capabilities such as <a href=\"http://www.kernel.org/pub/software/scm/git/docs/git-clone.html\" target=\"_blank\" rel=\"external\">cloning</a>.</p>\n<h3 id=\"5-Whenever-possible-debug-on-a-real-handset-not-the-emulator\"><a href=\"#5-Whenever-possible-debug-on-a-real-handset-not-the-emulator\" class=\"headerlink\" title=\"5) Whenever possible, debug on a real handset not the emulator.\"></a>5) Whenever possible, debug on a real handset not the emulator.</h3><p>There really isn’t much to say here but until you can actually run your application on a real handset you may never know if your layouts will display properly out in the wild. In addition if anyone you know has a different Android model ask them to try out your app and get some early feedback.</p>\n<h3 id=\"6-Start-a-code-journal-or-something-become-influential\"><a href=\"#6-Start-a-code-journal-or-something-become-influential\" class=\"headerlink\" title=\"6) Start a code journal or something; become influential.\"></a>6) Start a code journal or something; become influential.</h3><p>This might sound a little cheezy or evoke just a “yeah whatever” type of reaction but it pays to set clear deadlines for yourself and to not slack off. Writing an Android application can quickly go from just a weekend hack to a month long ordeal depending on your app. Although you could go to the extreme case and install productivity software to <a href=\"https://freedom.to/\" target=\"_blank\" rel=\"external\">lock down your web browser during working hours</a>, my alternative and the one I highly recommend is to start a code journal. A code journal to me at least is just a real journal(not this blog) where you jot down ideas about features you wish to implement or where you just plain brainstorm new web apps or something.</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Here are some of the things I learned about developing for the <a href=\"http://developer.android.com/index.html\">Android</a> platform from publishing my first app which I hope will useful to others who want to but haven’t started developing for the Android platform.</p>\n<p>Its currently in the free beta mode(with ads) right now as I plan on adding more features later such as the ability to design/store your own logos as preferences and an actual user interface that uses the <a href=\"http://developer.android.com/guide/topics/ui/actionbar.html\">action bar design pattern</a> which is so popular nowadays.</p>\n<h3 id=\"1-Not-knowing-Java-is-not-an-excuse\"><a href=\"#1-Not-knowing-Java-is-not-an-excuse\" class=\"headerlink\" title=\"1) Not knowing Java is not an excuse.\"></a>1) Not knowing Java is not an excuse.</h3><p>If you don’t know any Java but you’re proficient in a C-based or C-styled syntax programming language such as C#, C++, PHP  and or any others then you can easily absorb Java as you browse Android tutorials, read Android dev books and begin to poke around with the Android API. I myself only knew C++ but developing for the Android platform quickly allowed me to dive into Java and learn the fundamentals of such things as proper exception handling(ok I admit that I do use exceptions in C++ but I tend to use my own exception class rather than the standard library one); how garbage collected languages differ from non garbage collected ones, the <a href=\"http://www.eclipse.org\">Eclipse IDE</a>, the difference between classes and interfaces, how NULL referenced objects are treated by the JVM, lock based synchronization and much more. In short, developing an Android app was a great introduction to the Java programming language.</p>\n<h3 id=\"2-Find-a-great-intro-level-Android-development-book-to-supplement-online-tutorials\"><a href=\"#2-Find-a-great-intro-level-Android-development-book-to-supplement-online-tutorials\" class=\"headerlink\" title=\"2) Find a great intro level Android development book to supplement online tutorials.\"></a>2) Find a great intro level Android development book to supplement online tutorials.</h3><p>Most of the time when I started out I found that online tutorials and forum posts were often way too specific and narrowly focused to gain much useful knowledge from as a beginning Android dev. What I mean is that comments were often left out(necessary to understand the design choices) and or the solution posted was just a snippet of functionality and not something your could copy and paste into Eclipse and compile (unless you already knew what you were doing). Although there were a few good exceptions, I was only able to actually make sense of many online tutorials and such after I understood the basics of Android development. This also saves you the embarrassment of annoying people online when you ask questions which could be easily answered by a quick Google search or better yet printed in the first chapter of any of the numerous introductory level Android books.</p>\n<p>If you want to know which ones I read, I found <a href=\"http://www.amazon.com/Teach-Yourself-Android-Application-Development/dp/0321673352\">Teach Yourself Android Application Development in 24 Hours</a> to be very useful since each chapter(written to be read in 1 hour intervals) was very succinct and got straight to the point. In addition the Q&amp;A sections at the end of the chapters gave me a chance to practice and try out new things and prevented me from just engaging in passive learning. I also used <a href=\"http://www.amazon.com/Pro-Android-Sayed-Y-Hashimi/dp/1430226595/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1307061714&amp;sr=1-1\">APress Pro Android 2</a> which despite its less than stellar 3 out of 5 star rating(4 stars is my usual minimum) on Amazon.com it was a great source for fully functioning mini apps that you can run on your phone and the entire book covered almost all of the Android API.</p>\n<h3 id=\"3-Logcat-and-the-DDMS-Dalvik-Debug-Monitor-Server-are-your-best-friends\"><a href=\"#3-Logcat-and-the-DDMS-Dalvik-Debug-Monitor-Server-are-your-best-friends\" class=\"headerlink\" title=\"3) Logcat and the DDMS(Dalvik Debug Monitor Server) are your best friends.\"></a>3) Logcat and the DDMS(Dalvik Debug Monitor Server) are your best friends.</h3><p>While developing my first Android app I struggled early on to properly deal with sudden program crashes and JVM out of memory exceptions being triggered. At first I was at lost, until I learned how to properly use the debugging tools which were bundled with the Android SDK installation. This isn’t necessarily a blog post on debugging techniques but here is one great tutorial I found which helped me through some difficult times, or how you should learn to properly </p>\n<h3 id=\"4-Start-using-version-control-software-if-you-haven’t-been-doing-so\"><a href=\"#4-Start-using-version-control-software-if-you-haven’t-been-doing-so\" class=\"headerlink\" title=\"4) Start using version control software if you haven’t been doing so.\"></a>4) Start using version control software if you haven’t been doing so.</h3><p>I’m going to be honest here but prior to becoming comfortable with version control, I would add new features to my existing app by doing the following.</p>\n<ul>\n<li><p>Create a new project in Eclipse titled “New feature X”</p>\n</li>\n<li><p>Copy all necessary files from the existing project over to the new one</p>\n</li>\n<li><p>Implement the feature and debug</p>\n</li>\n<li><p>If the feature worked, copy and paste it back extra carefully into the original hoping that no squiggly red underlines would show up in the IDE</p>\n</li>\n<li><p>???</p>\n</li>\n<li><p>Compile!!!!</p>\n</li>\n</ul>\n<p>After a while I just grew tired of the fact that adding new features such as trying out multi-touch zooming and or testing out an alternative layout scheme became so immensely difficult and error prone(copy and pasting into the wrong Java class file and or creating variable naming conflicts). So I did a little research and found a neat tool called that was perfectly suited to my needs, a cool piece of software called <a href=\"http://git-scm.com/\">Git</a>. Go check it out, it runs well on all the popular OSs and you will just plain grow to appreciate version control as much as I now do. Ok I know <a href=\"http://git-scm.com/\">Git</a> isn’t the only version control software around, <a href=\"http://en.wikipedia.org/wiki/List_of_revision_control_software#Free\">wikipedia</a> has a list of free ones but its incredibly easy to learn and crazy powerful once you get started(no pun intended) using its advanced capabilities such as <a href=\"http://www.kernel.org/pub/software/scm/git/docs/git-clone.html\">cloning</a>.</p>\n<h3 id=\"5-Whenever-possible-debug-on-a-real-handset-not-the-emulator\"><a href=\"#5-Whenever-possible-debug-on-a-real-handset-not-the-emulator\" class=\"headerlink\" title=\"5) Whenever possible, debug on a real handset not the emulator.\"></a>5) Whenever possible, debug on a real handset not the emulator.</h3><p>There really isn’t much to say here but until you can actually run your application on a real handset you may never know if your layouts will display properly out in the wild. In addition if anyone you know has a different Android model ask them to try out your app and get some early feedback.</p>\n<h3 id=\"6-Start-a-code-journal-or-something-become-influential\"><a href=\"#6-Start-a-code-journal-or-something-become-influential\" class=\"headerlink\" title=\"6) Start a code journal or something; become influential.\"></a>6) Start a code journal or something; become influential.</h3><p>This might sound a little cheezy or evoke just a “yeah whatever” type of reaction but it pays to set clear deadlines for yourself and to not slack off. Writing an Android application can quickly go from just a weekend hack to a month long ordeal depending on your app. Although you could go to the extreme case and install productivity software to <a href=\"https://freedom.to/\">lock down your web browser during working hours</a>, my alternative and the one I highly recommend is to start a code journal. A code journal to me at least is just a real journal(not this blog) where you jot down ideas about features you wish to implement or where you just plain brainstorm new web apps or something.</p>\n"},{"title":"An Introductory Meteor Tutorial, Improving On The Leaderboard Sample App","date":"2012-03-26T07:00:00.000Z","catagories":["tutorial"],"_content":"In this tutorial I'll discuss my experience developing and launching(and yes you'll see how easy it is to launch with Meteor) a realtime javascript application using the Meteor framework; with its built in MongoDB shell and strong client server architecture Meteor is a powerful framework that should become popular for developers wishing to build fast realtime web applications.\n\n- <a href=\"https://github.com/taywils/Meteor_Tutorial_Code\">Grab the code on GitHub</a>\n\nTo begin this tutorial the first thing you'll want to do is to install the Meteor framework for NodeJs. \n\nDue to the nature of the framework under going constant updates, I won't write down specifically how to install Meteor because I'll then be forced to update this tutorial whenever the installation procedure changes. \n\nHowever I don't see anything wrong with providing a link to the official Meteor documentation where you'll find the download and installation instructions readily prepared for you. <a href=\"http://docs.meteor.com/#quickstart\">Meteor Installation Guide</a> Once you have Meteor installed on your system you're ready to go. If you're running a Linux variant or Mac OSX then then the installation guide should be sufficient however, Windows users might require extra steps. \n\nWorry not though because if all else fails for getting Meteor running on Windows I suggest you just download and install a free copy of <a href=\"http://www.ubuntu.com/\">Ubuntu Linux</a> and get it running first and then return to this tutorial.\n\nSo now that you have Meteor up and running we're going to start off by downloading the sample application \"Leaderboard\". To do so go to the Meteor official documentation for the leaderboard sample app and follow the instructions <a href=\"http://www.meteor.com/examples/leaderboard\">Meteor Leaderboard</a>. Once you have read through the instructions go ahead and give the sample application a test drive by changing into the directory of the application and entering \"meteor\" into you terminal window. \n\nNext the application should begin most likely on localhost:3000 which you can navigate to from your web browser of choice and view the application running live. \n\nOk so far we have installed the Meteor framework; downloaded the sample app, ran the sample app and verified that we can navigate to the application from our browser and see it in action. \nNow we'll begin modifying the leaderboard so we can better understand the framework and take a gander into its design structure. \n\nFrom your terminal window open the directory where you placed the sample app; you should see three files leaderboard.css, leaderboard.html and leaderboard.js. \n\nBased on the file names you can easily tell that the first file we're going to edit is the leaderboard.html since its the file which connects both the css and javascript. \nGo ahead and open up leaderboard.html with your editor of choice.\n\nThe re-branded sample application i.e fork of the leaderboard app we're going to create is called Boozenet. Boozenet was the name of this application chosen the team I worked with during a previous Hackathon. \n\nBoozenet was an application developed for the sole purpose of allowing friends who drink together on nights out to keep track of not only the beer they drank but the total amount of calories. \nThis application was developed during a mobile Health themed hackathon so the caloric intake was supposed to be the main feature of the app but the fact that it was realtime and ran on mobile as well as web based clients was the most impressive feature after all. \nEnough background, within leaderboard.html find the <head> and update its contents to appear as below.\n```html\n<head>\n  <title>BoozeNet</title>\n  <script src=\"http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js\"></script>\n</head>\n```\nIn addition Meteor also has a custom jquery plugin, from the documentation to use the jquery plugin navigate to the directory of this application and run the following command from the terminal \"meteor add jquery\".\n\nSo far we've updated the title of the application and included jquery... not much but its a good start. \nMoving onto the <body> tag you'll notice the unfamiliar (if you've never used an HTML templating framework before) set of double curly braces. \n\nWhat these represent are places where we'll substitute sections of HTML when the content is rendered on the browser once the templating javascript code scans over and updates the sections of the HTML marked with double curly braces when the application is ran. \nDespite the large number of HTML templating engines available (just Google for it and you'll see) the one pre-baked into the Meteor framework is a modern templating engine called Handlebars \n\n<a href=\"http://handlebarsjs.com/\">Click here for the Handlebarsjs Homepage</a>. \n\nIf you want you can read all about how Handlebarsjs does its magic by browsing the its homepage but for now we'll focus on applying it to extend the leaderboard sample application. \n```html\n<body>\n  <div id=\"outer\">\n  <table>\n  <tr>\n  <td><img src=\"beer_vector-200.png\" /></td>\n  <td>{{> game}}</td>\n  </tr>\n  </table>\n  {{> gallery }}\n  <div class=\"none\" />\n  {{> leaderboard}}\n  </div>\n</body>\n```\nFirst we're going to explain how the gallery template works; once that is established hopefully the double curly brace syntax won't appear so alien and you'll start reading it as just another HTML element. What the gallery does for our application is showcase the snapshots (in this contrived example they will be hyperlinks to images on the web) of various beers that users of our app have consumed. All this really means is that the gallery template is a placeholder for images to be dynamically inserted at when the page is rendered from image links stored within out database.\n\n```html\n<template name=\"gallery\">\n<div class=\"gallery\">\n{{#each photos}}\n{{> photo}}\n{{/each}}\n</div>\n</template>\n```\nAs you can probably already guess the <template> tag will substitute itself where the double braced enclosed word \"gallery\" appears earlier in the code. \nIf you thought it was going to be more complicated than that you were wrong, working with the handlebarsjs template engine is quite easy... although there are way more advanced features we won't need to get into to those at this level of a tutorial. \nThe next template we're going to create is the photo template which is to be  placed within the gallery template we just established.\n\n```html\n<template name=\"photo\">\n<img width=\"100\" height=\"100\" src=\"{{url}}\" />\n</template>\n```\n\nFor those of you with eagle eyes you might have caught that the the template argument url differs slightly from the all previous template arguments we have passed thus far.\nWhat the url lack is the leading > just after the second left-curly brace. \nHow the absence of the > affects the code will come into play later when you start writing the javascript code but for now just let it be. \nNext we'll need to template the leaderboard... its similar to the gallery but instead of photos wrapped within a each sub-template we'll have players displayed instead.\n\n```html\n<template name=\"leaderboard\">\n<div class=\"leaderboard\">\n{{#each players}}\n{{> player}}\n{{/each}}\n</div>\n\n{{#if selected_name}}\n<div class=\"details\">\n<div class=\"name\">Whats Up {{selected_name}}</div>\n<input type=\"button\" class=\"uploadImg\" value=\"Add Photo\" />\n<input id=&#039;imgUrlText&#039; type=&#039;text&#039; size=\"80\" name=&#039;imageUrl&#039; class=&#039;imageUrl&#039; />\n</div>\n{{/if}}\n\n{{#unless selected_name}}\n<div class=\"none\">Click a player to select</div>\n{{/unless}}\n</template>\n```\nSince we have just defined where the players template is going to fit onto the leaderboard we now have to create a template for them as well.\n```html\n<template name=\"player\">\n<div class=\"player {{selected}}\">\n<span class=\"name\">{{name}} | {{phone}}</span>\n<span class=\"score\">Calories {{score}}</span>\n</div>\n</template>\n```\nAnother thing you might have noticed is that in the above code the double curly brace appears within the value of the class tag. \nWhich means that you can even inject templates within css; pretty cool if I'd say so. \nMoving on notice how the template references whether or not the player has been selected. \nThat will become important once we get to the javascript part of this application where we'll actually define the events which take place when those conditionals are satisfied. \nLastly all we have to do now is define the game template, which is just where we have our input form for new players.\n```html\n<template name=\"game\">\n<div class=\"newGame\">\n  <input type=\"button\" class=\"newGame\" value=\"New Game\" />\n<br />\n<form class=\"standard_form\">\n  <label>Enter Phone#:</label><input id=&#039;phoneText&#039; type=&#039;text&#039; name=&#039;phoneNumber&#039; class=&#039;phoneNumber&#039; />\n  <label>Enter Name:</label><input id=&#039;nameText&#039; type=&#039;text&#039; name=&#039;newName&#039; class=&#039;newName&#039; />\n  <div class=\"submit_links\">\n  <input type=\"button\" class=\"addDrinker\" value=\"Join\" />\n  </div>\n</form>\n\n</div>\n</template>\n```\nNow we are done with leaderboard.html.\n\nBelow is the CSS for leaderboard.css there isn't much to the CSS so just read through it if you want. \nBesides that you might just want to flat out replace your leaderboard.css instead of making additions to the file like we did for the html page. \n```css\nbody {\n  font-family: 'Helvetica Neue', Helvetica, Arial, san-serif;\n  font-weight: 200;\nmargin: 50px 0;\npadding: 0;\n         -webkit-user-select: none;\n         -khtml-user-select: none;\n         -moz-user-select: none;\n         -o-user-select: none;\n         user-select: none;\n}\n\n#outer {\nwidth: 700px;\nmargin: 0 auto;    \n}\n\n.player {\npadding: 5px;\n}\n\n.player .name {\ndisplay: inline-block;\nwidth: 300px;\n       font-size: 1.75em;\n}\n\n.player .score {\ndisplay: inline-block;\nwidth: 100px;\n       text-align: right;\n       font-size: 2em;\n       font-weight: bold;\ncolor: #777;\n}\n\n.player.selected {\n  background-color: yellow;\ndisplay: inline-block;\n}\n\n.player.selected .score {\ncolor: black;\n}\n\n.details, .none {\n  font-weight: bold;\n  font-size: 2em;\n  border-style: dashed none none none;\n  border-color: #ccc;\n  border-width: 4px;\nmargin: 50px 10px;\npadding: 10px 0px;\n}\n\n.none {\ncolor: #777;\n}\n\ninput {\n  border-color: #006699;\n  border-style: solid;\n  border-width: 1px;\ncolor: #006699;\n}\n\n.standard_form {\nwidth: 400px;\nmargin: 0px;\npadding: 0px;\n}\n\n.standard_form label {\nfloat: left;\nwidth: 190px;\nclear: both;\nheight: 20px;\n}\n\n.standard_form input {\nfloat: right;\nwidth: 200px;\nheight: 20px;\n}\n\n.submit_links {\nclear: both;\n}\n\n.submit_links input {\nfloat: right;\nwidth: auto;\n}\n\n.leaderboard .player {\nwidth: 610px;\nclear: both;\n}\n\n.leaderboard .player .name {\nwidth: 300px;\nfloat: left;\n}\n\n.leaderboard .player .score {\nwidth: 300px;\nfloat: right;\n}\n```\nFor the final addition and where we get to see the true face of Meteor is within the javascript file.\nSo open leaderboard.js and we'll begin by taking apart the javascript section by section to make sure we understand what each part does and where we'll make additions to the sample code provided. \n\n```javascript\nPlayers = new Meteor.Collection(\"players\");\nPhotos = new Meteor.Collection(\"photos\");\n```\n\nThe first part is the addition of the Photos MongoDB Collection in addition to the regular Players Collection.\nThats simple enough but the interesting part we see next is how the each of the templates we coded in the HTML connects somehow to a Collection on the MongoDB.\nOne of the things I appreciate the most about the Meteor framework is how well they managed to make the connections between HTML templates and MongoDB collections crystal clear.\nIn particular pay attention to the conditional on the first line where we check whether the interaction is from the client.\nThis will become important later on where we describe what happens when the interation is on the server side.\nWhich is another cool thing about Meteor that you often don't see in a lot of other frameworks, clean separation between client and server object modeling. \nOften as I've seen before what happens is that the server side code is visibly connected to the database while its up to the developer to string together some sort of process for pushing the data to the client facing side.\n```javascript\nif (Meteor.is_client) {\n  Template.leaderboard.players = function () {\n    return Players.find({}, {sort: {score: -1, name: 1}});\n  };\n\n  Template.gallery.photos = function () {\n    return Photos.find({});\n  };\n\n  Template.leaderboard.selected_name = function () {\n    var player = Players.findOne(Session.get(\"selected_player\"));\n    return player && player.phone && player.name;\n  };\n\n  Template.player.selected = function () {\n    return Session.equals(\"selected_player\", this._id) ? \"selected\" : '';\n  };\n```\nNext fill in the various html events which are triggered based on client input on the page where the app is displayed. \nThe first event we'll code describes what happens when a user clicks the Image Upload button.\n```javascript\n    Template.leaderboard.events = {\n      'click input.uploadImg': function() {\n        var imgUrl = \"\";\n        imgUrl = $('#imgUrlText').val();\n        var imgSrc = imgUrl;\n\n        if( imgUrl != \"\" ) {\n          var player = Players.findOne(Session.get(\"selected_player\"));\n          Players.update(Session.get(\"selected_player\"), {$inc: {score: 343}});\n          Photos.insert({url: imgSrc, phone: player.phone });\n        }\n      }\n    };\n```\nThe code is pretty self explainatory but in short, we pull the image url, we take the selected player, increment her score and then insert the photo into our DB.\nThen we handle what happens when a playername is clicked... it just sets the selected player.\n```javascript\n    Template.player.events = {\n      'click': function () {\n        Session.set(\"selected_player\", this._id);\n      }\n    };\n```\nFinnally for the game template itself we need to handle two events, one in which a new player is added and the second when a new game is created.\n\nThe events for any template as you can tell by now is just a javascript Object so we can separate object member by a comma using a string as the key and function as the value.\n```javascript\n    Template.game.events = {\n      'click input.newGame': function () {\n        Players.remove({});\n        Photos.remove({});\n      },\n\n      'click input.addDrinker': function () {\n        var newScore = 0;\n        var newName = null;\n        var newPhoneNumber = null;\n\n        newPhoneNumber = $('#phoneText').val();\n        newName = $('#nameText').val();\n\n        if( $.trim(newName) != \"\" && $.trim(newPhoneNumber) != \"\" ) {\n          Players.insert({ name: newName, phone: newPhoneNumber, score: newScore });\n        }\n      }\n    };\n```\nFor the final part of the javascript we need to define how the Meteor server gets the data from the DB when the game is started which will then allow the client code to we coded above to behave properly.\n```javascript\n    if (Meteor.is_server) {\n      Meteor.startup(function () {\n          if (Players.find().count() === 0) {\n            var names = [\n            \"Click New Game\",\n            ];\n\n            for (var i = 0; i < names.length; i++) {\n              Players.insert({name: names[i], phone: \"\", score: 0});\n            }\n          }\n\n          if( Photos.find().count() === 0) {\n            var pics = [\n            \"http://upload.wikimedia.org/wikipedia/commons/e/e5/Pale_Ale.jpg\",\n            \"http://upload.wikimedia.org/wikipedia/commons/3/3e/Weizenbier.jpg\",\n            \"http://upload.wikimedia.org/wikipedia/commons/9/99/Glass_of_K%C3%B6stritzer_Schwarzbier.jpg\"\n            ];\n\n            for (var i = 0; i < pics.length; i++) {\n            Photos.insert({url: pics[i], phone: \"\"});\n            }\n          }\n      });\n    }\n```\nThe last thing you need to do in order to get the full code working together is to visit the github page for this code as this tutorial written here is more of in-depth documentation. So just git clone the project navigate to the main directory and run \"meteor\" from the terminal and browse to the site on your machine. \n\nIncluded within the GitHub code are the necessary image files you'll want as well.\n\n","source":"_posts/boozenet.md","raw":"---\ntitle: An Introductory Meteor Tutorial, Improving On The Leaderboard Sample App\ndate: 2012-03-26\ncatagories: [tutorial]\ntags: [javascript, nodejs]\n---\nIn this tutorial I'll discuss my experience developing and launching(and yes you'll see how easy it is to launch with Meteor) a realtime javascript application using the Meteor framework; with its built in MongoDB shell and strong client server architecture Meteor is a powerful framework that should become popular for developers wishing to build fast realtime web applications.\n\n- <a href=\"https://github.com/taywils/Meteor_Tutorial_Code\">Grab the code on GitHub</a>\n\nTo begin this tutorial the first thing you'll want to do is to install the Meteor framework for NodeJs. \n\nDue to the nature of the framework under going constant updates, I won't write down specifically how to install Meteor because I'll then be forced to update this tutorial whenever the installation procedure changes. \n\nHowever I don't see anything wrong with providing a link to the official Meteor documentation where you'll find the download and installation instructions readily prepared for you. <a href=\"http://docs.meteor.com/#quickstart\">Meteor Installation Guide</a> Once you have Meteor installed on your system you're ready to go. If you're running a Linux variant or Mac OSX then then the installation guide should be sufficient however, Windows users might require extra steps. \n\nWorry not though because if all else fails for getting Meteor running on Windows I suggest you just download and install a free copy of <a href=\"http://www.ubuntu.com/\">Ubuntu Linux</a> and get it running first and then return to this tutorial.\n\nSo now that you have Meteor up and running we're going to start off by downloading the sample application \"Leaderboard\". To do so go to the Meteor official documentation for the leaderboard sample app and follow the instructions <a href=\"http://www.meteor.com/examples/leaderboard\">Meteor Leaderboard</a>. Once you have read through the instructions go ahead and give the sample application a test drive by changing into the directory of the application and entering \"meteor\" into you terminal window. \n\nNext the application should begin most likely on localhost:3000 which you can navigate to from your web browser of choice and view the application running live. \n\nOk so far we have installed the Meteor framework; downloaded the sample app, ran the sample app and verified that we can navigate to the application from our browser and see it in action. \nNow we'll begin modifying the leaderboard so we can better understand the framework and take a gander into its design structure. \n\nFrom your terminal window open the directory where you placed the sample app; you should see three files leaderboard.css, leaderboard.html and leaderboard.js. \n\nBased on the file names you can easily tell that the first file we're going to edit is the leaderboard.html since its the file which connects both the css and javascript. \nGo ahead and open up leaderboard.html with your editor of choice.\n\nThe re-branded sample application i.e fork of the leaderboard app we're going to create is called Boozenet. Boozenet was the name of this application chosen the team I worked with during a previous Hackathon. \n\nBoozenet was an application developed for the sole purpose of allowing friends who drink together on nights out to keep track of not only the beer they drank but the total amount of calories. \nThis application was developed during a mobile Health themed hackathon so the caloric intake was supposed to be the main feature of the app but the fact that it was realtime and ran on mobile as well as web based clients was the most impressive feature after all. \nEnough background, within leaderboard.html find the <head> and update its contents to appear as below.\n```html\n<head>\n  <title>BoozeNet</title>\n  <script src=\"http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js\"></script>\n</head>\n```\nIn addition Meteor also has a custom jquery plugin, from the documentation to use the jquery plugin navigate to the directory of this application and run the following command from the terminal \"meteor add jquery\".\n\nSo far we've updated the title of the application and included jquery... not much but its a good start. \nMoving onto the <body> tag you'll notice the unfamiliar (if you've never used an HTML templating framework before) set of double curly braces. \n\nWhat these represent are places where we'll substitute sections of HTML when the content is rendered on the browser once the templating javascript code scans over and updates the sections of the HTML marked with double curly braces when the application is ran. \nDespite the large number of HTML templating engines available (just Google for it and you'll see) the one pre-baked into the Meteor framework is a modern templating engine called Handlebars \n\n<a href=\"http://handlebarsjs.com/\">Click here for the Handlebarsjs Homepage</a>. \n\nIf you want you can read all about how Handlebarsjs does its magic by browsing the its homepage but for now we'll focus on applying it to extend the leaderboard sample application. \n```html\n<body>\n  <div id=\"outer\">\n  <table>\n  <tr>\n  <td><img src=\"beer_vector-200.png\" /></td>\n  <td>{{> game}}</td>\n  </tr>\n  </table>\n  {{> gallery }}\n  <div class=\"none\" />\n  {{> leaderboard}}\n  </div>\n</body>\n```\nFirst we're going to explain how the gallery template works; once that is established hopefully the double curly brace syntax won't appear so alien and you'll start reading it as just another HTML element. What the gallery does for our application is showcase the snapshots (in this contrived example they will be hyperlinks to images on the web) of various beers that users of our app have consumed. All this really means is that the gallery template is a placeholder for images to be dynamically inserted at when the page is rendered from image links stored within out database.\n\n```html\n<template name=\"gallery\">\n<div class=\"gallery\">\n{{#each photos}}\n{{> photo}}\n{{/each}}\n</div>\n</template>\n```\nAs you can probably already guess the <template> tag will substitute itself where the double braced enclosed word \"gallery\" appears earlier in the code. \nIf you thought it was going to be more complicated than that you were wrong, working with the handlebarsjs template engine is quite easy... although there are way more advanced features we won't need to get into to those at this level of a tutorial. \nThe next template we're going to create is the photo template which is to be  placed within the gallery template we just established.\n\n```html\n<template name=\"photo\">\n<img width=\"100\" height=\"100\" src=\"{{url}}\" />\n</template>\n```\n\nFor those of you with eagle eyes you might have caught that the the template argument url differs slightly from the all previous template arguments we have passed thus far.\nWhat the url lack is the leading > just after the second left-curly brace. \nHow the absence of the > affects the code will come into play later when you start writing the javascript code but for now just let it be. \nNext we'll need to template the leaderboard... its similar to the gallery but instead of photos wrapped within a each sub-template we'll have players displayed instead.\n\n```html\n<template name=\"leaderboard\">\n<div class=\"leaderboard\">\n{{#each players}}\n{{> player}}\n{{/each}}\n</div>\n\n{{#if selected_name}}\n<div class=\"details\">\n<div class=\"name\">Whats Up {{selected_name}}</div>\n<input type=\"button\" class=\"uploadImg\" value=\"Add Photo\" />\n<input id=&#039;imgUrlText&#039; type=&#039;text&#039; size=\"80\" name=&#039;imageUrl&#039; class=&#039;imageUrl&#039; />\n</div>\n{{/if}}\n\n{{#unless selected_name}}\n<div class=\"none\">Click a player to select</div>\n{{/unless}}\n</template>\n```\nSince we have just defined where the players template is going to fit onto the leaderboard we now have to create a template for them as well.\n```html\n<template name=\"player\">\n<div class=\"player {{selected}}\">\n<span class=\"name\">{{name}} | {{phone}}</span>\n<span class=\"score\">Calories {{score}}</span>\n</div>\n</template>\n```\nAnother thing you might have noticed is that in the above code the double curly brace appears within the value of the class tag. \nWhich means that you can even inject templates within css; pretty cool if I'd say so. \nMoving on notice how the template references whether or not the player has been selected. \nThat will become important once we get to the javascript part of this application where we'll actually define the events which take place when those conditionals are satisfied. \nLastly all we have to do now is define the game template, which is just where we have our input form for new players.\n```html\n<template name=\"game\">\n<div class=\"newGame\">\n  <input type=\"button\" class=\"newGame\" value=\"New Game\" />\n<br />\n<form class=\"standard_form\">\n  <label>Enter Phone#:</label><input id=&#039;phoneText&#039; type=&#039;text&#039; name=&#039;phoneNumber&#039; class=&#039;phoneNumber&#039; />\n  <label>Enter Name:</label><input id=&#039;nameText&#039; type=&#039;text&#039; name=&#039;newName&#039; class=&#039;newName&#039; />\n  <div class=\"submit_links\">\n  <input type=\"button\" class=\"addDrinker\" value=\"Join\" />\n  </div>\n</form>\n\n</div>\n</template>\n```\nNow we are done with leaderboard.html.\n\nBelow is the CSS for leaderboard.css there isn't much to the CSS so just read through it if you want. \nBesides that you might just want to flat out replace your leaderboard.css instead of making additions to the file like we did for the html page. \n```css\nbody {\n  font-family: 'Helvetica Neue', Helvetica, Arial, san-serif;\n  font-weight: 200;\nmargin: 50px 0;\npadding: 0;\n         -webkit-user-select: none;\n         -khtml-user-select: none;\n         -moz-user-select: none;\n         -o-user-select: none;\n         user-select: none;\n}\n\n#outer {\nwidth: 700px;\nmargin: 0 auto;    \n}\n\n.player {\npadding: 5px;\n}\n\n.player .name {\ndisplay: inline-block;\nwidth: 300px;\n       font-size: 1.75em;\n}\n\n.player .score {\ndisplay: inline-block;\nwidth: 100px;\n       text-align: right;\n       font-size: 2em;\n       font-weight: bold;\ncolor: #777;\n}\n\n.player.selected {\n  background-color: yellow;\ndisplay: inline-block;\n}\n\n.player.selected .score {\ncolor: black;\n}\n\n.details, .none {\n  font-weight: bold;\n  font-size: 2em;\n  border-style: dashed none none none;\n  border-color: #ccc;\n  border-width: 4px;\nmargin: 50px 10px;\npadding: 10px 0px;\n}\n\n.none {\ncolor: #777;\n}\n\ninput {\n  border-color: #006699;\n  border-style: solid;\n  border-width: 1px;\ncolor: #006699;\n}\n\n.standard_form {\nwidth: 400px;\nmargin: 0px;\npadding: 0px;\n}\n\n.standard_form label {\nfloat: left;\nwidth: 190px;\nclear: both;\nheight: 20px;\n}\n\n.standard_form input {\nfloat: right;\nwidth: 200px;\nheight: 20px;\n}\n\n.submit_links {\nclear: both;\n}\n\n.submit_links input {\nfloat: right;\nwidth: auto;\n}\n\n.leaderboard .player {\nwidth: 610px;\nclear: both;\n}\n\n.leaderboard .player .name {\nwidth: 300px;\nfloat: left;\n}\n\n.leaderboard .player .score {\nwidth: 300px;\nfloat: right;\n}\n```\nFor the final addition and where we get to see the true face of Meteor is within the javascript file.\nSo open leaderboard.js and we'll begin by taking apart the javascript section by section to make sure we understand what each part does and where we'll make additions to the sample code provided. \n\n```javascript\nPlayers = new Meteor.Collection(\"players\");\nPhotos = new Meteor.Collection(\"photos\");\n```\n\nThe first part is the addition of the Photos MongoDB Collection in addition to the regular Players Collection.\nThats simple enough but the interesting part we see next is how the each of the templates we coded in the HTML connects somehow to a Collection on the MongoDB.\nOne of the things I appreciate the most about the Meteor framework is how well they managed to make the connections between HTML templates and MongoDB collections crystal clear.\nIn particular pay attention to the conditional on the first line where we check whether the interaction is from the client.\nThis will become important later on where we describe what happens when the interation is on the server side.\nWhich is another cool thing about Meteor that you often don't see in a lot of other frameworks, clean separation between client and server object modeling. \nOften as I've seen before what happens is that the server side code is visibly connected to the database while its up to the developer to string together some sort of process for pushing the data to the client facing side.\n```javascript\nif (Meteor.is_client) {\n  Template.leaderboard.players = function () {\n    return Players.find({}, {sort: {score: -1, name: 1}});\n  };\n\n  Template.gallery.photos = function () {\n    return Photos.find({});\n  };\n\n  Template.leaderboard.selected_name = function () {\n    var player = Players.findOne(Session.get(\"selected_player\"));\n    return player && player.phone && player.name;\n  };\n\n  Template.player.selected = function () {\n    return Session.equals(\"selected_player\", this._id) ? \"selected\" : '';\n  };\n```\nNext fill in the various html events which are triggered based on client input on the page where the app is displayed. \nThe first event we'll code describes what happens when a user clicks the Image Upload button.\n```javascript\n    Template.leaderboard.events = {\n      'click input.uploadImg': function() {\n        var imgUrl = \"\";\n        imgUrl = $('#imgUrlText').val();\n        var imgSrc = imgUrl;\n\n        if( imgUrl != \"\" ) {\n          var player = Players.findOne(Session.get(\"selected_player\"));\n          Players.update(Session.get(\"selected_player\"), {$inc: {score: 343}});\n          Photos.insert({url: imgSrc, phone: player.phone });\n        }\n      }\n    };\n```\nThe code is pretty self explainatory but in short, we pull the image url, we take the selected player, increment her score and then insert the photo into our DB.\nThen we handle what happens when a playername is clicked... it just sets the selected player.\n```javascript\n    Template.player.events = {\n      'click': function () {\n        Session.set(\"selected_player\", this._id);\n      }\n    };\n```\nFinnally for the game template itself we need to handle two events, one in which a new player is added and the second when a new game is created.\n\nThe events for any template as you can tell by now is just a javascript Object so we can separate object member by a comma using a string as the key and function as the value.\n```javascript\n    Template.game.events = {\n      'click input.newGame': function () {\n        Players.remove({});\n        Photos.remove({});\n      },\n\n      'click input.addDrinker': function () {\n        var newScore = 0;\n        var newName = null;\n        var newPhoneNumber = null;\n\n        newPhoneNumber = $('#phoneText').val();\n        newName = $('#nameText').val();\n\n        if( $.trim(newName) != \"\" && $.trim(newPhoneNumber) != \"\" ) {\n          Players.insert({ name: newName, phone: newPhoneNumber, score: newScore });\n        }\n      }\n    };\n```\nFor the final part of the javascript we need to define how the Meteor server gets the data from the DB when the game is started which will then allow the client code to we coded above to behave properly.\n```javascript\n    if (Meteor.is_server) {\n      Meteor.startup(function () {\n          if (Players.find().count() === 0) {\n            var names = [\n            \"Click New Game\",\n            ];\n\n            for (var i = 0; i < names.length; i++) {\n              Players.insert({name: names[i], phone: \"\", score: 0});\n            }\n          }\n\n          if( Photos.find().count() === 0) {\n            var pics = [\n            \"http://upload.wikimedia.org/wikipedia/commons/e/e5/Pale_Ale.jpg\",\n            \"http://upload.wikimedia.org/wikipedia/commons/3/3e/Weizenbier.jpg\",\n            \"http://upload.wikimedia.org/wikipedia/commons/9/99/Glass_of_K%C3%B6stritzer_Schwarzbier.jpg\"\n            ];\n\n            for (var i = 0; i < pics.length; i++) {\n            Photos.insert({url: pics[i], phone: \"\"});\n            }\n          }\n      });\n    }\n```\nThe last thing you need to do in order to get the full code working together is to visit the github page for this code as this tutorial written here is more of in-depth documentation. So just git clone the project navigate to the main directory and run \"meteor\" from the terminal and browse to the site on your machine. \n\nIncluded within the GitHub code are the necessary image files you'll want as well.\n\n","slug":"boozenet","published":1,"updated":"2017-04-15T21:26:30.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr11000f9uwv18lvy1s5","content":"<p>In this tutorial I’ll discuss my experience developing and launching(and yes you’ll see how easy it is to launch with Meteor) a realtime javascript application using the Meteor framework; with its built in MongoDB shell and strong client server architecture Meteor is a powerful framework that should become popular for developers wishing to build fast realtime web applications.</p>\n<ul>\n<li><a href=\"https://github.com/taywils/Meteor_Tutorial_Code\" target=\"_blank\" rel=\"external\">Grab the code on GitHub</a></li>\n</ul>\n<p>To begin this tutorial the first thing you’ll want to do is to install the Meteor framework for NodeJs. </p>\n<p>Due to the nature of the framework under going constant updates, I won’t write down specifically how to install Meteor because I’ll then be forced to update this tutorial whenever the installation procedure changes. </p>\n<p>However I don’t see anything wrong with providing a link to the official Meteor documentation where you’ll find the download and installation instructions readily prepared for you. <a href=\"http://docs.meteor.com/#quickstart\" target=\"_blank\" rel=\"external\">Meteor Installation Guide</a> Once you have Meteor installed on your system you’re ready to go. If you’re running a Linux variant or Mac OSX then then the installation guide should be sufficient however, Windows users might require extra steps. </p>\n<p>Worry not though because if all else fails for getting Meteor running on Windows I suggest you just download and install a free copy of <a href=\"http://www.ubuntu.com/\" target=\"_blank\" rel=\"external\">Ubuntu Linux</a> and get it running first and then return to this tutorial.</p>\n<p>So now that you have Meteor up and running we’re going to start off by downloading the sample application “Leaderboard”. To do so go to the Meteor official documentation for the leaderboard sample app and follow the instructions <a href=\"http://www.meteor.com/examples/leaderboard\" target=\"_blank\" rel=\"external\">Meteor Leaderboard</a>. Once you have read through the instructions go ahead and give the sample application a test drive by changing into the directory of the application and entering “meteor” into you terminal window. </p>\n<p>Next the application should begin most likely on localhost:3000 which you can navigate to from your web browser of choice and view the application running live. </p>\n<p>Ok so far we have installed the Meteor framework; downloaded the sample app, ran the sample app and verified that we can navigate to the application from our browser and see it in action.<br>Now we’ll begin modifying the leaderboard so we can better understand the framework and take a gander into its design structure. </p>\n<p>From your terminal window open the directory where you placed the sample app; you should see three files leaderboard.css, leaderboard.html and leaderboard.js. </p>\n<p>Based on the file names you can easily tell that the first file we’re going to edit is the leaderboard.html since its the file which connects both the css and javascript.<br>Go ahead and open up leaderboard.html with your editor of choice.</p>\n<p>The re-branded sample application i.e fork of the leaderboard app we’re going to create is called Boozenet. Boozenet was the name of this application chosen the team I worked with during a previous Hackathon. </p>\n<p>Boozenet was an application developed for the sole purpose of allowing friends who drink together on nights out to keep track of not only the beer they drank but the total amount of calories.<br>This application was developed during a mobile Health themed hackathon so the caloric intake was supposed to be the main feature of the app but the fact that it was realtime and ran on mobile as well as web based clients was the most impressive feature after all.<br>Enough background, within leaderboard.html find the <head> and update its contents to appear as below.<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>BoozeNet<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div></pre></td></tr></table></figure></head></p>\n<p>In addition Meteor also has a custom jquery plugin, from the documentation to use the jquery plugin navigate to the directory of this application and run the following command from the terminal “meteor add jquery”.</p>\n<p>So far we’ve updated the title of the application and included jquery… not much but its a good start.<br>Moving onto the <body> tag you’ll notice the unfamiliar (if you’ve never used an HTML templating framework before) set of double curly braces. </body></p>\n<p>What these represent are places where we’ll substitute sections of HTML when the content is rendered on the browser once the templating javascript code scans over and updates the sections of the HTML marked with double curly braces when the application is ran.<br>Despite the large number of HTML templating engines available (just Google for it and you’ll see) the one pre-baked into the Meteor framework is a modern templating engine called Handlebars </p>\n<p><a href=\"http://handlebarsjs.com/\" target=\"_blank\" rel=\"external\">Click here for the Handlebarsjs Homepage</a>. </p>\n<p>If you want you can read all about how Handlebarsjs does its magic by browsing the its homepage but for now we’ll focus on applying it to extend the leaderboard sample application.<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"outer\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"beer_vector-200.png\"</span> /&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;&gt; game&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></div><div class=\"line\">  &#123;&#123;&gt; gallery &#125;&#125;</div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"none\"</span> /&gt;</span></div><div class=\"line\">  &#123;&#123;&gt; leaderboard&#125;&#125;</div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>First we’re going to explain how the gallery template works; once that is established hopefully the double curly brace syntax won’t appear so alien and you’ll start reading it as just another HTML element. What the gallery does for our application is showcase the snapshots (in this contrived example they will be hyperlinks to images on the web) of various beers that users of our app have consumed. All this really means is that the gallery template is a placeholder for images to be dynamically inserted at when the page is rendered from image links stored within out database.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">name</span>=<span class=\"string\">\"gallery\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"gallery\"</span>&gt;</span></div><div class=\"line\">&#123;&#123;#each photos&#125;&#125;</div><div class=\"line\">&#123;&#123;&gt; photo&#125;&#125;</div><div class=\"line\">&#123;&#123;/each&#125;&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>As you can probably already guess the <template> tag will substitute itself where the double braced enclosed word “gallery” appears earlier in the code.<br>If you thought it was going to be more complicated than that you were wrong, working with the handlebarsjs template engine is quite easy… although there are way more advanced features we won’t need to get into to those at this level of a tutorial.<br>The next template we’re going to create is the photo template which is to be  placed within the gallery template we just established.</template></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">name</span>=<span class=\"string\">\"photo\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">width</span>=<span class=\"string\">\"100\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"100\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"&#123;&#123;url&#125;&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>For those of you with eagle eyes you might have caught that the the template argument url differs slightly from the all previous template arguments we have passed thus far.<br>What the url lack is the leading &gt; just after the second left-curly brace.<br>How the absence of the &gt; affects the code will come into play later when you start writing the javascript code but for now just let it be.<br>Next we’ll need to template the leaderboard… its similar to the gallery but instead of photos wrapped within a each sub-template we’ll have players displayed instead.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">name</span>=<span class=\"string\">\"leaderboard\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"leaderboard\"</span>&gt;</span></div><div class=\"line\">&#123;&#123;#each players&#125;&#125;</div><div class=\"line\">&#123;&#123;&gt; player&#125;&#125;</div><div class=\"line\">&#123;&#123;/each&#125;&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">&#123;&#123;#if selected_name&#125;&#125;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"details\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"name\"</span>&gt;</span>Whats Up &#123;&#123;selected_name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"uploadImg\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"Add Photo\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&amp;#039;imgUrlText&amp;#039;</span> <span class=\"attr\">type</span>=<span class=\"string\">&amp;#039;text&amp;#039;</span> <span class=\"attr\">size</span>=<span class=\"string\">\"80\"</span> <span class=\"attr\">name</span>=<span class=\"string\">&amp;#039;imageUrl&amp;#039;</span> <span class=\"attr\">class</span>=<span class=\"string\">&amp;#039;imageUrl&amp;#039;</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">&#123;&#123;/if&#125;&#125;</div><div class=\"line\"></div><div class=\"line\">&#123;&#123;#unless selected_name&#125;&#125;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"none\"</span>&gt;</span>Click a player to select<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">&#123;&#123;/unless&#125;&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Since we have just defined where the players template is going to fit onto the leaderboard we now have to create a template for them as well.<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">name</span>=<span class=\"string\">\"player\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"player &#123;&#123;selected&#125;&#125;\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"name\"</span>&gt;</span>&#123;&#123;name&#125;&#125; | &#123;&#123;phone&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"score\"</span>&gt;</span>Calories &#123;&#123;score&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>Another thing you might have noticed is that in the above code the double curly brace appears within the value of the class tag.<br>Which means that you can even inject templates within css; pretty cool if I’d say so.<br>Moving on notice how the template references whether or not the player has been selected.<br>That will become important once we get to the javascript part of this application where we’ll actually define the events which take place when those conditionals are satisfied.<br>Lastly all we have to do now is define the game template, which is just where we have our input form for new players.<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">name</span>=<span class=\"string\">\"game\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"newGame\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"newGame\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"New Game\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">class</span>=<span class=\"string\">\"standard_form\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Enter Phone#:<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&amp;#039;phoneText&amp;#039;</span> <span class=\"attr\">type</span>=<span class=\"string\">&amp;#039;text&amp;#039;</span> <span class=\"attr\">name</span>=<span class=\"string\">&amp;#039;phoneNumber&amp;#039;</span> <span class=\"attr\">class</span>=<span class=\"string\">&amp;#039;phoneNumber&amp;#039;</span> /&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Enter Name:<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&amp;#039;nameText&amp;#039;</span> <span class=\"attr\">type</span>=<span class=\"string\">&amp;#039;text&amp;#039;</span> <span class=\"attr\">name</span>=<span class=\"string\">&amp;#039;newName&amp;#039;</span> <span class=\"attr\">class</span>=<span class=\"string\">&amp;#039;newName&amp;#039;</span> /&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"submit_links\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"addDrinker\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"Join\"</span> /&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>Now we are done with leaderboard.html.</p>\n<p>Below is the CSS for leaderboard.css there isn’t much to the CSS so just read through it if you want.<br>Besides that you might just want to flat out replace your leaderboard.css instead of making additions to the file like we did for the html page.<br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">body</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">font-family</span>: <span class=\"string\">'Helvetica Neue'</span>, Helvetica, Arial, san-serif;</div><div class=\"line\">  <span class=\"attribute\">font-weight</span>: <span class=\"number\">200</span>;</div><div class=\"line\"><span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> <span class=\"number\">0</span>;</div><div class=\"line\"><span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</div><div class=\"line\">         <span class=\"attribute\">-webkit-user-select</span>: none;</div><div class=\"line\">         <span class=\"attribute\">-khtml-user-select</span>: none;</div><div class=\"line\">         <span class=\"attribute\">-moz-user-select</span>: none;</div><div class=\"line\">         <span class=\"attribute\">-o-user-select</span>: none;</div><div class=\"line\">         <span class=\"attribute\">user-select</span>: none;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-id\">#outer</span> &#123;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">700px</span>;</div><div class=\"line\"><span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;    </div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.player</span> &#123;</div><div class=\"line\"><span class=\"attribute\">padding</span>: <span class=\"number\">5px</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.player</span> <span class=\"selector-class\">.name</span> &#123;</div><div class=\"line\"><span class=\"attribute\">display</span>: inline-block;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</div><div class=\"line\">       <span class=\"attribute\">font-size</span>: <span class=\"number\">1.75em</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.player</span> <span class=\"selector-class\">.score</span> &#123;</div><div class=\"line\"><span class=\"attribute\">display</span>: inline-block;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</div><div class=\"line\">       <span class=\"attribute\">text-align</span>: right;</div><div class=\"line\">       <span class=\"attribute\">font-size</span>: <span class=\"number\">2em</span>;</div><div class=\"line\">       <span class=\"attribute\">font-weight</span>: bold;</div><div class=\"line\"><span class=\"attribute\">color</span>: <span class=\"number\">#777</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.player</span><span class=\"selector-class\">.selected</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">background-color</span>: yellow;</div><div class=\"line\"><span class=\"attribute\">display</span>: inline-block;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.player</span><span class=\"selector-class\">.selected</span> <span class=\"selector-class\">.score</span> &#123;</div><div class=\"line\"><span class=\"attribute\">color</span>: black;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.details</span>, <span class=\"selector-class\">.none</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">font-weight</span>: bold;</div><div class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">2em</span>;</div><div class=\"line\">  <span class=\"attribute\">border-style</span>: dashed none none none;</div><div class=\"line\">  <span class=\"attribute\">border-color</span>: <span class=\"number\">#ccc</span>;</div><div class=\"line\">  <span class=\"attribute\">border-width</span>: <span class=\"number\">4px</span>;</div><div class=\"line\"><span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> <span class=\"number\">10px</span>;</div><div class=\"line\"><span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">0px</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.none</span> &#123;</div><div class=\"line\"><span class=\"attribute\">color</span>: <span class=\"number\">#777</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-tag\">input</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">border-color</span>: <span class=\"number\">#006699</span>;</div><div class=\"line\">  <span class=\"attribute\">border-style</span>: solid;</div><div class=\"line\">  <span class=\"attribute\">border-width</span>: <span class=\"number\">1px</span>;</div><div class=\"line\"><span class=\"attribute\">color</span>: <span class=\"number\">#006699</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.standard_form</span> &#123;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">400px</span>;</div><div class=\"line\"><span class=\"attribute\">margin</span>: <span class=\"number\">0px</span>;</div><div class=\"line\"><span class=\"attribute\">padding</span>: <span class=\"number\">0px</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.standard_form</span> <span class=\"selector-tag\">label</span> &#123;</div><div class=\"line\"><span class=\"attribute\">float</span>: left;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">190px</span>;</div><div class=\"line\"><span class=\"attribute\">clear</span>: both;</div><div class=\"line\"><span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.standard_form</span> <span class=\"selector-tag\">input</span> &#123;</div><div class=\"line\"><span class=\"attribute\">float</span>: right;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</div><div class=\"line\"><span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.submit_links</span> &#123;</div><div class=\"line\"><span class=\"attribute\">clear</span>: both;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.submit_links</span> <span class=\"selector-tag\">input</span> &#123;</div><div class=\"line\"><span class=\"attribute\">float</span>: right;</div><div class=\"line\"><span class=\"attribute\">width</span>: auto;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.leaderboard</span> <span class=\"selector-class\">.player</span> &#123;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">610px</span>;</div><div class=\"line\"><span class=\"attribute\">clear</span>: both;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.leaderboard</span> <span class=\"selector-class\">.player</span> <span class=\"selector-class\">.name</span> &#123;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</div><div class=\"line\"><span class=\"attribute\">float</span>: left;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.leaderboard</span> <span class=\"selector-class\">.player</span> <span class=\"selector-class\">.score</span> &#123;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</div><div class=\"line\"><span class=\"attribute\">float</span>: right;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>For the final addition and where we get to see the true face of Meteor is within the javascript file.<br>So open leaderboard.js and we’ll begin by taking apart the javascript section by section to make sure we understand what each part does and where we’ll make additions to the sample code provided. </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">Players = <span class=\"keyword\">new</span> Meteor.Collection(<span class=\"string\">\"players\"</span>);</div><div class=\"line\">Photos = <span class=\"keyword\">new</span> Meteor.Collection(<span class=\"string\">\"photos\"</span>);</div></pre></td></tr></table></figure>\n<p>The first part is the addition of the Photos MongoDB Collection in addition to the regular Players Collection.<br>Thats simple enough but the interesting part we see next is how the each of the templates we coded in the HTML connects somehow to a Collection on the MongoDB.<br>One of the things I appreciate the most about the Meteor framework is how well they managed to make the connections between HTML templates and MongoDB collections crystal clear.<br>In particular pay attention to the conditional on the first line where we check whether the interaction is from the client.<br>This will become important later on where we describe what happens when the interation is on the server side.<br>Which is another cool thing about Meteor that you often don’t see in a lot of other frameworks, clean separation between client and server object modeling.<br>Often as I’ve seen before what happens is that the server side code is visibly connected to the database while its up to the developer to string together some sort of process for pushing the data to the client facing side.<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> (Meteor.is_client) &#123;</div><div class=\"line\">  Template.leaderboard.players = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> Players.find(&#123;&#125;, &#123;<span class=\"attr\">sort</span>: &#123;<span class=\"attr\">score</span>: <span class=\"number\">-1</span>, <span class=\"attr\">name</span>: <span class=\"number\">1</span>&#125;&#125;);</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  Template.gallery.photos = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> Photos.find(&#123;&#125;);</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  Template.leaderboard.selected_name = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> player = Players.findOne(Session.get(<span class=\"string\">\"selected_player\"</span>));</div><div class=\"line\">    <span class=\"keyword\">return</span> player &amp;&amp; player.phone &amp;&amp; player.name;</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  Template.player.selected = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> Session.equals(<span class=\"string\">\"selected_player\"</span>, <span class=\"keyword\">this</span>._id) ? <span class=\"string\">\"selected\"</span> : <span class=\"string\">''</span>;</div><div class=\"line\">  &#125;;</div></pre></td></tr></table></figure></p>\n<p>Next fill in the various html events which are triggered based on client input on the page where the app is displayed.<br>The first event we’ll code describes what happens when a user clicks the Image Upload button.<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">Template.leaderboard.events = &#123;</div><div class=\"line\">  <span class=\"string\">'click input.uploadImg'</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> imgUrl = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    imgUrl = $(<span class=\"string\">'#imgUrlText'</span>).val();</div><div class=\"line\">    <span class=\"keyword\">var</span> imgSrc = imgUrl;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( imgUrl != <span class=\"string\">\"\"</span> ) &#123;</div><div class=\"line\">      <span class=\"keyword\">var</span> player = Players.findOne(Session.get(<span class=\"string\">\"selected_player\"</span>));</div><div class=\"line\">      Players.update(Session.get(<span class=\"string\">\"selected_player\"</span>), &#123;<span class=\"attr\">$inc</span>: &#123;<span class=\"attr\">score</span>: <span class=\"number\">343</span>&#125;&#125;);</div><div class=\"line\">      Photos.insert(&#123;<span class=\"attr\">url</span>: imgSrc, <span class=\"attr\">phone</span>: player.phone &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure></p>\n<p>The code is pretty self explainatory but in short, we pull the image url, we take the selected player, increment her score and then insert the photo into our DB.<br>Then we handle what happens when a playername is clicked… it just sets the selected player.<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">Template.player.events = &#123;</div><div class=\"line\">  <span class=\"string\">'click'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    Session.set(<span class=\"string\">\"selected_player\"</span>, <span class=\"keyword\">this</span>._id);</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure></p>\n<p>Finnally for the game template itself we need to handle two events, one in which a new player is added and the second when a new game is created.</p>\n<p>The events for any template as you can tell by now is just a javascript Object so we can separate object member by a comma using a string as the key and function as the value.<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">Template.game.events = &#123;</div><div class=\"line\">  <span class=\"string\">'click input.newGame'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    Players.remove(&#123;&#125;);</div><div class=\"line\">    Photos.remove(&#123;&#125;);</div><div class=\"line\">  &#125;,</div><div class=\"line\"></div><div class=\"line\">  <span class=\"string\">'click input.addDrinker'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> newScore = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> newName = <span class=\"literal\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> newPhoneNumber = <span class=\"literal\">null</span>;</div><div class=\"line\"></div><div class=\"line\">    newPhoneNumber = $(<span class=\"string\">'#phoneText'</span>).val();</div><div class=\"line\">    newName = $(<span class=\"string\">'#nameText'</span>).val();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( $.trim(newName) != <span class=\"string\">\"\"</span> &amp;&amp; $.trim(newPhoneNumber) != <span class=\"string\">\"\"</span> ) &#123;</div><div class=\"line\">      Players.insert(&#123; <span class=\"attr\">name</span>: newName, <span class=\"attr\">phone</span>: newPhoneNumber, <span class=\"attr\">score</span>: newScore &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure></p>\n<p>For the final part of the javascript we need to define how the Meteor server gets the data from the DB when the game is started which will then allow the client code to we coded above to behave properly.<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> (Meteor.is_server) &#123;</div><div class=\"line\">  Meteor.startup(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> (Players.find().count() === <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> names = [</div><div class=\"line\">        <span class=\"string\">\"Click New Game\"</span>,</div><div class=\"line\">        ];</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; names.length; i++) &#123;</div><div class=\"line\">          Players.insert(&#123;<span class=\"attr\">name</span>: names[i], <span class=\"attr\">phone</span>: <span class=\"string\">\"\"</span>, <span class=\"attr\">score</span>: <span class=\"number\">0</span>&#125;);</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>( Photos.find().count() === <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> pics = [</div><div class=\"line\">        <span class=\"string\">\"http://upload.wikimedia.org/wikipedia/commons/e/e5/Pale_Ale.jpg\"</span>,</div><div class=\"line\">        <span class=\"string\">\"http://upload.wikimedia.org/wikipedia/commons/3/3e/Weizenbier.jpg\"</span>,</div><div class=\"line\">        <span class=\"string\">\"http://upload.wikimedia.org/wikipedia/commons/9/99/Glass_of_K%C3%B6stritzer_Schwarzbier.jpg\"</span></div><div class=\"line\">        ];</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; pics.length; i++) &#123;</div><div class=\"line\">        Photos.insert(&#123;<span class=\"attr\">url</span>: pics[i], <span class=\"attr\">phone</span>: <span class=\"string\">\"\"</span>&#125;);</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">  &#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The last thing you need to do in order to get the full code working together is to visit the github page for this code as this tutorial written here is more of in-depth documentation. So just git clone the project navigate to the main directory and run “meteor” from the terminal and browse to the site on your machine. </p>\n<p>Included within the GitHub code are the necessary image files you’ll want as well.</p>\n","site":{"data":{}},"excerpt":"","more":"<p>In this tutorial I’ll discuss my experience developing and launching(and yes you’ll see how easy it is to launch with Meteor) a realtime javascript application using the Meteor framework; with its built in MongoDB shell and strong client server architecture Meteor is a powerful framework that should become popular for developers wishing to build fast realtime web applications.</p>\n<ul>\n<li><a href=\"https://github.com/taywils/Meteor_Tutorial_Code\">Grab the code on GitHub</a></li>\n</ul>\n<p>To begin this tutorial the first thing you’ll want to do is to install the Meteor framework for NodeJs. </p>\n<p>Due to the nature of the framework under going constant updates, I won’t write down specifically how to install Meteor because I’ll then be forced to update this tutorial whenever the installation procedure changes. </p>\n<p>However I don’t see anything wrong with providing a link to the official Meteor documentation where you’ll find the download and installation instructions readily prepared for you. <a href=\"http://docs.meteor.com/#quickstart\">Meteor Installation Guide</a> Once you have Meteor installed on your system you’re ready to go. If you’re running a Linux variant or Mac OSX then then the installation guide should be sufficient however, Windows users might require extra steps. </p>\n<p>Worry not though because if all else fails for getting Meteor running on Windows I suggest you just download and install a free copy of <a href=\"http://www.ubuntu.com/\">Ubuntu Linux</a> and get it running first and then return to this tutorial.</p>\n<p>So now that you have Meteor up and running we’re going to start off by downloading the sample application “Leaderboard”. To do so go to the Meteor official documentation for the leaderboard sample app and follow the instructions <a href=\"http://www.meteor.com/examples/leaderboard\">Meteor Leaderboard</a>. Once you have read through the instructions go ahead and give the sample application a test drive by changing into the directory of the application and entering “meteor” into you terminal window. </p>\n<p>Next the application should begin most likely on localhost:3000 which you can navigate to from your web browser of choice and view the application running live. </p>\n<p>Ok so far we have installed the Meteor framework; downloaded the sample app, ran the sample app and verified that we can navigate to the application from our browser and see it in action.<br>Now we’ll begin modifying the leaderboard so we can better understand the framework and take a gander into its design structure. </p>\n<p>From your terminal window open the directory where you placed the sample app; you should see three files leaderboard.css, leaderboard.html and leaderboard.js. </p>\n<p>Based on the file names you can easily tell that the first file we’re going to edit is the leaderboard.html since its the file which connects both the css and javascript.<br>Go ahead and open up leaderboard.html with your editor of choice.</p>\n<p>The re-branded sample application i.e fork of the leaderboard app we’re going to create is called Boozenet. Boozenet was the name of this application chosen the team I worked with during a previous Hackathon. </p>\n<p>Boozenet was an application developed for the sole purpose of allowing friends who drink together on nights out to keep track of not only the beer they drank but the total amount of calories.<br>This application was developed during a mobile Health themed hackathon so the caloric intake was supposed to be the main feature of the app but the fact that it was realtime and ran on mobile as well as web based clients was the most impressive feature after all.<br>Enough background, within leaderboard.html find the <head> and update its contents to appear as below.<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>BoozeNet<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>In addition Meteor also has a custom jquery plugin, from the documentation to use the jquery plugin navigate to the directory of this application and run the following command from the terminal “meteor add jquery”.</p>\n<p>So far we’ve updated the title of the application and included jquery… not much but its a good start.<br>Moving onto the <body> tag you’ll notice the unfamiliar (if you’ve never used an HTML templating framework before) set of double curly braces. </p>\n<p>What these represent are places where we’ll substitute sections of HTML when the content is rendered on the browser once the templating javascript code scans over and updates the sections of the HTML marked with double curly braces when the application is ran.<br>Despite the large number of HTML templating engines available (just Google for it and you’ll see) the one pre-baked into the Meteor framework is a modern templating engine called Handlebars </p>\n<p><a href=\"http://handlebarsjs.com/\">Click here for the Handlebarsjs Homepage</a>. </p>\n<p>If you want you can read all about how Handlebarsjs does its magic by browsing the its homepage but for now we’ll focus on applying it to extend the leaderboard sample application.<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"outer\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"beer_vector-200.png\"</span> /&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;&gt; game&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></div><div class=\"line\">  &#123;&#123;&gt; gallery &#125;&#125;</div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"none\"</span> /&gt;</span></div><div class=\"line\">  &#123;&#123;&gt; leaderboard&#125;&#125;</div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>First we’re going to explain how the gallery template works; once that is established hopefully the double curly brace syntax won’t appear so alien and you’ll start reading it as just another HTML element. What the gallery does for our application is showcase the snapshots (in this contrived example they will be hyperlinks to images on the web) of various beers that users of our app have consumed. All this really means is that the gallery template is a placeholder for images to be dynamically inserted at when the page is rendered from image links stored within out database.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">name</span>=<span class=\"string\">\"gallery\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"gallery\"</span>&gt;</span></div><div class=\"line\">&#123;&#123;#each photos&#125;&#125;</div><div class=\"line\">&#123;&#123;&gt; photo&#125;&#125;</div><div class=\"line\">&#123;&#123;/each&#125;&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>As you can probably already guess the <template> tag will substitute itself where the double braced enclosed word “gallery” appears earlier in the code.<br>If you thought it was going to be more complicated than that you were wrong, working with the handlebarsjs template engine is quite easy… although there are way more advanced features we won’t need to get into to those at this level of a tutorial.<br>The next template we’re going to create is the photo template which is to be  placed within the gallery template we just established.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">name</span>=<span class=\"string\">\"photo\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">width</span>=<span class=\"string\">\"100\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"100\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"&#123;&#123;url&#125;&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>For those of you with eagle eyes you might have caught that the the template argument url differs slightly from the all previous template arguments we have passed thus far.<br>What the url lack is the leading &gt; just after the second left-curly brace.<br>How the absence of the &gt; affects the code will come into play later when you start writing the javascript code but for now just let it be.<br>Next we’ll need to template the leaderboard… its similar to the gallery but instead of photos wrapped within a each sub-template we’ll have players displayed instead.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">name</span>=<span class=\"string\">\"leaderboard\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"leaderboard\"</span>&gt;</span></div><div class=\"line\">&#123;&#123;#each players&#125;&#125;</div><div class=\"line\">&#123;&#123;&gt; player&#125;&#125;</div><div class=\"line\">&#123;&#123;/each&#125;&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">&#123;&#123;#if selected_name&#125;&#125;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"details\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"name\"</span>&gt;</span>Whats Up &#123;&#123;selected_name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"uploadImg\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"Add Photo\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&amp;#039;imgUrlText&amp;#039;</span> <span class=\"attr\">type</span>=<span class=\"string\">&amp;#039;text&amp;#039;</span> <span class=\"attr\">size</span>=<span class=\"string\">\"80\"</span> <span class=\"attr\">name</span>=<span class=\"string\">&amp;#039;imageUrl&amp;#039;</span> <span class=\"attr\">class</span>=<span class=\"string\">&amp;#039;imageUrl&amp;#039;</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">&#123;&#123;/if&#125;&#125;</div><div class=\"line\"></div><div class=\"line\">&#123;&#123;#unless selected_name&#125;&#125;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"none\"</span>&gt;</span>Click a player to select<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">&#123;&#123;/unless&#125;&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Since we have just defined where the players template is going to fit onto the leaderboard we now have to create a template for them as well.<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">name</span>=<span class=\"string\">\"player\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"player &#123;&#123;selected&#125;&#125;\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"name\"</span>&gt;</span>&#123;&#123;name&#125;&#125; | &#123;&#123;phone&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"score\"</span>&gt;</span>Calories &#123;&#123;score&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>Another thing you might have noticed is that in the above code the double curly brace appears within the value of the class tag.<br>Which means that you can even inject templates within css; pretty cool if I’d say so.<br>Moving on notice how the template references whether or not the player has been selected.<br>That will become important once we get to the javascript part of this application where we’ll actually define the events which take place when those conditionals are satisfied.<br>Lastly all we have to do now is define the game template, which is just where we have our input form for new players.<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">name</span>=<span class=\"string\">\"game\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"newGame\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"newGame\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"New Game\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">class</span>=<span class=\"string\">\"standard_form\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Enter Phone#:<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&amp;#039;phoneText&amp;#039;</span> <span class=\"attr\">type</span>=<span class=\"string\">&amp;#039;text&amp;#039;</span> <span class=\"attr\">name</span>=<span class=\"string\">&amp;#039;phoneNumber&amp;#039;</span> <span class=\"attr\">class</span>=<span class=\"string\">&amp;#039;phoneNumber&amp;#039;</span> /&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Enter Name:<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&amp;#039;nameText&amp;#039;</span> <span class=\"attr\">type</span>=<span class=\"string\">&amp;#039;text&amp;#039;</span> <span class=\"attr\">name</span>=<span class=\"string\">&amp;#039;newName&amp;#039;</span> <span class=\"attr\">class</span>=<span class=\"string\">&amp;#039;newName&amp;#039;</span> /&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"submit_links\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"addDrinker\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"Join\"</span> /&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>Now we are done with leaderboard.html.</p>\n<p>Below is the CSS for leaderboard.css there isn’t much to the CSS so just read through it if you want.<br>Besides that you might just want to flat out replace your leaderboard.css instead of making additions to the file like we did for the html page.<br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">body</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">font-family</span>: <span class=\"string\">'Helvetica Neue'</span>, Helvetica, Arial, san-serif;</div><div class=\"line\">  <span class=\"attribute\">font-weight</span>: <span class=\"number\">200</span>;</div><div class=\"line\"><span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> <span class=\"number\">0</span>;</div><div class=\"line\"><span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</div><div class=\"line\">         <span class=\"attribute\">-webkit-user-select</span>: none;</div><div class=\"line\">         <span class=\"attribute\">-khtml-user-select</span>: none;</div><div class=\"line\">         <span class=\"attribute\">-moz-user-select</span>: none;</div><div class=\"line\">         <span class=\"attribute\">-o-user-select</span>: none;</div><div class=\"line\">         <span class=\"attribute\">user-select</span>: none;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-id\">#outer</span> &#123;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">700px</span>;</div><div class=\"line\"><span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;    </div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.player</span> &#123;</div><div class=\"line\"><span class=\"attribute\">padding</span>: <span class=\"number\">5px</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.player</span> <span class=\"selector-class\">.name</span> &#123;</div><div class=\"line\"><span class=\"attribute\">display</span>: inline-block;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</div><div class=\"line\">       <span class=\"attribute\">font-size</span>: <span class=\"number\">1.75em</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.player</span> <span class=\"selector-class\">.score</span> &#123;</div><div class=\"line\"><span class=\"attribute\">display</span>: inline-block;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</div><div class=\"line\">       <span class=\"attribute\">text-align</span>: right;</div><div class=\"line\">       <span class=\"attribute\">font-size</span>: <span class=\"number\">2em</span>;</div><div class=\"line\">       <span class=\"attribute\">font-weight</span>: bold;</div><div class=\"line\"><span class=\"attribute\">color</span>: <span class=\"number\">#777</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.player</span><span class=\"selector-class\">.selected</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">background-color</span>: yellow;</div><div class=\"line\"><span class=\"attribute\">display</span>: inline-block;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.player</span><span class=\"selector-class\">.selected</span> <span class=\"selector-class\">.score</span> &#123;</div><div class=\"line\"><span class=\"attribute\">color</span>: black;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.details</span>, <span class=\"selector-class\">.none</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">font-weight</span>: bold;</div><div class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">2em</span>;</div><div class=\"line\">  <span class=\"attribute\">border-style</span>: dashed none none none;</div><div class=\"line\">  <span class=\"attribute\">border-color</span>: <span class=\"number\">#ccc</span>;</div><div class=\"line\">  <span class=\"attribute\">border-width</span>: <span class=\"number\">4px</span>;</div><div class=\"line\"><span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> <span class=\"number\">10px</span>;</div><div class=\"line\"><span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">0px</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.none</span> &#123;</div><div class=\"line\"><span class=\"attribute\">color</span>: <span class=\"number\">#777</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-tag\">input</span> &#123;</div><div class=\"line\">  <span class=\"attribute\">border-color</span>: <span class=\"number\">#006699</span>;</div><div class=\"line\">  <span class=\"attribute\">border-style</span>: solid;</div><div class=\"line\">  <span class=\"attribute\">border-width</span>: <span class=\"number\">1px</span>;</div><div class=\"line\"><span class=\"attribute\">color</span>: <span class=\"number\">#006699</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.standard_form</span> &#123;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">400px</span>;</div><div class=\"line\"><span class=\"attribute\">margin</span>: <span class=\"number\">0px</span>;</div><div class=\"line\"><span class=\"attribute\">padding</span>: <span class=\"number\">0px</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.standard_form</span> <span class=\"selector-tag\">label</span> &#123;</div><div class=\"line\"><span class=\"attribute\">float</span>: left;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">190px</span>;</div><div class=\"line\"><span class=\"attribute\">clear</span>: both;</div><div class=\"line\"><span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.standard_form</span> <span class=\"selector-tag\">input</span> &#123;</div><div class=\"line\"><span class=\"attribute\">float</span>: right;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</div><div class=\"line\"><span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.submit_links</span> &#123;</div><div class=\"line\"><span class=\"attribute\">clear</span>: both;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.submit_links</span> <span class=\"selector-tag\">input</span> &#123;</div><div class=\"line\"><span class=\"attribute\">float</span>: right;</div><div class=\"line\"><span class=\"attribute\">width</span>: auto;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.leaderboard</span> <span class=\"selector-class\">.player</span> &#123;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">610px</span>;</div><div class=\"line\"><span class=\"attribute\">clear</span>: both;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.leaderboard</span> <span class=\"selector-class\">.player</span> <span class=\"selector-class\">.name</span> &#123;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</div><div class=\"line\"><span class=\"attribute\">float</span>: left;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.leaderboard</span> <span class=\"selector-class\">.player</span> <span class=\"selector-class\">.score</span> &#123;</div><div class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</div><div class=\"line\"><span class=\"attribute\">float</span>: right;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>For the final addition and where we get to see the true face of Meteor is within the javascript file.<br>So open leaderboard.js and we’ll begin by taking apart the javascript section by section to make sure we understand what each part does and where we’ll make additions to the sample code provided. </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">Players = <span class=\"keyword\">new</span> Meteor.Collection(<span class=\"string\">\"players\"</span>);</div><div class=\"line\">Photos = <span class=\"keyword\">new</span> Meteor.Collection(<span class=\"string\">\"photos\"</span>);</div></pre></td></tr></table></figure>\n<p>The first part is the addition of the Photos MongoDB Collection in addition to the regular Players Collection.<br>Thats simple enough but the interesting part we see next is how the each of the templates we coded in the HTML connects somehow to a Collection on the MongoDB.<br>One of the things I appreciate the most about the Meteor framework is how well they managed to make the connections between HTML templates and MongoDB collections crystal clear.<br>In particular pay attention to the conditional on the first line where we check whether the interaction is from the client.<br>This will become important later on where we describe what happens when the interation is on the server side.<br>Which is another cool thing about Meteor that you often don’t see in a lot of other frameworks, clean separation between client and server object modeling.<br>Often as I’ve seen before what happens is that the server side code is visibly connected to the database while its up to the developer to string together some sort of process for pushing the data to the client facing side.<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> (Meteor.is_client) &#123;</div><div class=\"line\">  Template.leaderboard.players = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> Players.find(&#123;&#125;, &#123;<span class=\"attr\">sort</span>: &#123;<span class=\"attr\">score</span>: <span class=\"number\">-1</span>, <span class=\"attr\">name</span>: <span class=\"number\">1</span>&#125;&#125;);</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  Template.gallery.photos = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> Photos.find(&#123;&#125;);</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  Template.leaderboard.selected_name = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> player = Players.findOne(Session.get(<span class=\"string\">\"selected_player\"</span>));</div><div class=\"line\">    <span class=\"keyword\">return</span> player &amp;&amp; player.phone &amp;&amp; player.name;</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  Template.player.selected = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> Session.equals(<span class=\"string\">\"selected_player\"</span>, <span class=\"keyword\">this</span>._id) ? <span class=\"string\">\"selected\"</span> : <span class=\"string\">''</span>;</div><div class=\"line\">  &#125;;</div></pre></td></tr></table></figure></p>\n<p>Next fill in the various html events which are triggered based on client input on the page where the app is displayed.<br>The first event we’ll code describes what happens when a user clicks the Image Upload button.<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">Template.leaderboard.events = &#123;</div><div class=\"line\">  <span class=\"string\">'click input.uploadImg'</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> imgUrl = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    imgUrl = $(<span class=\"string\">'#imgUrlText'</span>).val();</div><div class=\"line\">    <span class=\"keyword\">var</span> imgSrc = imgUrl;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( imgUrl != <span class=\"string\">\"\"</span> ) &#123;</div><div class=\"line\">      <span class=\"keyword\">var</span> player = Players.findOne(Session.get(<span class=\"string\">\"selected_player\"</span>));</div><div class=\"line\">      Players.update(Session.get(<span class=\"string\">\"selected_player\"</span>), &#123;<span class=\"attr\">$inc</span>: &#123;<span class=\"attr\">score</span>: <span class=\"number\">343</span>&#125;&#125;);</div><div class=\"line\">      Photos.insert(&#123;<span class=\"attr\">url</span>: imgSrc, <span class=\"attr\">phone</span>: player.phone &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure></p>\n<p>The code is pretty self explainatory but in short, we pull the image url, we take the selected player, increment her score and then insert the photo into our DB.<br>Then we handle what happens when a playername is clicked… it just sets the selected player.<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">Template.player.events = &#123;</div><div class=\"line\">  <span class=\"string\">'click'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    Session.set(<span class=\"string\">\"selected_player\"</span>, <span class=\"keyword\">this</span>._id);</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure></p>\n<p>Finnally for the game template itself we need to handle two events, one in which a new player is added and the second when a new game is created.</p>\n<p>The events for any template as you can tell by now is just a javascript Object so we can separate object member by a comma using a string as the key and function as the value.<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">Template.game.events = &#123;</div><div class=\"line\">  <span class=\"string\">'click input.newGame'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    Players.remove(&#123;&#125;);</div><div class=\"line\">    Photos.remove(&#123;&#125;);</div><div class=\"line\">  &#125;,</div><div class=\"line\"></div><div class=\"line\">  <span class=\"string\">'click input.addDrinker'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> newScore = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> newName = <span class=\"literal\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> newPhoneNumber = <span class=\"literal\">null</span>;</div><div class=\"line\"></div><div class=\"line\">    newPhoneNumber = $(<span class=\"string\">'#phoneText'</span>).val();</div><div class=\"line\">    newName = $(<span class=\"string\">'#nameText'</span>).val();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( $.trim(newName) != <span class=\"string\">\"\"</span> &amp;&amp; $.trim(newPhoneNumber) != <span class=\"string\">\"\"</span> ) &#123;</div><div class=\"line\">      Players.insert(&#123; <span class=\"attr\">name</span>: newName, <span class=\"attr\">phone</span>: newPhoneNumber, <span class=\"attr\">score</span>: newScore &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure></p>\n<p>For the final part of the javascript we need to define how the Meteor server gets the data from the DB when the game is started which will then allow the client code to we coded above to behave properly.<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> (Meteor.is_server) &#123;</div><div class=\"line\">  Meteor.startup(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> (Players.find().count() === <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> names = [</div><div class=\"line\">        <span class=\"string\">\"Click New Game\"</span>,</div><div class=\"line\">        ];</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; names.length; i++) &#123;</div><div class=\"line\">          Players.insert(&#123;<span class=\"attr\">name</span>: names[i], <span class=\"attr\">phone</span>: <span class=\"string\">\"\"</span>, <span class=\"attr\">score</span>: <span class=\"number\">0</span>&#125;);</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>( Photos.find().count() === <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> pics = [</div><div class=\"line\">        <span class=\"string\">\"http://upload.wikimedia.org/wikipedia/commons/e/e5/Pale_Ale.jpg\"</span>,</div><div class=\"line\">        <span class=\"string\">\"http://upload.wikimedia.org/wikipedia/commons/3/3e/Weizenbier.jpg\"</span>,</div><div class=\"line\">        <span class=\"string\">\"http://upload.wikimedia.org/wikipedia/commons/9/99/Glass_of_K%C3%B6stritzer_Schwarzbier.jpg\"</span></div><div class=\"line\">        ];</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; pics.length; i++) &#123;</div><div class=\"line\">        Photos.insert(&#123;<span class=\"attr\">url</span>: pics[i], <span class=\"attr\">phone</span>: <span class=\"string\">\"\"</span>&#125;);</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">  &#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The last thing you need to do in order to get the full code working together is to visit the github page for this code as this tutorial written here is more of in-depth documentation. So just git clone the project navigate to the main directory and run “meteor” from the terminal and browse to the site on your machine. </p>\n<p>Included within the GitHub code are the necessary image files you’ll want as well.</p>\n"},{"title":"Build An Application Launcher For Android","date":"2011-07-05T07:00:00.000Z","_content":"In this tutorial we'll create an interesting android application which has the ability to launch any other app you have installed on your phone. If you've ever wanted to know how Android applications perform cross app communication you should read on(this tutorial assumes familiarity with the Android API).\n\nTo start off create a new Android application project within Eclipse. Whenever I develop Android apps I usually start with the layout of the application and add functionality via Java classes later. Since our app will display the users installed apps within a ListView widget we have to first declare a layout to hold the ListView itself.\n\nCreate a new xml layout for the ListView by right clicking the res/layout folder and adding a new android xml file. Title it \"applauncher.xml\" and then add the code below to it.\n\n```xml\n<LinearLayout\nxmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\nandroid:id=&quot;@+id/applauncher_linearlayout&quot;\nandroid:layout_width=&quot;fill_parent&quot;\nandroid:layout_height=&quot;fill_parent&quot;\nandroid:orientation=&quot;vertical&quot;>\n\n<ListView\nandroid:id=&quot;@android:id/list&quot;\nandroid:layout_width=&quot;fill_parent&quot;\nandroid:layout_height=&quot;fill_parent&quot;/>\n\n<TextView\nandroid:id=&quot;@android:id/empty&quot;\nandroid:layout_width=&quot;fill_parent&quot;\nandroid:layout_height=&quot;fill_parent&quot;\nandroid:text=&quot;List PlaceHolder&quot;/>\n\n</LinearLayout>\n```\nWhen using ListViews we can setup the overall look of each row by creating an xml layout with a skeleton of the widgets that we want to display in each row of our ListView. Think of the row layout as a \"row template\". If you look at the screenshots of the app you can tell that we only need two widgets within our row layout, an ImageView to hold the apps icon and a TextView to display the apps package name.\n\nCreate a new xml layout for the ListView rows by right clicking the res/layout folder and adding a new android xml file. Title it \"applauncherrow.xml\" and add the code below.\n```xml\n<LinearLayout\nxmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\nandroid:id=&quot;@+id/applauncherrow_imagelinearlayout&quot;\nandroid:layout_width=&quot;fill_parent&quot;\nandroid:layout_height=&quot;?android:attr/listPreferredItemHeight&quot;\nandroid:padding=&quot;6dip&quot;>\n\n<ImageView\nandroid:id=&quot;@+id/applauncherrow_icon&quot;\nandroid:layout_width=&quot;wrap_content&quot;\nandroid:layout_height=&quot;fill_parent&quot;\nandroid:layout_marginRight=&quot;6dip&quot;/>\n\n<LinearLayout\nandroid:id=&quot;@+id/applauncherrow_namelinearlayout&quot;\nandroid:orientation=&quot;vertical&quot;\nandroid:layout_width=&quot;0dip&quot;\nandroid:layout_weight=&quot;1&quot;\nandroid:layout_height=&quot;fill_parent&quot;>\n\n<TextView\nandroid:id=&quot;@+id/applauncherrow_appname&quot;\nandroid:layout_width=&quot;fill_parent&quot;\nandroid:layout_height=&quot;0dip&quot;\nandroid:layout_weight=&quot;1&quot;\nandroid:gravity=&quot;center_vertical&quot;/>\n\n</LinearLayout>\n\n</LinearLayout>\n```\nNext we're going to setup the main activity for the launcher app and register the activity in the manifest.\n\nCreate a new Java Class and name it \"AppLauncher.java\".\n\nNext open up the manifest file for your application and make sure it looks like the code below.\n\n```xml\n<!-- Your package=&quot;&quot; name might differ -->\n<manifest \nxmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\npackage=&quot;org.example.hello&quot; \nandroid:versionCode=&quot;1&quot;\nandroid:versionName=&quot;1.0&quot;>\n\n<!-- Your default android:icon=&quot;&quot; name might differ -->\n<application \nandroid:icon=&quot;@drawable/icon&quot; \nandroid:label=&quot;AppLauncher&quot; \nandroid:debuggable=&quot;true&quot;\nandroid:description=&quot;An Application Launcher&quot;>\n\n<activity\nandroid:name=&quot;AppLauncher&quot;\nandroid:label=&quot;AppLauncher&quot;>\n\n<!-- This tag indicates the initial activity -->\n<intent-filter>\n<action android:name=&quot;android.intent.action.MAIN&quot; />\n<category android:name=&quot;android.intent.category.LAUNCHER&quot; />\n</intent-filter>\n\n</activity>\n\n</application>\n\n<uses-sdk android:minSdkVersion=&quot;8&quot; />\n\n</manifest> \n```\nOk so now that the layouts are coded up and the activity is registered within the manifest open up AppLauncher.java and lets begin.\n\nLets start off with importing all the necessary libraries needed for our app.\n\n```java\n//Your package name might differ\npackage org.example.hello;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\n\nimport android.app.ListActivity;\nimport android.app.ProgressDialog;\nimport android.content.ComponentName;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.content.pm.ActivityInfo;\nimport android.content.pm.PackageInfo;\nimport android.content.pm.PackageManager;\nimport android.content.pm.ResolveInfo;\nimport android.graphics.drawable.Drawable;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.ArrayAdapter;\nimport android.widget.ImageView;\nimport android.widget.ListView;\nimport android.widget.TextView;\n```\n\nOur app will extend the ListActivity class in order to reduce the boiler plate needed to build a ListView.\n\n```java\npublic class AppLauncher extends ListActivity{\n```\n\nHowever, due to the structure of the app we'll build the classes needed and stitch them together so just follow along with a text editor for now. To begin we'll need a class to hold all the useful data we can obtain from a given app. We'll call it AppInfo, its very basic so go ahead and type it into your editor.\n\n```java\n    public class AppInfo{\n      private String appName = \"\";\n      private String packageName = \"\";\n      private String className = \"\";\n      private String versionName = \"\";\n      private Integer versionCode = 0;\n      private Drawable icon = null;\n\n      public String getAppName(){\n        return appName;\n      }\n\n      public String getPackageName(){\n        return packageName;\n      }\n\n      public String getClassName(){\n        return className;\n      }\n\n      public String getVersionName(){\n        return versionName;\n      }\n\n      public Integer getVersionCode(){\n        return versionCode;\n      }\n\n      public Drawable getIcon(){\n        return icon;\n      }\n    }\n```\n\nThe next class we need is a class that will be used to obtain the application info for the AppInfo class. This class is the bread and butter of our AppLauncher and it together with the AppInfo class can be ported to any application which needs to access other apps via intents.\n\n```java\n    public class Applications{\n      private ArrayList<AppInfo> packageList = null;\n      private List<ResolveInfo> activityList = null;\n      private Intent mainIntent = new Intent(Intent.ACTION_MAIN, null);\n      private PackageManager packMan = null;\n```\n\nFor the Applications constructor we will pass in the all important PackageManager from the main context.\n\n```java\n        public Applications(PackageManager packManager){\n          packMan = packManager;\n          packageList = this.createPackageList(false);\n          activityList = this.createActivityList();\n          this.addClassNamesToPackageList();\n        }\n```\n\nBelow are some getter methods for the package and activities list. The difference between the two is that the package list contains the info about the apps data and the activity list contains info about the intents the app responds to.\n\n```java\n        public ArrayList<AppInfo> getPackageList(){\n          return packageList;\n        }\n\n      public List<ResolveInfo> getActivityList(){\n        return activityList;\n      }\n```\n\nThe next method is the createPackageList method. All it does is simply extract a list of all the installed apps via the PackageManager that we passed into the constructor. Next we iterate over the list and copy the info we need into a AppInfo object and then shove that object into the ArrayList<AppInfo> that will be returned.\n\n```java\n        private ArrayList<AppInfo> createPackageList(boolean getSysPackages){\n          ArrayList<AppInfo> pList = new ArrayList<AppInfo>();        \n\n          List<PackageInfo> packs = getPackageManager(\n              ).getInstalledPackages(0);\n\n          for(int i = 0; i < packs.size(); i++){\n            PackageInfo packInfo = packs.get(i);\n\n            if((!getSysPackages) && (packInfo.versionName == null)){\n              continue ;\n            }\n\n            AppInfo newInfo = new AppInfo();\n\n            newInfo.appName = packInfo.applicationInfo.loadLabel(\n                getPackageManager()).toString();\n            newInfo.packageName = packInfo.packageName;   \n            newInfo.versionName = packInfo.versionName;\n            newInfo.versionCode = packInfo.versionCode;\n            newInfo.icon = packInfo.applicationInfo.loadIcon(\n                getPackageManager());\n\n            pList.add(newInfo);\n          }\n          return pList; \n        }\n```\n\nSimilar to the createPakageList method, createActivityList will return a list with all of the apps installed intent data but unlike createPackageList its only 8 lines of code.\n\n```java\n        private List<ResolveInfo> createActivityList(){\n          List<ResolveInfo> aList = packMan.queryIntentActivities(mainIntent, 0);\n\n          Collections.sort(aList, \n              new ResolveInfo.DisplayNameComparator(packMan)); \n\n          return aList;\n        }\n```\n\nThe next two methods are purely for dubugging purposes and can actually be left out but we'll include them for completeness or in case you use this class in another application.\n\n```java\n        private void packageDebug(){\n          if(null == packageList){\n            return;\n          }\n\n          for(int i = 0; i < packageList.size(); ++i){\n            Log.v(\"PACKINFO: \", \"\\t\" + \n                packageList.get(i).appName + \"\\t\" + \n                packageList.get(i).packageName + \"\\t\" + \n                packageList.get(i).className + \"\\t\" +\n                packageList.get(i).versionName + \"\\t\" + \n                packageList.get(i).versionCode);\n          }\n        }\n\n      private void activityDebug(){\n        if(null == activityList){\n          return;\n        }\n\n        for(int i = 0; i < activityList.size(); i++){ \n          ActivityInfo currentActivity = activityList.get(\n              i).activityInfo;\n          Log.v(\"ACTINFO\", \n              \"pName=\" \n              + currentActivity.applicationInfo.packageName +\n              \" cName=\" + currentActivity.name);\n        }\n      }\n```\n\nThe next method is needed only because in order to launch an app you need both its package name and its intent name that connects to the main class of the app. However, if you only use the packageList you'll lack the intent data, so the last method of the Application class adds the class name(intent data) to the packageList making it such that client of the class can have everything bundled up nicely in the packageList instead of having to rely on using both the activity and packageList in unison.\n\nFor the method addClassNameToPackageList we'll iterate over the packageList and for each packageName we'll find its match within the activityList by packageName and then extract the className from the activityList.\n\n```java\n        private void addClassNamesToPackageList(){\n          if(null == activityList || null == packageList){\n            return;\n          }\n\n          String tempName = \"\";\n\n          for(int i = 0; i < packageList.size(); ++i){\n            tempName = packageList.get(i).packageName;\n\n            for(int j = 0; j < activityList.size(); ++j){\n              if(tempName.equals(activityList.get(\n                      j).activityInfo.applicationInfo.packageName)){\n                packageList.get(i).className = activityList.get(\n                    j).activityInfo.name;\n              }\n            }\n          }\n        }\n    }\n```\n\nBelow is the complete Application class\n\n```java\n    public class Applications{\n      private ArrayList<AppInfo> packageList = null;\n      private List<ResolveInfo> activityList = null;\n      private Intent mainIntent = new Intent(Intent.ACTION_MAIN, null);\n      private PackageManager packMan = null;\n\n      public Applications(PackageManager packManager){\n        packMan = packManager;\n        packageList = this.createPackageList(false);\n        activityList = this.createActivityList();\n        this.addClassNamesToPackageList();\n      }\n\n      public ArrayList<AppInfo> getPackageList(){\n        return packageList;\n      }\n\n      public List<ResolveInfo> getActivityList(){\n        return activityList;\n      }\n\n      private ArrayList<AppInfo> createPackageList(boolean getSysPackages){\n        ArrayList<AppInfo> pList = new ArrayList<AppInfo>();        \n\n        List<PackageInfo> packs = getPackageManager(\n            ).getInstalledPackages(0);\n\n        for(int i = 0; i < packs.size(); i++){\n          PackageInfo packInfo = packs.get(i);\n\n          if((!getSysPackages) && (packInfo.versionName == null)){\n            continue ;\n          }\n\n          AppInfo newInfo = new AppInfo();\n\n          newInfo.appName = packInfo.applicationInfo.loadLabel(\n              getPackageManager()).toString();\n          newInfo.packageName = packInfo.packageName;   \n          newInfo.versionName = packInfo.versionName;\n          newInfo.versionCode = packInfo.versionCode;\n          newInfo.icon = packInfo.applicationInfo.loadIcon(\n              getPackageManager());\n\n          pList.add(newInfo);\n        }\n        return pList; \n      }\n\n      private List<ResolveInfo> createActivityList(){\n        List<ResolveInfo> aList = packMan.queryIntentActivities(mainIntent, 0);\n\n        Collections.sort(aList, \n            new ResolveInfo.DisplayNameComparator(packMan)); \n\n        return aList;\n      }\n\n      private void packageDebug(){\n        if(null == packageList){\n          return;\n        }\n\n        for(int i = 0; i < packageList.size(); ++i){\n          Log.v(\"PACKINFO: \", \"\\t\" + \n              packageList.get(i).appName + \"\\t\" + \n              packageList.get(i).packageName + \"\\t\" + \n              packageList.get(i).className + \"\\t\" +\n              packageList.get(i).versionName + \"\\t\" + \n              packageList.get(i).versionCode);\n        }\n      }\n\n      private void activityDebug(){\n        if(null == activityList){\n          return;\n        }\n\n        for(int i = 0; i < activityList.size(); i++){ \n          ActivityInfo currentActivity = activityList.get(\n              i).activityInfo;\n          Log.v(\"ACTINFO\", \n              \"pName=\" \n              + currentActivity.applicationInfo.packageName +\n              \" cName=\" + currentActivity.name);\n        }\n      }\n\n      private void addClassNamesToPackageList(){\n        if(null == activityList || null == packageList){\n          return;\n        }\n\n        String tempName = \"\";\n\n        for(int i = 0; i < packageList.size(); ++i){\n          tempName = packageList.get(i).packageName;\n\n          for(int j = 0; j < activityList.size(); ++j){\n            if(tempName.equals(activityList.get(\n                    j).activityInfo.applicationInfo.packageName)){\n              packageList.get(i).className = activityList.get(\n                  j).activityInfo.name;\n            }\n          }\n        }\n      }\n    }\n  ```\n\nRemember the AppInfo class that we made and the applauncherrow.xml layout. Well, now we'll utilize both within the custom ArrayAdapter extension we'll use to populate the data of our List. ArrayAdapters are used to fill in the data fields of a ListView widget by storing a layout(android uses the term inflate) holding data into a single row of the list.\n\n```java\n    public class ApplicationAdapter extends ArrayAdapter<AppInfo>{\n      private ArrayList<AppInfo> items;\n```\n\nThe constructor for our ArrayAdapter extension...\n\n```java\n        public ApplicationAdapter(Context context, int textViewResourceId, ArrayList<AppInfo> items){\n          super(context, textViewResourceId, items);\n          this.items = items;\n        }\n```\n\nBeing an ArrayAdapter extension means that we have to override the getView method, this is where the applauncherrow layout is populated with data and is used to represent each row of the ListView. To start we'll reference the applauncherrow layout and inflate it to become a view.\n\n```java\n        @Override\n        public View getView(int position, View convertView, \n            ViewGroup parent){\n          View view = convertView;\n\n          if(view == null){\n            LayoutInflater layout = (LayoutInflater)getSystemService(\n                Context.LAYOUT_INFLATER_SERVICE);\n            view = layout.inflate(R.layout.applauncherrow, null);\n          }\n```\n\nNow that the view is inflated with the applauncherrow.xml layout we can now match the ImageView and TextView with the contents of a AppInfo object in preparation for moving it into the ListView.\n\n```java\n            AppInfo appInfo = items.get(position);\n          if(appInfo != null){\n            TextView appName = (TextView) view.findViewById(\n                R.id.applauncherrow_appname);\n            ImageView appIcon = (ImageView) view.findViewById(\n                R.id.applauncherrow_icon);\n\n            if(appName != null){\n              appName.setText(appInfo.getAppName());\n            }\n            if(appIcon != null){\n              appIcon.setImageDrawable(appInfo.getIcon());\n            }\n          }\n\n          return view;\n        }\n    }\n```\n\nHere is the complete ApplicationAdapter class, you should add it to your text file.\n\n```java\n    public class ApplicationAdapter extends ArrayAdapter<AppInfo>{\n      private ArrayList<AppInfo> items;\n\n      public ApplicationAdapter(Context context, int textViewResourceId, \n          ArrayList<AppInfo> items){\n        super(context, textViewResourceId, items);\n        this.items = items;\n      }\n\n      @Override\n        public View getView(int position, View convertView, \n            ViewGroup parent){\n          View view = convertView;\n\n          if(view == null){\n            LayoutInflater layout = (LayoutInflater)getSystemService(\n                Context.LAYOUT_INFLATER_SERVICE);\n            view = layout.inflate(R.layout.applauncherrow, null);\n          }\n\n          AppInfo appInfo = items.get(position);\n          if(appInfo != null){\n            TextView appName = (TextView) view.findViewById(\n                R.id.applauncherrow_appname);\n            ImageView appIcon = (ImageView) view.findViewById(\n                R.id.applauncherrow_icon);\n\n            if(appName != null){\n              appName.setText(appInfo.getAppName());\n            }\n            if(appIcon != null){\n              appIcon.setImageDrawable(appInfo.getIcon());\n            }\n          }\n\n          return view;\n        }\n    }\n```\n\nWe are done with the utility classes so the next step is to add some methods to the AppLauncher class itself. The first one we're going to add is a method called getApps() which stores the pacakageList from an Applications object and passes it off to Java Runnable to be ran on a thread.\n\n```java\n    private void getApps(){\n      try{\n        myApps = new Applications(getPackageManager());\n        packageList = myApps.getPackageList();\n      }\n      catch(Exception exception){\n        Log.e(\"BACKGROUND PROC:\", exception.getMessage());\n      }\n      this.runOnUiThread(returnRes);\n    }\n```\n\nIf you look at the getApps() method the last line before the class ends is a method called this.runOnUiThread(returnRes), now what this means is that the main thread will be locked while we pump AppInfo objects into our ListView via the ArrayAdapter. If you are experienced with concurrent programming you might be wondering why lock the mainUIThread, the answer is because our app can't do anything until all objects have been added to the list. If we by chance were dynamically loading things from the Internet via HTTP requests then we would opt instead for a lazy loader which spawns a thread for each view object pumped into the ListVIew and the list would slowly populate as each item was fetched live from the web. So anyways here is our Runnable method that checks first that the packageList exists and then uses an object from our ApplicationAdapter to fill up our ListView widget.\n\n```java\n    private Runnable returnRes = new Runnable(){\n      public void run(){\n        if(packageList != null && packageList.size() > 0){\n          appAdapter.notifyDataSetChanged();\n\n          for(int i = 0; i < packageList.size(); ++i){\n            appAdapter.add(packageList.get(i));\n          }\n        }\n        progressDialog.dismiss();\n        appAdapter.notifyDataSetChanged();\n      }\n    };\n```\n\nWe're almost done so now open up your Eclipse IDE to the AppLauncher project and click on the AppLauncher.java class. If you remember from earlier where we left off go ahead and add the data members below to the AppLauncher class; notice the line numbers for reference.\n\n```java\n  ApplicationAdapter appAdapter = null;\n  ProgressDialog progressDialog = null; \n  Runnable viewApps = null;\n  ArrayList<AppInfo> packageList = null;\n  Applications myApps = null;\n```\n\nFor the onCreate() method there are some things you sould notice. First since AppLauncher is a ListActivity extension it inherits the setListAdapter() method. Second we'll  initialize the viewApps Runnable to call our getApps() within its run(). This means that any thread created with the viewApps as it's runnable will load up our packages into the ListView. In addition since getApps() locks the mainUIThread users of this app won't be able to do anything until the thread finishes.\n\n```java\n    public void onCreate(Bundle savedInstanceState){\n      super.onCreate(savedInstanceState);\n\n      this.setContentView(R.layout.applauncher);\n\n      packageList = new ArrayList<AppInfo>();\n      appAdapter = new ApplicationAdapter(this, R.layout.applauncherrow,\n          packageList);\n\n      this.setListAdapter(appAdapter);\n\n      viewApps = new Runnable(){\n        public void run(){\n          getApps();\n        }\n      };\n\n      Thread appLoaderThread = new Thread(null, viewApps, \n          \"AppLoaderThread\");\n      appLoaderThread.start();\n```\n\nNow that the thread has started and the app has been officially locked, how do we notify the user? The answer is with the android.app.ProgressDialog widget. Remember those loading screen from popular video games, that's all ProgressDialogs do.\n\n```java\n        progressDialog = ProgressDialog.show(AppLauncher.this, \"Hold on...\", \"Loading your apps...\", true);\n    }\n```\n\nRight now our app can successfully load up a list of Icons and application names but how then do we launch the apps the user touches from our list? The answer is via starting a new intent by overriding the onListItemClick method. So go open up your text file that contains the utility classes and methods and add the onListItemClick() method to it.\n\n```java\n    @Override\n    protected void onListItemClick(ListView list, View view, int position, \n        long id){\n      super.onListItemClick(list, view, position, id);\n\n      AppInfo rowClicked = (AppInfo)this.getListAdapter().getItem(\n          position);\n\n      Intent startApp = new Intent();\n      ComponentName component = new ComponentName(\n          rowClicked.getPackageName(), \n          rowClicked.getClassName());\n      startApp.setComponent(component);\n      startApp.setAction(Intent.ACTION_MAIN);\n\n      startActivity(startApp);\n    }\n```\n\nBefore you run the AppLauncher, be sure to copy and paste the classes and methods into the AppLauncher class so it resembles the complete file below.\n\n```java\n  package org.example.hello;\n\n  import java.util.ArrayList;\n  import java.util.Collections;\n  import java.util.List;\n\n  import android.app.ListActivity;\n  import android.app.ProgressDialog;\n  import android.content.ComponentName;\n  import android.content.Context;\n  import android.content.Intent;\n  import android.content.pm.ActivityInfo;\n  import android.content.pm.PackageInfo;\n  import android.content.pm.PackageManager;\n  import android.content.pm.ResolveInfo;\n  import android.graphics.drawable.Drawable;\n  import android.os.Bundle;\n  import android.util.Log;\n  import android.view.LayoutInflater;\n  import android.view.View;\n  import android.view.ViewGroup;\n  import android.widget.ArrayAdapter;\n  import android.widget.ImageView;\n  import android.widget.ListView;\n  import android.widget.TextView;\n\n  public class AppLauncher extends ListActivity{\n    ApplicationAdapter appAdapter = null;\n    ProgressDialog progressDialog = null; \n    Runnable viewApps = null;\n    ArrayList<AppInfo> packageList = null;\n    Applications myApps = null;\n\n    public void onCreate(Bundle savedInstanceState){\n      super.onCreate(savedInstanceState);\n\n      this.setContentView(R.layout.applauncher);\n\n      packageList = new ArrayList<AppInfo>();\n      appAdapter = new ApplicationAdapter(this, R.layout.applauncherrow,\n          packageList);\n\n      this.setListAdapter(appAdapter);\n\n      viewApps = new Runnable(){\n        public void run(){\n          getApps();\n        }\n      };\n\n      Thread appLoaderThread = new Thread(null, viewApps, \n          \"AppLoaderThread\");\n      appLoaderThread.start();\n\n      progressDialog = ProgressDialog.show(AppLauncher.this, \n          \"Hold on...\", \"Loading your apps...\", true);\n    }\n\n    public class Applications{\n      private ArrayList<AppInfo> packageList = null;\n      private List<ResolveInfo> activityList = null;\n      private Intent mainIntent = new Intent(Intent.ACTION_MAIN, null);\n      private PackageManager packMan = null;\n\n      public Applications(PackageManager packManager){\n        packMan = packManager;\n        packageList = this.createPackageList(false);\n        activityList = this.createActivityList();\n        this.addClassNamesToPackageList();\n      }\n\n      public ArrayList<AppInfo> getPackageList(){\n        return packageList;\n      }\n\n      public List<ResolveInfo> getActivityList(){\n        return activityList;\n      }\n\n      private ArrayList<AppInfo> createPackageList(boolean getSysPackages){\n        ArrayList<AppInfo> pList = new ArrayList<AppInfo>();        \n\n        List<PackageInfo> packs = getPackageManager(\n            ).getInstalledPackages(0);\n\n        for(int i = 0; i < packs.size(); i++){\n          PackageInfo packInfo = packs.get(i);\n\n          if((!getSysPackages) && (packInfo.versionName == null)){\n            continue ;\n          }\n\n          AppInfo newInfo = new AppInfo();\n\n          newInfo.appName = packInfo.applicationInfo.loadLabel(\n              getPackageManager()).toString();\n          newInfo.packageName = packInfo.packageName;   \n          newInfo.versionName = packInfo.versionName;\n          newInfo.versionCode = packInfo.versionCode;\n          newInfo.icon = packInfo.applicationInfo.loadIcon(\n              getPackageManager());\n\n          pList.add(newInfo);\n        }\n        return pList; \n      }\n\n      private List<ResolveInfo> createActivityList(){\n        List<ResolveInfo> aList = packMan.queryIntentActivities(mainIntent, 0);\n\n        Collections.sort(aList, \n            new ResolveInfo.DisplayNameComparator(packMan)); \n\n        return aList;\n      }\n\n      private void packageDebug(){\n        if(null == packageList){\n          return;\n        }\n\n        for(int i = 0; i < packageList.size(); ++i){\n          Log.v(\"PACKINFO: \", \"\\t\" + \n              packageList.get(i).appName + \"\\t\" + \n              packageList.get(i).packageName + \"\\t\" + \n              packageList.get(i).className + \"\\t\" +\n              packageList.get(i).versionName + \"\\t\" + \n              packageList.get(i).versionCode);\n        }\n      }\n\n      private void activityDebug(){\n        if(null == activityList){\n          return;\n        }\n\n        for(int i = 0; i < activityList.size(); i++){ \n          ActivityInfo currentActivity = activityList.get(\n              i).activityInfo;\n          Log.v(\"ACTINFO\", \n              \"pName=\" \n              + currentActivity.applicationInfo.packageName +\n              \" cName=\" + currentActivity.name);\n        }\n      }\n\n      private void addClassNamesToPackageList(){\n        if(null == activityList || null == packageList){\n          return;\n        }\n\n        String tempName = \"\";\n\n        for(int i = 0; i < packageList.size(); ++i){\n          tempName = packageList.get(i).packageName;\n\n          for(int j = 0; j < activityList.size(); ++j){\n            if(tempName.equals(activityList.get(\n                    j).activityInfo.applicationInfo.packageName)){\n              packageList.get(i).className = activityList.get(\n                  j).activityInfo.name;\n            }\n          }\n        }\n      }\n    }\n\n    public class AppInfo{\n      private String appName = \"\";\n      private String packageName = \"\";\n      private String className = \"\";\n      private String versionName = \"\";\n      private Integer versionCode = 0;\n      private Drawable icon = null;\n\n      public String getAppName(){\n        return appName;\n      }\n\n      public String getPackageName(){\n        return packageName;\n      }\n\n      public String getClassName(){\n        return className;\n      }\n\n      public String getVersionName(){\n        return versionName;\n      }\n\n      public Integer getVersionCode(){\n        return versionCode;\n      }\n\n      public Drawable getIcon(){\n        return icon;\n      }\n    }\n\n    public class ApplicationAdapter extends ArrayAdapter<AppInfo>{\n      private ArrayList<AppInfo> items;\n\n      public ApplicationAdapter(Context context, int textViewResourceId, \n          ArrayList<AppInfo> items){\n        super(context, textViewResourceId, items);\n        this.items = items;\n      }\n\n      @Override\n        public View getView(int position, View convertView, \n            ViewGroup parent){\n          View view = convertView;\n\n          if(view == null){\n            LayoutInflater layout = (LayoutInflater)getSystemService(\n                Context.LAYOUT_INFLATER_SERVICE);\n            view = layout.inflate(R.layout.applauncherrow, null);\n          }\n\n          AppInfo appInfo = items.get(position);\n          if(appInfo != null){\n            TextView appName = (TextView) view.findViewById(\n                R.id.applauncherrow_appname);\n            ImageView appIcon = (ImageView) view.findViewById(\n                R.id.applauncherrow_icon);\n\n            if(appName != null){\n              appName.setText(appInfo.getAppName());\n            }\n            if(appIcon != null){\n              appIcon.setImageDrawable(appInfo.getIcon());\n            }\n          }\n\n          return view;\n        }\n    }\n\n    private void getApps(){\n      try{\n        myApps = new Applications(getPackageManager());\n        packageList = myApps.getPackageList();\n      }\n      catch(Exception exception){\n        Log.e(\"BACKGROUND PROC:\", exception.getMessage());\n      }\n      this.runOnUiThread(returnRes);\n    }\n\n    private Runnable returnRes = new Runnable(){\n      public void run(){\n        if(packageList != null && packageList.size() > 0){\n          appAdapter.notifyDataSetChanged();\n\n          for(int i = 0; i < packageList.size(); ++i){\n            appAdapter.add(packageList.get(i));\n          }\n        }\n        progressDialog.dismiss();\n        appAdapter.notifyDataSetChanged();\n      }\n    };\n\n    @Override\n      protected void onListItemClick(ListView list, View view, int position, \n          long id){\n        super.onListItemClick(list, view, position, id);\n\n        AppInfo rowClicked = (AppInfo)this.getListAdapter().getItem(\n            position);\n\n        Intent startApp = new Intent();\n        ComponentName component = new ComponentName(\n            rowClicked.getPackageName(), \n            rowClicked.getClassName());\n        startApp.setComponent(component);\n        startApp.setAction(Intent.ACTION_MAIN);\n\n        startActivity(startApp);\n      }\n  }\n\n```\n\nEnjoy your AppLauncher.\n","source":"_posts/buildanapplicationlauncherwithandroid.md","raw":"---\ntitle: Build An Application Launcher For Android\ndate: 2011-07-05\ncategories: [tutorial]\ntags: [java, android, mobile]\n---\nIn this tutorial we'll create an interesting android application which has the ability to launch any other app you have installed on your phone. If you've ever wanted to know how Android applications perform cross app communication you should read on(this tutorial assumes familiarity with the Android API).\n\nTo start off create a new Android application project within Eclipse. Whenever I develop Android apps I usually start with the layout of the application and add functionality via Java classes later. Since our app will display the users installed apps within a ListView widget we have to first declare a layout to hold the ListView itself.\n\nCreate a new xml layout for the ListView by right clicking the res/layout folder and adding a new android xml file. Title it \"applauncher.xml\" and then add the code below to it.\n\n```xml\n<LinearLayout\nxmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\nandroid:id=&quot;@+id/applauncher_linearlayout&quot;\nandroid:layout_width=&quot;fill_parent&quot;\nandroid:layout_height=&quot;fill_parent&quot;\nandroid:orientation=&quot;vertical&quot;>\n\n<ListView\nandroid:id=&quot;@android:id/list&quot;\nandroid:layout_width=&quot;fill_parent&quot;\nandroid:layout_height=&quot;fill_parent&quot;/>\n\n<TextView\nandroid:id=&quot;@android:id/empty&quot;\nandroid:layout_width=&quot;fill_parent&quot;\nandroid:layout_height=&quot;fill_parent&quot;\nandroid:text=&quot;List PlaceHolder&quot;/>\n\n</LinearLayout>\n```\nWhen using ListViews we can setup the overall look of each row by creating an xml layout with a skeleton of the widgets that we want to display in each row of our ListView. Think of the row layout as a \"row template\". If you look at the screenshots of the app you can tell that we only need two widgets within our row layout, an ImageView to hold the apps icon and a TextView to display the apps package name.\n\nCreate a new xml layout for the ListView rows by right clicking the res/layout folder and adding a new android xml file. Title it \"applauncherrow.xml\" and add the code below.\n```xml\n<LinearLayout\nxmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\nandroid:id=&quot;@+id/applauncherrow_imagelinearlayout&quot;\nandroid:layout_width=&quot;fill_parent&quot;\nandroid:layout_height=&quot;?android:attr/listPreferredItemHeight&quot;\nandroid:padding=&quot;6dip&quot;>\n\n<ImageView\nandroid:id=&quot;@+id/applauncherrow_icon&quot;\nandroid:layout_width=&quot;wrap_content&quot;\nandroid:layout_height=&quot;fill_parent&quot;\nandroid:layout_marginRight=&quot;6dip&quot;/>\n\n<LinearLayout\nandroid:id=&quot;@+id/applauncherrow_namelinearlayout&quot;\nandroid:orientation=&quot;vertical&quot;\nandroid:layout_width=&quot;0dip&quot;\nandroid:layout_weight=&quot;1&quot;\nandroid:layout_height=&quot;fill_parent&quot;>\n\n<TextView\nandroid:id=&quot;@+id/applauncherrow_appname&quot;\nandroid:layout_width=&quot;fill_parent&quot;\nandroid:layout_height=&quot;0dip&quot;\nandroid:layout_weight=&quot;1&quot;\nandroid:gravity=&quot;center_vertical&quot;/>\n\n</LinearLayout>\n\n</LinearLayout>\n```\nNext we're going to setup the main activity for the launcher app and register the activity in the manifest.\n\nCreate a new Java Class and name it \"AppLauncher.java\".\n\nNext open up the manifest file for your application and make sure it looks like the code below.\n\n```xml\n<!-- Your package=&quot;&quot; name might differ -->\n<manifest \nxmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\npackage=&quot;org.example.hello&quot; \nandroid:versionCode=&quot;1&quot;\nandroid:versionName=&quot;1.0&quot;>\n\n<!-- Your default android:icon=&quot;&quot; name might differ -->\n<application \nandroid:icon=&quot;@drawable/icon&quot; \nandroid:label=&quot;AppLauncher&quot; \nandroid:debuggable=&quot;true&quot;\nandroid:description=&quot;An Application Launcher&quot;>\n\n<activity\nandroid:name=&quot;AppLauncher&quot;\nandroid:label=&quot;AppLauncher&quot;>\n\n<!-- This tag indicates the initial activity -->\n<intent-filter>\n<action android:name=&quot;android.intent.action.MAIN&quot; />\n<category android:name=&quot;android.intent.category.LAUNCHER&quot; />\n</intent-filter>\n\n</activity>\n\n</application>\n\n<uses-sdk android:minSdkVersion=&quot;8&quot; />\n\n</manifest> \n```\nOk so now that the layouts are coded up and the activity is registered within the manifest open up AppLauncher.java and lets begin.\n\nLets start off with importing all the necessary libraries needed for our app.\n\n```java\n//Your package name might differ\npackage org.example.hello;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\n\nimport android.app.ListActivity;\nimport android.app.ProgressDialog;\nimport android.content.ComponentName;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.content.pm.ActivityInfo;\nimport android.content.pm.PackageInfo;\nimport android.content.pm.PackageManager;\nimport android.content.pm.ResolveInfo;\nimport android.graphics.drawable.Drawable;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.ArrayAdapter;\nimport android.widget.ImageView;\nimport android.widget.ListView;\nimport android.widget.TextView;\n```\n\nOur app will extend the ListActivity class in order to reduce the boiler plate needed to build a ListView.\n\n```java\npublic class AppLauncher extends ListActivity{\n```\n\nHowever, due to the structure of the app we'll build the classes needed and stitch them together so just follow along with a text editor for now. To begin we'll need a class to hold all the useful data we can obtain from a given app. We'll call it AppInfo, its very basic so go ahead and type it into your editor.\n\n```java\n    public class AppInfo{\n      private String appName = \"\";\n      private String packageName = \"\";\n      private String className = \"\";\n      private String versionName = \"\";\n      private Integer versionCode = 0;\n      private Drawable icon = null;\n\n      public String getAppName(){\n        return appName;\n      }\n\n      public String getPackageName(){\n        return packageName;\n      }\n\n      public String getClassName(){\n        return className;\n      }\n\n      public String getVersionName(){\n        return versionName;\n      }\n\n      public Integer getVersionCode(){\n        return versionCode;\n      }\n\n      public Drawable getIcon(){\n        return icon;\n      }\n    }\n```\n\nThe next class we need is a class that will be used to obtain the application info for the AppInfo class. This class is the bread and butter of our AppLauncher and it together with the AppInfo class can be ported to any application which needs to access other apps via intents.\n\n```java\n    public class Applications{\n      private ArrayList<AppInfo> packageList = null;\n      private List<ResolveInfo> activityList = null;\n      private Intent mainIntent = new Intent(Intent.ACTION_MAIN, null);\n      private PackageManager packMan = null;\n```\n\nFor the Applications constructor we will pass in the all important PackageManager from the main context.\n\n```java\n        public Applications(PackageManager packManager){\n          packMan = packManager;\n          packageList = this.createPackageList(false);\n          activityList = this.createActivityList();\n          this.addClassNamesToPackageList();\n        }\n```\n\nBelow are some getter methods for the package and activities list. The difference between the two is that the package list contains the info about the apps data and the activity list contains info about the intents the app responds to.\n\n```java\n        public ArrayList<AppInfo> getPackageList(){\n          return packageList;\n        }\n\n      public List<ResolveInfo> getActivityList(){\n        return activityList;\n      }\n```\n\nThe next method is the createPackageList method. All it does is simply extract a list of all the installed apps via the PackageManager that we passed into the constructor. Next we iterate over the list and copy the info we need into a AppInfo object and then shove that object into the ArrayList<AppInfo> that will be returned.\n\n```java\n        private ArrayList<AppInfo> createPackageList(boolean getSysPackages){\n          ArrayList<AppInfo> pList = new ArrayList<AppInfo>();        \n\n          List<PackageInfo> packs = getPackageManager(\n              ).getInstalledPackages(0);\n\n          for(int i = 0; i < packs.size(); i++){\n            PackageInfo packInfo = packs.get(i);\n\n            if((!getSysPackages) && (packInfo.versionName == null)){\n              continue ;\n            }\n\n            AppInfo newInfo = new AppInfo();\n\n            newInfo.appName = packInfo.applicationInfo.loadLabel(\n                getPackageManager()).toString();\n            newInfo.packageName = packInfo.packageName;   \n            newInfo.versionName = packInfo.versionName;\n            newInfo.versionCode = packInfo.versionCode;\n            newInfo.icon = packInfo.applicationInfo.loadIcon(\n                getPackageManager());\n\n            pList.add(newInfo);\n          }\n          return pList; \n        }\n```\n\nSimilar to the createPakageList method, createActivityList will return a list with all of the apps installed intent data but unlike createPackageList its only 8 lines of code.\n\n```java\n        private List<ResolveInfo> createActivityList(){\n          List<ResolveInfo> aList = packMan.queryIntentActivities(mainIntent, 0);\n\n          Collections.sort(aList, \n              new ResolveInfo.DisplayNameComparator(packMan)); \n\n          return aList;\n        }\n```\n\nThe next two methods are purely for dubugging purposes and can actually be left out but we'll include them for completeness or in case you use this class in another application.\n\n```java\n        private void packageDebug(){\n          if(null == packageList){\n            return;\n          }\n\n          for(int i = 0; i < packageList.size(); ++i){\n            Log.v(\"PACKINFO: \", \"\\t\" + \n                packageList.get(i).appName + \"\\t\" + \n                packageList.get(i).packageName + \"\\t\" + \n                packageList.get(i).className + \"\\t\" +\n                packageList.get(i).versionName + \"\\t\" + \n                packageList.get(i).versionCode);\n          }\n        }\n\n      private void activityDebug(){\n        if(null == activityList){\n          return;\n        }\n\n        for(int i = 0; i < activityList.size(); i++){ \n          ActivityInfo currentActivity = activityList.get(\n              i).activityInfo;\n          Log.v(\"ACTINFO\", \n              \"pName=\" \n              + currentActivity.applicationInfo.packageName +\n              \" cName=\" + currentActivity.name);\n        }\n      }\n```\n\nThe next method is needed only because in order to launch an app you need both its package name and its intent name that connects to the main class of the app. However, if you only use the packageList you'll lack the intent data, so the last method of the Application class adds the class name(intent data) to the packageList making it such that client of the class can have everything bundled up nicely in the packageList instead of having to rely on using both the activity and packageList in unison.\n\nFor the method addClassNameToPackageList we'll iterate over the packageList and for each packageName we'll find its match within the activityList by packageName and then extract the className from the activityList.\n\n```java\n        private void addClassNamesToPackageList(){\n          if(null == activityList || null == packageList){\n            return;\n          }\n\n          String tempName = \"\";\n\n          for(int i = 0; i < packageList.size(); ++i){\n            tempName = packageList.get(i).packageName;\n\n            for(int j = 0; j < activityList.size(); ++j){\n              if(tempName.equals(activityList.get(\n                      j).activityInfo.applicationInfo.packageName)){\n                packageList.get(i).className = activityList.get(\n                    j).activityInfo.name;\n              }\n            }\n          }\n        }\n    }\n```\n\nBelow is the complete Application class\n\n```java\n    public class Applications{\n      private ArrayList<AppInfo> packageList = null;\n      private List<ResolveInfo> activityList = null;\n      private Intent mainIntent = new Intent(Intent.ACTION_MAIN, null);\n      private PackageManager packMan = null;\n\n      public Applications(PackageManager packManager){\n        packMan = packManager;\n        packageList = this.createPackageList(false);\n        activityList = this.createActivityList();\n        this.addClassNamesToPackageList();\n      }\n\n      public ArrayList<AppInfo> getPackageList(){\n        return packageList;\n      }\n\n      public List<ResolveInfo> getActivityList(){\n        return activityList;\n      }\n\n      private ArrayList<AppInfo> createPackageList(boolean getSysPackages){\n        ArrayList<AppInfo> pList = new ArrayList<AppInfo>();        \n\n        List<PackageInfo> packs = getPackageManager(\n            ).getInstalledPackages(0);\n\n        for(int i = 0; i < packs.size(); i++){\n          PackageInfo packInfo = packs.get(i);\n\n          if((!getSysPackages) && (packInfo.versionName == null)){\n            continue ;\n          }\n\n          AppInfo newInfo = new AppInfo();\n\n          newInfo.appName = packInfo.applicationInfo.loadLabel(\n              getPackageManager()).toString();\n          newInfo.packageName = packInfo.packageName;   \n          newInfo.versionName = packInfo.versionName;\n          newInfo.versionCode = packInfo.versionCode;\n          newInfo.icon = packInfo.applicationInfo.loadIcon(\n              getPackageManager());\n\n          pList.add(newInfo);\n        }\n        return pList; \n      }\n\n      private List<ResolveInfo> createActivityList(){\n        List<ResolveInfo> aList = packMan.queryIntentActivities(mainIntent, 0);\n\n        Collections.sort(aList, \n            new ResolveInfo.DisplayNameComparator(packMan)); \n\n        return aList;\n      }\n\n      private void packageDebug(){\n        if(null == packageList){\n          return;\n        }\n\n        for(int i = 0; i < packageList.size(); ++i){\n          Log.v(\"PACKINFO: \", \"\\t\" + \n              packageList.get(i).appName + \"\\t\" + \n              packageList.get(i).packageName + \"\\t\" + \n              packageList.get(i).className + \"\\t\" +\n              packageList.get(i).versionName + \"\\t\" + \n              packageList.get(i).versionCode);\n        }\n      }\n\n      private void activityDebug(){\n        if(null == activityList){\n          return;\n        }\n\n        for(int i = 0; i < activityList.size(); i++){ \n          ActivityInfo currentActivity = activityList.get(\n              i).activityInfo;\n          Log.v(\"ACTINFO\", \n              \"pName=\" \n              + currentActivity.applicationInfo.packageName +\n              \" cName=\" + currentActivity.name);\n        }\n      }\n\n      private void addClassNamesToPackageList(){\n        if(null == activityList || null == packageList){\n          return;\n        }\n\n        String tempName = \"\";\n\n        for(int i = 0; i < packageList.size(); ++i){\n          tempName = packageList.get(i).packageName;\n\n          for(int j = 0; j < activityList.size(); ++j){\n            if(tempName.equals(activityList.get(\n                    j).activityInfo.applicationInfo.packageName)){\n              packageList.get(i).className = activityList.get(\n                  j).activityInfo.name;\n            }\n          }\n        }\n      }\n    }\n  ```\n\nRemember the AppInfo class that we made and the applauncherrow.xml layout. Well, now we'll utilize both within the custom ArrayAdapter extension we'll use to populate the data of our List. ArrayAdapters are used to fill in the data fields of a ListView widget by storing a layout(android uses the term inflate) holding data into a single row of the list.\n\n```java\n    public class ApplicationAdapter extends ArrayAdapter<AppInfo>{\n      private ArrayList<AppInfo> items;\n```\n\nThe constructor for our ArrayAdapter extension...\n\n```java\n        public ApplicationAdapter(Context context, int textViewResourceId, ArrayList<AppInfo> items){\n          super(context, textViewResourceId, items);\n          this.items = items;\n        }\n```\n\nBeing an ArrayAdapter extension means that we have to override the getView method, this is where the applauncherrow layout is populated with data and is used to represent each row of the ListView. To start we'll reference the applauncherrow layout and inflate it to become a view.\n\n```java\n        @Override\n        public View getView(int position, View convertView, \n            ViewGroup parent){\n          View view = convertView;\n\n          if(view == null){\n            LayoutInflater layout = (LayoutInflater)getSystemService(\n                Context.LAYOUT_INFLATER_SERVICE);\n            view = layout.inflate(R.layout.applauncherrow, null);\n          }\n```\n\nNow that the view is inflated with the applauncherrow.xml layout we can now match the ImageView and TextView with the contents of a AppInfo object in preparation for moving it into the ListView.\n\n```java\n            AppInfo appInfo = items.get(position);\n          if(appInfo != null){\n            TextView appName = (TextView) view.findViewById(\n                R.id.applauncherrow_appname);\n            ImageView appIcon = (ImageView) view.findViewById(\n                R.id.applauncherrow_icon);\n\n            if(appName != null){\n              appName.setText(appInfo.getAppName());\n            }\n            if(appIcon != null){\n              appIcon.setImageDrawable(appInfo.getIcon());\n            }\n          }\n\n          return view;\n        }\n    }\n```\n\nHere is the complete ApplicationAdapter class, you should add it to your text file.\n\n```java\n    public class ApplicationAdapter extends ArrayAdapter<AppInfo>{\n      private ArrayList<AppInfo> items;\n\n      public ApplicationAdapter(Context context, int textViewResourceId, \n          ArrayList<AppInfo> items){\n        super(context, textViewResourceId, items);\n        this.items = items;\n      }\n\n      @Override\n        public View getView(int position, View convertView, \n            ViewGroup parent){\n          View view = convertView;\n\n          if(view == null){\n            LayoutInflater layout = (LayoutInflater)getSystemService(\n                Context.LAYOUT_INFLATER_SERVICE);\n            view = layout.inflate(R.layout.applauncherrow, null);\n          }\n\n          AppInfo appInfo = items.get(position);\n          if(appInfo != null){\n            TextView appName = (TextView) view.findViewById(\n                R.id.applauncherrow_appname);\n            ImageView appIcon = (ImageView) view.findViewById(\n                R.id.applauncherrow_icon);\n\n            if(appName != null){\n              appName.setText(appInfo.getAppName());\n            }\n            if(appIcon != null){\n              appIcon.setImageDrawable(appInfo.getIcon());\n            }\n          }\n\n          return view;\n        }\n    }\n```\n\nWe are done with the utility classes so the next step is to add some methods to the AppLauncher class itself. The first one we're going to add is a method called getApps() which stores the pacakageList from an Applications object and passes it off to Java Runnable to be ran on a thread.\n\n```java\n    private void getApps(){\n      try{\n        myApps = new Applications(getPackageManager());\n        packageList = myApps.getPackageList();\n      }\n      catch(Exception exception){\n        Log.e(\"BACKGROUND PROC:\", exception.getMessage());\n      }\n      this.runOnUiThread(returnRes);\n    }\n```\n\nIf you look at the getApps() method the last line before the class ends is a method called this.runOnUiThread(returnRes), now what this means is that the main thread will be locked while we pump AppInfo objects into our ListView via the ArrayAdapter. If you are experienced with concurrent programming you might be wondering why lock the mainUIThread, the answer is because our app can't do anything until all objects have been added to the list. If we by chance were dynamically loading things from the Internet via HTTP requests then we would opt instead for a lazy loader which spawns a thread for each view object pumped into the ListVIew and the list would slowly populate as each item was fetched live from the web. So anyways here is our Runnable method that checks first that the packageList exists and then uses an object from our ApplicationAdapter to fill up our ListView widget.\n\n```java\n    private Runnable returnRes = new Runnable(){\n      public void run(){\n        if(packageList != null && packageList.size() > 0){\n          appAdapter.notifyDataSetChanged();\n\n          for(int i = 0; i < packageList.size(); ++i){\n            appAdapter.add(packageList.get(i));\n          }\n        }\n        progressDialog.dismiss();\n        appAdapter.notifyDataSetChanged();\n      }\n    };\n```\n\nWe're almost done so now open up your Eclipse IDE to the AppLauncher project and click on the AppLauncher.java class. If you remember from earlier where we left off go ahead and add the data members below to the AppLauncher class; notice the line numbers for reference.\n\n```java\n  ApplicationAdapter appAdapter = null;\n  ProgressDialog progressDialog = null; \n  Runnable viewApps = null;\n  ArrayList<AppInfo> packageList = null;\n  Applications myApps = null;\n```\n\nFor the onCreate() method there are some things you sould notice. First since AppLauncher is a ListActivity extension it inherits the setListAdapter() method. Second we'll  initialize the viewApps Runnable to call our getApps() within its run(). This means that any thread created with the viewApps as it's runnable will load up our packages into the ListView. In addition since getApps() locks the mainUIThread users of this app won't be able to do anything until the thread finishes.\n\n```java\n    public void onCreate(Bundle savedInstanceState){\n      super.onCreate(savedInstanceState);\n\n      this.setContentView(R.layout.applauncher);\n\n      packageList = new ArrayList<AppInfo>();\n      appAdapter = new ApplicationAdapter(this, R.layout.applauncherrow,\n          packageList);\n\n      this.setListAdapter(appAdapter);\n\n      viewApps = new Runnable(){\n        public void run(){\n          getApps();\n        }\n      };\n\n      Thread appLoaderThread = new Thread(null, viewApps, \n          \"AppLoaderThread\");\n      appLoaderThread.start();\n```\n\nNow that the thread has started and the app has been officially locked, how do we notify the user? The answer is with the android.app.ProgressDialog widget. Remember those loading screen from popular video games, that's all ProgressDialogs do.\n\n```java\n        progressDialog = ProgressDialog.show(AppLauncher.this, \"Hold on...\", \"Loading your apps...\", true);\n    }\n```\n\nRight now our app can successfully load up a list of Icons and application names but how then do we launch the apps the user touches from our list? The answer is via starting a new intent by overriding the onListItemClick method. So go open up your text file that contains the utility classes and methods and add the onListItemClick() method to it.\n\n```java\n    @Override\n    protected void onListItemClick(ListView list, View view, int position, \n        long id){\n      super.onListItemClick(list, view, position, id);\n\n      AppInfo rowClicked = (AppInfo)this.getListAdapter().getItem(\n          position);\n\n      Intent startApp = new Intent();\n      ComponentName component = new ComponentName(\n          rowClicked.getPackageName(), \n          rowClicked.getClassName());\n      startApp.setComponent(component);\n      startApp.setAction(Intent.ACTION_MAIN);\n\n      startActivity(startApp);\n    }\n```\n\nBefore you run the AppLauncher, be sure to copy and paste the classes and methods into the AppLauncher class so it resembles the complete file below.\n\n```java\n  package org.example.hello;\n\n  import java.util.ArrayList;\n  import java.util.Collections;\n  import java.util.List;\n\n  import android.app.ListActivity;\n  import android.app.ProgressDialog;\n  import android.content.ComponentName;\n  import android.content.Context;\n  import android.content.Intent;\n  import android.content.pm.ActivityInfo;\n  import android.content.pm.PackageInfo;\n  import android.content.pm.PackageManager;\n  import android.content.pm.ResolveInfo;\n  import android.graphics.drawable.Drawable;\n  import android.os.Bundle;\n  import android.util.Log;\n  import android.view.LayoutInflater;\n  import android.view.View;\n  import android.view.ViewGroup;\n  import android.widget.ArrayAdapter;\n  import android.widget.ImageView;\n  import android.widget.ListView;\n  import android.widget.TextView;\n\n  public class AppLauncher extends ListActivity{\n    ApplicationAdapter appAdapter = null;\n    ProgressDialog progressDialog = null; \n    Runnable viewApps = null;\n    ArrayList<AppInfo> packageList = null;\n    Applications myApps = null;\n\n    public void onCreate(Bundle savedInstanceState){\n      super.onCreate(savedInstanceState);\n\n      this.setContentView(R.layout.applauncher);\n\n      packageList = new ArrayList<AppInfo>();\n      appAdapter = new ApplicationAdapter(this, R.layout.applauncherrow,\n          packageList);\n\n      this.setListAdapter(appAdapter);\n\n      viewApps = new Runnable(){\n        public void run(){\n          getApps();\n        }\n      };\n\n      Thread appLoaderThread = new Thread(null, viewApps, \n          \"AppLoaderThread\");\n      appLoaderThread.start();\n\n      progressDialog = ProgressDialog.show(AppLauncher.this, \n          \"Hold on...\", \"Loading your apps...\", true);\n    }\n\n    public class Applications{\n      private ArrayList<AppInfo> packageList = null;\n      private List<ResolveInfo> activityList = null;\n      private Intent mainIntent = new Intent(Intent.ACTION_MAIN, null);\n      private PackageManager packMan = null;\n\n      public Applications(PackageManager packManager){\n        packMan = packManager;\n        packageList = this.createPackageList(false);\n        activityList = this.createActivityList();\n        this.addClassNamesToPackageList();\n      }\n\n      public ArrayList<AppInfo> getPackageList(){\n        return packageList;\n      }\n\n      public List<ResolveInfo> getActivityList(){\n        return activityList;\n      }\n\n      private ArrayList<AppInfo> createPackageList(boolean getSysPackages){\n        ArrayList<AppInfo> pList = new ArrayList<AppInfo>();        \n\n        List<PackageInfo> packs = getPackageManager(\n            ).getInstalledPackages(0);\n\n        for(int i = 0; i < packs.size(); i++){\n          PackageInfo packInfo = packs.get(i);\n\n          if((!getSysPackages) && (packInfo.versionName == null)){\n            continue ;\n          }\n\n          AppInfo newInfo = new AppInfo();\n\n          newInfo.appName = packInfo.applicationInfo.loadLabel(\n              getPackageManager()).toString();\n          newInfo.packageName = packInfo.packageName;   \n          newInfo.versionName = packInfo.versionName;\n          newInfo.versionCode = packInfo.versionCode;\n          newInfo.icon = packInfo.applicationInfo.loadIcon(\n              getPackageManager());\n\n          pList.add(newInfo);\n        }\n        return pList; \n      }\n\n      private List<ResolveInfo> createActivityList(){\n        List<ResolveInfo> aList = packMan.queryIntentActivities(mainIntent, 0);\n\n        Collections.sort(aList, \n            new ResolveInfo.DisplayNameComparator(packMan)); \n\n        return aList;\n      }\n\n      private void packageDebug(){\n        if(null == packageList){\n          return;\n        }\n\n        for(int i = 0; i < packageList.size(); ++i){\n          Log.v(\"PACKINFO: \", \"\\t\" + \n              packageList.get(i).appName + \"\\t\" + \n              packageList.get(i).packageName + \"\\t\" + \n              packageList.get(i).className + \"\\t\" +\n              packageList.get(i).versionName + \"\\t\" + \n              packageList.get(i).versionCode);\n        }\n      }\n\n      private void activityDebug(){\n        if(null == activityList){\n          return;\n        }\n\n        for(int i = 0; i < activityList.size(); i++){ \n          ActivityInfo currentActivity = activityList.get(\n              i).activityInfo;\n          Log.v(\"ACTINFO\", \n              \"pName=\" \n              + currentActivity.applicationInfo.packageName +\n              \" cName=\" + currentActivity.name);\n        }\n      }\n\n      private void addClassNamesToPackageList(){\n        if(null == activityList || null == packageList){\n          return;\n        }\n\n        String tempName = \"\";\n\n        for(int i = 0; i < packageList.size(); ++i){\n          tempName = packageList.get(i).packageName;\n\n          for(int j = 0; j < activityList.size(); ++j){\n            if(tempName.equals(activityList.get(\n                    j).activityInfo.applicationInfo.packageName)){\n              packageList.get(i).className = activityList.get(\n                  j).activityInfo.name;\n            }\n          }\n        }\n      }\n    }\n\n    public class AppInfo{\n      private String appName = \"\";\n      private String packageName = \"\";\n      private String className = \"\";\n      private String versionName = \"\";\n      private Integer versionCode = 0;\n      private Drawable icon = null;\n\n      public String getAppName(){\n        return appName;\n      }\n\n      public String getPackageName(){\n        return packageName;\n      }\n\n      public String getClassName(){\n        return className;\n      }\n\n      public String getVersionName(){\n        return versionName;\n      }\n\n      public Integer getVersionCode(){\n        return versionCode;\n      }\n\n      public Drawable getIcon(){\n        return icon;\n      }\n    }\n\n    public class ApplicationAdapter extends ArrayAdapter<AppInfo>{\n      private ArrayList<AppInfo> items;\n\n      public ApplicationAdapter(Context context, int textViewResourceId, \n          ArrayList<AppInfo> items){\n        super(context, textViewResourceId, items);\n        this.items = items;\n      }\n\n      @Override\n        public View getView(int position, View convertView, \n            ViewGroup parent){\n          View view = convertView;\n\n          if(view == null){\n            LayoutInflater layout = (LayoutInflater)getSystemService(\n                Context.LAYOUT_INFLATER_SERVICE);\n            view = layout.inflate(R.layout.applauncherrow, null);\n          }\n\n          AppInfo appInfo = items.get(position);\n          if(appInfo != null){\n            TextView appName = (TextView) view.findViewById(\n                R.id.applauncherrow_appname);\n            ImageView appIcon = (ImageView) view.findViewById(\n                R.id.applauncherrow_icon);\n\n            if(appName != null){\n              appName.setText(appInfo.getAppName());\n            }\n            if(appIcon != null){\n              appIcon.setImageDrawable(appInfo.getIcon());\n            }\n          }\n\n          return view;\n        }\n    }\n\n    private void getApps(){\n      try{\n        myApps = new Applications(getPackageManager());\n        packageList = myApps.getPackageList();\n      }\n      catch(Exception exception){\n        Log.e(\"BACKGROUND PROC:\", exception.getMessage());\n      }\n      this.runOnUiThread(returnRes);\n    }\n\n    private Runnable returnRes = new Runnable(){\n      public void run(){\n        if(packageList != null && packageList.size() > 0){\n          appAdapter.notifyDataSetChanged();\n\n          for(int i = 0; i < packageList.size(); ++i){\n            appAdapter.add(packageList.get(i));\n          }\n        }\n        progressDialog.dismiss();\n        appAdapter.notifyDataSetChanged();\n      }\n    };\n\n    @Override\n      protected void onListItemClick(ListView list, View view, int position, \n          long id){\n        super.onListItemClick(list, view, position, id);\n\n        AppInfo rowClicked = (AppInfo)this.getListAdapter().getItem(\n            position);\n\n        Intent startApp = new Intent();\n        ComponentName component = new ComponentName(\n            rowClicked.getPackageName(), \n            rowClicked.getClassName());\n        startApp.setComponent(component);\n        startApp.setAction(Intent.ACTION_MAIN);\n\n        startActivity(startApp);\n      }\n  }\n\n```\n\nEnjoy your AppLauncher.\n","slug":"buildanapplicationlauncherwithandroid","published":1,"updated":"2017-04-15T20:23:06.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr1l000h9uwvehno0jqt","content":"<p>In this tutorial we’ll create an interesting android application which has the ability to launch any other app you have installed on your phone. If you’ve ever wanted to know how Android applications perform cross app communication you should read on(this tutorial assumes familiarity with the Android API).</p>\n<p>To start off create a new Android application project within Eclipse. Whenever I develop Android apps I usually start with the layout of the application and add functionality via Java classes later. Since our app will display the users installed apps within a ListView widget we have to first declare a layout to hold the ListView itself.</p>\n<p>Create a new xml layout for the ListView by right clicking the res/layout folder and adding a new android xml file. Title it “applauncher.xml” and then add the code below to it.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span></span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@+id/applauncher_linearlayout&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:orientation</span>=<span class=\"string\">&amp;quot;vertical&amp;quot;</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ListView</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@android:id/list&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;/</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@android:id/empty&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">&amp;quot;List</span> <span class=\"attr\">PlaceHolder</span>&amp;<span class=\"attr\">quot</span>;/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>When using ListViews we can setup the overall look of each row by creating an xml layout with a skeleton of the widgets that we want to display in each row of our ListView. Think of the row layout as a “row template”. If you look at the screenshots of the app you can tell that we only need two widgets within our row layout, an ImageView to hold the apps icon and a TextView to display the apps package name.</p>\n<p>Create a new xml layout for the ListView rows by right clicking the res/layout folder and adding a new android xml file. Title it “applauncherrow.xml” and add the code below.<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span></span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@+id/applauncherrow_imagelinearlayout&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;?android:attr/listPreferredItemHeight&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:padding</span>=<span class=\"string\">&amp;quot;6dip&amp;quot;</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ImageView</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@+id/applauncherrow_icon&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;wrap_content&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_marginRight</span>=<span class=\"string\">&amp;quot;6dip&amp;quot;/</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@+id/applauncherrow_namelinearlayout&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:orientation</span>=<span class=\"string\">&amp;quot;vertical&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;0dip&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_weight</span>=<span class=\"string\">&amp;quot;1&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@+id/applauncherrow_appname&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;0dip&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_weight</span>=<span class=\"string\">&amp;quot;1&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:gravity</span>=<span class=\"string\">&amp;quot;center_vertical&amp;quot;/</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>Next we’re going to setup the main activity for the launcher app and register the activity in the manifest.</p>\n<p>Create a new Java Class and name it “AppLauncher.java”.</p>\n<p>Next open up the manifest file for your application and make sure it looks like the code below.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- Your package=&amp;quot;&amp;quot; name might differ --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">manifest</span> </span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">package</span>=<span class=\"string\">&amp;quot;org.example.hello&amp;quot;</span> </div><div class=\"line\"><span class=\"attr\">android:versionCode</span>=<span class=\"string\">&amp;quot;1&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:versionName</span>=<span class=\"string\">&amp;quot;1.0&amp;quot;</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- Your default android:icon=&amp;quot;&amp;quot; name might differ --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">application</span> </span></div><div class=\"line\"><span class=\"attr\">android:icon</span>=<span class=\"string\">&amp;quot;@drawable/icon&amp;quot;</span> </div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">&amp;quot;AppLauncher&amp;quot;</span> </div><div class=\"line\"><span class=\"attr\">android:debuggable</span>=<span class=\"string\">&amp;quot;true&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:description</span>=<span class=\"string\">&amp;quot;An</span> <span class=\"attr\">Application</span> <span class=\"attr\">Launcher</span>&amp;<span class=\"attr\">quot</span>;&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">&amp;quot;AppLauncher&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">&amp;quot;AppLauncher&amp;quot;</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- This tag indicates the initial activity --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">intent-filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">android:name</span>=<span class=\"string\">&amp;quot;android.intent.action.MAIN&amp;quot;</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">category</span> <span class=\"attr\">android:name</span>=<span class=\"string\">&amp;quot;android.intent.category.LAUNCHER&amp;quot;</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">intent-filter</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">application</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-sdk</span> <span class=\"attr\">android:minSdkVersion</span>=<span class=\"string\">&amp;quot;8&amp;quot;</span> /&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">manifest</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Ok so now that the layouts are coded up and the activity is registered within the manifest open up AppLauncher.java and lets begin.</p>\n<p>Lets start off with importing all the necessary libraries needed for our app.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Your package name might differ</span></div><div class=\"line\"><span class=\"keyword\">package</span> org.example.hello;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.app.ListActivity;</div><div class=\"line\"><span class=\"keyword\">import</span> android.app.ProgressDialog;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.ComponentName;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.ActivityInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.PackageInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.PackageManager;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.ResolveInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.graphics.drawable.Drawable;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.util.Log;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.LayoutInflater;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.ViewGroup;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ArrayAdapter;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ImageView;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ListView;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.TextView;</div></pre></td></tr></table></figure>\n<p>Our app will extend the ListActivity class in order to reduce the boiler plate needed to build a ListView.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppLauncher</span> <span class=\"keyword\">extends</span> <span class=\"title\">ListActivity</span></span>&#123;</div></pre></td></tr></table></figure>\n<p>However, due to the structure of the app we’ll build the classes needed and stitch them together so just follow along with a text editor for now. To begin we’ll need a class to hold all the useful data we can obtain from a given app. We’ll call it AppInfo, its very basic so go ahead and type it into your editor.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppInfo</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">private</span> String appName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> String packageName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> String className = <span class=\"string\">\"\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> String versionName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> Integer versionCode = <span class=\"number\">0</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> Drawable icon = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getAppName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> appName;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPackageName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> packageName;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getClassName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> className;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getVersionName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> versionName;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getVersionCode</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> versionCode;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Drawable <span class=\"title\">getIcon</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> icon;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next class we need is a class that will be used to obtain the application info for the AppInfo class. This class is the bread and butter of our AppLauncher and it together with the AppInfo class can be ported to any application which needs to access other apps via intents.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Applications</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; packageList = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; activityList = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> Intent mainIntent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_MAIN, <span class=\"keyword\">null</span>);</div><div class=\"line\">  <span class=\"keyword\">private</span> PackageManager packMan = <span class=\"keyword\">null</span>;</div></pre></td></tr></table></figure>\n<p>For the Applications constructor we will pass in the all important PackageManager from the main context.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Applications</span><span class=\"params\">(PackageManager packManager)</span></span>&#123;</div><div class=\"line\">  packMan = packManager;</div><div class=\"line\">  packageList = <span class=\"keyword\">this</span>.createPackageList(<span class=\"keyword\">false</span>);</div><div class=\"line\">  activityList = <span class=\"keyword\">this</span>.createActivityList();</div><div class=\"line\">  <span class=\"keyword\">this</span>.addClassNamesToPackageList();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Below are some getter methods for the package and activities list. The difference between the two is that the package list contains the info about the apps data and the activity list contains info about the intents the app responds to.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">getPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> packageList;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> List&lt;ResolveInfo&gt; <span class=\"title\">getActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> activityList;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next method is the createPackageList method. All it does is simply extract a list of all the installed apps via the PackageManager that we passed into the constructor. Next we iterate over the list and copy the info we need into a AppInfo object and then shove that object into the ArrayList<appinfo> that will be returned.</appinfo></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">createPackageList</span><span class=\"params\">(<span class=\"keyword\">boolean</span> getSysPackages)</span></span>&#123;</div><div class=\"line\">  ArrayList&lt;AppInfo&gt; pList = <span class=\"keyword\">new</span> ArrayList&lt;AppInfo&gt;();        </div><div class=\"line\"></div><div class=\"line\">  List&lt;PackageInfo&gt; packs = getPackageManager(</div><div class=\"line\">      ).getInstalledPackages(<span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packs.size(); i++)&#123;</div><div class=\"line\">    PackageInfo packInfo = packs.get(i);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>((!getSysPackages) &amp;&amp; (packInfo.versionName == <span class=\"keyword\">null</span>))&#123;</div><div class=\"line\">      <span class=\"keyword\">continue</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    AppInfo newInfo = <span class=\"keyword\">new</span> AppInfo();</div><div class=\"line\"></div><div class=\"line\">    newInfo.appName = packInfo.applicationInfo.loadLabel(</div><div class=\"line\">        getPackageManager()).toString();</div><div class=\"line\">    newInfo.packageName = packInfo.packageName;   </div><div class=\"line\">    newInfo.versionName = packInfo.versionName;</div><div class=\"line\">    newInfo.versionCode = packInfo.versionCode;</div><div class=\"line\">    newInfo.icon = packInfo.applicationInfo.loadIcon(</div><div class=\"line\">        getPackageManager());</div><div class=\"line\"></div><div class=\"line\">    pList.add(newInfo);</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">return</span> pList; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Similar to the createPakageList method, createActivityList will return a list with all of the apps installed intent data but unlike createPackageList its only 8 lines of code.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; <span class=\"title\">createActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">  List&lt;ResolveInfo&gt; aList = packMan.queryIntentActivities(mainIntent, <span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">  Collections.sort(aList, </div><div class=\"line\">      <span class=\"keyword\">new</span> ResolveInfo.DisplayNameComparator(packMan)); </div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> aList;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next two methods are purely for dubugging purposes and can actually be left out but we’ll include them for completeness or in case you use this class in another application.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">packageDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">      Log.v(<span class=\"string\">\"PACKINFO: \"</span>, <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).appName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).packageName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).className + <span class=\"string\">\"\\t\"</span> +</div><div class=\"line\">          packageList.get(i).versionName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).versionCode);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">activityDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList)&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span>;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; activityList.size(); i++)&#123; </div><div class=\"line\">    ActivityInfo currentActivity = activityList.get(</div><div class=\"line\">        i).activityInfo;</div><div class=\"line\">    Log.v(<span class=\"string\">\"ACTINFO\"</span>, </div><div class=\"line\">        <span class=\"string\">\"pName=\"</span> </div><div class=\"line\">        + currentActivity.applicationInfo.packageName +</div><div class=\"line\">        <span class=\"string\">\" cName=\"</span> + currentActivity.name);</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next method is needed only because in order to launch an app you need both its package name and its intent name that connects to the main class of the app. However, if you only use the packageList you’ll lack the intent data, so the last method of the Application class adds the class name(intent data) to the packageList making it such that client of the class can have everything bundled up nicely in the packageList instead of having to rely on using both the activity and packageList in unison.</p>\n<p>For the method addClassNameToPackageList we’ll iterate over the packageList and for each packageName we’ll find its match within the activityList by packageName and then extract the className from the activityList.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">addClassNamesToPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList || <span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      String tempName = <span class=\"string\">\"\"</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">        tempName = packageList.get(i).packageName;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; activityList.size(); ++j)&#123;</div><div class=\"line\">          <span class=\"keyword\">if</span>(tempName.equals(activityList.get(</div><div class=\"line\">                  j).activityInfo.applicationInfo.packageName))&#123;</div><div class=\"line\">            packageList.get(i).className = activityList.get(</div><div class=\"line\">                j).activityInfo.name;</div><div class=\"line\">          &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Below is the complete Application class</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Applications</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; packageList = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; activityList = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> Intent mainIntent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_MAIN, <span class=\"keyword\">null</span>);</div><div class=\"line\">  <span class=\"keyword\">private</span> PackageManager packMan = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Applications</span><span class=\"params\">(PackageManager packManager)</span></span>&#123;</div><div class=\"line\">    packMan = packManager;</div><div class=\"line\">    packageList = <span class=\"keyword\">this</span>.createPackageList(<span class=\"keyword\">false</span>);</div><div class=\"line\">    activityList = <span class=\"keyword\">this</span>.createActivityList();</div><div class=\"line\">    <span class=\"keyword\">this</span>.addClassNamesToPackageList();</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">getPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> packageList;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> List&lt;ResolveInfo&gt; <span class=\"title\">getActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> activityList;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">createPackageList</span><span class=\"params\">(<span class=\"keyword\">boolean</span> getSysPackages)</span></span>&#123;</div><div class=\"line\">    ArrayList&lt;AppInfo&gt; pList = <span class=\"keyword\">new</span> ArrayList&lt;AppInfo&gt;();        </div><div class=\"line\"></div><div class=\"line\">    List&lt;PackageInfo&gt; packs = getPackageManager(</div><div class=\"line\">        ).getInstalledPackages(<span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packs.size(); i++)&#123;</div><div class=\"line\">      PackageInfo packInfo = packs.get(i);</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>((!getSysPackages) &amp;&amp; (packInfo.versionName == <span class=\"keyword\">null</span>))&#123;</div><div class=\"line\">        <span class=\"keyword\">continue</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      AppInfo newInfo = <span class=\"keyword\">new</span> AppInfo();</div><div class=\"line\"></div><div class=\"line\">      newInfo.appName = packInfo.applicationInfo.loadLabel(</div><div class=\"line\">          getPackageManager()).toString();</div><div class=\"line\">      newInfo.packageName = packInfo.packageName;   </div><div class=\"line\">      newInfo.versionName = packInfo.versionName;</div><div class=\"line\">      newInfo.versionCode = packInfo.versionCode;</div><div class=\"line\">      newInfo.icon = packInfo.applicationInfo.loadIcon(</div><div class=\"line\">          getPackageManager());</div><div class=\"line\"></div><div class=\"line\">      pList.add(newInfo);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> pList; </div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; <span class=\"title\">createActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    List&lt;ResolveInfo&gt; aList = packMan.queryIntentActivities(mainIntent, <span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">    Collections.sort(aList, </div><div class=\"line\">        <span class=\"keyword\">new</span> ResolveInfo.DisplayNameComparator(packMan)); </div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> aList;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">packageDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">      Log.v(<span class=\"string\">\"PACKINFO: \"</span>, <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).appName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).packageName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).className + <span class=\"string\">\"\\t\"</span> +</div><div class=\"line\">          packageList.get(i).versionName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).versionCode);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">activityDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList)&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; activityList.size(); i++)&#123; </div><div class=\"line\">      ActivityInfo currentActivity = activityList.get(</div><div class=\"line\">          i).activityInfo;</div><div class=\"line\">      Log.v(<span class=\"string\">\"ACTINFO\"</span>, </div><div class=\"line\">          <span class=\"string\">\"pName=\"</span> </div><div class=\"line\">          + currentActivity.applicationInfo.packageName +</div><div class=\"line\">          <span class=\"string\">\" cName=\"</span> + currentActivity.name);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">addClassNamesToPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList || <span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    String tempName = <span class=\"string\">\"\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">      tempName = packageList.get(i).packageName;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; activityList.size(); ++j)&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>(tempName.equals(activityList.get(</div><div class=\"line\">                j).activityInfo.applicationInfo.packageName))&#123;</div><div class=\"line\">          packageList.get(i).className = activityList.get(</div><div class=\"line\">              j).activityInfo.name;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Remember the AppInfo class that we made and the applauncherrow.xml layout. Well, now we’ll utilize both within the custom ArrayAdapter extension we’ll use to populate the data of our List. ArrayAdapters are used to fill in the data fields of a ListView widget by storing a layout(android uses the term inflate) holding data into a single row of the list.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationAdapter</span> <span class=\"keyword\">extends</span> <span class=\"title\">ArrayAdapter</span>&lt;<span class=\"title\">AppInfo</span>&gt;</span>&#123;</div><div class=\"line\">  <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; items;</div></pre></td></tr></table></figure>\n<p>The constructor for our ArrayAdapter extension…</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ApplicationAdapter</span><span class=\"params\">(Context context, <span class=\"keyword\">int</span> textViewResourceId, ArrayList&lt;AppInfo&gt; items)</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">super</span>(context, textViewResourceId, items);</div><div class=\"line\">  <span class=\"keyword\">this</span>.items = items;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Being an ArrayAdapter extension means that we have to override the getView method, this is where the applauncherrow layout is populated with data and is used to represent each row of the ListView. To start we’ll reference the applauncherrow layout and inflate it to become a view.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> View <span class=\"title\">getView</span><span class=\"params\">(<span class=\"keyword\">int</span> position, View convertView, </span></span></div><div class=\"line\">    ViewGroup parent)&#123;</div><div class=\"line\">  View view = convertView;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>(view == <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">    LayoutInflater layout = (LayoutInflater)getSystemService(</div><div class=\"line\">        Context.LAYOUT_INFLATER_SERVICE);</div><div class=\"line\">    view = layout.inflate(R.layout.applauncherrow, <span class=\"keyword\">null</span>);</div><div class=\"line\">  &#125;</div></pre></td></tr></table></figure>\n<p>Now that the view is inflated with the applauncherrow.xml layout we can now match the ImageView and TextView with the contents of a AppInfo object in preparation for moving it into the ListView.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">        AppInfo appInfo = items.get(position);</div><div class=\"line\">      <span class=\"keyword\">if</span>(appInfo != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">        TextView appName = (TextView) view.findViewById(</div><div class=\"line\">            R.id.applauncherrow_appname);</div><div class=\"line\">        ImageView appIcon = (ImageView) view.findViewById(</div><div class=\"line\">            R.id.applauncherrow_icon);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span>(appName != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          appName.setText(appInfo.getAppName());</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span>(appIcon != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          appIcon.setImageDrawable(appInfo.getIcon());</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">return</span> view;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Here is the complete ApplicationAdapter class, you should add it to your text file.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationAdapter</span> <span class=\"keyword\">extends</span> <span class=\"title\">ArrayAdapter</span>&lt;<span class=\"title\">AppInfo</span>&gt;</span>&#123;</div><div class=\"line\">  <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; items;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ApplicationAdapter</span><span class=\"params\">(Context context, <span class=\"keyword\">int</span> textViewResourceId, </span></span></div><div class=\"line\">      ArrayList&lt;AppInfo&gt; items)&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>(context, textViewResourceId, items);</div><div class=\"line\">    <span class=\"keyword\">this</span>.items = items;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> View <span class=\"title\">getView</span><span class=\"params\">(<span class=\"keyword\">int</span> position, View convertView, </span></span></div><div class=\"line\">        ViewGroup parent)&#123;</div><div class=\"line\">      View view = convertView;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>(view == <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">        LayoutInflater layout = (LayoutInflater)getSystemService(</div><div class=\"line\">            Context.LAYOUT_INFLATER_SERVICE);</div><div class=\"line\">        view = layout.inflate(R.layout.applauncherrow, <span class=\"keyword\">null</span>);</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      AppInfo appInfo = items.get(position);</div><div class=\"line\">      <span class=\"keyword\">if</span>(appInfo != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">        TextView appName = (TextView) view.findViewById(</div><div class=\"line\">            R.id.applauncherrow_appname);</div><div class=\"line\">        ImageView appIcon = (ImageView) view.findViewById(</div><div class=\"line\">            R.id.applauncherrow_icon);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span>(appName != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          appName.setText(appInfo.getAppName());</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span>(appIcon != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          appIcon.setImageDrawable(appInfo.getIcon());</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">return</span> view;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>We are done with the utility classes so the next step is to add some methods to the AppLauncher class itself. The first one we’re going to add is a method called getApps() which stores the pacakageList from an Applications object and passes it off to Java Runnable to be ran on a thread.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">getApps</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">try</span>&#123;</div><div class=\"line\">    myApps = <span class=\"keyword\">new</span> Applications(getPackageManager());</div><div class=\"line\">    packageList = myApps.getPackageList();</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">catch</span>(Exception exception)&#123;</div><div class=\"line\">    Log.e(<span class=\"string\">\"BACKGROUND PROC:\"</span>, exception.getMessage());</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">this</span>.runOnUiThread(returnRes);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>If you look at the getApps() method the last line before the class ends is a method called this.runOnUiThread(returnRes), now what this means is that the main thread will be locked while we pump AppInfo objects into our ListView via the ArrayAdapter. If you are experienced with concurrent programming you might be wondering why lock the mainUIThread, the answer is because our app can’t do anything until all objects have been added to the list. If we by chance were dynamically loading things from the Internet via HTTP requests then we would opt instead for a lazy loader which spawns a thread for each view object pumped into the ListVIew and the list would slowly populate as each item was fetched live from the web. So anyways here is our Runnable method that checks first that the packageList exists and then uses an object from our ApplicationAdapter to fill up our ListView widget.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> Runnable returnRes = <span class=\"keyword\">new</span> Runnable()&#123;</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(packageList != <span class=\"keyword\">null</span> &amp;&amp; packageList.size() &gt; <span class=\"number\">0</span>)&#123;</div><div class=\"line\">      appAdapter.notifyDataSetChanged();</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">        appAdapter.add(packageList.get(i));</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    progressDialog.dismiss();</div><div class=\"line\">    appAdapter.notifyDataSetChanged();</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<p>We’re almost done so now open up your Eclipse IDE to the AppLauncher project and click on the AppLauncher.java class. If you remember from earlier where we left off go ahead and add the data members below to the AppLauncher class; notice the line numbers for reference.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">ApplicationAdapter appAdapter = <span class=\"keyword\">null</span>;</div><div class=\"line\">ProgressDialog progressDialog = <span class=\"keyword\">null</span>; </div><div class=\"line\">Runnable viewApps = <span class=\"keyword\">null</span>;</div><div class=\"line\">ArrayList&lt;AppInfo&gt; packageList = <span class=\"keyword\">null</span>;</div><div class=\"line\">Applications myApps = <span class=\"keyword\">null</span>;</div></pre></td></tr></table></figure>\n<p>For the onCreate() method there are some things you sould notice. First since AppLauncher is a ListActivity extension it inherits the setListAdapter() method. Second we’ll  initialize the viewApps Runnable to call our getApps() within its run(). This means that any thread created with the viewApps as it’s runnable will load up our packages into the ListView. In addition since getApps() locks the mainUIThread users of this app won’t be able to do anything until the thread finishes.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle savedInstanceState)</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">super</span>.onCreate(savedInstanceState);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">this</span>.setContentView(R.layout.applauncher);</div><div class=\"line\"></div><div class=\"line\">  packageList = <span class=\"keyword\">new</span> ArrayList&lt;AppInfo&gt;();</div><div class=\"line\">  appAdapter = <span class=\"keyword\">new</span> ApplicationAdapter(<span class=\"keyword\">this</span>, R.layout.applauncherrow,</div><div class=\"line\">      packageList);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">this</span>.setListAdapter(appAdapter);</div><div class=\"line\"></div><div class=\"line\">  viewApps = <span class=\"keyword\">new</span> Runnable()&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      getApps();</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  Thread appLoaderThread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">null</span>, viewApps, </div><div class=\"line\">      <span class=\"string\">\"AppLoaderThread\"</span>);</div><div class=\"line\">  appLoaderThread.start();</div></pre></td></tr></table></figure>\n<p>Now that the thread has started and the app has been officially locked, how do we notify the user? The answer is with the android.app.ProgressDialog widget. Remember those loading screen from popular video games, that’s all ProgressDialogs do.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">    progressDialog = ProgressDialog.show(AppLauncher.<span class=\"keyword\">this</span>, <span class=\"string\">\"Hold on...\"</span>, <span class=\"string\">\"Loading your apps...\"</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Right now our app can successfully load up a list of Icons and application names but how then do we launch the apps the user touches from our list? The answer is via starting a new intent by overriding the onListItemClick method. So go open up your text file that contains the utility classes and methods and add the onListItemClick() method to it.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onListItemClick</span><span class=\"params\">(ListView list, View view, <span class=\"keyword\">int</span> position, </span></span></div><div class=\"line\">    <span class=\"keyword\">long</span> id)&#123;</div><div class=\"line\">  <span class=\"keyword\">super</span>.onListItemClick(list, view, position, id);</div><div class=\"line\"></div><div class=\"line\">  AppInfo rowClicked = (AppInfo)<span class=\"keyword\">this</span>.getListAdapter().getItem(</div><div class=\"line\">      position);</div><div class=\"line\"></div><div class=\"line\">  Intent startApp = <span class=\"keyword\">new</span> Intent();</div><div class=\"line\">  ComponentName component = <span class=\"keyword\">new</span> ComponentName(</div><div class=\"line\">      rowClicked.getPackageName(), </div><div class=\"line\">      rowClicked.getClassName());</div><div class=\"line\">  startApp.setComponent(component);</div><div class=\"line\">  startApp.setAction(Intent.ACTION_MAIN);</div><div class=\"line\"></div><div class=\"line\">  startActivity(startApp);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Before you run the AppLauncher, be sure to copy and paste the classes and methods into the AppLauncher class so it resembles the complete file below.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> org.example.hello;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.app.ListActivity;</div><div class=\"line\"><span class=\"keyword\">import</span> android.app.ProgressDialog;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.ComponentName;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.ActivityInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.PackageInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.PackageManager;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.ResolveInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.graphics.drawable.Drawable;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.util.Log;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.LayoutInflater;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.ViewGroup;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ArrayAdapter;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ImageView;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ListView;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.TextView;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppLauncher</span> <span class=\"keyword\">extends</span> <span class=\"title\">ListActivity</span></span>&#123;</div><div class=\"line\">  ApplicationAdapter appAdapter = <span class=\"keyword\">null</span>;</div><div class=\"line\">  ProgressDialog progressDialog = <span class=\"keyword\">null</span>; </div><div class=\"line\">  Runnable viewApps = <span class=\"keyword\">null</span>;</div><div class=\"line\">  ArrayList&lt;AppInfo&gt; packageList = <span class=\"keyword\">null</span>;</div><div class=\"line\">  Applications myApps = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle savedInstanceState)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>.onCreate(savedInstanceState);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">this</span>.setContentView(R.layout.applauncher);</div><div class=\"line\"></div><div class=\"line\">    packageList = <span class=\"keyword\">new</span> ArrayList&lt;AppInfo&gt;();</div><div class=\"line\">    appAdapter = <span class=\"keyword\">new</span> ApplicationAdapter(<span class=\"keyword\">this</span>, R.layout.applauncherrow,</div><div class=\"line\">        packageList);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">this</span>.setListAdapter(appAdapter);</div><div class=\"line\"></div><div class=\"line\">    viewApps = <span class=\"keyword\">new</span> Runnable()&#123;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">        getApps();</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;;</div><div class=\"line\"></div><div class=\"line\">    Thread appLoaderThread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">null</span>, viewApps, </div><div class=\"line\">        <span class=\"string\">\"AppLoaderThread\"</span>);</div><div class=\"line\">    appLoaderThread.start();</div><div class=\"line\"></div><div class=\"line\">    progressDialog = ProgressDialog.show(AppLauncher.<span class=\"keyword\">this</span>, </div><div class=\"line\">        <span class=\"string\">\"Hold on...\"</span>, <span class=\"string\">\"Loading your apps...\"</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Applications</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; packageList = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; activityList = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> Intent mainIntent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_MAIN, <span class=\"keyword\">null</span>);</div><div class=\"line\">    <span class=\"keyword\">private</span> PackageManager packMan = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Applications</span><span class=\"params\">(PackageManager packManager)</span></span>&#123;</div><div class=\"line\">      packMan = packManager;</div><div class=\"line\">      packageList = <span class=\"keyword\">this</span>.createPackageList(<span class=\"keyword\">false</span>);</div><div class=\"line\">      activityList = <span class=\"keyword\">this</span>.createActivityList();</div><div class=\"line\">      <span class=\"keyword\">this</span>.addClassNamesToPackageList();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">getPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> packageList;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;ResolveInfo&gt; <span class=\"title\">getActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> activityList;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">createPackageList</span><span class=\"params\">(<span class=\"keyword\">boolean</span> getSysPackages)</span></span>&#123;</div><div class=\"line\">      ArrayList&lt;AppInfo&gt; pList = <span class=\"keyword\">new</span> ArrayList&lt;AppInfo&gt;();        </div><div class=\"line\"></div><div class=\"line\">      List&lt;PackageInfo&gt; packs = getPackageManager(</div><div class=\"line\">          ).getInstalledPackages(<span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packs.size(); i++)&#123;</div><div class=\"line\">        PackageInfo packInfo = packs.get(i);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span>((!getSysPackages) &amp;&amp; (packInfo.versionName == <span class=\"keyword\">null</span>))&#123;</div><div class=\"line\">          <span class=\"keyword\">continue</span> ;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        AppInfo newInfo = <span class=\"keyword\">new</span> AppInfo();</div><div class=\"line\"></div><div class=\"line\">        newInfo.appName = packInfo.applicationInfo.loadLabel(</div><div class=\"line\">            getPackageManager()).toString();</div><div class=\"line\">        newInfo.packageName = packInfo.packageName;   </div><div class=\"line\">        newInfo.versionName = packInfo.versionName;</div><div class=\"line\">        newInfo.versionCode = packInfo.versionCode;</div><div class=\"line\">        newInfo.icon = packInfo.applicationInfo.loadIcon(</div><div class=\"line\">            getPackageManager());</div><div class=\"line\"></div><div class=\"line\">        pList.add(newInfo);</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">return</span> pList; </div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; <span class=\"title\">createActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      List&lt;ResolveInfo&gt; aList = packMan.queryIntentActivities(mainIntent, <span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">      Collections.sort(aList, </div><div class=\"line\">          <span class=\"keyword\">new</span> ResolveInfo.DisplayNameComparator(packMan)); </div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">return</span> aList;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">packageDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">        Log.v(<span class=\"string\">\"PACKINFO: \"</span>, <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">            packageList.get(i).appName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">            packageList.get(i).packageName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">            packageList.get(i).className + <span class=\"string\">\"\\t\"</span> +</div><div class=\"line\">            packageList.get(i).versionName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">            packageList.get(i).versionCode);</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">activityDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList)&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; activityList.size(); i++)&#123; </div><div class=\"line\">        ActivityInfo currentActivity = activityList.get(</div><div class=\"line\">            i).activityInfo;</div><div class=\"line\">        Log.v(<span class=\"string\">\"ACTINFO\"</span>, </div><div class=\"line\">            <span class=\"string\">\"pName=\"</span> </div><div class=\"line\">            + currentActivity.applicationInfo.packageName +</div><div class=\"line\">            <span class=\"string\">\" cName=\"</span> + currentActivity.name);</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">addClassNamesToPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList || <span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      String tempName = <span class=\"string\">\"\"</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">        tempName = packageList.get(i).packageName;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; activityList.size(); ++j)&#123;</div><div class=\"line\">          <span class=\"keyword\">if</span>(tempName.equals(activityList.get(</div><div class=\"line\">                  j).activityInfo.applicationInfo.packageName))&#123;</div><div class=\"line\">            packageList.get(i).className = activityList.get(</div><div class=\"line\">                j).activityInfo.name;</div><div class=\"line\">          &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppInfo</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> String appName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String packageName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String className = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String versionName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> Integer versionCode = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> Drawable icon = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getAppName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> appName;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPackageName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> packageName;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getClassName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> className;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getVersionName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> versionName;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getVersionCode</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> versionCode;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Drawable <span class=\"title\">getIcon</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> icon;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationAdapter</span> <span class=\"keyword\">extends</span> <span class=\"title\">ArrayAdapter</span>&lt;<span class=\"title\">AppInfo</span>&gt;</span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; items;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ApplicationAdapter</span><span class=\"params\">(Context context, <span class=\"keyword\">int</span> textViewResourceId, </span></span></div><div class=\"line\">        ArrayList&lt;AppInfo&gt; items)&#123;</div><div class=\"line\">      <span class=\"keyword\">super</span>(context, textViewResourceId, items);</div><div class=\"line\">      <span class=\"keyword\">this</span>.items = items;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> View <span class=\"title\">getView</span><span class=\"params\">(<span class=\"keyword\">int</span> position, View convertView, </span></span></div><div class=\"line\">          ViewGroup parent)&#123;</div><div class=\"line\">        View view = convertView;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span>(view == <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          LayoutInflater layout = (LayoutInflater)getSystemService(</div><div class=\"line\">              Context.LAYOUT_INFLATER_SERVICE);</div><div class=\"line\">          view = layout.inflate(R.layout.applauncherrow, <span class=\"keyword\">null</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        AppInfo appInfo = items.get(position);</div><div class=\"line\">        <span class=\"keyword\">if</span>(appInfo != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          TextView appName = (TextView) view.findViewById(</div><div class=\"line\">              R.id.applauncherrow_appname);</div><div class=\"line\">          ImageView appIcon = (ImageView) view.findViewById(</div><div class=\"line\">              R.id.applauncherrow_icon);</div><div class=\"line\"></div><div class=\"line\">          <span class=\"keyword\">if</span>(appName != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">            appName.setText(appInfo.getAppName());</div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"keyword\">if</span>(appIcon != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">            appIcon.setImageDrawable(appInfo.getIcon());</div><div class=\"line\">          &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> view;</div><div class=\"line\">      &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">getApps</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">try</span>&#123;</div><div class=\"line\">      myApps = <span class=\"keyword\">new</span> Applications(getPackageManager());</div><div class=\"line\">      packageList = myApps.getPackageList();</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">catch</span>(Exception exception)&#123;</div><div class=\"line\">      Log.e(<span class=\"string\">\"BACKGROUND PROC:\"</span>, exception.getMessage());</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">this</span>.runOnUiThread(returnRes);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> Runnable returnRes = <span class=\"keyword\">new</span> Runnable()&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>(packageList != <span class=\"keyword\">null</span> &amp;&amp; packageList.size() &gt; <span class=\"number\">0</span>)&#123;</div><div class=\"line\">        appAdapter.notifyDataSetChanged();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">          appAdapter.add(packageList.get(i));</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">      progressDialog.dismiss();</div><div class=\"line\">      appAdapter.notifyDataSetChanged();</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onListItemClick</span><span class=\"params\">(ListView list, View view, <span class=\"keyword\">int</span> position, </span></span></div><div class=\"line\">        <span class=\"keyword\">long</span> id)&#123;</div><div class=\"line\">      <span class=\"keyword\">super</span>.onListItemClick(list, view, position, id);</div><div class=\"line\"></div><div class=\"line\">      AppInfo rowClicked = (AppInfo)<span class=\"keyword\">this</span>.getListAdapter().getItem(</div><div class=\"line\">          position);</div><div class=\"line\"></div><div class=\"line\">      Intent startApp = <span class=\"keyword\">new</span> Intent();</div><div class=\"line\">      ComponentName component = <span class=\"keyword\">new</span> ComponentName(</div><div class=\"line\">          rowClicked.getPackageName(), </div><div class=\"line\">          rowClicked.getClassName());</div><div class=\"line\">      startApp.setComponent(component);</div><div class=\"line\">      startApp.setAction(Intent.ACTION_MAIN);</div><div class=\"line\"></div><div class=\"line\">      startActivity(startApp);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Enjoy your AppLauncher.</p>\n","site":{"data":{}},"excerpt":"","more":"<p>In this tutorial we’ll create an interesting android application which has the ability to launch any other app you have installed on your phone. If you’ve ever wanted to know how Android applications perform cross app communication you should read on(this tutorial assumes familiarity with the Android API).</p>\n<p>To start off create a new Android application project within Eclipse. Whenever I develop Android apps I usually start with the layout of the application and add functionality via Java classes later. Since our app will display the users installed apps within a ListView widget we have to first declare a layout to hold the ListView itself.</p>\n<p>Create a new xml layout for the ListView by right clicking the res/layout folder and adding a new android xml file. Title it “applauncher.xml” and then add the code below to it.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@+id/applauncher_linearlayout&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:orientation</span>=<span class=\"string\">&amp;quot;vertical&amp;quot;</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ListView</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@android:id/list&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;/</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@android:id/empty&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">&amp;quot;List</span> <span class=\"attr\">PlaceHolder</span>&amp;<span class=\"attr\">quot</span>;/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>When using ListViews we can setup the overall look of each row by creating an xml layout with a skeleton of the widgets that we want to display in each row of our ListView. Think of the row layout as a “row template”. If you look at the screenshots of the app you can tell that we only need two widgets within our row layout, an ImageView to hold the apps icon and a TextView to display the apps package name.</p>\n<p>Create a new xml layout for the ListView rows by right clicking the res/layout folder and adding a new android xml file. Title it “applauncherrow.xml” and add the code below.<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@+id/applauncherrow_imagelinearlayout&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;?android:attr/listPreferredItemHeight&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:padding</span>=<span class=\"string\">&amp;quot;6dip&amp;quot;</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ImageView</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@+id/applauncherrow_icon&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;wrap_content&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_marginRight</span>=<span class=\"string\">&amp;quot;6dip&amp;quot;/</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@+id/applauncherrow_namelinearlayout&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:orientation</span>=<span class=\"string\">&amp;quot;vertical&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;0dip&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_weight</span>=<span class=\"string\">&amp;quot;1&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">&amp;quot;@+id/applauncherrow_appname&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">&amp;quot;fill_parent&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">&amp;quot;0dip&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:layout_weight</span>=<span class=\"string\">&amp;quot;1&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:gravity</span>=<span class=\"string\">&amp;quot;center_vertical&amp;quot;/</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>Next we’re going to setup the main activity for the launcher app and register the activity in the manifest.</p>\n<p>Create a new Java Class and name it “AppLauncher.java”.</p>\n<p>Next open up the manifest file for your application and make sure it looks like the code below.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- Your package=&amp;quot;&amp;quot; name might differ --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">manifest</span> </div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">package</span>=<span class=\"string\">&amp;quot;org.example.hello&amp;quot;</span> </div><div class=\"line\"><span class=\"attr\">android:versionCode</span>=<span class=\"string\">&amp;quot;1&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:versionName</span>=<span class=\"string\">&amp;quot;1.0&amp;quot;</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- Your default android:icon=&amp;quot;&amp;quot; name might differ --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">application</span> </div><div class=\"line\"><span class=\"attr\">android:icon</span>=<span class=\"string\">&amp;quot;@drawable/icon&amp;quot;</span> </div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">&amp;quot;AppLauncher&amp;quot;</span> </div><div class=\"line\"><span class=\"attr\">android:debuggable</span>=<span class=\"string\">&amp;quot;true&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:description</span>=<span class=\"string\">&amp;quot;An</span> <span class=\"attr\">Application</span> <span class=\"attr\">Launcher</span>&amp;<span class=\"attr\">quot</span>;&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">&amp;quot;AppLauncher&amp;quot;</span></div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">&amp;quot;AppLauncher&amp;quot;</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- This tag indicates the initial activity --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">intent-filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">android:name</span>=<span class=\"string\">&amp;quot;android.intent.action.MAIN&amp;quot;</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">category</span> <span class=\"attr\">android:name</span>=<span class=\"string\">&amp;quot;android.intent.category.LAUNCHER&amp;quot;</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">intent-filter</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">application</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-sdk</span> <span class=\"attr\">android:minSdkVersion</span>=<span class=\"string\">&amp;quot;8&amp;quot;</span> /&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">manifest</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Ok so now that the layouts are coded up and the activity is registered within the manifest open up AppLauncher.java and lets begin.</p>\n<p>Lets start off with importing all the necessary libraries needed for our app.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Your package name might differ</span></div><div class=\"line\"><span class=\"keyword\">package</span> org.example.hello;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.app.ListActivity;</div><div class=\"line\"><span class=\"keyword\">import</span> android.app.ProgressDialog;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.ComponentName;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.ActivityInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.PackageInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.PackageManager;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.ResolveInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.graphics.drawable.Drawable;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.util.Log;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.LayoutInflater;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.ViewGroup;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ArrayAdapter;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ImageView;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ListView;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.TextView;</div></pre></td></tr></table></figure>\n<p>Our app will extend the ListActivity class in order to reduce the boiler plate needed to build a ListView.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppLauncher</span> <span class=\"keyword\">extends</span> <span class=\"title\">ListActivity</span></span>&#123;</div></pre></td></tr></table></figure>\n<p>However, due to the structure of the app we’ll build the classes needed and stitch them together so just follow along with a text editor for now. To begin we’ll need a class to hold all the useful data we can obtain from a given app. We’ll call it AppInfo, its very basic so go ahead and type it into your editor.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppInfo</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">private</span> String appName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> String packageName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> String className = <span class=\"string\">\"\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> String versionName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> Integer versionCode = <span class=\"number\">0</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> Drawable icon = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getAppName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> appName;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPackageName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> packageName;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getClassName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> className;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getVersionName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> versionName;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getVersionCode</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> versionCode;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Drawable <span class=\"title\">getIcon</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> icon;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next class we need is a class that will be used to obtain the application info for the AppInfo class. This class is the bread and butter of our AppLauncher and it together with the AppInfo class can be ported to any application which needs to access other apps via intents.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Applications</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; packageList = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; activityList = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> Intent mainIntent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_MAIN, <span class=\"keyword\">null</span>);</div><div class=\"line\">  <span class=\"keyword\">private</span> PackageManager packMan = <span class=\"keyword\">null</span>;</div></pre></td></tr></table></figure>\n<p>For the Applications constructor we will pass in the all important PackageManager from the main context.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Applications</span><span class=\"params\">(PackageManager packManager)</span></span>&#123;</div><div class=\"line\">  packMan = packManager;</div><div class=\"line\">  packageList = <span class=\"keyword\">this</span>.createPackageList(<span class=\"keyword\">false</span>);</div><div class=\"line\">  activityList = <span class=\"keyword\">this</span>.createActivityList();</div><div class=\"line\">  <span class=\"keyword\">this</span>.addClassNamesToPackageList();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Below are some getter methods for the package and activities list. The difference between the two is that the package list contains the info about the apps data and the activity list contains info about the intents the app responds to.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">getPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> packageList;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> List&lt;ResolveInfo&gt; <span class=\"title\">getActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> activityList;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next method is the createPackageList method. All it does is simply extract a list of all the installed apps via the PackageManager that we passed into the constructor. Next we iterate over the list and copy the info we need into a AppInfo object and then shove that object into the ArrayList<AppInfo> that will be returned.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">createPackageList</span><span class=\"params\">(<span class=\"keyword\">boolean</span> getSysPackages)</span></span>&#123;</div><div class=\"line\">  ArrayList&lt;AppInfo&gt; pList = <span class=\"keyword\">new</span> ArrayList&lt;AppInfo&gt;();        </div><div class=\"line\"></div><div class=\"line\">  List&lt;PackageInfo&gt; packs = getPackageManager(</div><div class=\"line\">      ).getInstalledPackages(<span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packs.size(); i++)&#123;</div><div class=\"line\">    PackageInfo packInfo = packs.get(i);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>((!getSysPackages) &amp;&amp; (packInfo.versionName == <span class=\"keyword\">null</span>))&#123;</div><div class=\"line\">      <span class=\"keyword\">continue</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    AppInfo newInfo = <span class=\"keyword\">new</span> AppInfo();</div><div class=\"line\"></div><div class=\"line\">    newInfo.appName = packInfo.applicationInfo.loadLabel(</div><div class=\"line\">        getPackageManager()).toString();</div><div class=\"line\">    newInfo.packageName = packInfo.packageName;   </div><div class=\"line\">    newInfo.versionName = packInfo.versionName;</div><div class=\"line\">    newInfo.versionCode = packInfo.versionCode;</div><div class=\"line\">    newInfo.icon = packInfo.applicationInfo.loadIcon(</div><div class=\"line\">        getPackageManager());</div><div class=\"line\"></div><div class=\"line\">    pList.add(newInfo);</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">return</span> pList; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Similar to the createPakageList method, createActivityList will return a list with all of the apps installed intent data but unlike createPackageList its only 8 lines of code.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; <span class=\"title\">createActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">  List&lt;ResolveInfo&gt; aList = packMan.queryIntentActivities(mainIntent, <span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">  Collections.sort(aList, </div><div class=\"line\">      <span class=\"keyword\">new</span> ResolveInfo.DisplayNameComparator(packMan)); </div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> aList;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next two methods are purely for dubugging purposes and can actually be left out but we’ll include them for completeness or in case you use this class in another application.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">packageDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">      Log.v(<span class=\"string\">\"PACKINFO: \"</span>, <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).appName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).packageName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).className + <span class=\"string\">\"\\t\"</span> +</div><div class=\"line\">          packageList.get(i).versionName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).versionCode);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">activityDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList)&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span>;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; activityList.size(); i++)&#123; </div><div class=\"line\">    ActivityInfo currentActivity = activityList.get(</div><div class=\"line\">        i).activityInfo;</div><div class=\"line\">    Log.v(<span class=\"string\">\"ACTINFO\"</span>, </div><div class=\"line\">        <span class=\"string\">\"pName=\"</span> </div><div class=\"line\">        + currentActivity.applicationInfo.packageName +</div><div class=\"line\">        <span class=\"string\">\" cName=\"</span> + currentActivity.name);</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next method is needed only because in order to launch an app you need both its package name and its intent name that connects to the main class of the app. However, if you only use the packageList you’ll lack the intent data, so the last method of the Application class adds the class name(intent data) to the packageList making it such that client of the class can have everything bundled up nicely in the packageList instead of having to rely on using both the activity and packageList in unison.</p>\n<p>For the method addClassNameToPackageList we’ll iterate over the packageList and for each packageName we’ll find its match within the activityList by packageName and then extract the className from the activityList.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">addClassNamesToPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList || <span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      String tempName = <span class=\"string\">\"\"</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">        tempName = packageList.get(i).packageName;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; activityList.size(); ++j)&#123;</div><div class=\"line\">          <span class=\"keyword\">if</span>(tempName.equals(activityList.get(</div><div class=\"line\">                  j).activityInfo.applicationInfo.packageName))&#123;</div><div class=\"line\">            packageList.get(i).className = activityList.get(</div><div class=\"line\">                j).activityInfo.name;</div><div class=\"line\">          &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Below is the complete Application class</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Applications</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; packageList = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; activityList = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> Intent mainIntent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_MAIN, <span class=\"keyword\">null</span>);</div><div class=\"line\">  <span class=\"keyword\">private</span> PackageManager packMan = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Applications</span><span class=\"params\">(PackageManager packManager)</span></span>&#123;</div><div class=\"line\">    packMan = packManager;</div><div class=\"line\">    packageList = <span class=\"keyword\">this</span>.createPackageList(<span class=\"keyword\">false</span>);</div><div class=\"line\">    activityList = <span class=\"keyword\">this</span>.createActivityList();</div><div class=\"line\">    <span class=\"keyword\">this</span>.addClassNamesToPackageList();</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">getPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> packageList;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> List&lt;ResolveInfo&gt; <span class=\"title\">getActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> activityList;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">createPackageList</span><span class=\"params\">(<span class=\"keyword\">boolean</span> getSysPackages)</span></span>&#123;</div><div class=\"line\">    ArrayList&lt;AppInfo&gt; pList = <span class=\"keyword\">new</span> ArrayList&lt;AppInfo&gt;();        </div><div class=\"line\"></div><div class=\"line\">    List&lt;PackageInfo&gt; packs = getPackageManager(</div><div class=\"line\">        ).getInstalledPackages(<span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packs.size(); i++)&#123;</div><div class=\"line\">      PackageInfo packInfo = packs.get(i);</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>((!getSysPackages) &amp;&amp; (packInfo.versionName == <span class=\"keyword\">null</span>))&#123;</div><div class=\"line\">        <span class=\"keyword\">continue</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      AppInfo newInfo = <span class=\"keyword\">new</span> AppInfo();</div><div class=\"line\"></div><div class=\"line\">      newInfo.appName = packInfo.applicationInfo.loadLabel(</div><div class=\"line\">          getPackageManager()).toString();</div><div class=\"line\">      newInfo.packageName = packInfo.packageName;   </div><div class=\"line\">      newInfo.versionName = packInfo.versionName;</div><div class=\"line\">      newInfo.versionCode = packInfo.versionCode;</div><div class=\"line\">      newInfo.icon = packInfo.applicationInfo.loadIcon(</div><div class=\"line\">          getPackageManager());</div><div class=\"line\"></div><div class=\"line\">      pList.add(newInfo);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> pList; </div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; <span class=\"title\">createActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    List&lt;ResolveInfo&gt; aList = packMan.queryIntentActivities(mainIntent, <span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">    Collections.sort(aList, </div><div class=\"line\">        <span class=\"keyword\">new</span> ResolveInfo.DisplayNameComparator(packMan)); </div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> aList;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">packageDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">      Log.v(<span class=\"string\">\"PACKINFO: \"</span>, <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).appName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).packageName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).className + <span class=\"string\">\"\\t\"</span> +</div><div class=\"line\">          packageList.get(i).versionName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">          packageList.get(i).versionCode);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">activityDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList)&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; activityList.size(); i++)&#123; </div><div class=\"line\">      ActivityInfo currentActivity = activityList.get(</div><div class=\"line\">          i).activityInfo;</div><div class=\"line\">      Log.v(<span class=\"string\">\"ACTINFO\"</span>, </div><div class=\"line\">          <span class=\"string\">\"pName=\"</span> </div><div class=\"line\">          + currentActivity.applicationInfo.packageName +</div><div class=\"line\">          <span class=\"string\">\" cName=\"</span> + currentActivity.name);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">addClassNamesToPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList || <span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    String tempName = <span class=\"string\">\"\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">      tempName = packageList.get(i).packageName;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; activityList.size(); ++j)&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>(tempName.equals(activityList.get(</div><div class=\"line\">                j).activityInfo.applicationInfo.packageName))&#123;</div><div class=\"line\">          packageList.get(i).className = activityList.get(</div><div class=\"line\">              j).activityInfo.name;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Remember the AppInfo class that we made and the applauncherrow.xml layout. Well, now we’ll utilize both within the custom ArrayAdapter extension we’ll use to populate the data of our List. ArrayAdapters are used to fill in the data fields of a ListView widget by storing a layout(android uses the term inflate) holding data into a single row of the list.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationAdapter</span> <span class=\"keyword\">extends</span> <span class=\"title\">ArrayAdapter</span>&lt;<span class=\"title\">AppInfo</span>&gt;</span>&#123;</div><div class=\"line\">  <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; items;</div></pre></td></tr></table></figure>\n<p>The constructor for our ArrayAdapter extension…</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ApplicationAdapter</span><span class=\"params\">(Context context, <span class=\"keyword\">int</span> textViewResourceId, ArrayList&lt;AppInfo&gt; items)</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">super</span>(context, textViewResourceId, items);</div><div class=\"line\">  <span class=\"keyword\">this</span>.items = items;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Being an ArrayAdapter extension means that we have to override the getView method, this is where the applauncherrow layout is populated with data and is used to represent each row of the ListView. To start we’ll reference the applauncherrow layout and inflate it to become a view.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> View <span class=\"title\">getView</span><span class=\"params\">(<span class=\"keyword\">int</span> position, View convertView, </div><div class=\"line\">    ViewGroup parent)</span></span>&#123;</div><div class=\"line\">  View view = convertView;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>(view == <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">    LayoutInflater layout = (LayoutInflater)getSystemService(</div><div class=\"line\">        Context.LAYOUT_INFLATER_SERVICE);</div><div class=\"line\">    view = layout.inflate(R.layout.applauncherrow, <span class=\"keyword\">null</span>);</div><div class=\"line\">  &#125;</div></pre></td></tr></table></figure>\n<p>Now that the view is inflated with the applauncherrow.xml layout we can now match the ImageView and TextView with the contents of a AppInfo object in preparation for moving it into the ListView.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">        AppInfo appInfo = items.get(position);</div><div class=\"line\">      <span class=\"keyword\">if</span>(appInfo != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">        TextView appName = (TextView) view.findViewById(</div><div class=\"line\">            R.id.applauncherrow_appname);</div><div class=\"line\">        ImageView appIcon = (ImageView) view.findViewById(</div><div class=\"line\">            R.id.applauncherrow_icon);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span>(appName != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          appName.setText(appInfo.getAppName());</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span>(appIcon != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          appIcon.setImageDrawable(appInfo.getIcon());</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">return</span> view;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Here is the complete ApplicationAdapter class, you should add it to your text file.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationAdapter</span> <span class=\"keyword\">extends</span> <span class=\"title\">ArrayAdapter</span>&lt;<span class=\"title\">AppInfo</span>&gt;</span>&#123;</div><div class=\"line\">  <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; items;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ApplicationAdapter</span><span class=\"params\">(Context context, <span class=\"keyword\">int</span> textViewResourceId, </div><div class=\"line\">      ArrayList&lt;AppInfo&gt; items)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>(context, textViewResourceId, items);</div><div class=\"line\">    <span class=\"keyword\">this</span>.items = items;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> View <span class=\"title\">getView</span><span class=\"params\">(<span class=\"keyword\">int</span> position, View convertView, </div><div class=\"line\">        ViewGroup parent)</span></span>&#123;</div><div class=\"line\">      View view = convertView;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>(view == <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">        LayoutInflater layout = (LayoutInflater)getSystemService(</div><div class=\"line\">            Context.LAYOUT_INFLATER_SERVICE);</div><div class=\"line\">        view = layout.inflate(R.layout.applauncherrow, <span class=\"keyword\">null</span>);</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      AppInfo appInfo = items.get(position);</div><div class=\"line\">      <span class=\"keyword\">if</span>(appInfo != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">        TextView appName = (TextView) view.findViewById(</div><div class=\"line\">            R.id.applauncherrow_appname);</div><div class=\"line\">        ImageView appIcon = (ImageView) view.findViewById(</div><div class=\"line\">            R.id.applauncherrow_icon);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span>(appName != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          appName.setText(appInfo.getAppName());</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span>(appIcon != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          appIcon.setImageDrawable(appInfo.getIcon());</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">return</span> view;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>We are done with the utility classes so the next step is to add some methods to the AppLauncher class itself. The first one we’re going to add is a method called getApps() which stores the pacakageList from an Applications object and passes it off to Java Runnable to be ran on a thread.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">getApps</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">try</span>&#123;</div><div class=\"line\">    myApps = <span class=\"keyword\">new</span> Applications(getPackageManager());</div><div class=\"line\">    packageList = myApps.getPackageList();</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">catch</span>(Exception exception)&#123;</div><div class=\"line\">    Log.e(<span class=\"string\">\"BACKGROUND PROC:\"</span>, exception.getMessage());</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">this</span>.runOnUiThread(returnRes);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>If you look at the getApps() method the last line before the class ends is a method called this.runOnUiThread(returnRes), now what this means is that the main thread will be locked while we pump AppInfo objects into our ListView via the ArrayAdapter. If you are experienced with concurrent programming you might be wondering why lock the mainUIThread, the answer is because our app can’t do anything until all objects have been added to the list. If we by chance were dynamically loading things from the Internet via HTTP requests then we would opt instead for a lazy loader which spawns a thread for each view object pumped into the ListVIew and the list would slowly populate as each item was fetched live from the web. So anyways here is our Runnable method that checks first that the packageList exists and then uses an object from our ApplicationAdapter to fill up our ListView widget.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> Runnable returnRes = <span class=\"keyword\">new</span> Runnable()&#123;</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(packageList != <span class=\"keyword\">null</span> &amp;&amp; packageList.size() &gt; <span class=\"number\">0</span>)&#123;</div><div class=\"line\">      appAdapter.notifyDataSetChanged();</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">        appAdapter.add(packageList.get(i));</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    progressDialog.dismiss();</div><div class=\"line\">    appAdapter.notifyDataSetChanged();</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<p>We’re almost done so now open up your Eclipse IDE to the AppLauncher project and click on the AppLauncher.java class. If you remember from earlier where we left off go ahead and add the data members below to the AppLauncher class; notice the line numbers for reference.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">ApplicationAdapter appAdapter = <span class=\"keyword\">null</span>;</div><div class=\"line\">ProgressDialog progressDialog = <span class=\"keyword\">null</span>; </div><div class=\"line\">Runnable viewApps = <span class=\"keyword\">null</span>;</div><div class=\"line\">ArrayList&lt;AppInfo&gt; packageList = <span class=\"keyword\">null</span>;</div><div class=\"line\">Applications myApps = <span class=\"keyword\">null</span>;</div></pre></td></tr></table></figure>\n<p>For the onCreate() method there are some things you sould notice. First since AppLauncher is a ListActivity extension it inherits the setListAdapter() method. Second we’ll  initialize the viewApps Runnable to call our getApps() within its run(). This means that any thread created with the viewApps as it’s runnable will load up our packages into the ListView. In addition since getApps() locks the mainUIThread users of this app won’t be able to do anything until the thread finishes.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle savedInstanceState)</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">super</span>.onCreate(savedInstanceState);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">this</span>.setContentView(R.layout.applauncher);</div><div class=\"line\"></div><div class=\"line\">  packageList = <span class=\"keyword\">new</span> ArrayList&lt;AppInfo&gt;();</div><div class=\"line\">  appAdapter = <span class=\"keyword\">new</span> ApplicationAdapter(<span class=\"keyword\">this</span>, R.layout.applauncherrow,</div><div class=\"line\">      packageList);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">this</span>.setListAdapter(appAdapter);</div><div class=\"line\"></div><div class=\"line\">  viewApps = <span class=\"keyword\">new</span> Runnable()&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      getApps();</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  Thread appLoaderThread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">null</span>, viewApps, </div><div class=\"line\">      <span class=\"string\">\"AppLoaderThread\"</span>);</div><div class=\"line\">  appLoaderThread.start();</div></pre></td></tr></table></figure>\n<p>Now that the thread has started and the app has been officially locked, how do we notify the user? The answer is with the android.app.ProgressDialog widget. Remember those loading screen from popular video games, that’s all ProgressDialogs do.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">    progressDialog = ProgressDialog.show(AppLauncher.<span class=\"keyword\">this</span>, <span class=\"string\">\"Hold on...\"</span>, <span class=\"string\">\"Loading your apps...\"</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Right now our app can successfully load up a list of Icons and application names but how then do we launch the apps the user touches from our list? The answer is via starting a new intent by overriding the onListItemClick method. So go open up your text file that contains the utility classes and methods and add the onListItemClick() method to it.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onListItemClick</span><span class=\"params\">(ListView list, View view, <span class=\"keyword\">int</span> position, </div><div class=\"line\">    <span class=\"keyword\">long</span> id)</span></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">super</span>.onListItemClick(list, view, position, id);</div><div class=\"line\"></div><div class=\"line\">  AppInfo rowClicked = (AppInfo)<span class=\"keyword\">this</span>.getListAdapter().getItem(</div><div class=\"line\">      position);</div><div class=\"line\"></div><div class=\"line\">  Intent startApp = <span class=\"keyword\">new</span> Intent();</div><div class=\"line\">  ComponentName component = <span class=\"keyword\">new</span> ComponentName(</div><div class=\"line\">      rowClicked.getPackageName(), </div><div class=\"line\">      rowClicked.getClassName());</div><div class=\"line\">  startApp.setComponent(component);</div><div class=\"line\">  startApp.setAction(Intent.ACTION_MAIN);</div><div class=\"line\"></div><div class=\"line\">  startActivity(startApp);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Before you run the AppLauncher, be sure to copy and paste the classes and methods into the AppLauncher class so it resembles the complete file below.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> org.example.hello;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.app.ListActivity;</div><div class=\"line\"><span class=\"keyword\">import</span> android.app.ProgressDialog;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.ComponentName;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.ActivityInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.PackageInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.PackageManager;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.pm.ResolveInfo;</div><div class=\"line\"><span class=\"keyword\">import</span> android.graphics.drawable.Drawable;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.util.Log;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.LayoutInflater;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.ViewGroup;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ArrayAdapter;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ImageView;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.ListView;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.TextView;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppLauncher</span> <span class=\"keyword\">extends</span> <span class=\"title\">ListActivity</span></span>&#123;</div><div class=\"line\">  ApplicationAdapter appAdapter = <span class=\"keyword\">null</span>;</div><div class=\"line\">  ProgressDialog progressDialog = <span class=\"keyword\">null</span>; </div><div class=\"line\">  Runnable viewApps = <span class=\"keyword\">null</span>;</div><div class=\"line\">  ArrayList&lt;AppInfo&gt; packageList = <span class=\"keyword\">null</span>;</div><div class=\"line\">  Applications myApps = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle savedInstanceState)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>.onCreate(savedInstanceState);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">this</span>.setContentView(R.layout.applauncher);</div><div class=\"line\"></div><div class=\"line\">    packageList = <span class=\"keyword\">new</span> ArrayList&lt;AppInfo&gt;();</div><div class=\"line\">    appAdapter = <span class=\"keyword\">new</span> ApplicationAdapter(<span class=\"keyword\">this</span>, R.layout.applauncherrow,</div><div class=\"line\">        packageList);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">this</span>.setListAdapter(appAdapter);</div><div class=\"line\"></div><div class=\"line\">    viewApps = <span class=\"keyword\">new</span> Runnable()&#123;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">        getApps();</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;;</div><div class=\"line\"></div><div class=\"line\">    Thread appLoaderThread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">null</span>, viewApps, </div><div class=\"line\">        <span class=\"string\">\"AppLoaderThread\"</span>);</div><div class=\"line\">    appLoaderThread.start();</div><div class=\"line\"></div><div class=\"line\">    progressDialog = ProgressDialog.show(AppLauncher.<span class=\"keyword\">this</span>, </div><div class=\"line\">        <span class=\"string\">\"Hold on...\"</span>, <span class=\"string\">\"Loading your apps...\"</span>, <span class=\"keyword\">true</span>);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Applications</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; packageList = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; activityList = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> Intent mainIntent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_MAIN, <span class=\"keyword\">null</span>);</div><div class=\"line\">    <span class=\"keyword\">private</span> PackageManager packMan = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Applications</span><span class=\"params\">(PackageManager packManager)</span></span>&#123;</div><div class=\"line\">      packMan = packManager;</div><div class=\"line\">      packageList = <span class=\"keyword\">this</span>.createPackageList(<span class=\"keyword\">false</span>);</div><div class=\"line\">      activityList = <span class=\"keyword\">this</span>.createActivityList();</div><div class=\"line\">      <span class=\"keyword\">this</span>.addClassNamesToPackageList();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">getPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> packageList;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;ResolveInfo&gt; <span class=\"title\">getActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> activityList;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; <span class=\"title\">createPackageList</span><span class=\"params\">(<span class=\"keyword\">boolean</span> getSysPackages)</span></span>&#123;</div><div class=\"line\">      ArrayList&lt;AppInfo&gt; pList = <span class=\"keyword\">new</span> ArrayList&lt;AppInfo&gt;();        </div><div class=\"line\"></div><div class=\"line\">      List&lt;PackageInfo&gt; packs = getPackageManager(</div><div class=\"line\">          ).getInstalledPackages(<span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packs.size(); i++)&#123;</div><div class=\"line\">        PackageInfo packInfo = packs.get(i);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span>((!getSysPackages) &amp;&amp; (packInfo.versionName == <span class=\"keyword\">null</span>))&#123;</div><div class=\"line\">          <span class=\"keyword\">continue</span> ;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        AppInfo newInfo = <span class=\"keyword\">new</span> AppInfo();</div><div class=\"line\"></div><div class=\"line\">        newInfo.appName = packInfo.applicationInfo.loadLabel(</div><div class=\"line\">            getPackageManager()).toString();</div><div class=\"line\">        newInfo.packageName = packInfo.packageName;   </div><div class=\"line\">        newInfo.versionName = packInfo.versionName;</div><div class=\"line\">        newInfo.versionCode = packInfo.versionCode;</div><div class=\"line\">        newInfo.icon = packInfo.applicationInfo.loadIcon(</div><div class=\"line\">            getPackageManager());</div><div class=\"line\"></div><div class=\"line\">        pList.add(newInfo);</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">return</span> pList; </div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;ResolveInfo&gt; <span class=\"title\">createActivityList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      List&lt;ResolveInfo&gt; aList = packMan.queryIntentActivities(mainIntent, <span class=\"number\">0</span>);</div><div class=\"line\"></div><div class=\"line\">      Collections.sort(aList, </div><div class=\"line\">          <span class=\"keyword\">new</span> ResolveInfo.DisplayNameComparator(packMan)); </div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">return</span> aList;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">packageDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">        Log.v(<span class=\"string\">\"PACKINFO: \"</span>, <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">            packageList.get(i).appName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">            packageList.get(i).packageName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">            packageList.get(i).className + <span class=\"string\">\"\\t\"</span> +</div><div class=\"line\">            packageList.get(i).versionName + <span class=\"string\">\"\\t\"</span> + </div><div class=\"line\">            packageList.get(i).versionCode);</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">activityDebug</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList)&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; activityList.size(); i++)&#123; </div><div class=\"line\">        ActivityInfo currentActivity = activityList.get(</div><div class=\"line\">            i).activityInfo;</div><div class=\"line\">        Log.v(<span class=\"string\">\"ACTINFO\"</span>, </div><div class=\"line\">            <span class=\"string\">\"pName=\"</span> </div><div class=\"line\">            + currentActivity.applicationInfo.packageName +</div><div class=\"line\">            <span class=\"string\">\" cName=\"</span> + currentActivity.name);</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">addClassNamesToPackageList</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span> == activityList || <span class=\"keyword\">null</span> == packageList)&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      String tempName = <span class=\"string\">\"\"</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">        tempName = packageList.get(i).packageName;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; activityList.size(); ++j)&#123;</div><div class=\"line\">          <span class=\"keyword\">if</span>(tempName.equals(activityList.get(</div><div class=\"line\">                  j).activityInfo.applicationInfo.packageName))&#123;</div><div class=\"line\">            packageList.get(i).className = activityList.get(</div><div class=\"line\">                j).activityInfo.name;</div><div class=\"line\">          &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppInfo</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> String appName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String packageName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String className = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String versionName = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> Integer versionCode = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> Drawable icon = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getAppName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> appName;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPackageName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> packageName;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getClassName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> className;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getVersionName</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> versionName;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getVersionCode</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> versionCode;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Drawable <span class=\"title\">getIcon</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> icon;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationAdapter</span> <span class=\"keyword\">extends</span> <span class=\"title\">ArrayAdapter</span>&lt;<span class=\"title\">AppInfo</span>&gt;</span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> ArrayList&lt;AppInfo&gt; items;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ApplicationAdapter</span><span class=\"params\">(Context context, <span class=\"keyword\">int</span> textViewResourceId, </div><div class=\"line\">        ArrayList&lt;AppInfo&gt; items)</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">super</span>(context, textViewResourceId, items);</div><div class=\"line\">      <span class=\"keyword\">this</span>.items = items;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> View <span class=\"title\">getView</span><span class=\"params\">(<span class=\"keyword\">int</span> position, View convertView, </div><div class=\"line\">          ViewGroup parent)</span></span>&#123;</div><div class=\"line\">        View view = convertView;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span>(view == <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          LayoutInflater layout = (LayoutInflater)getSystemService(</div><div class=\"line\">              Context.LAYOUT_INFLATER_SERVICE);</div><div class=\"line\">          view = layout.inflate(R.layout.applauncherrow, <span class=\"keyword\">null</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        AppInfo appInfo = items.get(position);</div><div class=\"line\">        <span class=\"keyword\">if</span>(appInfo != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">          TextView appName = (TextView) view.findViewById(</div><div class=\"line\">              R.id.applauncherrow_appname);</div><div class=\"line\">          ImageView appIcon = (ImageView) view.findViewById(</div><div class=\"line\">              R.id.applauncherrow_icon);</div><div class=\"line\"></div><div class=\"line\">          <span class=\"keyword\">if</span>(appName != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">            appName.setText(appInfo.getAppName());</div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"keyword\">if</span>(appIcon != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">            appIcon.setImageDrawable(appInfo.getIcon());</div><div class=\"line\">          &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> view;</div><div class=\"line\">      &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">getApps</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">try</span>&#123;</div><div class=\"line\">      myApps = <span class=\"keyword\">new</span> Applications(getPackageManager());</div><div class=\"line\">      packageList = myApps.getPackageList();</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">catch</span>(Exception exception)&#123;</div><div class=\"line\">      Log.e(<span class=\"string\">\"BACKGROUND PROC:\"</span>, exception.getMessage());</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">this</span>.runOnUiThread(returnRes);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> Runnable returnRes = <span class=\"keyword\">new</span> Runnable()&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>(packageList != <span class=\"keyword\">null</span> &amp;&amp; packageList.size() &gt; <span class=\"number\">0</span>)&#123;</div><div class=\"line\">        appAdapter.notifyDataSetChanged();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; packageList.size(); ++i)&#123;</div><div class=\"line\">          appAdapter.add(packageList.get(i));</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">      progressDialog.dismiss();</div><div class=\"line\">      appAdapter.notifyDataSetChanged();</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onListItemClick</span><span class=\"params\">(ListView list, View view, <span class=\"keyword\">int</span> position, </div><div class=\"line\">        <span class=\"keyword\">long</span> id)</span></span>&#123;</div><div class=\"line\">      <span class=\"keyword\">super</span>.onListItemClick(list, view, position, id);</div><div class=\"line\"></div><div class=\"line\">      AppInfo rowClicked = (AppInfo)<span class=\"keyword\">this</span>.getListAdapter().getItem(</div><div class=\"line\">          position);</div><div class=\"line\"></div><div class=\"line\">      Intent startApp = <span class=\"keyword\">new</span> Intent();</div><div class=\"line\">      ComponentName component = <span class=\"keyword\">new</span> ComponentName(</div><div class=\"line\">          rowClicked.getPackageName(), </div><div class=\"line\">          rowClicked.getClassName());</div><div class=\"line\">      startApp.setComponent(component);</div><div class=\"line\">      startApp.setAction(Intent.ACTION_MAIN);</div><div class=\"line\"></div><div class=\"line\">      startActivity(startApp);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Enjoy your AppLauncher.</p>\n"},{"title":"Imagescraper Is A Sinatra.rb App That Dumps Images From a Webpage","date":"2011-09-04T07:00:00.000Z","_content":"Learn about imagescraper, its a small test project I wrote to familiarize myself with the Sinatra microframework. In short you pass it a url and it returns all images from the page.\n\nImagescraper is a small project I built using Ruby together with the Sinatra microframework. If you aren't familiar with Sinatra you can browse the project's main website at <a href=\"http://www.sinatrarb.com/\">http://www.sinatrarb.com/</a>. In a nutshell Sinatra is light weight framework for Ruby that lets you rapidly build web applications using as few lines of code as possible.\n\nTo install Sinatra as a Ruby gem, just type\n\n```\n$ gem install sinatra\n```\n\ninto your terminal window assuming that you have Ruby installed on your machine and you can begin bashing out HTTP GET and POST request on your local machine using Ruby and then just run the app using the Sinatra gem. For a quick overview of Sinatra see the documentation <a href=\"http://www.sinatrarb.com/documentation\">http://www.sinatrarb.com/documentation</a>.\n\nAnyways, Imagescraper is a small Sinatra app that fetches and displays all images from a given url. I had planned to to do much more with the scraper such as let a user upload a text file with a list of urls and have it download the files to your machine but the project began to lose focus and the unnecessary feature creep was beginning to bog me down. However, the source code is available on my GitHub account and you can play with Imagescraper at the link below(the app is being hosted on Heroku)\n\nBrowse the source code:\n\n<a href=\"https://github.com/taywils/_Imagescraper_\">https://github.com/taywils/_Imagescraper_</a>\n\nRun the app on Heroku:\n\n<a href=\"http://imagescraper.heroku.com/\">http://imagescraper.heroku.com/</a>\n","source":"_posts/imagescrapeversion1.md","raw":"---\ntitle: Imagescraper Is A Sinatra.rb App That Dumps Images From a Webpage\ndate: 2011-09-04\ncategories: []\ntags: [javascript, ruby]\n---\nLearn about imagescraper, its a small test project I wrote to familiarize myself with the Sinatra microframework. In short you pass it a url and it returns all images from the page.\n\nImagescraper is a small project I built using Ruby together with the Sinatra microframework. If you aren't familiar with Sinatra you can browse the project's main website at <a href=\"http://www.sinatrarb.com/\">http://www.sinatrarb.com/</a>. In a nutshell Sinatra is light weight framework for Ruby that lets you rapidly build web applications using as few lines of code as possible.\n\nTo install Sinatra as a Ruby gem, just type\n\n```\n$ gem install sinatra\n```\n\ninto your terminal window assuming that you have Ruby installed on your machine and you can begin bashing out HTTP GET and POST request on your local machine using Ruby and then just run the app using the Sinatra gem. For a quick overview of Sinatra see the documentation <a href=\"http://www.sinatrarb.com/documentation\">http://www.sinatrarb.com/documentation</a>.\n\nAnyways, Imagescraper is a small Sinatra app that fetches and displays all images from a given url. I had planned to to do much more with the scraper such as let a user upload a text file with a list of urls and have it download the files to your machine but the project began to lose focus and the unnecessary feature creep was beginning to bog me down. However, the source code is available on my GitHub account and you can play with Imagescraper at the link below(the app is being hosted on Heroku)\n\nBrowse the source code:\n\n<a href=\"https://github.com/taywils/_Imagescraper_\">https://github.com/taywils/_Imagescraper_</a>\n\nRun the app on Heroku:\n\n<a href=\"http://imagescraper.heroku.com/\">http://imagescraper.heroku.com/</a>\n","slug":"imagescrapeversion1","published":1,"updated":"2017-04-15T20:25:24.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr1n000i9uwvdyav0i3x","content":"<p>Learn about imagescraper, its a small test project I wrote to familiarize myself with the Sinatra microframework. In short you pass it a url and it returns all images from the page.</p>\n<p>Imagescraper is a small project I built using Ruby together with the Sinatra microframework. If you aren’t familiar with Sinatra you can browse the project’s main website at <a href=\"http://www.sinatrarb.com/\" target=\"_blank\" rel=\"external\">http://www.sinatrarb.com/</a>. In a nutshell Sinatra is light weight framework for Ruby that lets you rapidly build web applications using as few lines of code as possible.</p>\n<p>To install Sinatra as a Ruby gem, just type</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ gem install sinatra</div></pre></td></tr></table></figure>\n<p>into your terminal window assuming that you have Ruby installed on your machine and you can begin bashing out HTTP GET and POST request on your local machine using Ruby and then just run the app using the Sinatra gem. For a quick overview of Sinatra see the documentation <a href=\"http://www.sinatrarb.com/documentation\" target=\"_blank\" rel=\"external\">http://www.sinatrarb.com/documentation</a>.</p>\n<p>Anyways, Imagescraper is a small Sinatra app that fetches and displays all images from a given url. I had planned to to do much more with the scraper such as let a user upload a text file with a list of urls and have it download the files to your machine but the project began to lose focus and the unnecessary feature creep was beginning to bog me down. However, the source code is available on my GitHub account and you can play with Imagescraper at the link below(the app is being hosted on Heroku)</p>\n<p>Browse the source code:</p>\n<p><a href=\"https://github.com/taywils/_Imagescraper_\" target=\"_blank\" rel=\"external\">https://github.com/taywils/<em>Imagescraper</em></a></p>\n<p>Run the app on Heroku:</p>\n<p><a href=\"http://imagescraper.heroku.com/\" target=\"_blank\" rel=\"external\">http://imagescraper.heroku.com/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Learn about imagescraper, its a small test project I wrote to familiarize myself with the Sinatra microframework. In short you pass it a url and it returns all images from the page.</p>\n<p>Imagescraper is a small project I built using Ruby together with the Sinatra microframework. If you aren’t familiar with Sinatra you can browse the project’s main website at <a href=\"http://www.sinatrarb.com/\">http://www.sinatrarb.com/</a>. In a nutshell Sinatra is light weight framework for Ruby that lets you rapidly build web applications using as few lines of code as possible.</p>\n<p>To install Sinatra as a Ruby gem, just type</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ gem install sinatra</div></pre></td></tr></table></figure>\n<p>into your terminal window assuming that you have Ruby installed on your machine and you can begin bashing out HTTP GET and POST request on your local machine using Ruby and then just run the app using the Sinatra gem. For a quick overview of Sinatra see the documentation <a href=\"http://www.sinatrarb.com/documentation\">http://www.sinatrarb.com/documentation</a>.</p>\n<p>Anyways, Imagescraper is a small Sinatra app that fetches and displays all images from a given url. I had planned to to do much more with the scraper such as let a user upload a text file with a list of urls and have it download the files to your machine but the project began to lose focus and the unnecessary feature creep was beginning to bog me down. However, the source code is available on my GitHub account and you can play with Imagescraper at the link below(the app is being hosted on Heroku)</p>\n<p>Browse the source code:</p>\n<p><a href=\"https://github.com/taywils/_Imagescraper_\">https://github.com/taywils/<em>Imagescraper</em></a></p>\n<p>Run the app on Heroku:</p>\n<p><a href=\"http://imagescraper.heroku.com/\">http://imagescraper.heroku.com/</a></p>\n"},{"title":"A Lightweight SqlLite Android tutorial","date":"2011-06-24T07:00:00.000Z","_content":"In this tutorial we'll step through the process of using the Android's builtin support for SqlLite to store a password and retrive it in a rather interesting attempt at creating a guest dialer application. When I first imagined a guest dialer I had in mind an application that would allow you to let someone use your phone without giving them total access to your incomming messages and other sensitive data. However, a lock-in application basically classifies as a virus when you think about it so whatever... at least I learned about the SqlLite api ^_^.\n\nBefore begining this tutorial make sure you have the following... \n\n- Java runtime and SDK installed\n- Android SDK\n- Some IDE which supports Android development such as Eclipse or IntelliJ IDEA(the free community edition can be used for Android Dev)\n- Some familiarity at least(not much don't worry) with Android Development\n\nWithin your IDE of choice create a new Android project and call it Secure Dialer(actually you can name it whatever but I'll just refer to it as Secure Dialer throughout this tutorial).\n\nNow locate the pre configured file called \"AndroidManifest.xml\".\nThe AndroidManifest file is the standard configuration file for Android applications.\nIts where you determine which permissions you demand from the phone OS as well as where you setup the various activity screens and many other things.\nJust think of the AndroidManifest as the app's system profile if that helps.\nTo start us off lets declare the permissions we need the end user to accept in order for our application to function correctly.\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest \nxmlns:android=\"http://schemas.android.com/apk/res/android\"\npackage=\"org.secure.dialer\"\nandroid:versionCode=\"1\"\nandroid:versionName=\"1.0\">\n\n<uses-sdk android:minSdkVersion=\"8\" />\n\n<uses-permission \nandroid:name=\"android.permission.CALL_PHONE\">\n</uses-permission>\n\n<uses-permission \nandroid:name=\"android.permission.READ_PHONE_STATE\">\n</uses-permission>\n```\n\nNext we'll fill out the <application> element; this is the element where we can declare \nthe activities and setup any intent-filters which we might need as well.\n\n```xml\n<application \nandroid:icon=\"@drawable/icon\" \nandroid:label=\"@string/app_name\" \nandroid:debuggable=\"true\">\n\n<activity\nandroid:name=\".HomeScreen\"\nandroid:label=\"@string/homescreen_label\">\n\n<intent-filter>\n<action android:name=\"android.intent.action.MAIN\" />\n<category android:name=\"android.intent.category.LAUNCHER\" />\n</intent-filter>\n\n</activity>\n\n<activity\nandroid:name=\".Dialer\"\nandroid:label=\"@string/dialer_label\">\n</activity>\n\n<activity\nandroid:name=\".NewPassword\"\nandroid:label=\"@string/newpassword_label\">\n</activity>\n\n<activity\nandroid:name=\".ResetPassword\"\nandroid:label=\"@string/resetpassword_label\">\n</activity>\n\n</application>\n\n</manifest>\n```\nNow go ahead and save the new AndroidManifest.xml with our changes in place.\nNext up is the resource file strings.xml.\n\nstrings.xml if you need a refresher is a special resource file that is standard across Androidapps because its the file where you define all of the text strings which will appear throughout your app.\n\nAlthough is practical to define strings within the .java files its considered good Android development practice to keep as many of the applications strings within the strings.xml.\n\nYou might think its crazy but for large applications it makes updating text notfications a piece of cake.\nSo navigate within your IDE to res/values/strings.xml or create the file if it doesn't exist.\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<resources>\n<string name=\"app_name\">SecureDialer</string>\n\n<string name=\"homescreen_label\">Homescreen Activity</string>\n<string name=\"homescreen_dialer\">Dialer</string>\n<string name=\"homescreen_password\">Password</string>\n<string name=\"homescreen_exit\">Exit</string>\n\n<string name=\"newpassword_label\">Newpassword Activity</string>\n<string name=\"newpassword_new_text\">Enter new password:</string>\n<string name=\"newpassword_confirm_text\">Repeat the password:</string>\n<string name=\"newpassword_new_hint\">Type new password here</string>\n<string name=\"newpassword_confirm_hint\">Repeat password here</string>\n<string name=\"newpassword_back\">Back</string>\n<string name=\"newpassword_save\">Save</string>\n\n<string name=\"resetpassword_label\">Resetpassword Activity</string>\n<string name=\"resetpassword_old_text\">Enter old password:</string>\n<string name=\"resetpassword_old_hint\">Type old password here</string>\n<string name=\"resetpassword_new_text\">Enter new password:</string>\n<string name=\"resetpassword_new_hint\">Type new password here</string>\n<string name=\"resetpassword_confirm_text\">Confirm password:</string>\n<string name=\"resetpassword_confirm_hint\">Repeat password here</string>\n\n<string name=\"dialer_label\">Dialer Activity</string>\n<string name=\"dialer_dial\">Dial</string>\n<string name=\"dialer_clear\">Clear</string>\n<string name=\"dialer_done\">Done</string>\n\n<string name=\"dialerpassword_enter\">Enter</string>\n<string name=\"dialerpassword_nevermind\">Nevermind</string>\n</resources>\n```\nRemember all of those @string/some_name values within the AndroidManifest.xml?\nWell that is how we reference the values stored within res/strings.xml.\n\nMoving along next create the Java class file HomeScreen within your applications src folder if you want to follow along with the code I have it under <div>src/org/secure/dialer/HomeScreen.java.</div>\nDon't worry about all of those string values you just typed or pasted we'll use them shortly as we introduce each activity screen.\n\nAs is normal with Android development we will first create the visual layouts and then once all our buttons and views are setup we then add Java to support the various actions we want to allow our users to make.\n\nBe warned though that this style of visuals first and then application logic might sound strange if you're comming from a web development MVC or MVVM background in which you first design your Models before hooking up controller logic before finnally designing a UI; but don't let it get to you too much because you'll see how its much easier for you to structure your Java code since you basically build application logic on top of objects created from your visual layout.\n\nBut enough chit chat, create a new file \"homescreen.xml\" within <div>/res/layout/</div>\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!-- \nA great tutorial on how to design button themes\nhttp://blog.androgames.net/40/custom-button-style-and-theme/\n-->\n<RelativeLayout \nxmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:id=\"@+id/homescreen_relative_layout\"\nandroid:orientation=\"vertical\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_height=\"fill_parent\">\n\n<Button\nandroid:id=\"@+id/homescreen_dialer_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"fill_parent\"\nandroid:text=\"@string/homescreen_dialer\"\nandroid:onClick=\"homescreen_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/homescreen_password_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_below=\"@id/homescreen_dialer_button\"\nandroid:text=\"@string/homescreen_password\"\nandroid:onClick=\"homescreen_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/homescreen_exit_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_below=\"@id/homescreen_password_button\"\nandroid:text=\"@string/homescreen_exit\"\nandroid:onClick=\"homescreen_button_click_handler\"/>\n\n</RelativeLayout>\n```\nThe homescreen is fairly basic it will just appear as three buttons vertically tiled.\nWhen we get to the code for the homescreen you'll see how easily you hookup code to support the android:onClick= tags from your xml file.\n\nNow create the Java class file \"HomeScreen.java\" within your project's src/ folder.\nHere you'll also notice a class called \"PasswordDB\" created, that is the object representation of our SQLite database which is the focus of the article and we'll cover it in depth later on.\n\n```java\npackage com.example;\n\nimport android.app.Activity;\nimport android.content.Intent;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.widget.Toast;\n\npublic class HomeScreen extends Activity {\n\n  protected PasswordDB password_db;\n\n  /**\n   * (non-Javadoc)\n   * @see android.app.Activity#onCreate(android.os.Bundle)\n   */\n  public void onCreate(Bundle saved_instance_state){\n    super.onCreate(saved_instance_state);\n    this.setContentView(R.layout.homescreen);\n    password_db = new PasswordDB(this);\n  }\n\n  /**\n   * Manages the button click events for the HomeScreen Activity.<br />\n   * Clicking exit terminates the app.<br />\n   * Clicking password launches either the newpassword or resetpassword\n   * activity depending on whether a password is currently stored.<br />\n   * Clicking dialer launches the dialer activity.\n   * @param button_clicked\n   */\n  public void homescreen_button_click_handler(View button_clicked){\n    switch(button_clicked.getId()){\n      Boolean password_found = password_db.is_password();\n\n      case R.id.homescreen_exit_button:\n      HomeScreen.this.finish();\n      break;\n\n      case R.id.homescreen_password_button:\n\n      if(!password_found){\n        Intent new_password_intent = new Intent(this.getApplicationContext(), NewPassword.class);\n\n        this.startActivity(new_password_intent);\n        HomeScreen.this.finish();\n      }\n      else{\n        Intent reset_password_intent = new Intent(this.getApplicationContext(), ResetPassword.class);\n\n        this.startActivity(reset_password_intent);\n        HomeScreen.this.finish();\n      }\n      break;\n\n      case R.id.homescreen_dialer_button:\n      if(password_found) {\n        Intent dialer_intent = new Intent(this.getApplicationContext(), Dialer.class);\n        this.startActivity(dialer_intent);\n        HomeScreen.this.finish();\n      } else {\n        display_toast(\"No password has been set yet.\");\n      }\n      break;\n    }\n  }\n\n  /**\n   * Displays the string passed as a new toast\n   * @param message\n   */\n  protected void display_toast(String message)\n  {\n    Toast.makeText(getApplicationContext(), message, Toast.LENGTH_SHORT).show();\n  }\n}\n```\nPay attention to the homescreen_button_click_handler. \nRemember inside our Homescreen.xml file where we defined the onClick attribute for each of the three buttons?\nNow you see how easy it is within the Java code to look up the button's unique id name and write handler code, it just becomes a switch case on the getId() method of the View which generated the click event.\nTo think if you tried it the other way around you would have foolishly built up three different button handler events where we have just a single button_handler for the entire Homescreen.\n\nThis style of design also makes our code very modular; if you wanted to add another button its as easy as popping in another case statement.\nLooking at the button_click_handler code when the user presses the homescreen_dialer_button we launch the Dialer activity screen... lets do that.\n</p>\n\n<p>\nAs before we'll create the dialer layout first, so create the file \"dialer.xml\" within the layout directory res/layout.\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<RelativeLayout\nxmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:id=\"@+id/dialer_relative_layout\"\nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\">\n\n<EditText\nandroid:id=\"@+id/dialer_number_edit\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_height=\"wrap_content\"\nandroid:focusable=\"false\"/>\n\n<Button\nandroid:id=\"@+id/dialer_one\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"1\"\nandroid:layout_below=\"@id/dialer_number_edit\"\nandroid:layout_alignLeft=\"@id/dialer_number_edit\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_two\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"2\"\nandroid:layout_below=\"@id/dialer_number_edit\"\nandroid:layout_toRightOf=\"@id/dialer_one\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_three\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"3\"\nandroid:layout_below=\"@id/dialer_number_edit\"\nandroid:layout_toRightOf=\"@id/dialer_two\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_four\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"4\"\nandroid:layout_below=\"@id/dialer_one\"\nandroid:layout_alignLeft=\"@id/dialer_one\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_five\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"5\"\nandroid:layout_below=\"@id/dialer_two\"\nandroid:layout_toRightOf=\"@id/dialer_four\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_six\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"6\"\nandroid:layout_below=\"@id/dialer_three\"\nandroid:layout_toRightOf=\"@id/dialer_five\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_seven\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"7\"\nandroid:layout_below=\"@id/dialer_four\"\nandroid:layout_alignLeft=\"@id/dialer_four\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_eight\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"8\"\nandroid:layout_below=\"@id/dialer_five\"\nandroid:layout_toRightOf=\"@id/dialer_seven\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_nine\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"9\"\nandroid:layout_below=\"@id/dialer_six\"\nandroid:layout_toRightOf=\"@id/dialer_eight\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_pound\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"#\"\nandroid:layout_below=\"@id/dialer_seven\"\nandroid:layout_alignLeft=\"@id/dialer_seven\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_zero\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"0\"\nandroid:layout_below=\"@id/dialer_eight\"\nandroid:layout_toRightOf=\"@id/dialer_pound\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_star\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"*\"\nandroid:layout_below=\"@id/dialer_nine\"\nandroid:layout_toRightOf=\"@id/dialer_zero\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_dial_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/dialer_dial\"\nandroid:layout_below=\"@id/dialer_pound\"\nandroid:layout_alignParentLeft=\"true\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_clear_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/dialer_clear\"\nandroid:layout_below=\"@id/dialer_star\"\nandroid:layout_alignParentRight=\"true\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_done_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/dialer_done\"\nandroid:layout_below=\"@id/dialer_dial_button\"\nandroid:layout_centerHorizontal=\"true\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n</RelativeLayout>\n```\nAs you can guess all of the numerical button are what you should expect from a phone dialer.\nOf intrest is the non-focusable editbox where the phonenumber will be displayed as the user types and the three buttons near the bottom; dial, clear and done.\nThe layout as you can see is rather plain but the interesting bits will come next when we add the Java code.\nHowever before that we need to creat the layout for the password prompt which will display once the guest has finished making a call and might potentially have the chance to muck around with your phone.\n\nAdd the file \"dialerpassword.xml\" to the res/layout folder.\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<RelativeLayout\nxmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:id=\"@+id/dialerpassword_relative_layout\"\nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\">\n\n<EditText\nandroid:id=\"@+id/dialerpassword_password_edit\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_height=\"wrap_content\"\nandroid:hint=\"@string/newpassword_confirm_hint\"\nandroid:singleLine=\"true\"/>\n\n<Button\nandroid:id=\"@+id/dialerpassword_enter_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/dialerpassword_enter\"\nandroid:layout_below=\"@id/dialerpassword_password_edit\"\nandroid:layout_alignLeft=\"@id/dialerpassword_password_edit\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialerpassword_nevermind_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/dialerpassword_nevermind\"\nandroid:layout_below=\"@id/dialerpassword_password_edit\"\nandroid:layout_alignRight=\"@id/dialerpassword_password_edit\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n</RelativeLayout>\n```\nFinally create the Java class file \"Dialer.java\" and place it within your src/ folder.\n```java\npackage com.example;\n\nimport android.app.Dialog;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.net.Uri;\nimport android.os.Bundle;\nimport android.telephony.TelephonyManager;\nimport android.view.KeyEvent;\nimport android.view.View;\nimport android.view.Window;\nimport android.view.WindowManager;\nimport android.view.View.OnClickListener;\nimport android.widget.Button;\nimport android.widget.EditText;\nimport android.telephony.PhoneStateListener;\n\npublic class Dialer extends HomeScreen {\n\n  private String current_password = null;\n  private EditText dialer_phone_number_field = null;\n  private Dialog password_dialog = null;\n  private EditText dialog_password_field = null;\n  private PhoneStateListener phone_state_listener = null;\n  private TelephonyManager telephony_manager = null;\n\n  /*\n   * (non-Javadoc)\n   * @see android.app.Activity#onCreate(android.os.Bundle)\n   */\n  public void onCreate(Bundle saved_instance_state){\n    // Hides both the title and status bar\n    // Must be called calling super.onCreate()\n    this.requestWindowFeature(Window.FEATURE_NO_TITLE);\n    getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,\n        WindowManager.LayoutParams.FLAG_FULLSCREEN);\n\n    super.onCreate(saved_instance_state);\n    this.setContentView(R.layout.dialer);\n\n    current_password = password_db.get_password();\n    dialer_phone_number_field = (EditText)findViewById(R.id.dialer_number_edit);\n    phone_state_listener = new CallEndedListener();\n    telephony_manager = (TelephonyManager) this.getSystemService(TELEPHONY_SERVICE);\n  }\n\n  /**\n   * Manages the button click events for the HomeScreen Activity.<br />\n   * Clicking the numpad adds the number to the dial box<br />\n   * Clicking dial calls the number within the dial box<br />\n   * Clicking clear erases the dial box<br />\n   * Clicking done prompts for the password<br />\n   * @param button_clicked\n   */\n  public void dialer_button_click_handler(View button_clicked){\n    StringBuilder phone_number = new StringBuilder();\n\n    switch(button_clicked.getId()){\n      case R.id.dialer_one:\n        phone_number.append('1');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_two:\n        phone_number.append('2');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_three:\n        phone_number.append('3');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_four:\n        phone_number.append('4');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_five:\n        phone_number.append('5');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_six:\n        phone_number.append('6');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_seven:\n        phone_number.append('7');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_eight:\n        phone_number.append('8');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_nine:\n        phone_number.append('9');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_zero:\n        phone_number.append('0');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_star:\n        phone_number.append('*');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_pound:\n        phone_number.append('#');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n        // Copies the phone_number_field to a StringBuilder,\n        // deletes the last digit and dumps the StringBuilder\n        // back to the phone_number_field\n      case R.id.dialer_clear_button:\n        if(!dialer_phone_number_field.getText().toString().equals(\"\")){\n          for(int i = 0; i < dialer_phone_number_field.getText().toString().length(); ++i){\n            phone_number.append(dialer_phone_number_field.getText().toString().charAt(i));\n          }\n\n          phone_number.deleteCharAt(phone_number.length() - 1);\n          dialer_phone_number_field.setText(phone_number.toString());\n          phone_number.setLength(0);\n        }\n        break;\n\n        // Launches the dialog box prompting for the new password\n      case R.id.dialer_done_button:\n        password_dialog = make_password_dialog(this);\n        password_dialog.show();\n        break;\n\n      case R.id.dialer_dial_button:\n        if(dialer_phone_number_field.getText().toString().equals(\"\")){\n          display_toast(\"Enter a phone number to dial\");\n        }\n        else{\n          perform_dial();\n        }\n        break;\n    }\n  }\n\n  /**\n   * Creates a dialog for the password confirmation\n   * @param context\n   * @return\n   */\n  public Dialog make_password_dialog(Context context){\n    Dialog dialog = new Dialog(context);\n\n    dialog.setContentView(R.layout.dialerpassword);\n    dialog.setTitle(\"Password?\");\n    dialog.setCancelable(true);\n\n    dialog_password_field = (EditText)dialog.findViewById(R.id.dialerpassword_password_edit);\n    Button dialog_enter = (Button)dialog.findViewById(R.id.dialerpassword_enter_button);\n    dialog_enter.setOnClickListener(dialog_click_listener);\n    Button dialog_nevermind = (Button)dialog.findViewById(R.id.dialerpassword_nevermind_button);\n    dialog_nevermind.setOnClickListener(dialog_click_listener);\n\n    return dialog;\n  }\n\n  /**\n   * Custom View.OnClickListener interface for the password\n   * dialog buttons.\n   */\n  public OnClickListener dialog_click_listener = new View.OnClickListener(){\n\n    /**\n     * Clicking nevermind closes the dialog menu<br />\n     * Clicking done validates the password entered.\n     * (non-Javadoc)\n     * @see android.view.View.OnClickListener#onClick(android.view.View)\n     */\n    @Override\n      public void onClick(View button_clicked) {\n        switch(button_clicked.getId()){\n          case R.id.dialerpassword_nevermind_button:\n            password_dialog.dismiss();\n            break;\n\n          case R.id.dialerpassword_enter_button:\n            if(validate_password(dialog_password_field.getText().toString().trim())){\n              password_dialog.dismiss();\n              Intent homescreen_intent = new Intent(getApplicationContext(), HomeScreen.class);\n              startActivity(homescreen_intent);\n              Dialer.this.finish();\n            }\n            break;\n        }\n      }\n  };\n\n  /**\n   * Validates the password typed by the user to check if it\n   * matches the current password stored in the database.\n   * @param password_value\n   * @return true if the password was valid\n   */\n  private Boolean validate_password(String password_value){\n    if(!password_value.equals(current_password)){\n      display_toast(\"Incorrect password!\");\n      this.dialog_password_field.setText(\"\");\n      return false;\n    }\n    else{\n      return true;\n    }\n  }\n\n  /**\n   * A small hack to disable the back button\n   * (non-Javadoc)\n   * @see android.app.Activity#onBackPressed()\n   */\n  @Override\n    public void onBackPressed() {\n      display_toast(\"The back button is disabled\");\n      return;\n    }\n\n  /**\n   * Lets the user call using the dial button\n   * (non-Javadoc)\n   * @see android.app.Activity#onKeyDown(int, android.view.KeyEvent)\n   */\n  public boolean onKeyDown(int keyCode, KeyEvent event){\n    if(keyCode == KeyEvent.KEYCODE_CALL){\n      perform_dial();\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Dials the desired phone number and creates a listener to\n   * to capture the state when the phone call has ended.\n   */\n  public void perform_dial(){\n    if(dialer_phone_number_field != null){\n      try{\n        telephony_manager.listen(phone_state_listener, PhoneStateListener.LISTEN_CALL_STATE);\n        Intent phone_call = new Intent(Intent.ACTION_CALL,\n            Uri.parse(\"tel:\" + dialer_phone_number_field.getText()));\n        startActivity(phone_call);\n      }\n      catch(Exception error){\n        error.printStackTrace();\n      }\n    }\n  }\n\n  /**\n   *\n   * @author Alex Bredariol Grilo\n   * {@link www.umamao.com}\n   */\n  private class CallEndedListener extends PhoneStateListener {\n    boolean called = false;\n\n    /* Waits until the phone call is done and restarts the activity.\n     *\n     * (non-Javadoc)\n     * @see android.telephony.PhoneStateListener#onCallStateChanged(int, java.lang.String)\n     */\n    @Override\n      public void onCallStateChanged(int state, String incoming_number) {\n        if(called && state == TelephonyManager.CALL_STATE_IDLE){\n          called = false;\n\n          telephony_manager.listen(this,\n              PhoneStateListener.LISTEN_NONE);\n\n          try{\n            Dialer.this.finish();\n            Intent dialer_restart = new Intent(Dialer.this, Dialer.class);\n            dialer_restart.setAction(Intent.ACTION_MAIN);\n            startActivity(dialer_restart);\n          }\n          catch(Exception e){\n            e.printStackTrace();\n          }\n        }\n        else{\n          // When the phone is not in idle mode it is currently\n          // in use\n          if(state == TelephonyManager.CALL_STATE_OFFHOOK){\n            called = true;\n          }\n        }\n      }\n  }\n}\n```\nStepping through the code for the Dialer class you'll notice that its relatively simple.\nSince the activity is once again button based the meat of the code involves deciding what we should do once each button handler event is triggered.\n\nA quick thing to notice is that the Dialer class we defined extends the HomeScreen where we intialized the password database object; so all of the password interaction is due to our great use of inheritance.\n\nAnyhow the basic idea for the Dialer activity is the following...\n\n1. Pressing the numeric keys lets the user enter a phonenumber\n2. The clear button should delete a numeric character one at a time\n3. Dial... makes a phonecall\n4. Done should prompt the user for a password, if correct unlocks the app\n\nWhat you'll notice here is that the prompting for a password is how we make the dialer somewhat secure. If the wrong one is entered the user should theorectically have no other access to your phone meaning they can't touch your apps, peek at your emails or do anything else.\nLooking at the code you'll see the function make_password_dialog() which creates the kinda mini embedded activity when the user triggers the dialer_done_button click event.\n\nThe remaining code within the Dialer class involves the TelephonyManager which is the Android API's way of letting developers controller the actions of the phone listener and receiver.\nIts rather easy to understand after you force yourself to think of the Phone as advancing across as series of states such as IDLE, OFFHOOK, LISTEN_CALL and create a mental map of those states as you normally talk on the phone. Now we'll return back to the Homescreen and add in the code to support the new and reset password buttons. \n\nEach of the buttons will have a layout and Java class file associated. Lets begin with the NewPassword class, create the file \"newpassword.xml\" within the res/layout folder of your Android project. The xml rather easy to understand as its just a regular enter password and repeat it once type of layout you've seen all over the place.\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<RelativeLayout\nxmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:id=\"@+id/newpassword_relative_layout\" \nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\">\n\n<TextView \nandroid:id=\"@+id/newpassword_new_password_text\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:text=\"@string/newpassword_new_text\"/>\n\n<EditText \nandroid:id=\"@+id/newpassword_new_password_edit\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:hint=\"@string/newpassword_new_hint\"\nandroid:layout_below=\"@id/newpassword_new_password_text\"\nandroid:singleLine=\"true\"/>\n\n<TextView \nandroid:id=\"@+id/newpassword_confirm_password_text\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:text=\"@string/newpassword_confirm_text\"\nandroid:layout_below=\"@id/newpassword_new_password_edit\"/>\n\n<EditText \nandroid:id=\"@+id/newpassword_confirm_password_edit\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:hint=\"@string/newpassword_confirm_hint\"\nandroid:layout_below=\"@id/newpassword_confirm_password_text\"\nandroid:singleLine=\"true\"/>\n\n<Button\nandroid:id=\"@+id/newpassword_back_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/newpassword_back\"\nandroid:layout_below=\"@id/newpassword_confirm_password_edit\"\nandroid:layout_alignLeft=\"@id/newpassword_confirm_password_edit\"\nandroid:onClick=\"newpassword_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/newpassword_save_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/newpassword_save\"\nandroid:layout_below=\"@id/newpassword_confirm_password_edit\"\nandroid:layout_alignRight=\"@id/newpassword_confirm_password_edit\"\nandroid:onClick=\"newpassword_button_click_handler\"/>\n\n</RelativeLayout>\n```\nThe Java code should be titled \"NewPassword.java\" and stored within the src/ folder of your project.\nThe code consist of letting the user enter a password into the editText box, and validate that the repeated value matches the original.\nOnce the validation has been accepted we make a DB transaction and store the password.\n```java\npackage com.example;\n\nimport android.content.Intent;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.widget.EditText;\n\npublic class NewPassword extends HomeScreen {\n\n  private EditText new_password_field = null;\n  private EditText confirm_password_field = null;\n\n  /*\n   * (non-Javadoc)\n   * @see android.app.Activity#onCreate(android.os.Bundle)\n   */\n  public void onCreate(Bundle saved_instance_state){\n    super.onCreate(saved_instance_state);\n    this.setContentView(R.layout.newpassword);\n\n    new_password_field = (EditText)findViewById(\n        R.id.newpassword_new_password_edit);\n    confirm_password_field = (EditText)findViewById(\n        R.id.newpassword_confirm_password_edit);\n  }\n\n  /**\n   * Manages the button click events for the NewPassword Activity.<br />\n   * Clicking back returns to the HomeScreen.<br />\n   * Clicking save will save the password if it passes the validation\n   * check.\n   * @param button_clicked\n   */\n  public void newpassword_button_click_handler(View button_clicked){\n    Intent homescreen_intent = new Intent(this.getApplicationContext(),\n        HomeScreen.class);\n\n    switch(button_clicked.getId()){\n      case R.id.newpassword_back_button:\n        this.startActivity(homescreen_intent);\n        NewPassword.this.finish();\n        break;\n\n      case R.id.newpassword_save_button:\n        if(validate_password(\n              new_password_field.getText().toString().trim(),\n              confirm_password_field.getText().toString().trim()\n              )){\n          this.startActivity(homescreen_intent);\n          NewPassword.this.finish();\n        }\n        break;\n    }\n  }\n\n  /**\n   * When both the new password and the confirmation password\n   * match the new password is saved. Else when the passwords\n   * don't match or are empty an error message is displayed.\n   * @return true if both password fields match else false\n   */\n  private Boolean validate_password(String new_password_value,\n      String confirm_password_value){\n\n    if(!new_password_value.equals(confirm_password_value)){\n      display_toast(\"Your Passwords do not match\");\n      return false;\n    }\n    else if(new_password_value.equals(\"\") &&\n        new_password_value.equals(\"\")){\n      display_toast(\"Your Passwords cannot be empty\");\n      return false;\n    }\n    else{\n      password_db.set_password(new_password_value);\n      display_toast(\"Your new password was saved!\");\n      return true;\n    }\n  }\n}\n```\nIf you pay enough attention to the newpassword xml and Java code behind you'll have no trouble at all with the resetpassword code as its very similar.\nWe'll begin with the layout for the resetpassword code, so create the file \"resetpassword.xml\" within the res/layout/ folder of your project.\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<RelativeLayout\nxmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:id=\"@+id/resetpassword_relative_layout\" \nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\">\n\n<TextView \nandroid:id=\"@+id/resetpassword_old_password_text\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:text=\"@string/resetpassword_old_text\"/>\n\n<EditText \nandroid:id=\"@+id/resetpassword_old_password_edit\" \nandroid:hint=\"@string/resetpassword_old_hint\"\nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:layout_below=\"@id/resetpassword_old_password_text\"\nandroid:singleLine=\"true\"\nandroid:maxLength=\"10\"/>\n\n<TextView \nandroid:id=\"@+id/resetpassword_new_password_text\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:text=\"@string/resetpassword_new_text\"\nandroid:layout_below=\"@id/resetpassword_old_password_edit\"/>\n\n<EditText \nandroid:id=\"@+id/resetpassword_new_password_edit\" \nandroid:hint=\"@string/resetpassword_new_hint\"\nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:layout_below=\"@id/resetpassword_new_password_text\"\nandroid:singleLine=\"true\"\nandroid:maxLength=\"10\"/>\n\n<TextView \nandroid:id=\"@+id/resetpassword_confirm_password_text\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:text=\"@string/resetpassword_confirm_text\"\nandroid:layout_below=\"@id/resetpassword_new_password_edit\"/>\n\n<EditText \nandroid:id=\"@+id/resetpassword_confirm_password_edit\" \nandroid:hint=\"@string/resetpassword_confirm_hint\"\nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:layout_below=\"@id/resetpassword_confirm_password_text\"\nandroid:singleLine=\"true\"\nandroid:maxLength=\"10\"/>\n\n<Button\nandroid:id=\"@+id/resetpassword_back_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/newpassword_back\"\nandroid:layout_below=\"@id/resetpassword_confirm_password_edit\"\nandroid:layout_alignLeft=\"@id/resetpassword_confirm_password_edit\"\nandroid:onClick=\"reset_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/resetpassword_save_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/newpassword_save\"\nandroid:layout_below=\"@id/resetpassword_confirm_password_edit\"\nandroid:layout_alignRight=\"@id/resetpassword_confirm_password_edit\"\nandroid:onClick=\"reset_button_click_handler\"/>\n\n</RelativeLayout>\n```\nThe addition here for the reset password xml layout is the entry for the current or old password. We going to assert that the value entered there must be found within the database before we can create a new transaction to store the value of a new password. Now create the file within the src/ folder of your project called \"ResetPassword.java\". I was extra careful to write useful comments within this file so be sure to read them before moving on to the last part.\n```java\npackage com.example;\n\nimport android.content.Intent;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.widget.EditText;\n\n/**\n * Resets the applications' password used to escape from the dialer activity\n */\npublic class ResetPassword extends HomeScreen {\n\n  private String current_password = null;\n  private EditText new_password_field = null;\n  private EditText confirm_password_field = null;\n  private EditText old_password_field = null;\n\n  /*\n   * (non-Javadoc)\n   * @see android.app.Activity#onCreate(android.os.Bundle)\n   */\n  public void onCreate(Bundle saved_instance_state){\n    super.onCreate(saved_instance_state);\n    this.setContentView(R.layout.resetpassword);\n\n    current_password = password_db.get_password();\n    new_password_field = (EditText)findViewById(\n        R.id.resetpassword_new_password_edit);\n    confirm_password_field = (EditText)findViewById(\n        R.id.resetpassword_confirm_password_edit);\n    old_password_field = (EditText)findViewById(\n        R.id.resetpassword_old_password_edit);\n  }\n\n  /**\n   * Manages the button click events for the NewPassword Activity.<br />\n   * Clicking back returns to the HomeScreen.<br />\n   * Clicking save will save the password if it passes the validation\n   * check.\n   * @param button_clicked\n   */\n  public void reset_button_click_handler(View button_clicked){\n    Intent homescreen_intent = new Intent(this.getApplicationContext(),\n        HomeScreen.class);\n\n    switch(button_clicked.getId()){\n      case R.id.resetpassword_back_button:\n        this.startActivity(homescreen_intent);\n        ResetPassword.this.finish();\n        break;\n\n      case R.id.resetpassword_save_button:\n        if(validate_password(\n              old_password_field.getText().toString().trim(),\n              new_password_field.getText().toString().trim(),\n              confirm_password_field.getText().toString().trim()\n              )){\n          this.startActivity(homescreen_intent);\n          ResetPassword.this.finish();\n        }\n        break;\n    }\n  }\n\n  /**\n   * When the new password equals the confirmation password\n   * and the old password equals the current password \n   * then the new password is reset. Else when the passwords\n   * don't match or are empty or the old password doesn't match the\n   * current password then an error message is displayed.\n   * @return true if both password fields match else false\n   */\n  private Boolean validate_password(String old_password_value,\n      String new_password_value, String confirm_password_value){\n    if(!old_password_value.equals(current_password)){\n      display_toast(\"Your old password is incorrect\");\n      return false;\n    }\n    else if(!new_password_value.equals(confirm_password_value)){\n      display_toast(\"Your Passwords do not match\");\n      return false;\n    }\n    else if(new_password_value.equals(\"\") &&\n        confirm_password_value.equals(\"\")){\n      display_toast(\"Your Passwords cannot be empty\");\n      return false;\n    }\n    else{\n      password_db.reset_password(new_password_value);\n      display_toast(\"Your new password was saved!\");\n      return true;\n    }\n  }\n}\n```\nWe are now ready to explore the basics of the Android SQLite API.\nWithin the src folder of your project add the file \"PasswordDB.java\".\n```java\nimport android.content.ContentValues;\nimport android.content.Context;\nimport android.database.Cursor;\nimport android.database.sqlite.SQLiteDatabase;\nimport android.database.sqlite.SQLiteOpenHelper;\n\n/**\n * Represents the Password Database\n * @author Demetrious\n *\n */\npublic class PasswordDB extends SQLiteOpenHelper {\n\n  private static final String db_name = \"PasswordDB\";\n  private static final String password_table = \"Passwords\";\n  private static final String password_col_password_number = \"PassNo\";\n  private static final String password_col_password_value = \"PassVal\";\n```\nThe static strings we declared above represent the name of our database, table and two columns.\nThe password number or PassNo will be the primary key and the string value\nof the password(this is not a mission critical app so we're not going to encrpyt it) will be its stored value.\n\nNext we'll write the constructor for the database which will create the databasewith the name we gave it within the string db_name.\n```java\n    /**\n     * \n     * @param context\n     */\n    public PasswordDB(Context context) {\n      super(context, db_name, null, 1);\n    }\n```\nWith our database in place the next step is to create the Table.\nThe code below will accomplish just that, look at the JavaDoc I wrote to see the corresponding SQL.\n```java\n    /**\n     * Invokes the SQL statements below.\n     *  <p>\n     *belowCREATE TABLE IF NOT EXISTS Password( <br />\n     *brPassNoINTEGER PRIMARY KEY, <br />\n     *brPassValVARCHAR(10) NOT NULL <br />\n     *br);\n     * </p>\n     * (non-Javadoc)\n     * @see android.database.sqlite.SQLiteOpenHelper#onCreate(android.database.sqlite.SQLiteDatabase)\n     */\n    @Override\n    public void onCreate(SQLiteDatabase db) {\n      db.execSQL(\"CREATE TABLE IF NOT EXISTS \" + password_table + \"(\" + \n          password_col_password_number + \" INTEGER PRIMARY KEY,\" +\n          password_col_password_value + \" VARCHAR(10) NOT NULL\" +\n          \");\");\n    }\n```\nThe next method onUpgrade() is a required function but we're not going to actually implement it since we don't need it for this example.\n```java\n    /**\n     * (non-Javadoc)\n     * @see android.database.sqlite.SQLiteOpenHelper#onUpgrade(android.database.sqlite.SQLiteDatabase, int, int)\n     */\n    @Override\n    public void onUpgrade(SQLiteDatabase db, int oldVersion, \n        int newVersion) {\n    }\n```\nWe'll of course need a way to insert a new password into our database.\nThe method set_password does just that. All its doing is calling a basic SQL insert into query but using the Android API helper method insert();\n```java\n    /**\n     * Inserts a new password into the Password DB via the following SQL.\n     * <p>\n     * INSERT INTO Password (PassVal)<br />\n     * VALUES('new_password');\n     * </p>\n     * @param new_password\n     */\n    public void set_password(String new_password){\n      SQLiteDatabase db = this.getWritableDatabase();\n\n      ContentValues content_values = new ContentValues();\n\n      content_values.put(password_col_password_value, new_password);\n\n      db.insert(password_table, password_col_password_value, \n          content_values);\n      db.close();\n    }\n```\nMuch like a Java property we need a getter to accompany the setter.\nHowever here we'll first write a raw query which will place a cursor at the first result row that was found from our SELECT statement.\nDatabase cursors can be though of as table iterators.\nThe cursor will begin at the result table itself, you must first move it to the  result row to begin reading data.\nOnce at a result row you have to move the cursor column by column and read the rrow value from each.\nSince we are only going to be storing a single password the first row result will always contain the password we want to fetch. \n```java\n    /**\n     * Returns the existing password assuming that one exists via the \n     * following SQL.\n     * <p>\n     * SELECT * <br />\n     * FROM Passwords <br />\n     * WHERE PassNo='1';\n     * </p>\n     * @return A String with the current password\n     */\n    public String get_password(){\n      SQLiteDatabase db = this.getWritableDatabase();\n\n      Cursor cursor = db.rawQuery(\n          \"SELECT \" + password_col_password_value +\n          \" FROM \" + password_table +\n          \" WHERE \" + password_col_password_number + \"=\\'1\\';\", null);\n\n      cursor.moveToFirst();\n      Integer column_index = cursor.getColumnIndex(\n          password_col_password_value);\n      String string_value = cursor.getString(column_index);\n\n      cursor.close();\n      db.close();\n\n      return string_value;\n    }\n```\nNow the question becomes how do we update an existing password?\nTo do so we have to use the update() method which is another Android SQLite API wrapper around the traditional SQL UPDATE WHERE statement.\nLooking at the JavaDoc I wrote you can see how we would write this if it were a regular SQL statement.\n\nDespite the Android SQL API being a little verbose(this might change in the future) the parameterized input means that we would be safe from any type of injection attacks since we're not passing a rawQuery from the user input.\nIn short using the parameterized wrapper methods is more code but it saves you from the potential danger of calling rawQueries which substitute in user values.\n```java\n    /**\n     * Updates the existing password based on the following SQL.\n     * <p>\n     *  UPDATE Password <br />\n     *brSET PassVal='new_password' <br />\n     *brWHERE PassVal='old_password';\n     * </p>\n     * @param new_password\n     */\n    public void reset_password(String new_password){\n      String old_password = get_password();\n      SQLiteDatabase db = this.getWritableDatabase();\n      ContentValues content_values = new ContentValues();\n\n      content_values.put(password_col_password_value, new_password);\n\n      String where_clause = password_col_password_value + \"=?\";\n      String[] where_args = {old_password};\n      db.update(password_table, content_values, where_clause, \n          where_args);\n\n      db.close();\n    }\n```\nLastly we need a way to verify if a password has been set or not. \nThis will allow us to determine when we need to prompt the user for a reset.\nIts short and sweet, just run a select query and count the results.\n```java\n    /**\n     * Uses the following SQL.\n     * <p>\n     * SELECT * <br />\n     * FROM Passwords <br />\n     * WHERE PassNo='1';\n     * </p>\n     * @return true if a password exists else false\n     */\n    public Boolean is_password(){\n      SQLiteDatabase db = this.getWritableDatabase();\n\n      Cursor cursor = db.rawQuery(\n          \"SELECT \" + password_col_password_value +\n          \" FROM \" + password_table +\n          \" WHERE \" + password_col_password_number + \"=\\'1\\';\", null);\n\n      if(cursor != null && cursor.getCount() > 0 ){\n        db.close();\n        cursor.close();\n        return true;\n      }\n      else{\n        db.close();\n        cursor.close();\n        return false;\n      }\n    }\n}\n```\nPerhaps you got lost(its better if you followed along closely) but here is the PasswordDB class in full.\n```java\n//Add your package name here!\n\nimport android.content.ContentValues;\nimport android.content.Context;\nimport android.database.Cursor;\nimport android.database.sqlite.SQLiteDatabase;\nimport android.database.sqlite.SQLiteOpenHelper;\n\npublic class PasswordDB extends SQLiteOpenHelper {\n\n  private static final String db_name = \"PasswordDB\";\n  private static final String password_table = \"Passwords\";\n  private static final String password_col_password_number = \"PassNo\";\n  private static final String password_col_password_value = \"PassVal\";\n\n  /**\n   * \n   * @param context\n   */\n  public PasswordDB(Context context) {\n    super(context, db_name, null, 1);\n  }\n\n  /**\n   * Invokes the SQL statements below.\n   *  <p>\n   *belowCREATE TABLE IF NOT EXISTS Password( <br />\n   *brPassNoINTEGER PRIMARY KEY, <br />\n   *brPassValVARCHAR(10) NOT NULL <br />\n   *br);\n   * </p>\n   * (non-Javadoc)\n   * @see android.database.sqlite.SQLiteOpenHelper#onCreate(android.database.sqlite.SQLiteDatabase)\n   */\n  @Override\n    public void onCreate(SQLiteDatabase db) {\n      db.execSQL(\"CREATE TABLE IF NOT EXISTS \" + password_table + \"(\" + \n          password_col_password_number + \" INTEGER PRIMARY KEY,\" +\n          password_col_password_value + \" VARCHAR(10) NOT NULL\" +\n          \");\");\n    }\n\n  /**\n   * (non-Javadoc)\n   * @see android.database.sqlite.SQLiteOpenHelper#onUpgrade(android.database.sqlite.SQLiteDatabase, int, int)\n   */\n  @Override\n    public void onUpgrade(SQLiteDatabase db, int oldVersion, \n        int newVersion) {\n    }\n\n  /**\n   * Inserts a new password into the Password DB via the following SQL.\n   * <p>\n   * INSERT INTO Password (PassVal)<br />\n   * VALUES('new_password');\n   * </p>\n   * @param new_password\n   */\n  public void set_password(String new_password){\n    SQLiteDatabase db = this.getWritableDatabase();\n\n    ContentValues content_values = new ContentValues();\n\n    content_values.put(password_col_password_value, new_password);\n\n    db.insert(password_table, password_col_password_value, \n        content_values);\n    db.close();\n  }\n\n  /**\n   * Returns the existing password assuming that one exists via the \n   * following SQL.\n   * <p>\n   * SELECT * <br />\n   * FROM Passwords <br />\n   * WHERE PassNo='1';\n   * </p>\n   * @return A String with the current password\n   */\n  public String get_password(){\n    SQLiteDatabase db = this.getWritableDatabase();\n\n    Cursor cursor = db.rawQuery(\n        \"SELECT \" + password_col_password_value +\n        \" FROM \" + password_table +\n        \" WHERE \" + password_col_password_number + \"=\\'1\\';\", null);\n\n    cursor.moveToFirst();\n    Integer column_index = cursor.getColumnIndex(\n        password_col_password_value);\n    String string_value = cursor.getString(column_index);\n\n    cursor.close();\n    db.close();\n\n    return string_value;\n  }\n\n  /**\n   * Updates the existing password based on the following SQL.\n   * <p>\n   *  UPDATE Password <br />\n   *brSET PassVal='new_password' <br />\n   *brWHERE PassVal='old_password';\n   * </p>\n   * @param new_password\n   */\n  public void reset_password(String new_password){\n    String old_password = get_password();\n    SQLiteDatabase db = this.getWritableDatabase();\n    ContentValues content_values = new ContentValues();\n\n    content_values.put(password_col_password_value, new_password);\n\n    String where_clause = password_col_password_value + \"=?\";\n    String[] where_args = {old_password};\n    db.update(password_table, content_values, where_clause, \n        where_args);\n\n    db.close();\n  }\n\n  /**\n   * Uses the following SQL.\n   * <p>\n   * SELECT * <br />\n   * FROM Passwords <br />\n   * WHERE PassNo='1';\n   * </p>\n   * @return true if a password exists else false\n   */\n  public Boolean is_password(){\n    SQLiteDatabase db = this.getWritableDatabase();\n\n    Cursor cursor = db.rawQuery(\n        \"SELECT \" + password_col_password_value +\n        \" FROM \" + password_table +\n        \" WHERE \" + password_col_password_number + \"=\\'1\\';\", null);\n\n    if(cursor != null && cursor.getCount() > 0 ){\n      db.close();\n      cursor.close();\n      return true;\n    }\n    else{\n      db.close();\n      cursor.close();\n      return false;\n    }\n  }\n}\n```\nSo there you go, an Android application that makes use of the SQLite API. Perhaps you can extend this application or something.\n\nAnyways... enjoy your guestDialer app. \n","source":"_posts/guestdialer.md","raw":"---\ntitle: A Lightweight SqlLite Android tutorial\ndate: 2011-06-24\ncategories: [tutorial]\ntags: [java, android]\n---\nIn this tutorial we'll step through the process of using the Android's builtin support for SqlLite to store a password and retrive it in a rather interesting attempt at creating a guest dialer application. When I first imagined a guest dialer I had in mind an application that would allow you to let someone use your phone without giving them total access to your incomming messages and other sensitive data. However, a lock-in application basically classifies as a virus when you think about it so whatever... at least I learned about the SqlLite api ^_^.\n\nBefore begining this tutorial make sure you have the following... \n\n- Java runtime and SDK installed\n- Android SDK\n- Some IDE which supports Android development such as Eclipse or IntelliJ IDEA(the free community edition can be used for Android Dev)\n- Some familiarity at least(not much don't worry) with Android Development\n\nWithin your IDE of choice create a new Android project and call it Secure Dialer(actually you can name it whatever but I'll just refer to it as Secure Dialer throughout this tutorial).\n\nNow locate the pre configured file called \"AndroidManifest.xml\".\nThe AndroidManifest file is the standard configuration file for Android applications.\nIts where you determine which permissions you demand from the phone OS as well as where you setup the various activity screens and many other things.\nJust think of the AndroidManifest as the app's system profile if that helps.\nTo start us off lets declare the permissions we need the end user to accept in order for our application to function correctly.\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest \nxmlns:android=\"http://schemas.android.com/apk/res/android\"\npackage=\"org.secure.dialer\"\nandroid:versionCode=\"1\"\nandroid:versionName=\"1.0\">\n\n<uses-sdk android:minSdkVersion=\"8\" />\n\n<uses-permission \nandroid:name=\"android.permission.CALL_PHONE\">\n</uses-permission>\n\n<uses-permission \nandroid:name=\"android.permission.READ_PHONE_STATE\">\n</uses-permission>\n```\n\nNext we'll fill out the <application> element; this is the element where we can declare \nthe activities and setup any intent-filters which we might need as well.\n\n```xml\n<application \nandroid:icon=\"@drawable/icon\" \nandroid:label=\"@string/app_name\" \nandroid:debuggable=\"true\">\n\n<activity\nandroid:name=\".HomeScreen\"\nandroid:label=\"@string/homescreen_label\">\n\n<intent-filter>\n<action android:name=\"android.intent.action.MAIN\" />\n<category android:name=\"android.intent.category.LAUNCHER\" />\n</intent-filter>\n\n</activity>\n\n<activity\nandroid:name=\".Dialer\"\nandroid:label=\"@string/dialer_label\">\n</activity>\n\n<activity\nandroid:name=\".NewPassword\"\nandroid:label=\"@string/newpassword_label\">\n</activity>\n\n<activity\nandroid:name=\".ResetPassword\"\nandroid:label=\"@string/resetpassword_label\">\n</activity>\n\n</application>\n\n</manifest>\n```\nNow go ahead and save the new AndroidManifest.xml with our changes in place.\nNext up is the resource file strings.xml.\n\nstrings.xml if you need a refresher is a special resource file that is standard across Androidapps because its the file where you define all of the text strings which will appear throughout your app.\n\nAlthough is practical to define strings within the .java files its considered good Android development practice to keep as many of the applications strings within the strings.xml.\n\nYou might think its crazy but for large applications it makes updating text notfications a piece of cake.\nSo navigate within your IDE to res/values/strings.xml or create the file if it doesn't exist.\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<resources>\n<string name=\"app_name\">SecureDialer</string>\n\n<string name=\"homescreen_label\">Homescreen Activity</string>\n<string name=\"homescreen_dialer\">Dialer</string>\n<string name=\"homescreen_password\">Password</string>\n<string name=\"homescreen_exit\">Exit</string>\n\n<string name=\"newpassword_label\">Newpassword Activity</string>\n<string name=\"newpassword_new_text\">Enter new password:</string>\n<string name=\"newpassword_confirm_text\">Repeat the password:</string>\n<string name=\"newpassword_new_hint\">Type new password here</string>\n<string name=\"newpassword_confirm_hint\">Repeat password here</string>\n<string name=\"newpassword_back\">Back</string>\n<string name=\"newpassword_save\">Save</string>\n\n<string name=\"resetpassword_label\">Resetpassword Activity</string>\n<string name=\"resetpassword_old_text\">Enter old password:</string>\n<string name=\"resetpassword_old_hint\">Type old password here</string>\n<string name=\"resetpassword_new_text\">Enter new password:</string>\n<string name=\"resetpassword_new_hint\">Type new password here</string>\n<string name=\"resetpassword_confirm_text\">Confirm password:</string>\n<string name=\"resetpassword_confirm_hint\">Repeat password here</string>\n\n<string name=\"dialer_label\">Dialer Activity</string>\n<string name=\"dialer_dial\">Dial</string>\n<string name=\"dialer_clear\">Clear</string>\n<string name=\"dialer_done\">Done</string>\n\n<string name=\"dialerpassword_enter\">Enter</string>\n<string name=\"dialerpassword_nevermind\">Nevermind</string>\n</resources>\n```\nRemember all of those @string/some_name values within the AndroidManifest.xml?\nWell that is how we reference the values stored within res/strings.xml.\n\nMoving along next create the Java class file HomeScreen within your applications src folder if you want to follow along with the code I have it under <div>src/org/secure/dialer/HomeScreen.java.</div>\nDon't worry about all of those string values you just typed or pasted we'll use them shortly as we introduce each activity screen.\n\nAs is normal with Android development we will first create the visual layouts and then once all our buttons and views are setup we then add Java to support the various actions we want to allow our users to make.\n\nBe warned though that this style of visuals first and then application logic might sound strange if you're comming from a web development MVC or MVVM background in which you first design your Models before hooking up controller logic before finnally designing a UI; but don't let it get to you too much because you'll see how its much easier for you to structure your Java code since you basically build application logic on top of objects created from your visual layout.\n\nBut enough chit chat, create a new file \"homescreen.xml\" within <div>/res/layout/</div>\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!-- \nA great tutorial on how to design button themes\nhttp://blog.androgames.net/40/custom-button-style-and-theme/\n-->\n<RelativeLayout \nxmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:id=\"@+id/homescreen_relative_layout\"\nandroid:orientation=\"vertical\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_height=\"fill_parent\">\n\n<Button\nandroid:id=\"@+id/homescreen_dialer_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"fill_parent\"\nandroid:text=\"@string/homescreen_dialer\"\nandroid:onClick=\"homescreen_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/homescreen_password_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_below=\"@id/homescreen_dialer_button\"\nandroid:text=\"@string/homescreen_password\"\nandroid:onClick=\"homescreen_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/homescreen_exit_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_below=\"@id/homescreen_password_button\"\nandroid:text=\"@string/homescreen_exit\"\nandroid:onClick=\"homescreen_button_click_handler\"/>\n\n</RelativeLayout>\n```\nThe homescreen is fairly basic it will just appear as three buttons vertically tiled.\nWhen we get to the code for the homescreen you'll see how easily you hookup code to support the android:onClick= tags from your xml file.\n\nNow create the Java class file \"HomeScreen.java\" within your project's src/ folder.\nHere you'll also notice a class called \"PasswordDB\" created, that is the object representation of our SQLite database which is the focus of the article and we'll cover it in depth later on.\n\n```java\npackage com.example;\n\nimport android.app.Activity;\nimport android.content.Intent;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.widget.Toast;\n\npublic class HomeScreen extends Activity {\n\n  protected PasswordDB password_db;\n\n  /**\n   * (non-Javadoc)\n   * @see android.app.Activity#onCreate(android.os.Bundle)\n   */\n  public void onCreate(Bundle saved_instance_state){\n    super.onCreate(saved_instance_state);\n    this.setContentView(R.layout.homescreen);\n    password_db = new PasswordDB(this);\n  }\n\n  /**\n   * Manages the button click events for the HomeScreen Activity.<br />\n   * Clicking exit terminates the app.<br />\n   * Clicking password launches either the newpassword or resetpassword\n   * activity depending on whether a password is currently stored.<br />\n   * Clicking dialer launches the dialer activity.\n   * @param button_clicked\n   */\n  public void homescreen_button_click_handler(View button_clicked){\n    switch(button_clicked.getId()){\n      Boolean password_found = password_db.is_password();\n\n      case R.id.homescreen_exit_button:\n      HomeScreen.this.finish();\n      break;\n\n      case R.id.homescreen_password_button:\n\n      if(!password_found){\n        Intent new_password_intent = new Intent(this.getApplicationContext(), NewPassword.class);\n\n        this.startActivity(new_password_intent);\n        HomeScreen.this.finish();\n      }\n      else{\n        Intent reset_password_intent = new Intent(this.getApplicationContext(), ResetPassword.class);\n\n        this.startActivity(reset_password_intent);\n        HomeScreen.this.finish();\n      }\n      break;\n\n      case R.id.homescreen_dialer_button:\n      if(password_found) {\n        Intent dialer_intent = new Intent(this.getApplicationContext(), Dialer.class);\n        this.startActivity(dialer_intent);\n        HomeScreen.this.finish();\n      } else {\n        display_toast(\"No password has been set yet.\");\n      }\n      break;\n    }\n  }\n\n  /**\n   * Displays the string passed as a new toast\n   * @param message\n   */\n  protected void display_toast(String message)\n  {\n    Toast.makeText(getApplicationContext(), message, Toast.LENGTH_SHORT).show();\n  }\n}\n```\nPay attention to the homescreen_button_click_handler. \nRemember inside our Homescreen.xml file where we defined the onClick attribute for each of the three buttons?\nNow you see how easy it is within the Java code to look up the button's unique id name and write handler code, it just becomes a switch case on the getId() method of the View which generated the click event.\nTo think if you tried it the other way around you would have foolishly built up three different button handler events where we have just a single button_handler for the entire Homescreen.\n\nThis style of design also makes our code very modular; if you wanted to add another button its as easy as popping in another case statement.\nLooking at the button_click_handler code when the user presses the homescreen_dialer_button we launch the Dialer activity screen... lets do that.\n</p>\n\n<p>\nAs before we'll create the dialer layout first, so create the file \"dialer.xml\" within the layout directory res/layout.\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<RelativeLayout\nxmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:id=\"@+id/dialer_relative_layout\"\nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\">\n\n<EditText\nandroid:id=\"@+id/dialer_number_edit\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_height=\"wrap_content\"\nandroid:focusable=\"false\"/>\n\n<Button\nandroid:id=\"@+id/dialer_one\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"1\"\nandroid:layout_below=\"@id/dialer_number_edit\"\nandroid:layout_alignLeft=\"@id/dialer_number_edit\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_two\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"2\"\nandroid:layout_below=\"@id/dialer_number_edit\"\nandroid:layout_toRightOf=\"@id/dialer_one\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_three\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"3\"\nandroid:layout_below=\"@id/dialer_number_edit\"\nandroid:layout_toRightOf=\"@id/dialer_two\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_four\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"4\"\nandroid:layout_below=\"@id/dialer_one\"\nandroid:layout_alignLeft=\"@id/dialer_one\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_five\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"5\"\nandroid:layout_below=\"@id/dialer_two\"\nandroid:layout_toRightOf=\"@id/dialer_four\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_six\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"6\"\nandroid:layout_below=\"@id/dialer_three\"\nandroid:layout_toRightOf=\"@id/dialer_five\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_seven\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"7\"\nandroid:layout_below=\"@id/dialer_four\"\nandroid:layout_alignLeft=\"@id/dialer_four\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_eight\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"8\"\nandroid:layout_below=\"@id/dialer_five\"\nandroid:layout_toRightOf=\"@id/dialer_seven\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_nine\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"9\"\nandroid:layout_below=\"@id/dialer_six\"\nandroid:layout_toRightOf=\"@id/dialer_eight\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_pound\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"#\"\nandroid:layout_below=\"@id/dialer_seven\"\nandroid:layout_alignLeft=\"@id/dialer_seven\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_zero\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"0\"\nandroid:layout_below=\"@id/dialer_eight\"\nandroid:layout_toRightOf=\"@id/dialer_pound\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_star\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"*\"\nandroid:layout_below=\"@id/dialer_nine\"\nandroid:layout_toRightOf=\"@id/dialer_zero\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_dial_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/dialer_dial\"\nandroid:layout_below=\"@id/dialer_pound\"\nandroid:layout_alignParentLeft=\"true\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_clear_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/dialer_clear\"\nandroid:layout_below=\"@id/dialer_star\"\nandroid:layout_alignParentRight=\"true\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialer_done_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/dialer_done\"\nandroid:layout_below=\"@id/dialer_dial_button\"\nandroid:layout_centerHorizontal=\"true\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n</RelativeLayout>\n```\nAs you can guess all of the numerical button are what you should expect from a phone dialer.\nOf intrest is the non-focusable editbox where the phonenumber will be displayed as the user types and the three buttons near the bottom; dial, clear and done.\nThe layout as you can see is rather plain but the interesting bits will come next when we add the Java code.\nHowever before that we need to creat the layout for the password prompt which will display once the guest has finished making a call and might potentially have the chance to muck around with your phone.\n\nAdd the file \"dialerpassword.xml\" to the res/layout folder.\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<RelativeLayout\nxmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:id=\"@+id/dialerpassword_relative_layout\"\nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\">\n\n<EditText\nandroid:id=\"@+id/dialerpassword_password_edit\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_height=\"wrap_content\"\nandroid:hint=\"@string/newpassword_confirm_hint\"\nandroid:singleLine=\"true\"/>\n\n<Button\nandroid:id=\"@+id/dialerpassword_enter_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/dialerpassword_enter\"\nandroid:layout_below=\"@id/dialerpassword_password_edit\"\nandroid:layout_alignLeft=\"@id/dialerpassword_password_edit\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/dialerpassword_nevermind_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/dialerpassword_nevermind\"\nandroid:layout_below=\"@id/dialerpassword_password_edit\"\nandroid:layout_alignRight=\"@id/dialerpassword_password_edit\"\nandroid:onClick=\"dialer_button_click_handler\"/>\n\n</RelativeLayout>\n```\nFinally create the Java class file \"Dialer.java\" and place it within your src/ folder.\n```java\npackage com.example;\n\nimport android.app.Dialog;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.net.Uri;\nimport android.os.Bundle;\nimport android.telephony.TelephonyManager;\nimport android.view.KeyEvent;\nimport android.view.View;\nimport android.view.Window;\nimport android.view.WindowManager;\nimport android.view.View.OnClickListener;\nimport android.widget.Button;\nimport android.widget.EditText;\nimport android.telephony.PhoneStateListener;\n\npublic class Dialer extends HomeScreen {\n\n  private String current_password = null;\n  private EditText dialer_phone_number_field = null;\n  private Dialog password_dialog = null;\n  private EditText dialog_password_field = null;\n  private PhoneStateListener phone_state_listener = null;\n  private TelephonyManager telephony_manager = null;\n\n  /*\n   * (non-Javadoc)\n   * @see android.app.Activity#onCreate(android.os.Bundle)\n   */\n  public void onCreate(Bundle saved_instance_state){\n    // Hides both the title and status bar\n    // Must be called calling super.onCreate()\n    this.requestWindowFeature(Window.FEATURE_NO_TITLE);\n    getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,\n        WindowManager.LayoutParams.FLAG_FULLSCREEN);\n\n    super.onCreate(saved_instance_state);\n    this.setContentView(R.layout.dialer);\n\n    current_password = password_db.get_password();\n    dialer_phone_number_field = (EditText)findViewById(R.id.dialer_number_edit);\n    phone_state_listener = new CallEndedListener();\n    telephony_manager = (TelephonyManager) this.getSystemService(TELEPHONY_SERVICE);\n  }\n\n  /**\n   * Manages the button click events for the HomeScreen Activity.<br />\n   * Clicking the numpad adds the number to the dial box<br />\n   * Clicking dial calls the number within the dial box<br />\n   * Clicking clear erases the dial box<br />\n   * Clicking done prompts for the password<br />\n   * @param button_clicked\n   */\n  public void dialer_button_click_handler(View button_clicked){\n    StringBuilder phone_number = new StringBuilder();\n\n    switch(button_clicked.getId()){\n      case R.id.dialer_one:\n        phone_number.append('1');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_two:\n        phone_number.append('2');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_three:\n        phone_number.append('3');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_four:\n        phone_number.append('4');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_five:\n        phone_number.append('5');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_six:\n        phone_number.append('6');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_seven:\n        phone_number.append('7');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_eight:\n        phone_number.append('8');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_nine:\n        phone_number.append('9');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_zero:\n        phone_number.append('0');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_star:\n        phone_number.append('*');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n      case R.id.dialer_pound:\n        phone_number.append('#');\n        dialer_phone_number_field.append(phone_number);\n        phone_number.deleteCharAt(0);\n        break;\n\n        // Copies the phone_number_field to a StringBuilder,\n        // deletes the last digit and dumps the StringBuilder\n        // back to the phone_number_field\n      case R.id.dialer_clear_button:\n        if(!dialer_phone_number_field.getText().toString().equals(\"\")){\n          for(int i = 0; i < dialer_phone_number_field.getText().toString().length(); ++i){\n            phone_number.append(dialer_phone_number_field.getText().toString().charAt(i));\n          }\n\n          phone_number.deleteCharAt(phone_number.length() - 1);\n          dialer_phone_number_field.setText(phone_number.toString());\n          phone_number.setLength(0);\n        }\n        break;\n\n        // Launches the dialog box prompting for the new password\n      case R.id.dialer_done_button:\n        password_dialog = make_password_dialog(this);\n        password_dialog.show();\n        break;\n\n      case R.id.dialer_dial_button:\n        if(dialer_phone_number_field.getText().toString().equals(\"\")){\n          display_toast(\"Enter a phone number to dial\");\n        }\n        else{\n          perform_dial();\n        }\n        break;\n    }\n  }\n\n  /**\n   * Creates a dialog for the password confirmation\n   * @param context\n   * @return\n   */\n  public Dialog make_password_dialog(Context context){\n    Dialog dialog = new Dialog(context);\n\n    dialog.setContentView(R.layout.dialerpassword);\n    dialog.setTitle(\"Password?\");\n    dialog.setCancelable(true);\n\n    dialog_password_field = (EditText)dialog.findViewById(R.id.dialerpassword_password_edit);\n    Button dialog_enter = (Button)dialog.findViewById(R.id.dialerpassword_enter_button);\n    dialog_enter.setOnClickListener(dialog_click_listener);\n    Button dialog_nevermind = (Button)dialog.findViewById(R.id.dialerpassword_nevermind_button);\n    dialog_nevermind.setOnClickListener(dialog_click_listener);\n\n    return dialog;\n  }\n\n  /**\n   * Custom View.OnClickListener interface for the password\n   * dialog buttons.\n   */\n  public OnClickListener dialog_click_listener = new View.OnClickListener(){\n\n    /**\n     * Clicking nevermind closes the dialog menu<br />\n     * Clicking done validates the password entered.\n     * (non-Javadoc)\n     * @see android.view.View.OnClickListener#onClick(android.view.View)\n     */\n    @Override\n      public void onClick(View button_clicked) {\n        switch(button_clicked.getId()){\n          case R.id.dialerpassword_nevermind_button:\n            password_dialog.dismiss();\n            break;\n\n          case R.id.dialerpassword_enter_button:\n            if(validate_password(dialog_password_field.getText().toString().trim())){\n              password_dialog.dismiss();\n              Intent homescreen_intent = new Intent(getApplicationContext(), HomeScreen.class);\n              startActivity(homescreen_intent);\n              Dialer.this.finish();\n            }\n            break;\n        }\n      }\n  };\n\n  /**\n   * Validates the password typed by the user to check if it\n   * matches the current password stored in the database.\n   * @param password_value\n   * @return true if the password was valid\n   */\n  private Boolean validate_password(String password_value){\n    if(!password_value.equals(current_password)){\n      display_toast(\"Incorrect password!\");\n      this.dialog_password_field.setText(\"\");\n      return false;\n    }\n    else{\n      return true;\n    }\n  }\n\n  /**\n   * A small hack to disable the back button\n   * (non-Javadoc)\n   * @see android.app.Activity#onBackPressed()\n   */\n  @Override\n    public void onBackPressed() {\n      display_toast(\"The back button is disabled\");\n      return;\n    }\n\n  /**\n   * Lets the user call using the dial button\n   * (non-Javadoc)\n   * @see android.app.Activity#onKeyDown(int, android.view.KeyEvent)\n   */\n  public boolean onKeyDown(int keyCode, KeyEvent event){\n    if(keyCode == KeyEvent.KEYCODE_CALL){\n      perform_dial();\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Dials the desired phone number and creates a listener to\n   * to capture the state when the phone call has ended.\n   */\n  public void perform_dial(){\n    if(dialer_phone_number_field != null){\n      try{\n        telephony_manager.listen(phone_state_listener, PhoneStateListener.LISTEN_CALL_STATE);\n        Intent phone_call = new Intent(Intent.ACTION_CALL,\n            Uri.parse(\"tel:\" + dialer_phone_number_field.getText()));\n        startActivity(phone_call);\n      }\n      catch(Exception error){\n        error.printStackTrace();\n      }\n    }\n  }\n\n  /**\n   *\n   * @author Alex Bredariol Grilo\n   * {@link www.umamao.com}\n   */\n  private class CallEndedListener extends PhoneStateListener {\n    boolean called = false;\n\n    /* Waits until the phone call is done and restarts the activity.\n     *\n     * (non-Javadoc)\n     * @see android.telephony.PhoneStateListener#onCallStateChanged(int, java.lang.String)\n     */\n    @Override\n      public void onCallStateChanged(int state, String incoming_number) {\n        if(called && state == TelephonyManager.CALL_STATE_IDLE){\n          called = false;\n\n          telephony_manager.listen(this,\n              PhoneStateListener.LISTEN_NONE);\n\n          try{\n            Dialer.this.finish();\n            Intent dialer_restart = new Intent(Dialer.this, Dialer.class);\n            dialer_restart.setAction(Intent.ACTION_MAIN);\n            startActivity(dialer_restart);\n          }\n          catch(Exception e){\n            e.printStackTrace();\n          }\n        }\n        else{\n          // When the phone is not in idle mode it is currently\n          // in use\n          if(state == TelephonyManager.CALL_STATE_OFFHOOK){\n            called = true;\n          }\n        }\n      }\n  }\n}\n```\nStepping through the code for the Dialer class you'll notice that its relatively simple.\nSince the activity is once again button based the meat of the code involves deciding what we should do once each button handler event is triggered.\n\nA quick thing to notice is that the Dialer class we defined extends the HomeScreen where we intialized the password database object; so all of the password interaction is due to our great use of inheritance.\n\nAnyhow the basic idea for the Dialer activity is the following...\n\n1. Pressing the numeric keys lets the user enter a phonenumber\n2. The clear button should delete a numeric character one at a time\n3. Dial... makes a phonecall\n4. Done should prompt the user for a password, if correct unlocks the app\n\nWhat you'll notice here is that the prompting for a password is how we make the dialer somewhat secure. If the wrong one is entered the user should theorectically have no other access to your phone meaning they can't touch your apps, peek at your emails or do anything else.\nLooking at the code you'll see the function make_password_dialog() which creates the kinda mini embedded activity when the user triggers the dialer_done_button click event.\n\nThe remaining code within the Dialer class involves the TelephonyManager which is the Android API's way of letting developers controller the actions of the phone listener and receiver.\nIts rather easy to understand after you force yourself to think of the Phone as advancing across as series of states such as IDLE, OFFHOOK, LISTEN_CALL and create a mental map of those states as you normally talk on the phone. Now we'll return back to the Homescreen and add in the code to support the new and reset password buttons. \n\nEach of the buttons will have a layout and Java class file associated. Lets begin with the NewPassword class, create the file \"newpassword.xml\" within the res/layout folder of your Android project. The xml rather easy to understand as its just a regular enter password and repeat it once type of layout you've seen all over the place.\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<RelativeLayout\nxmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:id=\"@+id/newpassword_relative_layout\" \nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\">\n\n<TextView \nandroid:id=\"@+id/newpassword_new_password_text\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:text=\"@string/newpassword_new_text\"/>\n\n<EditText \nandroid:id=\"@+id/newpassword_new_password_edit\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:hint=\"@string/newpassword_new_hint\"\nandroid:layout_below=\"@id/newpassword_new_password_text\"\nandroid:singleLine=\"true\"/>\n\n<TextView \nandroid:id=\"@+id/newpassword_confirm_password_text\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:text=\"@string/newpassword_confirm_text\"\nandroid:layout_below=\"@id/newpassword_new_password_edit\"/>\n\n<EditText \nandroid:id=\"@+id/newpassword_confirm_password_edit\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:hint=\"@string/newpassword_confirm_hint\"\nandroid:layout_below=\"@id/newpassword_confirm_password_text\"\nandroid:singleLine=\"true\"/>\n\n<Button\nandroid:id=\"@+id/newpassword_back_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/newpassword_back\"\nandroid:layout_below=\"@id/newpassword_confirm_password_edit\"\nandroid:layout_alignLeft=\"@id/newpassword_confirm_password_edit\"\nandroid:onClick=\"newpassword_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/newpassword_save_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/newpassword_save\"\nandroid:layout_below=\"@id/newpassword_confirm_password_edit\"\nandroid:layout_alignRight=\"@id/newpassword_confirm_password_edit\"\nandroid:onClick=\"newpassword_button_click_handler\"/>\n\n</RelativeLayout>\n```\nThe Java code should be titled \"NewPassword.java\" and stored within the src/ folder of your project.\nThe code consist of letting the user enter a password into the editText box, and validate that the repeated value matches the original.\nOnce the validation has been accepted we make a DB transaction and store the password.\n```java\npackage com.example;\n\nimport android.content.Intent;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.widget.EditText;\n\npublic class NewPassword extends HomeScreen {\n\n  private EditText new_password_field = null;\n  private EditText confirm_password_field = null;\n\n  /*\n   * (non-Javadoc)\n   * @see android.app.Activity#onCreate(android.os.Bundle)\n   */\n  public void onCreate(Bundle saved_instance_state){\n    super.onCreate(saved_instance_state);\n    this.setContentView(R.layout.newpassword);\n\n    new_password_field = (EditText)findViewById(\n        R.id.newpassword_new_password_edit);\n    confirm_password_field = (EditText)findViewById(\n        R.id.newpassword_confirm_password_edit);\n  }\n\n  /**\n   * Manages the button click events for the NewPassword Activity.<br />\n   * Clicking back returns to the HomeScreen.<br />\n   * Clicking save will save the password if it passes the validation\n   * check.\n   * @param button_clicked\n   */\n  public void newpassword_button_click_handler(View button_clicked){\n    Intent homescreen_intent = new Intent(this.getApplicationContext(),\n        HomeScreen.class);\n\n    switch(button_clicked.getId()){\n      case R.id.newpassword_back_button:\n        this.startActivity(homescreen_intent);\n        NewPassword.this.finish();\n        break;\n\n      case R.id.newpassword_save_button:\n        if(validate_password(\n              new_password_field.getText().toString().trim(),\n              confirm_password_field.getText().toString().trim()\n              )){\n          this.startActivity(homescreen_intent);\n          NewPassword.this.finish();\n        }\n        break;\n    }\n  }\n\n  /**\n   * When both the new password and the confirmation password\n   * match the new password is saved. Else when the passwords\n   * don't match or are empty an error message is displayed.\n   * @return true if both password fields match else false\n   */\n  private Boolean validate_password(String new_password_value,\n      String confirm_password_value){\n\n    if(!new_password_value.equals(confirm_password_value)){\n      display_toast(\"Your Passwords do not match\");\n      return false;\n    }\n    else if(new_password_value.equals(\"\") &&\n        new_password_value.equals(\"\")){\n      display_toast(\"Your Passwords cannot be empty\");\n      return false;\n    }\n    else{\n      password_db.set_password(new_password_value);\n      display_toast(\"Your new password was saved!\");\n      return true;\n    }\n  }\n}\n```\nIf you pay enough attention to the newpassword xml and Java code behind you'll have no trouble at all with the resetpassword code as its very similar.\nWe'll begin with the layout for the resetpassword code, so create the file \"resetpassword.xml\" within the res/layout/ folder of your project.\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<RelativeLayout\nxmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:id=\"@+id/resetpassword_relative_layout\" \nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\">\n\n<TextView \nandroid:id=\"@+id/resetpassword_old_password_text\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:text=\"@string/resetpassword_old_text\"/>\n\n<EditText \nandroid:id=\"@+id/resetpassword_old_password_edit\" \nandroid:hint=\"@string/resetpassword_old_hint\"\nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:layout_below=\"@id/resetpassword_old_password_text\"\nandroid:singleLine=\"true\"\nandroid:maxLength=\"10\"/>\n\n<TextView \nandroid:id=\"@+id/resetpassword_new_password_text\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:text=\"@string/resetpassword_new_text\"\nandroid:layout_below=\"@id/resetpassword_old_password_edit\"/>\n\n<EditText \nandroid:id=\"@+id/resetpassword_new_password_edit\" \nandroid:hint=\"@string/resetpassword_new_hint\"\nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:layout_below=\"@id/resetpassword_new_password_text\"\nandroid:singleLine=\"true\"\nandroid:maxLength=\"10\"/>\n\n<TextView \nandroid:id=\"@+id/resetpassword_confirm_password_text\" \nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:text=\"@string/resetpassword_confirm_text\"\nandroid:layout_below=\"@id/resetpassword_new_password_edit\"/>\n\n<EditText \nandroid:id=\"@+id/resetpassword_confirm_password_edit\" \nandroid:hint=\"@string/resetpassword_confirm_hint\"\nandroid:layout_width=\"fill_parent\" \nandroid:layout_height=\"wrap_content\" \nandroid:layout_below=\"@id/resetpassword_confirm_password_text\"\nandroid:singleLine=\"true\"\nandroid:maxLength=\"10\"/>\n\n<Button\nandroid:id=\"@+id/resetpassword_back_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/newpassword_back\"\nandroid:layout_below=\"@id/resetpassword_confirm_password_edit\"\nandroid:layout_alignLeft=\"@id/resetpassword_confirm_password_edit\"\nandroid:onClick=\"reset_button_click_handler\"/>\n\n<Button\nandroid:id=\"@+id/resetpassword_save_button\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_width=\"wrap_content\"\nandroid:text=\"@string/newpassword_save\"\nandroid:layout_below=\"@id/resetpassword_confirm_password_edit\"\nandroid:layout_alignRight=\"@id/resetpassword_confirm_password_edit\"\nandroid:onClick=\"reset_button_click_handler\"/>\n\n</RelativeLayout>\n```\nThe addition here for the reset password xml layout is the entry for the current or old password. We going to assert that the value entered there must be found within the database before we can create a new transaction to store the value of a new password. Now create the file within the src/ folder of your project called \"ResetPassword.java\". I was extra careful to write useful comments within this file so be sure to read them before moving on to the last part.\n```java\npackage com.example;\n\nimport android.content.Intent;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.widget.EditText;\n\n/**\n * Resets the applications' password used to escape from the dialer activity\n */\npublic class ResetPassword extends HomeScreen {\n\n  private String current_password = null;\n  private EditText new_password_field = null;\n  private EditText confirm_password_field = null;\n  private EditText old_password_field = null;\n\n  /*\n   * (non-Javadoc)\n   * @see android.app.Activity#onCreate(android.os.Bundle)\n   */\n  public void onCreate(Bundle saved_instance_state){\n    super.onCreate(saved_instance_state);\n    this.setContentView(R.layout.resetpassword);\n\n    current_password = password_db.get_password();\n    new_password_field = (EditText)findViewById(\n        R.id.resetpassword_new_password_edit);\n    confirm_password_field = (EditText)findViewById(\n        R.id.resetpassword_confirm_password_edit);\n    old_password_field = (EditText)findViewById(\n        R.id.resetpassword_old_password_edit);\n  }\n\n  /**\n   * Manages the button click events for the NewPassword Activity.<br />\n   * Clicking back returns to the HomeScreen.<br />\n   * Clicking save will save the password if it passes the validation\n   * check.\n   * @param button_clicked\n   */\n  public void reset_button_click_handler(View button_clicked){\n    Intent homescreen_intent = new Intent(this.getApplicationContext(),\n        HomeScreen.class);\n\n    switch(button_clicked.getId()){\n      case R.id.resetpassword_back_button:\n        this.startActivity(homescreen_intent);\n        ResetPassword.this.finish();\n        break;\n\n      case R.id.resetpassword_save_button:\n        if(validate_password(\n              old_password_field.getText().toString().trim(),\n              new_password_field.getText().toString().trim(),\n              confirm_password_field.getText().toString().trim()\n              )){\n          this.startActivity(homescreen_intent);\n          ResetPassword.this.finish();\n        }\n        break;\n    }\n  }\n\n  /**\n   * When the new password equals the confirmation password\n   * and the old password equals the current password \n   * then the new password is reset. Else when the passwords\n   * don't match or are empty or the old password doesn't match the\n   * current password then an error message is displayed.\n   * @return true if both password fields match else false\n   */\n  private Boolean validate_password(String old_password_value,\n      String new_password_value, String confirm_password_value){\n    if(!old_password_value.equals(current_password)){\n      display_toast(\"Your old password is incorrect\");\n      return false;\n    }\n    else if(!new_password_value.equals(confirm_password_value)){\n      display_toast(\"Your Passwords do not match\");\n      return false;\n    }\n    else if(new_password_value.equals(\"\") &&\n        confirm_password_value.equals(\"\")){\n      display_toast(\"Your Passwords cannot be empty\");\n      return false;\n    }\n    else{\n      password_db.reset_password(new_password_value);\n      display_toast(\"Your new password was saved!\");\n      return true;\n    }\n  }\n}\n```\nWe are now ready to explore the basics of the Android SQLite API.\nWithin the src folder of your project add the file \"PasswordDB.java\".\n```java\nimport android.content.ContentValues;\nimport android.content.Context;\nimport android.database.Cursor;\nimport android.database.sqlite.SQLiteDatabase;\nimport android.database.sqlite.SQLiteOpenHelper;\n\n/**\n * Represents the Password Database\n * @author Demetrious\n *\n */\npublic class PasswordDB extends SQLiteOpenHelper {\n\n  private static final String db_name = \"PasswordDB\";\n  private static final String password_table = \"Passwords\";\n  private static final String password_col_password_number = \"PassNo\";\n  private static final String password_col_password_value = \"PassVal\";\n```\nThe static strings we declared above represent the name of our database, table and two columns.\nThe password number or PassNo will be the primary key and the string value\nof the password(this is not a mission critical app so we're not going to encrpyt it) will be its stored value.\n\nNext we'll write the constructor for the database which will create the databasewith the name we gave it within the string db_name.\n```java\n    /**\n     * \n     * @param context\n     */\n    public PasswordDB(Context context) {\n      super(context, db_name, null, 1);\n    }\n```\nWith our database in place the next step is to create the Table.\nThe code below will accomplish just that, look at the JavaDoc I wrote to see the corresponding SQL.\n```java\n    /**\n     * Invokes the SQL statements below.\n     *  <p>\n     *belowCREATE TABLE IF NOT EXISTS Password( <br />\n     *brPassNoINTEGER PRIMARY KEY, <br />\n     *brPassValVARCHAR(10) NOT NULL <br />\n     *br);\n     * </p>\n     * (non-Javadoc)\n     * @see android.database.sqlite.SQLiteOpenHelper#onCreate(android.database.sqlite.SQLiteDatabase)\n     */\n    @Override\n    public void onCreate(SQLiteDatabase db) {\n      db.execSQL(\"CREATE TABLE IF NOT EXISTS \" + password_table + \"(\" + \n          password_col_password_number + \" INTEGER PRIMARY KEY,\" +\n          password_col_password_value + \" VARCHAR(10) NOT NULL\" +\n          \");\");\n    }\n```\nThe next method onUpgrade() is a required function but we're not going to actually implement it since we don't need it for this example.\n```java\n    /**\n     * (non-Javadoc)\n     * @see android.database.sqlite.SQLiteOpenHelper#onUpgrade(android.database.sqlite.SQLiteDatabase, int, int)\n     */\n    @Override\n    public void onUpgrade(SQLiteDatabase db, int oldVersion, \n        int newVersion) {\n    }\n```\nWe'll of course need a way to insert a new password into our database.\nThe method set_password does just that. All its doing is calling a basic SQL insert into query but using the Android API helper method insert();\n```java\n    /**\n     * Inserts a new password into the Password DB via the following SQL.\n     * <p>\n     * INSERT INTO Password (PassVal)<br />\n     * VALUES('new_password');\n     * </p>\n     * @param new_password\n     */\n    public void set_password(String new_password){\n      SQLiteDatabase db = this.getWritableDatabase();\n\n      ContentValues content_values = new ContentValues();\n\n      content_values.put(password_col_password_value, new_password);\n\n      db.insert(password_table, password_col_password_value, \n          content_values);\n      db.close();\n    }\n```\nMuch like a Java property we need a getter to accompany the setter.\nHowever here we'll first write a raw query which will place a cursor at the first result row that was found from our SELECT statement.\nDatabase cursors can be though of as table iterators.\nThe cursor will begin at the result table itself, you must first move it to the  result row to begin reading data.\nOnce at a result row you have to move the cursor column by column and read the rrow value from each.\nSince we are only going to be storing a single password the first row result will always contain the password we want to fetch. \n```java\n    /**\n     * Returns the existing password assuming that one exists via the \n     * following SQL.\n     * <p>\n     * SELECT * <br />\n     * FROM Passwords <br />\n     * WHERE PassNo='1';\n     * </p>\n     * @return A String with the current password\n     */\n    public String get_password(){\n      SQLiteDatabase db = this.getWritableDatabase();\n\n      Cursor cursor = db.rawQuery(\n          \"SELECT \" + password_col_password_value +\n          \" FROM \" + password_table +\n          \" WHERE \" + password_col_password_number + \"=\\'1\\';\", null);\n\n      cursor.moveToFirst();\n      Integer column_index = cursor.getColumnIndex(\n          password_col_password_value);\n      String string_value = cursor.getString(column_index);\n\n      cursor.close();\n      db.close();\n\n      return string_value;\n    }\n```\nNow the question becomes how do we update an existing password?\nTo do so we have to use the update() method which is another Android SQLite API wrapper around the traditional SQL UPDATE WHERE statement.\nLooking at the JavaDoc I wrote you can see how we would write this if it were a regular SQL statement.\n\nDespite the Android SQL API being a little verbose(this might change in the future) the parameterized input means that we would be safe from any type of injection attacks since we're not passing a rawQuery from the user input.\nIn short using the parameterized wrapper methods is more code but it saves you from the potential danger of calling rawQueries which substitute in user values.\n```java\n    /**\n     * Updates the existing password based on the following SQL.\n     * <p>\n     *  UPDATE Password <br />\n     *brSET PassVal='new_password' <br />\n     *brWHERE PassVal='old_password';\n     * </p>\n     * @param new_password\n     */\n    public void reset_password(String new_password){\n      String old_password = get_password();\n      SQLiteDatabase db = this.getWritableDatabase();\n      ContentValues content_values = new ContentValues();\n\n      content_values.put(password_col_password_value, new_password);\n\n      String where_clause = password_col_password_value + \"=?\";\n      String[] where_args = {old_password};\n      db.update(password_table, content_values, where_clause, \n          where_args);\n\n      db.close();\n    }\n```\nLastly we need a way to verify if a password has been set or not. \nThis will allow us to determine when we need to prompt the user for a reset.\nIts short and sweet, just run a select query and count the results.\n```java\n    /**\n     * Uses the following SQL.\n     * <p>\n     * SELECT * <br />\n     * FROM Passwords <br />\n     * WHERE PassNo='1';\n     * </p>\n     * @return true if a password exists else false\n     */\n    public Boolean is_password(){\n      SQLiteDatabase db = this.getWritableDatabase();\n\n      Cursor cursor = db.rawQuery(\n          \"SELECT \" + password_col_password_value +\n          \" FROM \" + password_table +\n          \" WHERE \" + password_col_password_number + \"=\\'1\\';\", null);\n\n      if(cursor != null && cursor.getCount() > 0 ){\n        db.close();\n        cursor.close();\n        return true;\n      }\n      else{\n        db.close();\n        cursor.close();\n        return false;\n      }\n    }\n}\n```\nPerhaps you got lost(its better if you followed along closely) but here is the PasswordDB class in full.\n```java\n//Add your package name here!\n\nimport android.content.ContentValues;\nimport android.content.Context;\nimport android.database.Cursor;\nimport android.database.sqlite.SQLiteDatabase;\nimport android.database.sqlite.SQLiteOpenHelper;\n\npublic class PasswordDB extends SQLiteOpenHelper {\n\n  private static final String db_name = \"PasswordDB\";\n  private static final String password_table = \"Passwords\";\n  private static final String password_col_password_number = \"PassNo\";\n  private static final String password_col_password_value = \"PassVal\";\n\n  /**\n   * \n   * @param context\n   */\n  public PasswordDB(Context context) {\n    super(context, db_name, null, 1);\n  }\n\n  /**\n   * Invokes the SQL statements below.\n   *  <p>\n   *belowCREATE TABLE IF NOT EXISTS Password( <br />\n   *brPassNoINTEGER PRIMARY KEY, <br />\n   *brPassValVARCHAR(10) NOT NULL <br />\n   *br);\n   * </p>\n   * (non-Javadoc)\n   * @see android.database.sqlite.SQLiteOpenHelper#onCreate(android.database.sqlite.SQLiteDatabase)\n   */\n  @Override\n    public void onCreate(SQLiteDatabase db) {\n      db.execSQL(\"CREATE TABLE IF NOT EXISTS \" + password_table + \"(\" + \n          password_col_password_number + \" INTEGER PRIMARY KEY,\" +\n          password_col_password_value + \" VARCHAR(10) NOT NULL\" +\n          \");\");\n    }\n\n  /**\n   * (non-Javadoc)\n   * @see android.database.sqlite.SQLiteOpenHelper#onUpgrade(android.database.sqlite.SQLiteDatabase, int, int)\n   */\n  @Override\n    public void onUpgrade(SQLiteDatabase db, int oldVersion, \n        int newVersion) {\n    }\n\n  /**\n   * Inserts a new password into the Password DB via the following SQL.\n   * <p>\n   * INSERT INTO Password (PassVal)<br />\n   * VALUES('new_password');\n   * </p>\n   * @param new_password\n   */\n  public void set_password(String new_password){\n    SQLiteDatabase db = this.getWritableDatabase();\n\n    ContentValues content_values = new ContentValues();\n\n    content_values.put(password_col_password_value, new_password);\n\n    db.insert(password_table, password_col_password_value, \n        content_values);\n    db.close();\n  }\n\n  /**\n   * Returns the existing password assuming that one exists via the \n   * following SQL.\n   * <p>\n   * SELECT * <br />\n   * FROM Passwords <br />\n   * WHERE PassNo='1';\n   * </p>\n   * @return A String with the current password\n   */\n  public String get_password(){\n    SQLiteDatabase db = this.getWritableDatabase();\n\n    Cursor cursor = db.rawQuery(\n        \"SELECT \" + password_col_password_value +\n        \" FROM \" + password_table +\n        \" WHERE \" + password_col_password_number + \"=\\'1\\';\", null);\n\n    cursor.moveToFirst();\n    Integer column_index = cursor.getColumnIndex(\n        password_col_password_value);\n    String string_value = cursor.getString(column_index);\n\n    cursor.close();\n    db.close();\n\n    return string_value;\n  }\n\n  /**\n   * Updates the existing password based on the following SQL.\n   * <p>\n   *  UPDATE Password <br />\n   *brSET PassVal='new_password' <br />\n   *brWHERE PassVal='old_password';\n   * </p>\n   * @param new_password\n   */\n  public void reset_password(String new_password){\n    String old_password = get_password();\n    SQLiteDatabase db = this.getWritableDatabase();\n    ContentValues content_values = new ContentValues();\n\n    content_values.put(password_col_password_value, new_password);\n\n    String where_clause = password_col_password_value + \"=?\";\n    String[] where_args = {old_password};\n    db.update(password_table, content_values, where_clause, \n        where_args);\n\n    db.close();\n  }\n\n  /**\n   * Uses the following SQL.\n   * <p>\n   * SELECT * <br />\n   * FROM Passwords <br />\n   * WHERE PassNo='1';\n   * </p>\n   * @return true if a password exists else false\n   */\n  public Boolean is_password(){\n    SQLiteDatabase db = this.getWritableDatabase();\n\n    Cursor cursor = db.rawQuery(\n        \"SELECT \" + password_col_password_value +\n        \" FROM \" + password_table +\n        \" WHERE \" + password_col_password_number + \"=\\'1\\';\", null);\n\n    if(cursor != null && cursor.getCount() > 0 ){\n      db.close();\n      cursor.close();\n      return true;\n    }\n    else{\n      db.close();\n      cursor.close();\n      return false;\n    }\n  }\n}\n```\nSo there you go, an Android application that makes use of the SQLite API. Perhaps you can extend this application or something.\n\nAnyways... enjoy your guestDialer app. \n","slug":"guestdialer","published":1,"updated":"2017-04-15T04:50:32.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr1q000k9uwv0lqsesjd","content":"<p>In this tutorial we’ll step through the process of using the Android’s builtin support for SqlLite to store a password and retrive it in a rather interesting attempt at creating a guest dialer application. When I first imagined a guest dialer I had in mind an application that would allow you to let someone use your phone without giving them total access to your incomming messages and other sensitive data. However, a lock-in application basically classifies as a virus when you think about it so whatever… at least I learned about the SqlLite api ^_^.</p>\n<p>Before begining this tutorial make sure you have the following… </p>\n<ul>\n<li>Java runtime and SDK installed</li>\n<li>Android SDK</li>\n<li>Some IDE which supports Android development such as Eclipse or IntelliJ IDEA(the free community edition can be used for Android Dev)</li>\n<li>Some familiarity at least(not much don’t worry) with Android Development</li>\n</ul>\n<p>Within your IDE of choice create a new Android project and call it Secure Dialer(actually you can name it whatever but I’ll just refer to it as Secure Dialer throughout this tutorial).</p>\n<p>Now locate the pre configured file called “AndroidManifest.xml”.<br>The AndroidManifest file is the standard configuration file for Android applications.<br>Its where you determine which permissions you demand from the phone OS as well as where you setup the various activity screens and many other things.<br>Just think of the AndroidManifest as the app’s system profile if that helps.<br>To start us off lets declare the permissions we need the end user to accept in order for our application to function correctly.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">manifest</span> </span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">package</span>=<span class=\"string\">\"org.secure.dialer\"</span></div><div class=\"line\"><span class=\"attr\">android:versionCode</span>=<span class=\"string\">\"1\"</span></div><div class=\"line\"><span class=\"attr\">android:versionName</span>=<span class=\"string\">\"1.0\"</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-sdk</span> <span class=\"attr\">android:minSdkVersion</span>=<span class=\"string\">\"8\"</span> /&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> </span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.CALL_PHONE\"</span>&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">uses-permission</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> </span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.READ_PHONE_STATE\"</span>&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">uses-permission</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Next we’ll fill out the <application> element; this is the element where we can declare<br>the activities and setup any intent-filters which we might need as well.</application></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">application</span> </span></div><div class=\"line\"><span class=\"attr\">android:icon</span>=<span class=\"string\">\"@drawable/icon\"</span> </div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/app_name\"</span> </div><div class=\"line\"><span class=\"attr\">android:debuggable</span>=<span class=\"string\">\"true\"</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\".HomeScreen\"</span></div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/homescreen_label\"</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">intent-filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.intent.action.MAIN\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">category</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.intent.category.LAUNCHER\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">intent-filter</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\".Dialer\"</span></div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/dialer_label\"</span>&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\".NewPassword\"</span></div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/newpassword_label\"</span>&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\".ResetPassword\"</span></div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/resetpassword_label\"</span>&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">application</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">manifest</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Now go ahead and save the new AndroidManifest.xml with our changes in place.<br>Next up is the resource file strings.xml.</p>\n<p>strings.xml if you need a refresher is a special resource file that is standard across Androidapps because its the file where you define all of the text strings which will appear throughout your app.</p>\n<p>Although is practical to define strings within the .java files its considered good Android development practice to keep as many of the applications strings within the strings.xml.</p>\n<p>You might think its crazy but for large applications it makes updating text notfications a piece of cake.<br>So navigate within your IDE to res/values/strings.xml or create the file if it doesn’t exist.<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"app_name\"</span>&gt;</span>SecureDialer<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"homescreen_label\"</span>&gt;</span>Homescreen Activity<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"homescreen_dialer\"</span>&gt;</span>Dialer<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"homescreen_password\"</span>&gt;</span>Password<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"homescreen_exit\"</span>&gt;</span>Exit<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_label\"</span>&gt;</span>Newpassword Activity<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_new_text\"</span>&gt;</span>Enter new password:<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_confirm_text\"</span>&gt;</span>Repeat the password:<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_new_hint\"</span>&gt;</span>Type new password here<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_confirm_hint\"</span>&gt;</span>Repeat password here<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_back\"</span>&gt;</span>Back<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_save\"</span>&gt;</span>Save<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_label\"</span>&gt;</span>Resetpassword Activity<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_old_text\"</span>&gt;</span>Enter old password:<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_old_hint\"</span>&gt;</span>Type old password here<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_new_text\"</span>&gt;</span>Enter new password:<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_new_hint\"</span>&gt;</span>Type new password here<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_confirm_text\"</span>&gt;</span>Confirm password:<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_confirm_hint\"</span>&gt;</span>Repeat password here<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialer_label\"</span>&gt;</span>Dialer Activity<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialer_dial\"</span>&gt;</span>Dial<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialer_clear\"</span>&gt;</span>Clear<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialer_done\"</span>&gt;</span>Done<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialerpassword_enter\"</span>&gt;</span>Enter<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialerpassword_nevermind\"</span>&gt;</span>Nevermind<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>Remember all of those @string/some_name values within the AndroidManifest.xml?<br>Well that is how we reference the values stored within res/strings.xml.</p>\n<p>Moving along next create the Java class file HomeScreen within your applications src folder if you want to follow along with the code I have it under <div>src/org/secure/dialer/HomeScreen.java.</div><br>Don’t worry about all of those string values you just typed or pasted we’ll use them shortly as we introduce each activity screen.</p>\n<p>As is normal with Android development we will first create the visual layouts and then once all our buttons and views are setup we then add Java to support the various actions we want to allow our users to make.</p>\n<p>Be warned though that this style of visuals first and then application logic might sound strange if you’re comming from a web development MVC or MVVM background in which you first design your Models before hooking up controller logic before finnally designing a UI; but don’t let it get to you too much because you’ll see how its much easier for you to structure your Java code since you basically build application logic on top of objects created from your visual layout.</p>\n<p>But enough chit chat, create a new file “homescreen.xml” within <div>/res/layout/</div></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">A great tutorial on how to design button themes</div><div class=\"line\">http://blog.androgames.net/40/custom-button-style-and-theme/</div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">RelativeLayout</span> </span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/homescreen_relative_layout\"</span></div><div class=\"line\"><span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"fill_parent\"</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/homescreen_dialer_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/homescreen_dialer\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"homescreen_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/homescreen_password_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/homescreen_dialer_button\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/homescreen_password\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"homescreen_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/homescreen_exit_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/homescreen_password_button\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/homescreen_exit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"homescreen_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>The homescreen is fairly basic it will just appear as three buttons vertically tiled.<br>When we get to the code for the homescreen you’ll see how easily you hookup code to support the android:onClick= tags from your xml file.</p>\n<p>Now create the Java class file “HomeScreen.java” within your project’s src/ folder.<br>Here you’ll also notice a class called “PasswordDB” created, that is the object representation of our SQLite database which is the focus of the article and we’ll cover it in depth later on.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.example;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.app.Activity;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.Toast;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeScreen</span> <span class=\"keyword\">extends</span> <span class=\"title\">Activity</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">protected</span> PasswordDB password_db;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * <span class=\"doctag\">@see</span> android.app.Activity#onCreate(android.os.Bundle)</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle saved_instance_state)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>.onCreate(saved_instance_state);</div><div class=\"line\">    <span class=\"keyword\">this</span>.setContentView(R.layout.homescreen);</div><div class=\"line\">    password_db = <span class=\"keyword\">new</span> PasswordDB(<span class=\"keyword\">this</span>);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Manages the button click events for the HomeScreen Activity.&lt;br /&gt;</div><div class=\"line\">   * Clicking exit terminates the app.&lt;br /&gt;</div><div class=\"line\">   * Clicking password launches either the newpassword or resetpassword</div><div class=\"line\">   * activity depending on whether a password is currently stored.&lt;br /&gt;</div><div class=\"line\">   * Clicking dialer launches the dialer activity.</div><div class=\"line\">   * <span class=\"doctag\">@param</span> button_clicked</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">homescreen_button_click_handler</span><span class=\"params\">(View button_clicked)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">switch</span>(button_clicked.getId())&#123;</div><div class=\"line\">      Boolean password_found = password_db.is_password();</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.homescreen_exit_button:</div><div class=\"line\">      HomeScreen.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">      <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.homescreen_password_button:</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>(!password_found)&#123;</div><div class=\"line\">        Intent new_password_intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>.getApplicationContext(), NewPassword.class);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">this</span>.startActivity(new_password_intent);</div><div class=\"line\">        HomeScreen.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">        Intent reset_password_intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>.getApplicationContext(), ResetPassword.class);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">this</span>.startActivity(reset_password_intent);</div><div class=\"line\">        HomeScreen.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.homescreen_dialer_button:</div><div class=\"line\">      <span class=\"keyword\">if</span>(password_found) &#123;</div><div class=\"line\">        Intent dialer_intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>.getApplicationContext(), Dialer.class);</div><div class=\"line\">        <span class=\"keyword\">this</span>.startActivity(dialer_intent);</div><div class=\"line\">        HomeScreen.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        display_toast(<span class=\"string\">\"No password has been set yet.\"</span>);</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Displays the string passed as a new toast</div><div class=\"line\">   * <span class=\"doctag\">@param</span> message</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">display_toast</span><span class=\"params\">(String message)</span></span></div><div class=\"line\">  &#123;</div><div class=\"line\">    Toast.makeText(getApplicationContext(), message, Toast.LENGTH_SHORT).show();</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Pay attention to the homescreen_button_click_handler.<br>Remember inside our Homescreen.xml file where we defined the onClick attribute for each of the three buttons?<br>Now you see how easy it is within the Java code to look up the button’s unique id name and write handler code, it just becomes a switch case on the getId() method of the View which generated the click event.<br>To think if you tried it the other way around you would have foolishly built up three different button handler events where we have just a single button_handler for the entire Homescreen.</p>\n<p>This style of design also makes our code very modular; if you wanted to add another button its as easy as popping in another case statement.<br>Looking at the button_click_handler code when the user presses the homescreen_dialer_button we launch the Dialer activity screen… lets do that.<br></p><p></p>\n<p></p><p><br>As before we’ll create the dialer layout first, so create the file “dialer.xml” within the layout directory res/layout.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">RelativeLayout</span></span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_relative_layout\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_number_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:focusable</span>=<span class=\"string\">\"false\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_one\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"1\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_number_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/dialer_number_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_two\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"2\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_number_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_one\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_three\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"3\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_number_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_two\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_four\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"4\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_one\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/dialer_one\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_five\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"5\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_two\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_four\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_six\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"6\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_three\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_five\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_seven\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"7\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_four\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/dialer_four\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_eight\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"8\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_five\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_seven\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_nine\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"9\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_six\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_eight\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_pound\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"#\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_seven\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/dialer_seven\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_zero\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"0\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_eight\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_pound\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_star\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"*\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_nine\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_zero\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_dial_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/dialer_dial\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_pound\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignParentLeft</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_clear_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/dialer_clear\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_star\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignParentRight</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_done_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/dialer_done\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_dial_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_centerHorizontal</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>As you can guess all of the numerical button are what you should expect from a phone dialer.<br>Of intrest is the non-focusable editbox where the phonenumber will be displayed as the user types and the three buttons near the bottom; dial, clear and done.<br>The layout as you can see is rather plain but the interesting bits will come next when we add the Java code.<br>However before that we need to creat the layout for the password prompt which will display once the guest has finished making a call and might potentially have the chance to muck around with your phone.</p>\n<p>Add the file “dialerpassword.xml” to the res/layout folder.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">RelativeLayout</span></span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialerpassword_relative_layout\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialerpassword_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/newpassword_confirm_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialerpassword_enter_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/dialerpassword_enter\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialerpassword_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/dialerpassword_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialerpassword_nevermind_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/dialerpassword_nevermind\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialerpassword_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignRight</span>=<span class=\"string\">\"@id/dialerpassword_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Finally create the Java class file “Dialer.java” and place it within your src/ folder.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div><div class=\"line\">303</div><div class=\"line\">304</div><div class=\"line\">305</div><div class=\"line\">306</div><div class=\"line\">307</div><div class=\"line\">308</div><div class=\"line\">309</div><div class=\"line\">310</div><div class=\"line\">311</div><div class=\"line\">312</div><div class=\"line\">313</div><div class=\"line\">314</div><div class=\"line\">315</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.example;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.app.Dialog;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.net.Uri;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.telephony.TelephonyManager;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.KeyEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.Window;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.WindowManager;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View.OnClickListener;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.Button;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.EditText;</div><div class=\"line\"><span class=\"keyword\">import</span> android.telephony.PhoneStateListener;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dialer</span> <span class=\"keyword\">extends</span> <span class=\"title\">HomeScreen</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> String current_password = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText dialer_phone_number_field = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> Dialog password_dialog = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText dialog_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> PhoneStateListener phone_state_listener = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> TelephonyManager telephony_manager = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/*</span></div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * @see android.app.Activity#onCreate(android.os.Bundle)</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle saved_instance_state)</span></span>&#123;</div><div class=\"line\">    <span class=\"comment\">// Hides both the title and status bar</span></div><div class=\"line\">    <span class=\"comment\">// Must be called calling super.onCreate()</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.requestWindowFeature(Window.FEATURE_NO_TITLE);</div><div class=\"line\">    getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,</div><div class=\"line\">        WindowManager.LayoutParams.FLAG_FULLSCREEN);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">super</span>.onCreate(saved_instance_state);</div><div class=\"line\">    <span class=\"keyword\">this</span>.setContentView(R.layout.dialer);</div><div class=\"line\"></div><div class=\"line\">    current_password = password_db.get_password();</div><div class=\"line\">    dialer_phone_number_field = (EditText)findViewById(R.id.dialer_number_edit);</div><div class=\"line\">    phone_state_listener = <span class=\"keyword\">new</span> CallEndedListener();</div><div class=\"line\">    telephony_manager = (TelephonyManager) <span class=\"keyword\">this</span>.getSystemService(TELEPHONY_SERVICE);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Manages the button click events for the HomeScreen Activity.&lt;br /&gt;</div><div class=\"line\">   * Clicking the numpad adds the number to the dial box&lt;br /&gt;</div><div class=\"line\">   * Clicking dial calls the number within the dial box&lt;br /&gt;</div><div class=\"line\">   * Clicking clear erases the dial box&lt;br /&gt;</div><div class=\"line\">   * Clicking done prompts for the password&lt;br /&gt;</div><div class=\"line\">   * <span class=\"doctag\">@param</span> button_clicked</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dialer_button_click_handler</span><span class=\"params\">(View button_clicked)</span></span>&#123;</div><div class=\"line\">    StringBuilder phone_number = <span class=\"keyword\">new</span> StringBuilder();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">switch</span>(button_clicked.getId())&#123;</div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_one:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'1'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_two:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'2'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_three:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'3'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_four:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'4'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_five:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'5'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_six:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'6'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_seven:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'7'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_eight:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'8'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_nine:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'9'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_zero:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'0'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_star:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'*'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_pound:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'#'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// Copies the phone_number_field to a StringBuilder,</span></div><div class=\"line\">        <span class=\"comment\">// deletes the last digit and dumps the StringBuilder</span></div><div class=\"line\">        <span class=\"comment\">// back to the phone_number_field</span></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_clear_button:</div><div class=\"line\">        <span class=\"keyword\">if</span>(!dialer_phone_number_field.getText().toString().equals(<span class=\"string\">\"\"</span>))&#123;</div><div class=\"line\">          <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; dialer_phone_number_field.getText().toString().length(); ++i)&#123;</div><div class=\"line\">            phone_number.append(dialer_phone_number_field.getText().toString().charAt(i));</div><div class=\"line\">          &#125;</div><div class=\"line\"></div><div class=\"line\">          phone_number.deleteCharAt(phone_number.length() - <span class=\"number\">1</span>);</div><div class=\"line\">          dialer_phone_number_field.setText(phone_number.toString());</div><div class=\"line\">          phone_number.setLength(<span class=\"number\">0</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// Launches the dialog box prompting for the new password</span></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_done_button:</div><div class=\"line\">        password_dialog = make_password_dialog(<span class=\"keyword\">this</span>);</div><div class=\"line\">        password_dialog.show();</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_dial_button:</div><div class=\"line\">        <span class=\"keyword\">if</span>(dialer_phone_number_field.getText().toString().equals(<span class=\"string\">\"\"</span>))&#123;</div><div class=\"line\">          display_toast(<span class=\"string\">\"Enter a phone number to dial\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">          perform_dial();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Creates a dialog for the password confirmation</div><div class=\"line\">   * <span class=\"doctag\">@param</span> context</div><div class=\"line\">   * <span class=\"doctag\">@return</span></div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Dialog <span class=\"title\">make_password_dialog</span><span class=\"params\">(Context context)</span></span>&#123;</div><div class=\"line\">    Dialog dialog = <span class=\"keyword\">new</span> Dialog(context);</div><div class=\"line\"></div><div class=\"line\">    dialog.setContentView(R.layout.dialerpassword);</div><div class=\"line\">    dialog.setTitle(<span class=\"string\">\"Password?\"</span>);</div><div class=\"line\">    dialog.setCancelable(<span class=\"keyword\">true</span>);</div><div class=\"line\"></div><div class=\"line\">    dialog_password_field = (EditText)dialog.findViewById(R.id.dialerpassword_password_edit);</div><div class=\"line\">    Button dialog_enter = (Button)dialog.findViewById(R.id.dialerpassword_enter_button);</div><div class=\"line\">    dialog_enter.setOnClickListener(dialog_click_listener);</div><div class=\"line\">    Button dialog_nevermind = (Button)dialog.findViewById(R.id.dialerpassword_nevermind_button);</div><div class=\"line\">    dialog_nevermind.setOnClickListener(dialog_click_listener);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> dialog;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Custom View.OnClickListener interface for the password</div><div class=\"line\">   * dialog buttons.</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"keyword\">public</span> OnClickListener dialog_click_listener = <span class=\"keyword\">new</span> View.OnClickListener()&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * Clicking nevermind closes the dialog menu&lt;br /&gt;</div><div class=\"line\">     * Clicking done validates the password entered.</div><div class=\"line\">     * (non-Javadoc)</div><div class=\"line\">     * <span class=\"doctag\">@see</span> android.view.View.OnClickListener#onClick(android.view.View)</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onClick</span><span class=\"params\">(View button_clicked)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">switch</span>(button_clicked.getId())&#123;</div><div class=\"line\">          <span class=\"keyword\">case</span> R.id.dialerpassword_nevermind_button:</div><div class=\"line\">            password_dialog.dismiss();</div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">          <span class=\"keyword\">case</span> R.id.dialerpassword_enter_button:</div><div class=\"line\">            <span class=\"keyword\">if</span>(validate_password(dialog_password_field.getText().toString().trim()))&#123;</div><div class=\"line\">              password_dialog.dismiss();</div><div class=\"line\">              Intent homescreen_intent = <span class=\"keyword\">new</span> Intent(getApplicationContext(), HomeScreen.class);</div><div class=\"line\">              startActivity(homescreen_intent);</div><div class=\"line\">              Dialer.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Validates the password typed by the user to check if it</div><div class=\"line\">   * matches the current password stored in the database.</div><div class=\"line\">   * <span class=\"doctag\">@param</span> password_value</div><div class=\"line\">   * <span class=\"doctag\">@return</span> true if the password was valid</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> Boolean <span class=\"title\">validate_password</span><span class=\"params\">(String password_value)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(!password_value.equals(current_password))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Incorrect password!\"</span>);</div><div class=\"line\">      <span class=\"keyword\">this</span>.dialog_password_field.setText(<span class=\"string\">\"\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * A small hack to disable the back button</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * <span class=\"doctag\">@see</span> android.app.Activity#onBackPressed()</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onBackPressed</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"The back button is disabled\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Lets the user call using the dial button</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * <span class=\"doctag\">@see</span> android.app.Activity#onKeyDown(int, android.view.KeyEvent)</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onKeyDown</span><span class=\"params\">(<span class=\"keyword\">int</span> keyCode, KeyEvent event)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(keyCode == KeyEvent.KEYCODE_CALL)&#123;</div><div class=\"line\">      perform_dial();</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Dials the desired phone number and creates a listener to</div><div class=\"line\">   * to capture the state when the phone call has ended.</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">perform_dial</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(dialer_phone_number_field != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">      <span class=\"keyword\">try</span>&#123;</div><div class=\"line\">        telephony_manager.listen(phone_state_listener, PhoneStateListener.LISTEN_CALL_STATE);</div><div class=\"line\">        Intent phone_call = <span class=\"keyword\">new</span> Intent(Intent.ACTION_CALL,</div><div class=\"line\">            Uri.parse(<span class=\"string\">\"tel:\"</span> + dialer_phone_number_field.getText()));</div><div class=\"line\">        startActivity(phone_call);</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">catch</span>(Exception error)&#123;</div><div class=\"line\">        error.printStackTrace();</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   *</div><div class=\"line\">   * <span class=\"doctag\">@author</span> Alex Bredariol Grilo</div><div class=\"line\">   * &#123;<span class=\"doctag\">@link</span> www.umamao.com&#125;</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallEndedListener</span> <span class=\"keyword\">extends</span> <span class=\"title\">PhoneStateListener</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> called = <span class=\"keyword\">false</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/* Waits until the phone call is done and restarts the activity.</span></div><div class=\"line\">     *</div><div class=\"line\">     * (non-Javadoc)</div><div class=\"line\">     * @see android.telephony.PhoneStateListener#onCallStateChanged(int, java.lang.String)</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCallStateChanged</span><span class=\"params\">(<span class=\"keyword\">int</span> state, String incoming_number)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>(called &amp;&amp; state == TelephonyManager.CALL_STATE_IDLE)&#123;</div><div class=\"line\">          called = <span class=\"keyword\">false</span>;</div><div class=\"line\"></div><div class=\"line\">          telephony_manager.listen(<span class=\"keyword\">this</span>,</div><div class=\"line\">              PhoneStateListener.LISTEN_NONE);</div><div class=\"line\"></div><div class=\"line\">          <span class=\"keyword\">try</span>&#123;</div><div class=\"line\">            Dialer.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">            Intent dialer_restart = <span class=\"keyword\">new</span> Intent(Dialer.<span class=\"keyword\">this</span>, Dialer.class);</div><div class=\"line\">            dialer_restart.setAction(Intent.ACTION_MAIN);</div><div class=\"line\">            startActivity(dialer_restart);</div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"keyword\">catch</span>(Exception e)&#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">          &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">          <span class=\"comment\">// When the phone is not in idle mode it is currently</span></div><div class=\"line\">          <span class=\"comment\">// in use</span></div><div class=\"line\">          <span class=\"keyword\">if</span>(state == TelephonyManager.CALL_STATE_OFFHOOK)&#123;</div><div class=\"line\">            called = <span class=\"keyword\">true</span>;</div><div class=\"line\">          &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Stepping through the code for the Dialer class you’ll notice that its relatively simple.<br>Since the activity is once again button based the meat of the code involves deciding what we should do once each button handler event is triggered.</p>\n<p>A quick thing to notice is that the Dialer class we defined extends the HomeScreen where we intialized the password database object; so all of the password interaction is due to our great use of inheritance.</p>\n<p>Anyhow the basic idea for the Dialer activity is the following…</p>\n<ol>\n<li>Pressing the numeric keys lets the user enter a phonenumber</li>\n<li>The clear button should delete a numeric character one at a time</li>\n<li>Dial… makes a phonecall</li>\n<li>Done should prompt the user for a password, if correct unlocks the app</li>\n</ol>\n<p>What you’ll notice here is that the prompting for a password is how we make the dialer somewhat secure. If the wrong one is entered the user should theorectically have no other access to your phone meaning they can’t touch your apps, peek at your emails or do anything else.<br>Looking at the code you’ll see the function make_password_dialog() which creates the kinda mini embedded activity when the user triggers the dialer_done_button click event.</p>\n<p>The remaining code within the Dialer class involves the TelephonyManager which is the Android API’s way of letting developers controller the actions of the phone listener and receiver.<br>Its rather easy to understand after you force yourself to think of the Phone as advancing across as series of states such as IDLE, OFFHOOK, LISTEN_CALL and create a mental map of those states as you normally talk on the phone. Now we’ll return back to the Homescreen and add in the code to support the new and reset password buttons. </p>\n<p>Each of the buttons will have a layout and Java class file associated. Lets begin with the NewPassword class, create the file “newpassword.xml” within the res/layout folder of your Android project. The xml rather easy to understand as its just a regular enter password and repeat it once type of layout you’ve seen all over the place.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">RelativeLayout</span></span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_relative_layout\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span> </span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_new_password_text\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_new_text\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> </span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_new_password_edit\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/newpassword_new_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/newpassword_new_password_text\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span> </span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_confirm_password_text\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_confirm_text\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/newpassword_new_password_edit\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> </span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_confirm_password_edit\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/newpassword_confirm_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/newpassword_confirm_password_text\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_back_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_back\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/newpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/newpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"newpassword_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_save_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_save\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/newpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignRight</span>=<span class=\"string\">\"@id/newpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"newpassword_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>The Java code should be titled “NewPassword.java” and stored within the src/ folder of your project.<br>The code consist of letting the user enter a password into the editText box, and validate that the repeated value matches the original.<br>Once the validation has been accepted we make a DB transaction and store the password.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.example;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.EditText;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NewPassword</span> <span class=\"keyword\">extends</span> <span class=\"title\">HomeScreen</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> EditText new_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText confirm_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/*</span></div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * @see android.app.Activity#onCreate(android.os.Bundle)</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle saved_instance_state)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>.onCreate(saved_instance_state);</div><div class=\"line\">    <span class=\"keyword\">this</span>.setContentView(R.layout.newpassword);</div><div class=\"line\"></div><div class=\"line\">    new_password_field = (EditText)findViewById(</div><div class=\"line\">        R.id.newpassword_new_password_edit);</div><div class=\"line\">    confirm_password_field = (EditText)findViewById(</div><div class=\"line\">        R.id.newpassword_confirm_password_edit);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Manages the button click events for the NewPassword Activity.&lt;br /&gt;</div><div class=\"line\">   * Clicking back returns to the HomeScreen.&lt;br /&gt;</div><div class=\"line\">   * Clicking save will save the password if it passes the validation</div><div class=\"line\">   * check.</div><div class=\"line\">   * <span class=\"doctag\">@param</span> button_clicked</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">newpassword_button_click_handler</span><span class=\"params\">(View button_clicked)</span></span>&#123;</div><div class=\"line\">    Intent homescreen_intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>.getApplicationContext(),</div><div class=\"line\">        HomeScreen.class);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">switch</span>(button_clicked.getId())&#123;</div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.newpassword_back_button:</div><div class=\"line\">        <span class=\"keyword\">this</span>.startActivity(homescreen_intent);</div><div class=\"line\">        NewPassword.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.newpassword_save_button:</div><div class=\"line\">        <span class=\"keyword\">if</span>(validate_password(</div><div class=\"line\">              new_password_field.getText().toString().trim(),</div><div class=\"line\">              confirm_password_field.getText().toString().trim()</div><div class=\"line\">              ))&#123;</div><div class=\"line\">          <span class=\"keyword\">this</span>.startActivity(homescreen_intent);</div><div class=\"line\">          NewPassword.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * When both the new password and the confirmation password</div><div class=\"line\">   * match the new password is saved. Else when the passwords</div><div class=\"line\">   * don't match or are empty an error message is displayed.</div><div class=\"line\">   * <span class=\"doctag\">@return</span> true if both password fields match else false</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> Boolean <span class=\"title\">validate_password</span><span class=\"params\">(String new_password_value,</span></span></div><div class=\"line\">      String confirm_password_value)&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>(!new_password_value.equals(confirm_password_value))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your Passwords do not match\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(new_password_value.equals(<span class=\"string\">\"\"</span>) &amp;&amp;</div><div class=\"line\">        new_password_value.equals(<span class=\"string\">\"\"</span>))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your Passwords cannot be empty\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">      password_db.set_password(new_password_value);</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your new password was saved!\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>If you pay enough attention to the newpassword xml and Java code behind you’ll have no trouble at all with the resetpassword code as its very similar.<br>We’ll begin with the layout for the resetpassword code, so create the file “resetpassword.xml” within the res/layout/ folder of your project.<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">RelativeLayout</span></span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_relative_layout\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span> </span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_old_password_text\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/resetpassword_old_text\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> </span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_old_password_edit\"</span> </div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/resetpassword_old_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_old_password_text\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:maxLength</span>=<span class=\"string\">\"10\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span> </span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_new_password_text\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/resetpassword_new_text\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_old_password_edit\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> </span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_new_password_edit\"</span> </div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/resetpassword_new_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_new_password_text\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:maxLength</span>=<span class=\"string\">\"10\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span> </span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_confirm_password_text\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/resetpassword_confirm_text\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_new_password_edit\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> </span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_confirm_password_edit\"</span> </div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/resetpassword_confirm_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_confirm_password_text\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:maxLength</span>=<span class=\"string\">\"10\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_back_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_back\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/resetpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"reset_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_save_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_save\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignRight</span>=<span class=\"string\">\"@id/resetpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"reset_button_click_handler\"</span>/&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>The addition here for the reset password xml layout is the entry for the current or old password. We going to assert that the value entered there must be found within the database before we can create a new transaction to store the value of a new password. Now create the file within the src/ folder of your project called “ResetPassword.java”. I was extra careful to write useful comments within this file so be sure to read them before moving on to the last part.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.example;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.EditText;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Resets the applications' password used to escape from the dialer activity</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ResetPassword</span> <span class=\"keyword\">extends</span> <span class=\"title\">HomeScreen</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> String current_password = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText new_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText confirm_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText old_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/*</span></div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * @see android.app.Activity#onCreate(android.os.Bundle)</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle saved_instance_state)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>.onCreate(saved_instance_state);</div><div class=\"line\">    <span class=\"keyword\">this</span>.setContentView(R.layout.resetpassword);</div><div class=\"line\"></div><div class=\"line\">    current_password = password_db.get_password();</div><div class=\"line\">    new_password_field = (EditText)findViewById(</div><div class=\"line\">        R.id.resetpassword_new_password_edit);</div><div class=\"line\">    confirm_password_field = (EditText)findViewById(</div><div class=\"line\">        R.id.resetpassword_confirm_password_edit);</div><div class=\"line\">    old_password_field = (EditText)findViewById(</div><div class=\"line\">        R.id.resetpassword_old_password_edit);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Manages the button click events for the NewPassword Activity.&lt;br /&gt;</div><div class=\"line\">   * Clicking back returns to the HomeScreen.&lt;br /&gt;</div><div class=\"line\">   * Clicking save will save the password if it passes the validation</div><div class=\"line\">   * check.</div><div class=\"line\">   * <span class=\"doctag\">@param</span> button_clicked</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">reset_button_click_handler</span><span class=\"params\">(View button_clicked)</span></span>&#123;</div><div class=\"line\">    Intent homescreen_intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>.getApplicationContext(),</div><div class=\"line\">        HomeScreen.class);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">switch</span>(button_clicked.getId())&#123;</div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.resetpassword_back_button:</div><div class=\"line\">        <span class=\"keyword\">this</span>.startActivity(homescreen_intent);</div><div class=\"line\">        ResetPassword.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.resetpassword_save_button:</div><div class=\"line\">        <span class=\"keyword\">if</span>(validate_password(</div><div class=\"line\">              old_password_field.getText().toString().trim(),</div><div class=\"line\">              new_password_field.getText().toString().trim(),</div><div class=\"line\">              confirm_password_field.getText().toString().trim()</div><div class=\"line\">              ))&#123;</div><div class=\"line\">          <span class=\"keyword\">this</span>.startActivity(homescreen_intent);</div><div class=\"line\">          ResetPassword.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * When the new password equals the confirmation password</div><div class=\"line\">   * and the old password equals the current password </div><div class=\"line\">   * then the new password is reset. Else when the passwords</div><div class=\"line\">   * don't match or are empty or the old password doesn't match the</div><div class=\"line\">   * current password then an error message is displayed.</div><div class=\"line\">   * <span class=\"doctag\">@return</span> true if both password fields match else false</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> Boolean <span class=\"title\">validate_password</span><span class=\"params\">(String old_password_value,</span></span></div><div class=\"line\">      String new_password_value, String confirm_password_value)&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(!old_password_value.equals(current_password))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your old password is incorrect\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(!new_password_value.equals(confirm_password_value))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your Passwords do not match\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(new_password_value.equals(<span class=\"string\">\"\"</span>) &amp;&amp;</div><div class=\"line\">        confirm_password_value.equals(<span class=\"string\">\"\"</span>))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your Passwords cannot be empty\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">      password_db.reset_password(new_password_value);</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your new password was saved!\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>We are now ready to explore the basics of the Android SQLite API.<br>Within the src folder of your project add the file “PasswordDB.java”.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> android.content.ContentValues;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.Cursor;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.sqlite.SQLiteDatabase;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.sqlite.SQLiteOpenHelper;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Represents the Password Database</div><div class=\"line\"> * <span class=\"doctag\">@author</span> Demetrious</div><div class=\"line\"> *</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PasswordDB</span> <span class=\"keyword\">extends</span> <span class=\"title\">SQLiteOpenHelper</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String db_name = <span class=\"string\">\"PasswordDB\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_table = <span class=\"string\">\"Passwords\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_col_password_number = <span class=\"string\">\"PassNo\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_col_password_value = <span class=\"string\">\"PassVal\"</span>;</div></pre></td></tr></table></figure></p>\n<p>The static strings we declared above represent the name of our database, table and two columns.<br>The password number or PassNo will be the primary key and the string value<br>of the password(this is not a mission critical app so we’re not going to encrpyt it) will be its stored value.</p>\n<p>Next we’ll write the constructor for the database which will create the databasewith the name we gave it within the string db_name.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * </div><div class=\"line\"> * <span class=\"doctag\">@param</span> context</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">PasswordDB</span><span class=\"params\">(Context context)</span> </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">super</span>(context, db_name, <span class=\"keyword\">null</span>, <span class=\"number\">1</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>With our database in place the next step is to create the Table.<br>The code below will accomplish just that, look at the JavaDoc I wrote to see the corresponding SQL.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Invokes the SQL statements below.</div><div class=\"line\"> *  &lt;p&gt;</div><div class=\"line\"> *belowCREATE TABLE IF NOT EXISTS Password( &lt;br /&gt;</div><div class=\"line\"> *brPassNoINTEGER PRIMARY KEY, &lt;br /&gt;</div><div class=\"line\"> *brPassValVARCHAR(10) NOT NULL &lt;br /&gt;</div><div class=\"line\"> *br);</div><div class=\"line\"> * &lt;/p&gt;</div><div class=\"line\"> * (non-Javadoc)</div><div class=\"line\"> * <span class=\"doctag\">@see</span> android.database.sqlite.SQLiteOpenHelper#onCreate(android.database.sqlite.SQLiteDatabase)</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(SQLiteDatabase db)</span> </span>&#123;</div><div class=\"line\">  db.execSQL(<span class=\"string\">\"CREATE TABLE IF NOT EXISTS \"</span> + password_table + <span class=\"string\">\"(\"</span> + </div><div class=\"line\">      password_col_password_number + <span class=\"string\">\" INTEGER PRIMARY KEY,\"</span> +</div><div class=\"line\">      password_col_password_value + <span class=\"string\">\" VARCHAR(10) NOT NULL\"</span> +</div><div class=\"line\">      <span class=\"string\">\");\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The next method onUpgrade() is a required function but we’re not going to actually implement it since we don’t need it for this example.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * (non-Javadoc)</div><div class=\"line\"> * <span class=\"doctag\">@see</span> android.database.sqlite.SQLiteOpenHelper#onUpgrade(android.database.sqlite.SQLiteDatabase, int, int)</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onUpgrade</span><span class=\"params\">(SQLiteDatabase db, <span class=\"keyword\">int</span> oldVersion, </span></span></div><div class=\"line\">    <span class=\"keyword\">int</span> newVersion) &#123;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>We’ll of course need a way to insert a new password into our database.<br>The method set_password does just that. All its doing is calling a basic SQL insert into query but using the Android API helper method insert();<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Inserts a new password into the Password DB via the following SQL.</div><div class=\"line\"> * &lt;p&gt;</div><div class=\"line\"> * INSERT INTO Password (PassVal)&lt;br /&gt;</div><div class=\"line\"> * VALUES('new_password');</div><div class=\"line\"> * &lt;/p&gt;</div><div class=\"line\"> * <span class=\"doctag\">@param</span> new_password</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">set_password</span><span class=\"params\">(String new_password)</span></span>&#123;</div><div class=\"line\">  SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">  ContentValues content_values = <span class=\"keyword\">new</span> ContentValues();</div><div class=\"line\"></div><div class=\"line\">  content_values.put(password_col_password_value, new_password);</div><div class=\"line\"></div><div class=\"line\">  db.insert(password_table, password_col_password_value, </div><div class=\"line\">      content_values);</div><div class=\"line\">  db.close();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Much like a Java property we need a getter to accompany the setter.<br>However here we’ll first write a raw query which will place a cursor at the first result row that was found from our SELECT statement.<br>Database cursors can be though of as table iterators.<br>The cursor will begin at the result table itself, you must first move it to the  result row to begin reading data.<br>Once at a result row you have to move the cursor column by column and read the rrow value from each.<br>Since we are only going to be storing a single password the first row result will always contain the password we want to fetch.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Returns the existing password assuming that one exists via the </div><div class=\"line\"> * following SQL.</div><div class=\"line\"> * &lt;p&gt;</div><div class=\"line\"> * SELECT * &lt;br /&gt;</div><div class=\"line\"> * FROM Passwords &lt;br /&gt;</div><div class=\"line\"> * WHERE PassNo='1';</div><div class=\"line\"> * &lt;/p&gt;</div><div class=\"line\"> * <span class=\"doctag\">@return</span> A String with the current password</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">get_password</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">  SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">  Cursor cursor = db.rawQuery(</div><div class=\"line\">      <span class=\"string\">\"SELECT \"</span> + password_col_password_value +</div><div class=\"line\">      <span class=\"string\">\" FROM \"</span> + password_table +</div><div class=\"line\">      <span class=\"string\">\" WHERE \"</span> + password_col_password_number + <span class=\"string\">\"=\\'1\\';\"</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\"></div><div class=\"line\">  cursor.moveToFirst();</div><div class=\"line\">  Integer column_index = cursor.getColumnIndex(</div><div class=\"line\">      password_col_password_value);</div><div class=\"line\">  String string_value = cursor.getString(column_index);</div><div class=\"line\"></div><div class=\"line\">  cursor.close();</div><div class=\"line\">  db.close();</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> string_value;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now the question becomes how do we update an existing password?<br>To do so we have to use the update() method which is another Android SQLite API wrapper around the traditional SQL UPDATE WHERE statement.<br>Looking at the JavaDoc I wrote you can see how we would write this if it were a regular SQL statement.</p>\n<p>Despite the Android SQL API being a little verbose(this might change in the future) the parameterized input means that we would be safe from any type of injection attacks since we’re not passing a rawQuery from the user input.<br>In short using the parameterized wrapper methods is more code but it saves you from the potential danger of calling rawQueries which substitute in user values.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Updates the existing password based on the following SQL.</div><div class=\"line\"> * &lt;p&gt;</div><div class=\"line\"> *  UPDATE Password &lt;br /&gt;</div><div class=\"line\"> *brSET PassVal='new_password' &lt;br /&gt;</div><div class=\"line\"> *brWHERE PassVal='old_password';</div><div class=\"line\"> * &lt;/p&gt;</div><div class=\"line\"> * <span class=\"doctag\">@param</span> new_password</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">reset_password</span><span class=\"params\">(String new_password)</span></span>&#123;</div><div class=\"line\">  String old_password = get_password();</div><div class=\"line\">  SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\">  ContentValues content_values = <span class=\"keyword\">new</span> ContentValues();</div><div class=\"line\"></div><div class=\"line\">  content_values.put(password_col_password_value, new_password);</div><div class=\"line\"></div><div class=\"line\">  String where_clause = password_col_password_value + <span class=\"string\">\"=?\"</span>;</div><div class=\"line\">  String[] where_args = &#123;old_password&#125;;</div><div class=\"line\">  db.update(password_table, content_values, where_clause, </div><div class=\"line\">      where_args);</div><div class=\"line\"></div><div class=\"line\">  db.close();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Lastly we need a way to verify if a password has been set or not.<br>This will allow us to determine when we need to prompt the user for a reset.<br>Its short and sweet, just run a select query and count the results.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * Uses the following SQL.</div><div class=\"line\">     * &lt;p&gt;</div><div class=\"line\">     * SELECT * &lt;br /&gt;</div><div class=\"line\">     * FROM Passwords &lt;br /&gt;</div><div class=\"line\">     * WHERE PassNo='1';</div><div class=\"line\">     * &lt;/p&gt;</div><div class=\"line\">     * <span class=\"doctag\">@return</span> true if a password exists else false</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">is_password</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">      Cursor cursor = db.rawQuery(</div><div class=\"line\">          <span class=\"string\">\"SELECT \"</span> + password_col_password_value +</div><div class=\"line\">          <span class=\"string\">\" FROM \"</span> + password_table +</div><div class=\"line\">          <span class=\"string\">\" WHERE \"</span> + password_col_password_number + <span class=\"string\">\"=\\'1\\';\"</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>(cursor != <span class=\"keyword\">null</span> &amp;&amp; cursor.getCount() &gt; <span class=\"number\">0</span> )&#123;</div><div class=\"line\">        db.close();</div><div class=\"line\">        cursor.close();</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">        db.close();</div><div class=\"line\">        cursor.close();</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Perhaps you got lost(its better if you followed along closely) but here is the PasswordDB class in full.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Add your package name here!</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.content.ContentValues;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.Cursor;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.sqlite.SQLiteDatabase;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.sqlite.SQLiteOpenHelper;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PasswordDB</span> <span class=\"keyword\">extends</span> <span class=\"title\">SQLiteOpenHelper</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String db_name = <span class=\"string\">\"PasswordDB\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_table = <span class=\"string\">\"Passwords\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_col_password_number = <span class=\"string\">\"PassNo\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_col_password_value = <span class=\"string\">\"PassVal\"</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * </div><div class=\"line\">   * <span class=\"doctag\">@param</span> context</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">PasswordDB</span><span class=\"params\">(Context context)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>(context, db_name, <span class=\"keyword\">null</span>, <span class=\"number\">1</span>);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Invokes the SQL statements below.</div><div class=\"line\">   *  &lt;p&gt;</div><div class=\"line\">   *belowCREATE TABLE IF NOT EXISTS Password( &lt;br /&gt;</div><div class=\"line\">   *brPassNoINTEGER PRIMARY KEY, &lt;br /&gt;</div><div class=\"line\">   *brPassValVARCHAR(10) NOT NULL &lt;br /&gt;</div><div class=\"line\">   *br);</div><div class=\"line\">   * &lt;/p&gt;</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * <span class=\"doctag\">@see</span> android.database.sqlite.SQLiteOpenHelper#onCreate(android.database.sqlite.SQLiteDatabase)</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(SQLiteDatabase db)</span> </span>&#123;</div><div class=\"line\">      db.execSQL(<span class=\"string\">\"CREATE TABLE IF NOT EXISTS \"</span> + password_table + <span class=\"string\">\"(\"</span> + </div><div class=\"line\">          password_col_password_number + <span class=\"string\">\" INTEGER PRIMARY KEY,\"</span> +</div><div class=\"line\">          password_col_password_value + <span class=\"string\">\" VARCHAR(10) NOT NULL\"</span> +</div><div class=\"line\">          <span class=\"string\">\");\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * <span class=\"doctag\">@see</span> android.database.sqlite.SQLiteOpenHelper#onUpgrade(android.database.sqlite.SQLiteDatabase, int, int)</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onUpgrade</span><span class=\"params\">(SQLiteDatabase db, <span class=\"keyword\">int</span> oldVersion, </span></span></div><div class=\"line\">        <span class=\"keyword\">int</span> newVersion) &#123;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Inserts a new password into the Password DB via the following SQL.</div><div class=\"line\">   * &lt;p&gt;</div><div class=\"line\">   * INSERT INTO Password (PassVal)&lt;br /&gt;</div><div class=\"line\">   * VALUES('new_password');</div><div class=\"line\">   * &lt;/p&gt;</div><div class=\"line\">   * <span class=\"doctag\">@param</span> new_password</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">set_password</span><span class=\"params\">(String new_password)</span></span>&#123;</div><div class=\"line\">    SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">    ContentValues content_values = <span class=\"keyword\">new</span> ContentValues();</div><div class=\"line\"></div><div class=\"line\">    content_values.put(password_col_password_value, new_password);</div><div class=\"line\"></div><div class=\"line\">    db.insert(password_table, password_col_password_value, </div><div class=\"line\">        content_values);</div><div class=\"line\">    db.close();</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Returns the existing password assuming that one exists via the </div><div class=\"line\">   * following SQL.</div><div class=\"line\">   * &lt;p&gt;</div><div class=\"line\">   * SELECT * &lt;br /&gt;</div><div class=\"line\">   * FROM Passwords &lt;br /&gt;</div><div class=\"line\">   * WHERE PassNo='1';</div><div class=\"line\">   * &lt;/p&gt;</div><div class=\"line\">   * <span class=\"doctag\">@return</span> A String with the current password</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">get_password</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">    Cursor cursor = db.rawQuery(</div><div class=\"line\">        <span class=\"string\">\"SELECT \"</span> + password_col_password_value +</div><div class=\"line\">        <span class=\"string\">\" FROM \"</span> + password_table +</div><div class=\"line\">        <span class=\"string\">\" WHERE \"</span> + password_col_password_number + <span class=\"string\">\"=\\'1\\';\"</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\"></div><div class=\"line\">    cursor.moveToFirst();</div><div class=\"line\">    Integer column_index = cursor.getColumnIndex(</div><div class=\"line\">        password_col_password_value);</div><div class=\"line\">    String string_value = cursor.getString(column_index);</div><div class=\"line\"></div><div class=\"line\">    cursor.close();</div><div class=\"line\">    db.close();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> string_value;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Updates the existing password based on the following SQL.</div><div class=\"line\">   * &lt;p&gt;</div><div class=\"line\">   *  UPDATE Password &lt;br /&gt;</div><div class=\"line\">   *brSET PassVal='new_password' &lt;br /&gt;</div><div class=\"line\">   *brWHERE PassVal='old_password';</div><div class=\"line\">   * &lt;/p&gt;</div><div class=\"line\">   * <span class=\"doctag\">@param</span> new_password</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">reset_password</span><span class=\"params\">(String new_password)</span></span>&#123;</div><div class=\"line\">    String old_password = get_password();</div><div class=\"line\">    SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\">    ContentValues content_values = <span class=\"keyword\">new</span> ContentValues();</div><div class=\"line\"></div><div class=\"line\">    content_values.put(password_col_password_value, new_password);</div><div class=\"line\"></div><div class=\"line\">    String where_clause = password_col_password_value + <span class=\"string\">\"=?\"</span>;</div><div class=\"line\">    String[] where_args = &#123;old_password&#125;;</div><div class=\"line\">    db.update(password_table, content_values, where_clause, </div><div class=\"line\">        where_args);</div><div class=\"line\"></div><div class=\"line\">    db.close();</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</span></div><div class=\"line\">   * Uses the following SQL.</div><div class=\"line\">   * &lt;p&gt;</div><div class=\"line\">   * SELECT * &lt;br /&gt;</div><div class=\"line\">   * FROM Passwords &lt;br /&gt;</div><div class=\"line\">   * WHERE PassNo='1';</div><div class=\"line\">   * &lt;/p&gt;</div><div class=\"line\">   * <span class=\"doctag\">@return</span> true if a password exists else false</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">is_password</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">    Cursor cursor = db.rawQuery(</div><div class=\"line\">        <span class=\"string\">\"SELECT \"</span> + password_col_password_value +</div><div class=\"line\">        <span class=\"string\">\" FROM \"</span> + password_table +</div><div class=\"line\">        <span class=\"string\">\" WHERE \"</span> + password_col_password_number + <span class=\"string\">\"=\\'1\\';\"</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>(cursor != <span class=\"keyword\">null</span> &amp;&amp; cursor.getCount() &gt; <span class=\"number\">0</span> )&#123;</div><div class=\"line\">      db.close();</div><div class=\"line\">      cursor.close();</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">      db.close();</div><div class=\"line\">      cursor.close();</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>So there you go, an Android application that makes use of the SQLite API. Perhaps you can extend this application or something.</p>\n<p>Anyways… enjoy your guestDialer app. </p>\n","site":{"data":{}},"excerpt":"","more":"<p>In this tutorial we’ll step through the process of using the Android’s builtin support for SqlLite to store a password and retrive it in a rather interesting attempt at creating a guest dialer application. When I first imagined a guest dialer I had in mind an application that would allow you to let someone use your phone without giving them total access to your incomming messages and other sensitive data. However, a lock-in application basically classifies as a virus when you think about it so whatever… at least I learned about the SqlLite api ^_^.</p>\n<p>Before begining this tutorial make sure you have the following… </p>\n<ul>\n<li>Java runtime and SDK installed</li>\n<li>Android SDK</li>\n<li>Some IDE which supports Android development such as Eclipse or IntelliJ IDEA(the free community edition can be used for Android Dev)</li>\n<li>Some familiarity at least(not much don’t worry) with Android Development</li>\n</ul>\n<p>Within your IDE of choice create a new Android project and call it Secure Dialer(actually you can name it whatever but I’ll just refer to it as Secure Dialer throughout this tutorial).</p>\n<p>Now locate the pre configured file called “AndroidManifest.xml”.<br>The AndroidManifest file is the standard configuration file for Android applications.<br>Its where you determine which permissions you demand from the phone OS as well as where you setup the various activity screens and many other things.<br>Just think of the AndroidManifest as the app’s system profile if that helps.<br>To start us off lets declare the permissions we need the end user to accept in order for our application to function correctly.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">manifest</span> </div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">package</span>=<span class=\"string\">\"org.secure.dialer\"</span></div><div class=\"line\"><span class=\"attr\">android:versionCode</span>=<span class=\"string\">\"1\"</span></div><div class=\"line\"><span class=\"attr\">android:versionName</span>=<span class=\"string\">\"1.0\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-sdk</span> <span class=\"attr\">android:minSdkVersion</span>=<span class=\"string\">\"8\"</span> /&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> </div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.CALL_PHONE\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">uses-permission</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> </div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.READ_PHONE_STATE\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">uses-permission</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Next we’ll fill out the <application> element; this is the element where we can declare<br>the activities and setup any intent-filters which we might need as well.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">application</span> </div><div class=\"line\"><span class=\"attr\">android:icon</span>=<span class=\"string\">\"@drawable/icon\"</span> </div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/app_name\"</span> </div><div class=\"line\"><span class=\"attr\">android:debuggable</span>=<span class=\"string\">\"true\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\".HomeScreen\"</span></div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/homescreen_label\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">intent-filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.intent.action.MAIN\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">category</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.intent.category.LAUNCHER\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">intent-filter</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\".Dialer\"</span></div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/dialer_label\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\".NewPassword\"</span></div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/newpassword_label\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></div><div class=\"line\"><span class=\"attr\">android:name</span>=<span class=\"string\">\".ResetPassword\"</span></div><div class=\"line\"><span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/resetpassword_label\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">application</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">manifest</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Now go ahead and save the new AndroidManifest.xml with our changes in place.<br>Next up is the resource file strings.xml.</p>\n<p>strings.xml if you need a refresher is a special resource file that is standard across Androidapps because its the file where you define all of the text strings which will appear throughout your app.</p>\n<p>Although is practical to define strings within the .java files its considered good Android development practice to keep as many of the applications strings within the strings.xml.</p>\n<p>You might think its crazy but for large applications it makes updating text notfications a piece of cake.<br>So navigate within your IDE to res/values/strings.xml or create the file if it doesn’t exist.<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"app_name\"</span>&gt;</span>SecureDialer<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"homescreen_label\"</span>&gt;</span>Homescreen Activity<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"homescreen_dialer\"</span>&gt;</span>Dialer<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"homescreen_password\"</span>&gt;</span>Password<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"homescreen_exit\"</span>&gt;</span>Exit<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_label\"</span>&gt;</span>Newpassword Activity<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_new_text\"</span>&gt;</span>Enter new password:<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_confirm_text\"</span>&gt;</span>Repeat the password:<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_new_hint\"</span>&gt;</span>Type new password here<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_confirm_hint\"</span>&gt;</span>Repeat password here<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_back\"</span>&gt;</span>Back<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"newpassword_save\"</span>&gt;</span>Save<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_label\"</span>&gt;</span>Resetpassword Activity<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_old_text\"</span>&gt;</span>Enter old password:<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_old_hint\"</span>&gt;</span>Type old password here<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_new_text\"</span>&gt;</span>Enter new password:<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_new_hint\"</span>&gt;</span>Type new password here<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_confirm_text\"</span>&gt;</span>Confirm password:<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"resetpassword_confirm_hint\"</span>&gt;</span>Repeat password here<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialer_label\"</span>&gt;</span>Dialer Activity<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialer_dial\"</span>&gt;</span>Dial<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialer_clear\"</span>&gt;</span>Clear<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialer_done\"</span>&gt;</span>Done<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialerpassword_enter\"</span>&gt;</span>Enter<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dialerpassword_nevermind\"</span>&gt;</span>Nevermind<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>Remember all of those @string/some_name values within the AndroidManifest.xml?<br>Well that is how we reference the values stored within res/strings.xml.</p>\n<p>Moving along next create the Java class file HomeScreen within your applications src folder if you want to follow along with the code I have it under <div>src/org/secure/dialer/HomeScreen.java.</div><br>Don’t worry about all of those string values you just typed or pasted we’ll use them shortly as we introduce each activity screen.</p>\n<p>As is normal with Android development we will first create the visual layouts and then once all our buttons and views are setup we then add Java to support the various actions we want to allow our users to make.</p>\n<p>Be warned though that this style of visuals first and then application logic might sound strange if you’re comming from a web development MVC or MVVM background in which you first design your Models before hooking up controller logic before finnally designing a UI; but don’t let it get to you too much because you’ll see how its much easier for you to structure your Java code since you basically build application logic on top of objects created from your visual layout.</p>\n<p>But enough chit chat, create a new file “homescreen.xml” within <div>/res/layout/</div></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"comment\">&lt;!-- </div><div class=\"line\">A great tutorial on how to design button themes</div><div class=\"line\">http://blog.androgames.net/40/custom-button-style-and-theme/</div><div class=\"line\">--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">RelativeLayout</span> </div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/homescreen_relative_layout\"</span></div><div class=\"line\"><span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"fill_parent\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/homescreen_dialer_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/homescreen_dialer\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"homescreen_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/homescreen_password_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/homescreen_dialer_button\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/homescreen_password\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"homescreen_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/homescreen_exit_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/homescreen_password_button\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/homescreen_exit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"homescreen_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>The homescreen is fairly basic it will just appear as three buttons vertically tiled.<br>When we get to the code for the homescreen you’ll see how easily you hookup code to support the android:onClick= tags from your xml file.</p>\n<p>Now create the Java class file “HomeScreen.java” within your project’s src/ folder.<br>Here you’ll also notice a class called “PasswordDB” created, that is the object representation of our SQLite database which is the focus of the article and we’ll cover it in depth later on.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.example;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.app.Activity;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.Toast;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeScreen</span> <span class=\"keyword\">extends</span> <span class=\"title\">Activity</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">protected</span> PasswordDB password_db;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * <span class=\"doctag\">@see</span> android.app.Activity#onCreate(android.os.Bundle)</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle saved_instance_state)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>.onCreate(saved_instance_state);</div><div class=\"line\">    <span class=\"keyword\">this</span>.setContentView(R.layout.homescreen);</div><div class=\"line\">    password_db = <span class=\"keyword\">new</span> PasswordDB(<span class=\"keyword\">this</span>);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Manages the button click events for the HomeScreen Activity.&lt;br /&gt;</div><div class=\"line\">   * Clicking exit terminates the app.&lt;br /&gt;</div><div class=\"line\">   * Clicking password launches either the newpassword or resetpassword</div><div class=\"line\">   * activity depending on whether a password is currently stored.&lt;br /&gt;</div><div class=\"line\">   * Clicking dialer launches the dialer activity.</div><div class=\"line\">   * <span class=\"doctag\">@param</span> button_clicked</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">homescreen_button_click_handler</span><span class=\"params\">(View button_clicked)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">switch</span>(button_clicked.getId())&#123;</div><div class=\"line\">      Boolean password_found = password_db.is_password();</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.homescreen_exit_button:</div><div class=\"line\">      HomeScreen.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">      <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.homescreen_password_button:</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>(!password_found)&#123;</div><div class=\"line\">        Intent new_password_intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>.getApplicationContext(), NewPassword.class);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">this</span>.startActivity(new_password_intent);</div><div class=\"line\">        HomeScreen.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">        Intent reset_password_intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>.getApplicationContext(), ResetPassword.class);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">this</span>.startActivity(reset_password_intent);</div><div class=\"line\">        HomeScreen.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.homescreen_dialer_button:</div><div class=\"line\">      <span class=\"keyword\">if</span>(password_found) &#123;</div><div class=\"line\">        Intent dialer_intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>.getApplicationContext(), Dialer.class);</div><div class=\"line\">        <span class=\"keyword\">this</span>.startActivity(dialer_intent);</div><div class=\"line\">        HomeScreen.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        display_toast(<span class=\"string\">\"No password has been set yet.\"</span>);</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Displays the string passed as a new toast</div><div class=\"line\">   * <span class=\"doctag\">@param</span> message</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">display_toast</span><span class=\"params\">(String message)</span></div><div class=\"line\">  </span>&#123;</div><div class=\"line\">    Toast.makeText(getApplicationContext(), message, Toast.LENGTH_SHORT).show();</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Pay attention to the homescreen_button_click_handler.<br>Remember inside our Homescreen.xml file where we defined the onClick attribute for each of the three buttons?<br>Now you see how easy it is within the Java code to look up the button’s unique id name and write handler code, it just becomes a switch case on the getId() method of the View which generated the click event.<br>To think if you tried it the other way around you would have foolishly built up three different button handler events where we have just a single button_handler for the entire Homescreen.</p>\n<p>This style of design also makes our code very modular; if you wanted to add another button its as easy as popping in another case statement.<br>Looking at the button_click_handler code when the user presses the homescreen_dialer_button we launch the Dialer activity screen… lets do that.<br></p></p>\n<p><p><br>As before we’ll create the dialer layout first, so create the file “dialer.xml” within the layout directory res/layout.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">RelativeLayout</span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_relative_layout\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_number_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:focusable</span>=<span class=\"string\">\"false\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_one\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"1\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_number_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/dialer_number_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_two\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"2\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_number_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_one\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_three\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"3\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_number_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_two\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_four\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"4\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_one\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/dialer_one\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_five\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"5\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_two\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_four\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_six\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"6\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_three\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_five\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_seven\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"7\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_four\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/dialer_four\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_eight\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"8\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_five\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_seven\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_nine\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"9\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_six\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_eight\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_pound\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"#\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_seven\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/dialer_seven\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_zero\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"0\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_eight\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_pound\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_star\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"*\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_nine\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_toRightOf</span>=<span class=\"string\">\"@id/dialer_zero\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_dial_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/dialer_dial\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_pound\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignParentLeft</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_clear_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/dialer_clear\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_star\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignParentRight</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialer_done_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/dialer_done\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialer_dial_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_centerHorizontal</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>As you can guess all of the numerical button are what you should expect from a phone dialer.<br>Of intrest is the non-focusable editbox where the phonenumber will be displayed as the user types and the three buttons near the bottom; dial, clear and done.<br>The layout as you can see is rather plain but the interesting bits will come next when we add the Java code.<br>However before that we need to creat the layout for the password prompt which will display once the guest has finished making a call and might potentially have the chance to muck around with your phone.</p>\n<p>Add the file “dialerpassword.xml” to the res/layout folder.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">RelativeLayout</span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialerpassword_relative_layout\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialerpassword_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/newpassword_confirm_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialerpassword_enter_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/dialerpassword_enter\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialerpassword_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/dialerpassword_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/dialerpassword_nevermind_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/dialerpassword_nevermind\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/dialerpassword_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignRight</span>=<span class=\"string\">\"@id/dialerpassword_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"dialer_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Finally create the Java class file “Dialer.java” and place it within your src/ folder.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div><div class=\"line\">303</div><div class=\"line\">304</div><div class=\"line\">305</div><div class=\"line\">306</div><div class=\"line\">307</div><div class=\"line\">308</div><div class=\"line\">309</div><div class=\"line\">310</div><div class=\"line\">311</div><div class=\"line\">312</div><div class=\"line\">313</div><div class=\"line\">314</div><div class=\"line\">315</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.example;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.app.Dialog;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.net.Uri;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.telephony.TelephonyManager;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.KeyEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.Window;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.WindowManager;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View.OnClickListener;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.Button;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.EditText;</div><div class=\"line\"><span class=\"keyword\">import</span> android.telephony.PhoneStateListener;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dialer</span> <span class=\"keyword\">extends</span> <span class=\"title\">HomeScreen</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> String current_password = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText dialer_phone_number_field = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> Dialog password_dialog = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText dialog_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> PhoneStateListener phone_state_listener = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> TelephonyManager telephony_manager = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/*</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * @see android.app.Activity#onCreate(android.os.Bundle)</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle saved_instance_state)</span></span>&#123;</div><div class=\"line\">    <span class=\"comment\">// Hides both the title and status bar</span></div><div class=\"line\">    <span class=\"comment\">// Must be called calling super.onCreate()</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.requestWindowFeature(Window.FEATURE_NO_TITLE);</div><div class=\"line\">    getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,</div><div class=\"line\">        WindowManager.LayoutParams.FLAG_FULLSCREEN);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">super</span>.onCreate(saved_instance_state);</div><div class=\"line\">    <span class=\"keyword\">this</span>.setContentView(R.layout.dialer);</div><div class=\"line\"></div><div class=\"line\">    current_password = password_db.get_password();</div><div class=\"line\">    dialer_phone_number_field = (EditText)findViewById(R.id.dialer_number_edit);</div><div class=\"line\">    phone_state_listener = <span class=\"keyword\">new</span> CallEndedListener();</div><div class=\"line\">    telephony_manager = (TelephonyManager) <span class=\"keyword\">this</span>.getSystemService(TELEPHONY_SERVICE);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Manages the button click events for the HomeScreen Activity.&lt;br /&gt;</div><div class=\"line\">   * Clicking the numpad adds the number to the dial box&lt;br /&gt;</div><div class=\"line\">   * Clicking dial calls the number within the dial box&lt;br /&gt;</div><div class=\"line\">   * Clicking clear erases the dial box&lt;br /&gt;</div><div class=\"line\">   * Clicking done prompts for the password&lt;br /&gt;</div><div class=\"line\">   * <span class=\"doctag\">@param</span> button_clicked</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dialer_button_click_handler</span><span class=\"params\">(View button_clicked)</span></span>&#123;</div><div class=\"line\">    StringBuilder phone_number = <span class=\"keyword\">new</span> StringBuilder();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">switch</span>(button_clicked.getId())&#123;</div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_one:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'1'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_two:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'2'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_three:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'3'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_four:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'4'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_five:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'5'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_six:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'6'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_seven:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'7'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_eight:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'8'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_nine:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'9'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_zero:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'0'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_star:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'*'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_pound:</div><div class=\"line\">        phone_number.append(<span class=\"string\">'#'</span>);</div><div class=\"line\">        dialer_phone_number_field.append(phone_number);</div><div class=\"line\">        phone_number.deleteCharAt(<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// Copies the phone_number_field to a StringBuilder,</span></div><div class=\"line\">        <span class=\"comment\">// deletes the last digit and dumps the StringBuilder</span></div><div class=\"line\">        <span class=\"comment\">// back to the phone_number_field</span></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_clear_button:</div><div class=\"line\">        <span class=\"keyword\">if</span>(!dialer_phone_number_field.getText().toString().equals(<span class=\"string\">\"\"</span>))&#123;</div><div class=\"line\">          <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; dialer_phone_number_field.getText().toString().length(); ++i)&#123;</div><div class=\"line\">            phone_number.append(dialer_phone_number_field.getText().toString().charAt(i));</div><div class=\"line\">          &#125;</div><div class=\"line\"></div><div class=\"line\">          phone_number.deleteCharAt(phone_number.length() - <span class=\"number\">1</span>);</div><div class=\"line\">          dialer_phone_number_field.setText(phone_number.toString());</div><div class=\"line\">          phone_number.setLength(<span class=\"number\">0</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// Launches the dialog box prompting for the new password</span></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_done_button:</div><div class=\"line\">        password_dialog = make_password_dialog(<span class=\"keyword\">this</span>);</div><div class=\"line\">        password_dialog.show();</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.dialer_dial_button:</div><div class=\"line\">        <span class=\"keyword\">if</span>(dialer_phone_number_field.getText().toString().equals(<span class=\"string\">\"\"</span>))&#123;</div><div class=\"line\">          display_toast(<span class=\"string\">\"Enter a phone number to dial\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">          perform_dial();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Creates a dialog for the password confirmation</div><div class=\"line\">   * <span class=\"doctag\">@param</span> context</div><div class=\"line\">   * <span class=\"doctag\">@return</span></div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Dialog <span class=\"title\">make_password_dialog</span><span class=\"params\">(Context context)</span></span>&#123;</div><div class=\"line\">    Dialog dialog = <span class=\"keyword\">new</span> Dialog(context);</div><div class=\"line\"></div><div class=\"line\">    dialog.setContentView(R.layout.dialerpassword);</div><div class=\"line\">    dialog.setTitle(<span class=\"string\">\"Password?\"</span>);</div><div class=\"line\">    dialog.setCancelable(<span class=\"keyword\">true</span>);</div><div class=\"line\"></div><div class=\"line\">    dialog_password_field = (EditText)dialog.findViewById(R.id.dialerpassword_password_edit);</div><div class=\"line\">    Button dialog_enter = (Button)dialog.findViewById(R.id.dialerpassword_enter_button);</div><div class=\"line\">    dialog_enter.setOnClickListener(dialog_click_listener);</div><div class=\"line\">    Button dialog_nevermind = (Button)dialog.findViewById(R.id.dialerpassword_nevermind_button);</div><div class=\"line\">    dialog_nevermind.setOnClickListener(dialog_click_listener);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> dialog;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Custom View.OnClickListener interface for the password</div><div class=\"line\">   * dialog buttons.</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"keyword\">public</span> OnClickListener dialog_click_listener = <span class=\"keyword\">new</span> View.OnClickListener()&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</div><div class=\"line\">     * Clicking nevermind closes the dialog menu&lt;br /&gt;</div><div class=\"line\">     * Clicking done validates the password entered.</div><div class=\"line\">     * (non-Javadoc)</div><div class=\"line\">     * <span class=\"doctag\">@see</span> android.view.View.OnClickListener#onClick(android.view.View)</div><div class=\"line\">     */</span></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onClick</span><span class=\"params\">(View button_clicked)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">switch</span>(button_clicked.getId())&#123;</div><div class=\"line\">          <span class=\"keyword\">case</span> R.id.dialerpassword_nevermind_button:</div><div class=\"line\">            password_dialog.dismiss();</div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">          <span class=\"keyword\">case</span> R.id.dialerpassword_enter_button:</div><div class=\"line\">            <span class=\"keyword\">if</span>(validate_password(dialog_password_field.getText().toString().trim()))&#123;</div><div class=\"line\">              password_dialog.dismiss();</div><div class=\"line\">              Intent homescreen_intent = <span class=\"keyword\">new</span> Intent(getApplicationContext(), HomeScreen.class);</div><div class=\"line\">              startActivity(homescreen_intent);</div><div class=\"line\">              Dialer.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Validates the password typed by the user to check if it</div><div class=\"line\">   * matches the current password stored in the database.</div><div class=\"line\">   * <span class=\"doctag\">@param</span> password_value</div><div class=\"line\">   * <span class=\"doctag\">@return</span> true if the password was valid</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> Boolean <span class=\"title\">validate_password</span><span class=\"params\">(String password_value)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(!password_value.equals(current_password))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Incorrect password!\"</span>);</div><div class=\"line\">      <span class=\"keyword\">this</span>.dialog_password_field.setText(<span class=\"string\">\"\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * A small hack to disable the back button</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * <span class=\"doctag\">@see</span> android.app.Activity#onBackPressed()</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onBackPressed</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"The back button is disabled\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Lets the user call using the dial button</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * <span class=\"doctag\">@see</span> android.app.Activity#onKeyDown(int, android.view.KeyEvent)</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onKeyDown</span><span class=\"params\">(<span class=\"keyword\">int</span> keyCode, KeyEvent event)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(keyCode == KeyEvent.KEYCODE_CALL)&#123;</div><div class=\"line\">      perform_dial();</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Dials the desired phone number and creates a listener to</div><div class=\"line\">   * to capture the state when the phone call has ended.</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">perform_dial</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(dialer_phone_number_field != <span class=\"keyword\">null</span>)&#123;</div><div class=\"line\">      <span class=\"keyword\">try</span>&#123;</div><div class=\"line\">        telephony_manager.listen(phone_state_listener, PhoneStateListener.LISTEN_CALL_STATE);</div><div class=\"line\">        Intent phone_call = <span class=\"keyword\">new</span> Intent(Intent.ACTION_CALL,</div><div class=\"line\">            Uri.parse(<span class=\"string\">\"tel:\"</span> + dialer_phone_number_field.getText()));</div><div class=\"line\">        startActivity(phone_call);</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">catch</span>(Exception error)&#123;</div><div class=\"line\">        error.printStackTrace();</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   *</div><div class=\"line\">   * <span class=\"doctag\">@author</span> Alex Bredariol Grilo</div><div class=\"line\">   * &#123;<span class=\"doctag\">@link</span> www.umamao.com&#125;</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallEndedListener</span> <span class=\"keyword\">extends</span> <span class=\"title\">PhoneStateListener</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> called = <span class=\"keyword\">false</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/* Waits until the phone call is done and restarts the activity.</div><div class=\"line\">     *</div><div class=\"line\">     * (non-Javadoc)</div><div class=\"line\">     * @see android.telephony.PhoneStateListener#onCallStateChanged(int, java.lang.String)</div><div class=\"line\">     */</span></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCallStateChanged</span><span class=\"params\">(<span class=\"keyword\">int</span> state, String incoming_number)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>(called &amp;&amp; state == TelephonyManager.CALL_STATE_IDLE)&#123;</div><div class=\"line\">          called = <span class=\"keyword\">false</span>;</div><div class=\"line\"></div><div class=\"line\">          telephony_manager.listen(<span class=\"keyword\">this</span>,</div><div class=\"line\">              PhoneStateListener.LISTEN_NONE);</div><div class=\"line\"></div><div class=\"line\">          <span class=\"keyword\">try</span>&#123;</div><div class=\"line\">            Dialer.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">            Intent dialer_restart = <span class=\"keyword\">new</span> Intent(Dialer.<span class=\"keyword\">this</span>, Dialer.class);</div><div class=\"line\">            dialer_restart.setAction(Intent.ACTION_MAIN);</div><div class=\"line\">            startActivity(dialer_restart);</div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"keyword\">catch</span>(Exception e)&#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">          &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">          <span class=\"comment\">// When the phone is not in idle mode it is currently</span></div><div class=\"line\">          <span class=\"comment\">// in use</span></div><div class=\"line\">          <span class=\"keyword\">if</span>(state == TelephonyManager.CALL_STATE_OFFHOOK)&#123;</div><div class=\"line\">            called = <span class=\"keyword\">true</span>;</div><div class=\"line\">          &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Stepping through the code for the Dialer class you’ll notice that its relatively simple.<br>Since the activity is once again button based the meat of the code involves deciding what we should do once each button handler event is triggered.</p>\n<p>A quick thing to notice is that the Dialer class we defined extends the HomeScreen where we intialized the password database object; so all of the password interaction is due to our great use of inheritance.</p>\n<p>Anyhow the basic idea for the Dialer activity is the following…</p>\n<ol>\n<li>Pressing the numeric keys lets the user enter a phonenumber</li>\n<li>The clear button should delete a numeric character one at a time</li>\n<li>Dial… makes a phonecall</li>\n<li>Done should prompt the user for a password, if correct unlocks the app</li>\n</ol>\n<p>What you’ll notice here is that the prompting for a password is how we make the dialer somewhat secure. If the wrong one is entered the user should theorectically have no other access to your phone meaning they can’t touch your apps, peek at your emails or do anything else.<br>Looking at the code you’ll see the function make_password_dialog() which creates the kinda mini embedded activity when the user triggers the dialer_done_button click event.</p>\n<p>The remaining code within the Dialer class involves the TelephonyManager which is the Android API’s way of letting developers controller the actions of the phone listener and receiver.<br>Its rather easy to understand after you force yourself to think of the Phone as advancing across as series of states such as IDLE, OFFHOOK, LISTEN_CALL and create a mental map of those states as you normally talk on the phone. Now we’ll return back to the Homescreen and add in the code to support the new and reset password buttons. </p>\n<p>Each of the buttons will have a layout and Java class file associated. Lets begin with the NewPassword class, create the file “newpassword.xml” within the res/layout folder of your Android project. The xml rather easy to understand as its just a regular enter password and repeat it once type of layout you’ve seen all over the place.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">RelativeLayout</span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_relative_layout\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span> </div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_new_password_text\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_new_text\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> </div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_new_password_edit\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/newpassword_new_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/newpassword_new_password_text\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span> </div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_confirm_password_text\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_confirm_text\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/newpassword_new_password_edit\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> </div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_confirm_password_edit\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/newpassword_confirm_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/newpassword_confirm_password_text\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_back_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_back\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/newpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/newpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"newpassword_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/newpassword_save_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_save\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/newpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignRight</span>=<span class=\"string\">\"@id/newpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"newpassword_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>The Java code should be titled “NewPassword.java” and stored within the src/ folder of your project.<br>The code consist of letting the user enter a password into the editText box, and validate that the repeated value matches the original.<br>Once the validation has been accepted we make a DB transaction and store the password.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.example;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.EditText;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NewPassword</span> <span class=\"keyword\">extends</span> <span class=\"title\">HomeScreen</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> EditText new_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText confirm_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/*</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * @see android.app.Activity#onCreate(android.os.Bundle)</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle saved_instance_state)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>.onCreate(saved_instance_state);</div><div class=\"line\">    <span class=\"keyword\">this</span>.setContentView(R.layout.newpassword);</div><div class=\"line\"></div><div class=\"line\">    new_password_field = (EditText)findViewById(</div><div class=\"line\">        R.id.newpassword_new_password_edit);</div><div class=\"line\">    confirm_password_field = (EditText)findViewById(</div><div class=\"line\">        R.id.newpassword_confirm_password_edit);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Manages the button click events for the NewPassword Activity.&lt;br /&gt;</div><div class=\"line\">   * Clicking back returns to the HomeScreen.&lt;br /&gt;</div><div class=\"line\">   * Clicking save will save the password if it passes the validation</div><div class=\"line\">   * check.</div><div class=\"line\">   * <span class=\"doctag\">@param</span> button_clicked</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">newpassword_button_click_handler</span><span class=\"params\">(View button_clicked)</span></span>&#123;</div><div class=\"line\">    Intent homescreen_intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>.getApplicationContext(),</div><div class=\"line\">        HomeScreen.class);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">switch</span>(button_clicked.getId())&#123;</div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.newpassword_back_button:</div><div class=\"line\">        <span class=\"keyword\">this</span>.startActivity(homescreen_intent);</div><div class=\"line\">        NewPassword.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.newpassword_save_button:</div><div class=\"line\">        <span class=\"keyword\">if</span>(validate_password(</div><div class=\"line\">              new_password_field.getText().toString().trim(),</div><div class=\"line\">              confirm_password_field.getText().toString().trim()</div><div class=\"line\">              ))&#123;</div><div class=\"line\">          <span class=\"keyword\">this</span>.startActivity(homescreen_intent);</div><div class=\"line\">          NewPassword.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * When both the new password and the confirmation password</div><div class=\"line\">   * match the new password is saved. Else when the passwords</div><div class=\"line\">   * don't match or are empty an error message is displayed.</div><div class=\"line\">   * <span class=\"doctag\">@return</span> true if both password fields match else false</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> Boolean <span class=\"title\">validate_password</span><span class=\"params\">(String new_password_value,</div><div class=\"line\">      String confirm_password_value)</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>(!new_password_value.equals(confirm_password_value))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your Passwords do not match\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(new_password_value.equals(<span class=\"string\">\"\"</span>) &amp;&amp;</div><div class=\"line\">        new_password_value.equals(<span class=\"string\">\"\"</span>))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your Passwords cannot be empty\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">      password_db.set_password(new_password_value);</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your new password was saved!\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>If you pay enough attention to the newpassword xml and Java code behind you’ll have no trouble at all with the resetpassword code as its very similar.<br>We’ll begin with the layout for the resetpassword code, so create the file “resetpassword.xml” within the res/layout/ folder of your project.<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">RelativeLayout</span></div><div class=\"line\"><span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_relative_layout\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span> </div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_old_password_text\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/resetpassword_old_text\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> </div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_old_password_edit\"</span> </div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/resetpassword_old_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_old_password_text\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:maxLength</span>=<span class=\"string\">\"10\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span> </div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_new_password_text\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/resetpassword_new_text\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_old_password_edit\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> </div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_new_password_edit\"</span> </div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/resetpassword_new_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_new_password_text\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:maxLength</span>=<span class=\"string\">\"10\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span> </div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_confirm_password_text\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/resetpassword_confirm_text\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_new_password_edit\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> </div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_confirm_password_edit\"</span> </div><div class=\"line\"><span class=\"attr\">android:hint</span>=<span class=\"string\">\"@string/resetpassword_confirm_hint\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"fill_parent\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> </div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_confirm_password_text\"</span></div><div class=\"line\"><span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span></div><div class=\"line\"><span class=\"attr\">android:maxLength</span>=<span class=\"string\">\"10\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_back_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_back\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignLeft</span>=<span class=\"string\">\"@id/resetpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"reset_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></div><div class=\"line\"><span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/resetpassword_save_button\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></div><div class=\"line\"><span class=\"attr\">android:text</span>=<span class=\"string\">\"@string/newpassword_save\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_below</span>=<span class=\"string\">\"@id/resetpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:layout_alignRight</span>=<span class=\"string\">\"@id/resetpassword_confirm_password_edit\"</span></div><div class=\"line\"><span class=\"attr\">android:onClick</span>=<span class=\"string\">\"reset_button_click_handler\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>The addition here for the reset password xml layout is the entry for the current or old password. We going to assert that the value entered there must be found within the database before we can create a new transaction to store the value of a new password. Now create the file within the src/ folder of your project called “ResetPassword.java”. I was extra careful to write useful comments within this file so be sure to read them before moving on to the last part.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.example;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</div><div class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</div><div class=\"line\"><span class=\"keyword\">import</span> android.view.View;</div><div class=\"line\"><span class=\"keyword\">import</span> android.widget.EditText;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * Resets the applications' password used to escape from the dialer activity</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ResetPassword</span> <span class=\"keyword\">extends</span> <span class=\"title\">HomeScreen</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> String current_password = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText new_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText confirm_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> EditText old_password_field = <span class=\"keyword\">null</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/*</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * @see android.app.Activity#onCreate(android.os.Bundle)</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle saved_instance_state)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>.onCreate(saved_instance_state);</div><div class=\"line\">    <span class=\"keyword\">this</span>.setContentView(R.layout.resetpassword);</div><div class=\"line\"></div><div class=\"line\">    current_password = password_db.get_password();</div><div class=\"line\">    new_password_field = (EditText)findViewById(</div><div class=\"line\">        R.id.resetpassword_new_password_edit);</div><div class=\"line\">    confirm_password_field = (EditText)findViewById(</div><div class=\"line\">        R.id.resetpassword_confirm_password_edit);</div><div class=\"line\">    old_password_field = (EditText)findViewById(</div><div class=\"line\">        R.id.resetpassword_old_password_edit);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Manages the button click events for the NewPassword Activity.&lt;br /&gt;</div><div class=\"line\">   * Clicking back returns to the HomeScreen.&lt;br /&gt;</div><div class=\"line\">   * Clicking save will save the password if it passes the validation</div><div class=\"line\">   * check.</div><div class=\"line\">   * <span class=\"doctag\">@param</span> button_clicked</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">reset_button_click_handler</span><span class=\"params\">(View button_clicked)</span></span>&#123;</div><div class=\"line\">    Intent homescreen_intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>.getApplicationContext(),</div><div class=\"line\">        HomeScreen.class);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">switch</span>(button_clicked.getId())&#123;</div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.resetpassword_back_button:</div><div class=\"line\">        <span class=\"keyword\">this</span>.startActivity(homescreen_intent);</div><div class=\"line\">        ResetPassword.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">case</span> R.id.resetpassword_save_button:</div><div class=\"line\">        <span class=\"keyword\">if</span>(validate_password(</div><div class=\"line\">              old_password_field.getText().toString().trim(),</div><div class=\"line\">              new_password_field.getText().toString().trim(),</div><div class=\"line\">              confirm_password_field.getText().toString().trim()</div><div class=\"line\">              ))&#123;</div><div class=\"line\">          <span class=\"keyword\">this</span>.startActivity(homescreen_intent);</div><div class=\"line\">          ResetPassword.<span class=\"keyword\">this</span>.finish();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * When the new password equals the confirmation password</div><div class=\"line\">   * and the old password equals the current password </div><div class=\"line\">   * then the new password is reset. Else when the passwords</div><div class=\"line\">   * don't match or are empty or the old password doesn't match the</div><div class=\"line\">   * current password then an error message is displayed.</div><div class=\"line\">   * <span class=\"doctag\">@return</span> true if both password fields match else false</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> Boolean <span class=\"title\">validate_password</span><span class=\"params\">(String old_password_value,</div><div class=\"line\">      String new_password_value, String confirm_password_value)</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(!old_password_value.equals(current_password))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your old password is incorrect\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(!new_password_value.equals(confirm_password_value))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your Passwords do not match\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(new_password_value.equals(<span class=\"string\">\"\"</span>) &amp;&amp;</div><div class=\"line\">        confirm_password_value.equals(<span class=\"string\">\"\"</span>))&#123;</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your Passwords cannot be empty\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">      password_db.reset_password(new_password_value);</div><div class=\"line\">      display_toast(<span class=\"string\">\"Your new password was saved!\"</span>);</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>We are now ready to explore the basics of the Android SQLite API.<br>Within the src folder of your project add the file “PasswordDB.java”.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> android.content.ContentValues;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.Cursor;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.sqlite.SQLiteDatabase;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.sqlite.SQLiteOpenHelper;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * Represents the Password Database</div><div class=\"line\"> * <span class=\"doctag\">@author</span> Demetrious</div><div class=\"line\"> *</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PasswordDB</span> <span class=\"keyword\">extends</span> <span class=\"title\">SQLiteOpenHelper</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String db_name = <span class=\"string\">\"PasswordDB\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_table = <span class=\"string\">\"Passwords\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_col_password_number = <span class=\"string\">\"PassNo\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_col_password_value = <span class=\"string\">\"PassVal\"</span>;</div></pre></td></tr></table></figure></p>\n<p>The static strings we declared above represent the name of our database, table and two columns.<br>The password number or PassNo will be the primary key and the string value<br>of the password(this is not a mission critical app so we’re not going to encrpyt it) will be its stored value.</p>\n<p>Next we’ll write the constructor for the database which will create the databasewith the name we gave it within the string db_name.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * </div><div class=\"line\"> * <span class=\"doctag\">@param</span> context</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">PasswordDB</span><span class=\"params\">(Context context)</span> </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">super</span>(context, db_name, <span class=\"keyword\">null</span>, <span class=\"number\">1</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>With our database in place the next step is to create the Table.<br>The code below will accomplish just that, look at the JavaDoc I wrote to see the corresponding SQL.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * Invokes the SQL statements below.</div><div class=\"line\"> *  &lt;p&gt;</div><div class=\"line\"> *belowCREATE TABLE IF NOT EXISTS Password( &lt;br /&gt;</div><div class=\"line\"> *brPassNoINTEGER PRIMARY KEY, &lt;br /&gt;</div><div class=\"line\"> *brPassValVARCHAR(10) NOT NULL &lt;br /&gt;</div><div class=\"line\"> *br);</div><div class=\"line\"> * &lt;/p&gt;</div><div class=\"line\"> * (non-Javadoc)</div><div class=\"line\"> * <span class=\"doctag\">@see</span> android.database.sqlite.SQLiteOpenHelper#onCreate(android.database.sqlite.SQLiteDatabase)</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(SQLiteDatabase db)</span> </span>&#123;</div><div class=\"line\">  db.execSQL(<span class=\"string\">\"CREATE TABLE IF NOT EXISTS \"</span> + password_table + <span class=\"string\">\"(\"</span> + </div><div class=\"line\">      password_col_password_number + <span class=\"string\">\" INTEGER PRIMARY KEY,\"</span> +</div><div class=\"line\">      password_col_password_value + <span class=\"string\">\" VARCHAR(10) NOT NULL\"</span> +</div><div class=\"line\">      <span class=\"string\">\");\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The next method onUpgrade() is a required function but we’re not going to actually implement it since we don’t need it for this example.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * (non-Javadoc)</div><div class=\"line\"> * <span class=\"doctag\">@see</span> android.database.sqlite.SQLiteOpenHelper#onUpgrade(android.database.sqlite.SQLiteDatabase, int, int)</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onUpgrade</span><span class=\"params\">(SQLiteDatabase db, <span class=\"keyword\">int</span> oldVersion, </div><div class=\"line\">    <span class=\"keyword\">int</span> newVersion)</span> </span>&#123;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>We’ll of course need a way to insert a new password into our database.<br>The method set_password does just that. All its doing is calling a basic SQL insert into query but using the Android API helper method insert();<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * Inserts a new password into the Password DB via the following SQL.</div><div class=\"line\"> * &lt;p&gt;</div><div class=\"line\"> * INSERT INTO Password (PassVal)&lt;br /&gt;</div><div class=\"line\"> * VALUES('new_password');</div><div class=\"line\"> * &lt;/p&gt;</div><div class=\"line\"> * <span class=\"doctag\">@param</span> new_password</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">set_password</span><span class=\"params\">(String new_password)</span></span>&#123;</div><div class=\"line\">  SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">  ContentValues content_values = <span class=\"keyword\">new</span> ContentValues();</div><div class=\"line\"></div><div class=\"line\">  content_values.put(password_col_password_value, new_password);</div><div class=\"line\"></div><div class=\"line\">  db.insert(password_table, password_col_password_value, </div><div class=\"line\">      content_values);</div><div class=\"line\">  db.close();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Much like a Java property we need a getter to accompany the setter.<br>However here we’ll first write a raw query which will place a cursor at the first result row that was found from our SELECT statement.<br>Database cursors can be though of as table iterators.<br>The cursor will begin at the result table itself, you must first move it to the  result row to begin reading data.<br>Once at a result row you have to move the cursor column by column and read the rrow value from each.<br>Since we are only going to be storing a single password the first row result will always contain the password we want to fetch.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * Returns the existing password assuming that one exists via the </div><div class=\"line\"> * following SQL.</div><div class=\"line\"> * &lt;p&gt;</div><div class=\"line\"> * SELECT * &lt;br /&gt;</div><div class=\"line\"> * FROM Passwords &lt;br /&gt;</div><div class=\"line\"> * WHERE PassNo='1';</div><div class=\"line\"> * &lt;/p&gt;</div><div class=\"line\"> * <span class=\"doctag\">@return</span> A String with the current password</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">get_password</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">  SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">  Cursor cursor = db.rawQuery(</div><div class=\"line\">      <span class=\"string\">\"SELECT \"</span> + password_col_password_value +</div><div class=\"line\">      <span class=\"string\">\" FROM \"</span> + password_table +</div><div class=\"line\">      <span class=\"string\">\" WHERE \"</span> + password_col_password_number + <span class=\"string\">\"=\\'1\\';\"</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\"></div><div class=\"line\">  cursor.moveToFirst();</div><div class=\"line\">  Integer column_index = cursor.getColumnIndex(</div><div class=\"line\">      password_col_password_value);</div><div class=\"line\">  String string_value = cursor.getString(column_index);</div><div class=\"line\"></div><div class=\"line\">  cursor.close();</div><div class=\"line\">  db.close();</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> string_value;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now the question becomes how do we update an existing password?<br>To do so we have to use the update() method which is another Android SQLite API wrapper around the traditional SQL UPDATE WHERE statement.<br>Looking at the JavaDoc I wrote you can see how we would write this if it were a regular SQL statement.</p>\n<p>Despite the Android SQL API being a little verbose(this might change in the future) the parameterized input means that we would be safe from any type of injection attacks since we’re not passing a rawQuery from the user input.<br>In short using the parameterized wrapper methods is more code but it saves you from the potential danger of calling rawQueries which substitute in user values.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * Updates the existing password based on the following SQL.</div><div class=\"line\"> * &lt;p&gt;</div><div class=\"line\"> *  UPDATE Password &lt;br /&gt;</div><div class=\"line\"> *brSET PassVal='new_password' &lt;br /&gt;</div><div class=\"line\"> *brWHERE PassVal='old_password';</div><div class=\"line\"> * &lt;/p&gt;</div><div class=\"line\"> * <span class=\"doctag\">@param</span> new_password</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">reset_password</span><span class=\"params\">(String new_password)</span></span>&#123;</div><div class=\"line\">  String old_password = get_password();</div><div class=\"line\">  SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\">  ContentValues content_values = <span class=\"keyword\">new</span> ContentValues();</div><div class=\"line\"></div><div class=\"line\">  content_values.put(password_col_password_value, new_password);</div><div class=\"line\"></div><div class=\"line\">  String where_clause = password_col_password_value + <span class=\"string\">\"=?\"</span>;</div><div class=\"line\">  String[] where_args = &#123;old_password&#125;;</div><div class=\"line\">  db.update(password_table, content_values, where_clause, </div><div class=\"line\">      where_args);</div><div class=\"line\"></div><div class=\"line\">  db.close();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Lastly we need a way to verify if a password has been set or not.<br>This will allow us to determine when we need to prompt the user for a reset.<br>Its short and sweet, just run a select query and count the results.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"comment\">/**</div><div class=\"line\">     * Uses the following SQL.</div><div class=\"line\">     * &lt;p&gt;</div><div class=\"line\">     * SELECT * &lt;br /&gt;</div><div class=\"line\">     * FROM Passwords &lt;br /&gt;</div><div class=\"line\">     * WHERE PassNo='1';</div><div class=\"line\">     * &lt;/p&gt;</div><div class=\"line\">     * <span class=\"doctag\">@return</span> true if a password exists else false</div><div class=\"line\">     */</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">is_password</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">      SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">      Cursor cursor = db.rawQuery(</div><div class=\"line\">          <span class=\"string\">\"SELECT \"</span> + password_col_password_value +</div><div class=\"line\">          <span class=\"string\">\" FROM \"</span> + password_table +</div><div class=\"line\">          <span class=\"string\">\" WHERE \"</span> + password_col_password_number + <span class=\"string\">\"=\\'1\\';\"</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>(cursor != <span class=\"keyword\">null</span> &amp;&amp; cursor.getCount() &gt; <span class=\"number\">0</span> )&#123;</div><div class=\"line\">        db.close();</div><div class=\"line\">        cursor.close();</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">        db.close();</div><div class=\"line\">        cursor.close();</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Perhaps you got lost(its better if you followed along closely) but here is the PasswordDB class in full.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Add your package name here!</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> android.content.ContentValues;</div><div class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.Cursor;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.sqlite.SQLiteDatabase;</div><div class=\"line\"><span class=\"keyword\">import</span> android.database.sqlite.SQLiteOpenHelper;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PasswordDB</span> <span class=\"keyword\">extends</span> <span class=\"title\">SQLiteOpenHelper</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String db_name = <span class=\"string\">\"PasswordDB\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_table = <span class=\"string\">\"Passwords\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_col_password_number = <span class=\"string\">\"PassNo\"</span>;</div><div class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String password_col_password_value = <span class=\"string\">\"PassVal\"</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * </div><div class=\"line\">   * <span class=\"doctag\">@param</span> context</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">PasswordDB</span><span class=\"params\">(Context context)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">super</span>(context, db_name, <span class=\"keyword\">null</span>, <span class=\"number\">1</span>);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Invokes the SQL statements below.</div><div class=\"line\">   *  &lt;p&gt;</div><div class=\"line\">   *belowCREATE TABLE IF NOT EXISTS Password( &lt;br /&gt;</div><div class=\"line\">   *brPassNoINTEGER PRIMARY KEY, &lt;br /&gt;</div><div class=\"line\">   *brPassValVARCHAR(10) NOT NULL &lt;br /&gt;</div><div class=\"line\">   *br);</div><div class=\"line\">   * &lt;/p&gt;</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * <span class=\"doctag\">@see</span> android.database.sqlite.SQLiteOpenHelper#onCreate(android.database.sqlite.SQLiteDatabase)</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(SQLiteDatabase db)</span> </span>&#123;</div><div class=\"line\">      db.execSQL(<span class=\"string\">\"CREATE TABLE IF NOT EXISTS \"</span> + password_table + <span class=\"string\">\"(\"</span> + </div><div class=\"line\">          password_col_password_number + <span class=\"string\">\" INTEGER PRIMARY KEY,\"</span> +</div><div class=\"line\">          password_col_password_value + <span class=\"string\">\" VARCHAR(10) NOT NULL\"</span> +</div><div class=\"line\">          <span class=\"string\">\");\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * (non-Javadoc)</div><div class=\"line\">   * <span class=\"doctag\">@see</span> android.database.sqlite.SQLiteOpenHelper#onUpgrade(android.database.sqlite.SQLiteDatabase, int, int)</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onUpgrade</span><span class=\"params\">(SQLiteDatabase db, <span class=\"keyword\">int</span> oldVersion, </div><div class=\"line\">        <span class=\"keyword\">int</span> newVersion)</span> </span>&#123;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Inserts a new password into the Password DB via the following SQL.</div><div class=\"line\">   * &lt;p&gt;</div><div class=\"line\">   * INSERT INTO Password (PassVal)&lt;br /&gt;</div><div class=\"line\">   * VALUES('new_password');</div><div class=\"line\">   * &lt;/p&gt;</div><div class=\"line\">   * <span class=\"doctag\">@param</span> new_password</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">set_password</span><span class=\"params\">(String new_password)</span></span>&#123;</div><div class=\"line\">    SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">    ContentValues content_values = <span class=\"keyword\">new</span> ContentValues();</div><div class=\"line\"></div><div class=\"line\">    content_values.put(password_col_password_value, new_password);</div><div class=\"line\"></div><div class=\"line\">    db.insert(password_table, password_col_password_value, </div><div class=\"line\">        content_values);</div><div class=\"line\">    db.close();</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Returns the existing password assuming that one exists via the </div><div class=\"line\">   * following SQL.</div><div class=\"line\">   * &lt;p&gt;</div><div class=\"line\">   * SELECT * &lt;br /&gt;</div><div class=\"line\">   * FROM Passwords &lt;br /&gt;</div><div class=\"line\">   * WHERE PassNo='1';</div><div class=\"line\">   * &lt;/p&gt;</div><div class=\"line\">   * <span class=\"doctag\">@return</span> A String with the current password</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">get_password</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">    Cursor cursor = db.rawQuery(</div><div class=\"line\">        <span class=\"string\">\"SELECT \"</span> + password_col_password_value +</div><div class=\"line\">        <span class=\"string\">\" FROM \"</span> + password_table +</div><div class=\"line\">        <span class=\"string\">\" WHERE \"</span> + password_col_password_number + <span class=\"string\">\"=\\'1\\';\"</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\"></div><div class=\"line\">    cursor.moveToFirst();</div><div class=\"line\">    Integer column_index = cursor.getColumnIndex(</div><div class=\"line\">        password_col_password_value);</div><div class=\"line\">    String string_value = cursor.getString(column_index);</div><div class=\"line\"></div><div class=\"line\">    cursor.close();</div><div class=\"line\">    db.close();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> string_value;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Updates the existing password based on the following SQL.</div><div class=\"line\">   * &lt;p&gt;</div><div class=\"line\">   *  UPDATE Password &lt;br /&gt;</div><div class=\"line\">   *brSET PassVal='new_password' &lt;br /&gt;</div><div class=\"line\">   *brWHERE PassVal='old_password';</div><div class=\"line\">   * &lt;/p&gt;</div><div class=\"line\">   * <span class=\"doctag\">@param</span> new_password</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">reset_password</span><span class=\"params\">(String new_password)</span></span>&#123;</div><div class=\"line\">    String old_password = get_password();</div><div class=\"line\">    SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\">    ContentValues content_values = <span class=\"keyword\">new</span> ContentValues();</div><div class=\"line\"></div><div class=\"line\">    content_values.put(password_col_password_value, new_password);</div><div class=\"line\"></div><div class=\"line\">    String where_clause = password_col_password_value + <span class=\"string\">\"=?\"</span>;</div><div class=\"line\">    String[] where_args = &#123;old_password&#125;;</div><div class=\"line\">    db.update(password_table, content_values, where_clause, </div><div class=\"line\">        where_args);</div><div class=\"line\"></div><div class=\"line\">    db.close();</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/**</div><div class=\"line\">   * Uses the following SQL.</div><div class=\"line\">   * &lt;p&gt;</div><div class=\"line\">   * SELECT * &lt;br /&gt;</div><div class=\"line\">   * FROM Passwords &lt;br /&gt;</div><div class=\"line\">   * WHERE PassNo='1';</div><div class=\"line\">   * &lt;/p&gt;</div><div class=\"line\">   * <span class=\"doctag\">@return</span> true if a password exists else false</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">is_password</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">    SQLiteDatabase db = <span class=\"keyword\">this</span>.getWritableDatabase();</div><div class=\"line\"></div><div class=\"line\">    Cursor cursor = db.rawQuery(</div><div class=\"line\">        <span class=\"string\">\"SELECT \"</span> + password_col_password_value +</div><div class=\"line\">        <span class=\"string\">\" FROM \"</span> + password_table +</div><div class=\"line\">        <span class=\"string\">\" WHERE \"</span> + password_col_password_number + <span class=\"string\">\"=\\'1\\';\"</span>, <span class=\"keyword\">null</span>);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>(cursor != <span class=\"keyword\">null</span> &amp;&amp; cursor.getCount() &gt; <span class=\"number\">0</span> )&#123;</div><div class=\"line\">      db.close();</div><div class=\"line\">      cursor.close();</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span>&#123;</div><div class=\"line\">      db.close();</div><div class=\"line\">      cursor.close();</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>So there you go, an Android application that makes use of the SQLite API. Perhaps you can extend this application or something.</p>\n<p>Anyways… enjoy your guestDialer app. </p>\n"},{"title":"Ruby On Rails Blog Project Live Demo","date":"2011-06-10T07:00:00.000Z","_content":"A while ago I decided to get my feet wet with the awesome Ruby On Rails MVC framework for developing dynamic databased backed web applications. In this article you can see a short project I developed that highlights a typical blog you can create using the Ruby On Rails framework.\n\n<p>Last winter I began playing around with the Ruby programming language and seeing whether or not I would like to begin building software in it as opposed to Python or PHP. Well after going through various online tutorials and a spending about 2 months(while I was still in college) reading through a well <a href=\"http://www.amazon.com/Beginning-Ruby-Novice-Professional-Experts/dp/1590597664\">rounded intro book on the Ruby</a> language I decided that it would be best to start learning about the Rails web development framework. So I headed over to the Rails homepage <a href=\"http://rubyonrails.org/\">rubyonrails.org</a> and began going through some more tutorials and finally decided to try out a demo project just to get a more well rounded feeling of the framework that goes beyond simple Rails scaffolds and or 30 minute View-Controller applications that don’t require databases. So without boring you to death the link below is the demo application I built using the Ruby on Rails framework over the course of about eight weeks or so(during my senior year of college and mostly on weekends) at the link below.</p> <p>Click here to see my Rails demo. <b>No longer available</b></a></p> <p><strong><u>The Ruby On Rails Blog is hosted on a server running Apache; so how the heck did I embed a Rails application on an Apache server?</u></strong></p> <p>The answer to this question is <a href=\"http://www.modrails.com/\">a well known Ruby gem called passenger a.k.a mod_rails</a> developed by <a href=\"http://www.phusion.nl/\">Phusion</a>. In short it allows you to deploy a Rails application onto an Apache server with very little additional configuration(only a single file needs to be added along with a symbolic link to the rails/public directory).</p>\n","source":"_posts/rubyonrailsblogdemo.md","raw":"---\ntitle: Ruby On Rails Blog Project Live Demo\ndate: 2011-06-10\ncategories: [ruby-on-rails]\ntags: [ruby, javascript]\n---\nA while ago I decided to get my feet wet with the awesome Ruby On Rails MVC framework for developing dynamic databased backed web applications. In this article you can see a short project I developed that highlights a typical blog you can create using the Ruby On Rails framework.\n\n<p>Last winter I began playing around with the Ruby programming language and seeing whether or not I would like to begin building software in it as opposed to Python or PHP. Well after going through various online tutorials and a spending about 2 months(while I was still in college) reading through a well <a href=\"http://www.amazon.com/Beginning-Ruby-Novice-Professional-Experts/dp/1590597664\">rounded intro book on the Ruby</a> language I decided that it would be best to start learning about the Rails web development framework. So I headed over to the Rails homepage <a href=\"http://rubyonrails.org/\">rubyonrails.org</a> and began going through some more tutorials and finally decided to try out a demo project just to get a more well rounded feeling of the framework that goes beyond simple Rails scaffolds and or 30 minute View-Controller applications that don’t require databases. So without boring you to death the link below is the demo application I built using the Ruby on Rails framework over the course of about eight weeks or so(during my senior year of college and mostly on weekends) at the link below.</p> <p>Click here to see my Rails demo. <b>No longer available</b></a></p> <p><strong><u>The Ruby On Rails Blog is hosted on a server running Apache; so how the heck did I embed a Rails application on an Apache server?</u></strong></p> <p>The answer to this question is <a href=\"http://www.modrails.com/\">a well known Ruby gem called passenger a.k.a mod_rails</a> developed by <a href=\"http://www.phusion.nl/\">Phusion</a>. In short it allows you to deploy a Rails application onto an Apache server with very little additional configuration(only a single file needs to be added along with a symbolic link to the rails/public directory).</p>\n","slug":"rubyonrailsblogdemo","published":1,"updated":"2017-04-12T08:57:48.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr1s000m9uwvgv5yjhho","content":"<p>A while ago I decided to get my feet wet with the awesome Ruby On Rails MVC framework for developing dynamic databased backed web applications. In this article you can see a short project I developed that highlights a typical blog you can create using the Ruby On Rails framework.</p>\n<p>Last winter I began playing around with the Ruby programming language and seeing whether or not I would like to begin building software in it as opposed to Python or PHP. Well after going through various online tutorials and a spending about 2 months(while I was still in college) reading through a well <a href=\"http://www.amazon.com/Beginning-Ruby-Novice-Professional-Experts/dp/1590597664\" target=\"_blank\" rel=\"external\">rounded intro book on the Ruby</a> language I decided that it would be best to start learning about the Rails web development framework. So I headed over to the Rails homepage <a href=\"http://rubyonrails.org/\" target=\"_blank\" rel=\"external\">rubyonrails.org</a> and began going through some more tutorials and finally decided to try out a demo project just to get a more well rounded feeling of the framework that goes beyond simple Rails scaffolds and or 30 minute View-Controller applications that don’t require databases. So without boring you to death the link below is the demo application I built using the Ruby on Rails framework over the course of about eight weeks or so(during my senior year of college and mostly on weekends) at the link below.</p> <p>Click here to see my Rails demo. <b>No longer available</b></p> <p><strong><u>The Ruby On Rails Blog is hosted on a server running Apache; so how the heck did I embed a Rails application on an Apache server?</u></strong></p> <p>The answer to this question is <a href=\"http://www.modrails.com/\" target=\"_blank\" rel=\"external\">a well known Ruby gem called passenger a.k.a mod_rails</a> developed by <a href=\"http://www.phusion.nl/\" target=\"_blank\" rel=\"external\">Phusion</a>. In short it allows you to deploy a Rails application onto an Apache server with very little additional configuration(only a single file needs to be added along with a symbolic link to the rails/public directory).</p>\n","site":{"data":{}},"excerpt":"","more":"<p>A while ago I decided to get my feet wet with the awesome Ruby On Rails MVC framework for developing dynamic databased backed web applications. In this article you can see a short project I developed that highlights a typical blog you can create using the Ruby On Rails framework.</p>\n<p>Last winter I began playing around with the Ruby programming language and seeing whether or not I would like to begin building software in it as opposed to Python or PHP. Well after going through various online tutorials and a spending about 2 months(while I was still in college) reading through a well <a href=\"http://www.amazon.com/Beginning-Ruby-Novice-Professional-Experts/dp/1590597664\">rounded intro book on the Ruby</a> language I decided that it would be best to start learning about the Rails web development framework. So I headed over to the Rails homepage <a href=\"http://rubyonrails.org/\">rubyonrails.org</a> and began going through some more tutorials and finally decided to try out a demo project just to get a more well rounded feeling of the framework that goes beyond simple Rails scaffolds and or 30 minute View-Controller applications that don’t require databases. So without boring you to death the link below is the demo application I built using the Ruby on Rails framework over the course of about eight weeks or so(during my senior year of college and mostly on weekends) at the link below.</p> <p>Click here to see my Rails demo. <b>No longer available</b></a></p> <p><strong><u>The Ruby On Rails Blog is hosted on a server running Apache; so how the heck did I embed a Rails application on an Apache server?</u></strong></p> <p>The answer to this question is <a href=\"http://www.modrails.com/\">a well known Ruby gem called passenger a.k.a mod_rails</a> developed by <a href=\"http://www.phusion.nl/\">Phusion</a>. In short it allows you to deploy a Rails application onto an Apache server with very little additional configuration(only a single file needs to be added along with a symbolic link to the rails/public directory).</p>\n"},{"title":"New project update! A Question and Answer Board using PHP and MongoDB","date":"2012-07-15T07:00:00.000Z","catagories":[],"_content":"QALite is a basic Question and Answer Board that's designed to be embedded within a larger site, it was built using MongoDB and a neat MVC PHP framework called Lithium. If you've ever been curious as to how to create a basic questions and answers site or would just like to see an example of applying MVC to PHP then you should definately check it out.\n\nTo see the source code for this app and read a brief description about the project [visit the Github repo for QALite][link_qalite]\n\n[link_qalite]: https://github.com/taywils/QA-LIte\n","source":"_posts/qalite.md","raw":"---\ntitle: New project update! A Question and Answer Board using PHP and MongoDB\ndate: 2012-07-15\ntags: [php, javascript]\ncatagories: []\n---\nQALite is a basic Question and Answer Board that's designed to be embedded within a larger site, it was built using MongoDB and a neat MVC PHP framework called Lithium. If you've ever been curious as to how to create a basic questions and answers site or would just like to see an example of applying MVC to PHP then you should definately check it out.\n\nTo see the source code for this app and read a brief description about the project [visit the Github repo for QALite][link_qalite]\n\n[link_qalite]: https://github.com/taywils/QA-LIte\n","slug":"qalite","published":1,"updated":"2017-04-15T21:47:55.000Z","_id":"cj1jsmr1u000n9uwvn217gqj1","comments":1,"layout":"post","photos":[],"link":"","content":"<p>QALite is a basic Question and Answer Board that’s designed to be embedded within a larger site, it was built using MongoDB and a neat MVC PHP framework called Lithium. If you’ve ever been curious as to how to create a basic questions and answers site or would just like to see an example of applying MVC to PHP then you should definately check it out.</p>\n<p>To see the source code for this app and read a brief description about the project <a href=\"https://github.com/taywils/QA-LIte\" target=\"_blank\" rel=\"external\">visit the Github repo for QALite</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>QALite is a basic Question and Answer Board that’s designed to be embedded within a larger site, it was built using MongoDB and a neat MVC PHP framework called Lithium. If you’ve ever been curious as to how to create a basic questions and answers site or would just like to see an example of applying MVC to PHP then you should definately check it out.</p>\n<p>To see the source code for this app and read a brief description about the project <a href=\"https://github.com/taywils/QA-LIte\">visit the Github repo for QALite</a></p>\n"},{"title":"Build A Text Based Multiplayer RPG Part I","date":"2011-06-05T07:00:00.000Z","_content":"[Click here for part II][link_part_2]\n\n# Intro\n\nThis is the first article in a multi-part series on how to develop a console based multiplayer MUD style RPG game. By the end of this series you will have a fully working console app that will run a typical client server model desktop application on Windows. This tutorial requires the Microsoft Visual C++ Compiler.\n\n## Review Material\n\n<a href=\"http://cslibrary.stanford.edu/102/\">Click here for a review on pointers if you need to brush up.</a>\n<a href=\"http://www.cprogramming.com/tutorial/stl/iterators.html\">Click here for a review on C++ iterators, if you can’t follow it then read the pointer review first.</a>\n\n## Background\n\nIf you happen to be curious as to what exactly a “text based role playing game(rpg)” is in my own words a text based rpg is simply a game in which the player or players input commands into a terminal and are fed back a description of the actions which took place within the game world. <a href=\"http://en.wikipedia.org/wiki/Online_text-based_role-playing_game\">For more info see the Wikipedia entry on it</a>.\n\nOk, now that we’re all familiar with the concept, lets first review why anyone would even want to build a text-based rpg in todays world of fancy <a href=\"http://us.battle.net/wow/en/\">3D graphics, special effects and semi-realistic computer rendered player models</a>. I believe text based rpgs are a great start for programmers who want to build more serious/professional grade rpgs for several reasons. First, text based rpgs allow programmers to focus purely on the game engine itself without the overhead of graphics and or animation.\n\nSecond, the core of any role playing game relies on the sophistication of its <a href=\"http://en.wikipedia.org/wiki/Role-playing_game_system\">role playing system</a>; or the game mechanics. Without a unique and interesting core system, gamers will quickly dismiss your rpg as a rehash or just another D&D clone.\n\nLastly, from a programming perspective it’s a great excuse to practice data structures, socket programming and object oriented design. In this first part of series we’re going to begin by writing out the code base for the header class which will hold all the definitions for the objects which will appear within our game. However before we even write a single line of code lets first think about how we want all the game objects to fit together. Take a look at the picture below, and take note of all the objects that are identified. We have the <em>player</em>, <em>monster</em>, <em>items</em>, <em>dungeon</em> and <em>terminal </em>objects which are all clearly identified within our simple mock up. Although those won’t be our exact classes that we’ll code in a moment, the rough picture just lets us better understand the model.\n<p style=\"text-align: center;\"><a class=\"lightbox\" href=\"https://s3-us-west-2.amazonaws.com/taywils.me.static.files/images/Simple_C%2B%2B_Part_1_2.png\"><img class=\"aligncenter size-thumbnail wp-image-92\" src=\"https://s3-us-west-2.amazonaws.com/taywils.me.static.files/images/Simple_C%2B%2B_Part_1_2.png\" alt=\"Photo\" width=\"150\" height=\"150\" /></a></p>\n\n## Initial Code\n\nNow lets start coding; call this file <strong>database.h,</strong> why we chose to name it database will be important in the future once we get to the multiplayer aspects of the game but enough talk.\n\n```c\n#include<iostream>\n#include<string>\n#include<list>\n#include<vector>\n#include<map>\n#include<algorithm>\n#include<iterator>\n#include<locale>\n#include<sstream>\n\nusing namespace std ;\n\nnamespace MUD\n{\n  class Player ;\n  class Item ;\n  class Room ;\n  class Dungeon ;\n  class Monster ;\n  class Dispatch ;\n  class Filter ;\n```\n\nOk so now we have our libraries all included and the forward declarations for our classes planned out. Don’t worry about the inclusion of the not so common libraries such as locale, and sstream yet as we’ll introduce them in the future.\n\n\n## Item and Monster Classes\n\nTo start off we begin with the Item class. The item class as you can guess will represent items within our rpg game. Due to this being a simple rpg game we will restrict ourselves to just three types; weapons, armor and health. At this moment you might be wondering why don’t we just make three different classes, one for each item. However, as you can see below, we’ll just stick with this one class and generalize it.\n\n```c\n    class Item\n    {\n      public:\n        enum TYPE { WEAPON, ARMOR, HEALTH } ;\n\n        Item( string name, Item::TYPE type, int power, int vitality, int health ) ;\n        Item operator=( Item& newItem ) ;\n        Item( void ) ;\n        //~Item()\n\n        void setPower( int value ) ;\n        int getPower( void ) ;\n\n        void setVitality( int value ) ;\n        int getVitality( void ) ;\n\n        void setHealth( int value ) ;\n        int getHealth( void ) ;\n\n        void setName( string name ) ;\n        string getName( void ) ;\n\n        void setType( TYPE newType ) ;\n        TYPE getType( void ) ;\n\n        string mName ;\n        int mPower ;\n        int mVitality ;\n        int mHealth ;\n        TYPE mType ;\n        bool mAvailiable ;\n    } ;\n```\n\nThe item class as you can look at above uses six different attributes, name, power, vitality, health, type and availability. We’ll discuss each of those further when we get to writing the actual methods for the class but for now try and think about how each of those attributes relate to the three different enum types or weapon, armor and health. Next, we are going to look at the monster class. This class being as its represents the monsters in our game should meet the following requirements. Monsters should have some measurement of life or hit points, a strength or attack power, a defense rating, a unique name and of course an indicator of whether or not they are currently in combat.\n\n```c\n    class Monster\n    {\n      public:\n        Monster( string name, int maxHp, int strength, int defence ) ;\n        //~Monster() \n\n        void setHp( int newHp ) ;\n        int getHp( void ) ;\n\n        void setStrength( int newStrength ) ;\n        int getStrength( void ) ;\n\n        void setDefence( int newDefence ) ;\n        int getDefence( void ) ;\n\n        void setName( string newName ) ;\n        string getName( void ) ;\n\n        void setMaxHp( int newMaxHp ) ;\n\n        int mMaxHp ;\n        int mHp ;\n        int mStrength ;\n        int mDefence ;\n        string mName ;\n        bool inCombat ;\n    } ;\n```\n\n## The Room Class and Player Classes\n\nFor more sophisticated games our monster class would probably have attributes for magic, speed, steal-able items and experience points rewarded if your into the experience points style of rpgs. But for this simple game; strength, hp and defense will do. Moving along we are ready to begin sketching out the code for the room class. The room class is a class which will represent a single room within our dungeon and will also contain items, monsters and allow players to traverse them. In order to best represent the interconnected nature of the rooms as they would appear in our game setting the data structure of choice will be a simple 4-way(technically 8-way since each rooms allows backtracking) linked list with each direction being the familiar north, south, east and west. When I first designed this application several months ago the room class was by far the most difficult class conceptually since most of the game revolves around traversing the rooms, finding items(within rooms), slaying monsters(again within rooms), updating the state of the player(moving about rooms) and keeping the state of the dungeon intact(managing the rooms). As you can tell the room class is key to this simple game we’re making.\n\n```c\n    class Room\n    {\n      public:\n        Room( string name, string description, Item* item = NULL ) ;\n        //Room( void ) ;\n        //~Room()\n\n        typedef bool success ;\n\n        void addMonster( Monster* newMonster ) ;\n        Monster& getMonsterRef( string monsterName ) ;\n        success killMonster( string monsterName ) ;\n        void itemTaken( void ) ;\n        string searchResponse( void ) ;\n        success link( char direction, Room& room ) ;\n        Room& north( void ) ;\n        Room& south( void ) ;\n        Room& east( void ) ;\n        Room& west( void ) ;\n\n        void setName( string newName ) ;\n\n        void setDescription( string newDescription ) ;\n        string getDescription( void ) ;\n\n        void setItem( Item* newItem ) ;\n\n        Item* mItem ;\n        Room* mNorth ;\n        Room* mSouth ;\n        Room* mEast ;\n        Room* mWest ;\n        list< Monster* > mMonsters ;\n        string mName ;\n        string mDescription ;\n    } ;\n```\n\nNext up is the player class, although for this simple game the player class resembles the monster class to an exceedingly high degree and you might be thinking “why are we not using inheritance from a general base class that has hp, str, def and such”. The answer to that question was due to me having originally planned out the player class to have multiple sub classes representing jobs such wizard, knight, archer, monk, ninja and such and to have different weapons and movement bonuses and so on until I realized that it was getting too large. So I cut all that stuff out and decided to keep things simple.\n\n```c\n    class Player\n    {\n      public:\n        Player( string name, Room* start = NULL ) ;\n        //~Player()\n\n        typedef bool dead ;\n\n        void setHp( int newHp ) ;\n        int getHp( void ) ;\n\n        void setStrength( int newStrength ) ;\n        int getStrength( void ) ;\n\n        void setDefence( int newDefence ) ;\n        int getDefence( void ) ;\n\n        string getLocation( void ) ;\n\n        void setName( string newName ) ;\n        string getName( void ) const ;\n\n        string equip( string itemName ) ;\n        string attack( string monsterName ) ;\n        string move( char direction ) ;\n        string search( void ) ;\n        dead death( void ) ;\n\n        int mMaxHp ;\n        int mHp ;\n        int mStrength ;\n        int mDefence ;\n        Room* mLocation ;\n        string mName ;\n        Item* mWeapon ;\n        Item* mArmor ;\n        dead mLife ;\n    } ;\n```\n\n## The Dungeon Class\n\nNow here is where the class design gets a little tricky. The dungeon class, the class we’re coding next will make use of two std::vector<> objects to hold both the current players and the references to the various rooms within the game. Also an interesting method within the dungeon class which we’ll describe in detail later on in this tutorial series is the combatLoop() method. If you recall from earlier, the player class already has an attack() method so why does the entire dungeon need to be aware of which players are in combat? Remember that the goal of this tutorial is a multiplayer game so important aspects of the dungeon such as which players are alive and which monsters have been slain should be propagated to each player. Ok, so here is the code.\n\n```c\nclass Dungeon\n{\n  public:\n    Dungeon( int maxPlayers, int maxRooms ) ;\n    //~Dungeon()\n\n    bool isComplete( void ) ;\n    string addPlayer( Player* newPlayer ) ;\n    string addRoom( Room* newRoom ) ;\n    string removePlayer( string playerName ) ;\n    void generatePlayerStats( Player* newPlayer ) ;\n    void combatLoop( Player& hero, Monster& villain ) ;\n    string* playerStatus( Player& player ) ;\n    void displayHelp( void ) ;\n\n    int mMaxRooms ;\n    int mMaxPlayers ;\n    vector< Room* > mRooms ;\n    vector< Player* > mPlayers ;\n} ;\n```\n\n## Utility helpers, \"Filter\" and \"Dispatch\"\n\nLastly there are two utility classes I wrote to help facilitate the ever important parsing of the user inputs into the game terminal. Being that this game is text based, players will undoubtedly type in all sorts of crazy commands and awkward inputs. So the design of the two utility classes dispatch and filter were put in place to basically filter all incoming messages to ensure validity and to dispatch valid messages based on a simple protocol I crafted to handle commands. In other words, in order to avoid players attempting to cheat the game say by equipping from rooms which they currently don’t occupy or grabbing all the health items from other players the filter class serves to clean up dirty commands before they even reach the dungeon class.\n\n```c\nclass Filter\n{\n  public:\n    typedef bool valid ;\n\n    valid validateMessage( string message ) ;\n    string chat( string message ) ;\n} ;\n\nclass Dispatch\n{\n  public:\n    char extractCommand( string fromFilter ) ;\n    string extractValue( string fromFilter ) ;\n} ;\n```\n\nOk folks that’s about all for now; just remember to stay tuned for the next parts of this tutorial which I’ll roll out when I get the time.\n\n-Thanks-\n\nOh and here is the whole code if you're in a hurry\n\n```c\n// database.h\n#include<iostream>\n#include<string>\n#include<list>\n#include<vector>\n#include<map>\n#include<algorithm>\n#include<iterator>\n#include<locale>\n#include<sstream>\n\nusing namespace std ;\n\nnamespace MUD\n{\n  class Player ;\n  class Item ;\n  class Room ;\n  class Dungeon ;\n  class Monster ;\n  class Dispatch ;\n  class Filter ;\n\n  class Item\n  {\n    public:\n      enum TYPE { WEAPON, ARMOR, HEALTH } ;\n\n      Item( string name, Item::TYPE type, int power, int vitality, int health ) ;\n      Item operator=( Item& newItem ) ;\n      Item( void ) ;\n      //~Item()\n\n      void setPower( int value ) ;\n      int getPower( void ) ;\n\n      void setVitality( int value ) ;\n      int getVitality( void ) ;\n\n      void setHealth( int value ) ;\n      int getHealth( void ) ;\n\n      void setName( string name ) ;\n      string getName( void ) ;\n\n      void setType( TYPE newType ) ;\n      TYPE getType( void ) ;\n\n      string mName ;\n      int mPower ;\n      int mVitality ;\n      int mHealth ;\n      TYPE mType ;\n      bool mAvailiable ;\n  } ;\n\n  class Monster\n  {\n    public:\n      Monster( string name, int maxHp, int strength, int defence ) ;\n      //~Monster() \n\n      void setHp( int newHp ) ;\n      int getHp( void ) ;\n\n      void setStrength( int newStrength ) ;\n      int getStrength( void ) ;\n\n      void setDefence( int newDefence ) ;\n      int getDefence( void ) ;\n\n      void setName( string newName ) ;\n      string getName( void ) ;\n\n      void setMaxHp( int newMaxHp ) ;\n\n      int mMaxHp ;\n      int mHp ;\n      int mStrength ;\n      int mDefence ;\n      string mName ;\n      bool inCombat ;\n  } ;\n\n  class Room \n  {\n    public:\n      Room( string name, string description, Item* item = NULL ) ;\n      //Room( void ) ;\n      //~Room()\n\n      typedef bool success ;\n\n      void addMonster( Monster* newMonster ) ;\n      Monster& getMonsterRef( string monsterName ) ;\n      success killMonster( string monsterName ) ;\n      void itemTaken( void ) ;\n      string searchResponse( void ) ;\n      success link( char direction, Room& room ) ;\n      Room& north( void ) ;\n      Room& south( void ) ;\n      Room& east( void ) ;\n      Room& west( void ) ;\n\n      void setName( string newName ) ;\n\n      void setDescription( string newDescription ) ;\n      string getDescription( void ) ;\n\n      void setItem( Item* newItem ) ;\n\n      Item* mItem ;\n      Room* mNorth ;\n      Room* mSouth ;\n      Room* mEast ;\n      Room* mWest ;\n      list< Monster* > mMonsters ;\n      string mName ;\n      string mDescription ;\n  } ;\n\n  class Player\n  {\n    public:\n      Player( string name, Room* start = NULL ) ;\n      //~Player()\n\n      typedef bool dead ;\n\n      void setHp( int newHp ) ;\n      int getHp( void ) ;\n\n      void setStrength( int newStrength ) ;\n      int getStrength( void ) ;\n\n      void setDefence( int newDefence ) ;\n      int getDefence( void ) ;\n\n      string getLocation( void ) ;\n\n      void setName( string newName ) ;\n      string getName( void ) const ;\n\n      string equip( string itemName ) ;\n      string attack( string monsterName ) ;\n      string move( char direction ) ;\n      string search( void ) ;\n      dead death( void ) ;\n\n      int mMaxHp ;\n      int mHp ;\n      int mStrength ;\n      int mDefence ;\n      Room* mLocation ;\n      string mName ;\n      Item* mWeapon ;\n      Item* mArmor ;\n      dead mLife ;\n  } ;\n\n  class Dungeon\n  {\n    public:\n      Dungeon( int maxPlayers, int maxRooms ) ;\n      //~Dungeon()\n\n      bool isComplete( void ) ;\n      string addPlayer( Player* newPlayer ) ;\n      string addRoom( Room* newRoom ) ;\n      string removePlayer( string playerName ) ;\n      void generatePlayerStats( Player* newPlayer ) ;\n      void combatLoop( Player& hero, Monster& villain ) ;\n      string* playerStatus( Player& player ) ;\n      void displayHelp( void ) ;\n\n      int mMaxRooms ;\n      int mMaxPlayers ;\n      vector< Room* > mRooms ;\n      vector< Player* > mPlayers ;\n  } ;\n\n  class Filter\n  {\n    public:\n      typedef bool valid ;\n\n      valid validateMessage( string message ) ;\n      string chat( string message ) ;\n  } ;\n\n  class Dispatch\n  {\n    public:\n      char extractCommand( string fromFilter ) ;\n      string extractValue( string fromFilter ) ;\n  } ;\n}\n```\n\n[Click here for part II][link_part_2]\n\n[link_part_2]: /2011/06/08/textbasedrpgpart2\n","source":"_posts/textbasedrpgpart1.md","raw":"---\ntitle: Build A Text Based Multiplayer RPG Part I\ndate: 2011-06-05\ncategories: [tutorial]\ntags: [cpp]\n---\n[Click here for part II][link_part_2]\n\n# Intro\n\nThis is the first article in a multi-part series on how to develop a console based multiplayer MUD style RPG game. By the end of this series you will have a fully working console app that will run a typical client server model desktop application on Windows. This tutorial requires the Microsoft Visual C++ Compiler.\n\n## Review Material\n\n<a href=\"http://cslibrary.stanford.edu/102/\">Click here for a review on pointers if you need to brush up.</a>\n<a href=\"http://www.cprogramming.com/tutorial/stl/iterators.html\">Click here for a review on C++ iterators, if you can’t follow it then read the pointer review first.</a>\n\n## Background\n\nIf you happen to be curious as to what exactly a “text based role playing game(rpg)” is in my own words a text based rpg is simply a game in which the player or players input commands into a terminal and are fed back a description of the actions which took place within the game world. <a href=\"http://en.wikipedia.org/wiki/Online_text-based_role-playing_game\">For more info see the Wikipedia entry on it</a>.\n\nOk, now that we’re all familiar with the concept, lets first review why anyone would even want to build a text-based rpg in todays world of fancy <a href=\"http://us.battle.net/wow/en/\">3D graphics, special effects and semi-realistic computer rendered player models</a>. I believe text based rpgs are a great start for programmers who want to build more serious/professional grade rpgs for several reasons. First, text based rpgs allow programmers to focus purely on the game engine itself without the overhead of graphics and or animation.\n\nSecond, the core of any role playing game relies on the sophistication of its <a href=\"http://en.wikipedia.org/wiki/Role-playing_game_system\">role playing system</a>; or the game mechanics. Without a unique and interesting core system, gamers will quickly dismiss your rpg as a rehash or just another D&D clone.\n\nLastly, from a programming perspective it’s a great excuse to practice data structures, socket programming and object oriented design. In this first part of series we’re going to begin by writing out the code base for the header class which will hold all the definitions for the objects which will appear within our game. However before we even write a single line of code lets first think about how we want all the game objects to fit together. Take a look at the picture below, and take note of all the objects that are identified. We have the <em>player</em>, <em>monster</em>, <em>items</em>, <em>dungeon</em> and <em>terminal </em>objects which are all clearly identified within our simple mock up. Although those won’t be our exact classes that we’ll code in a moment, the rough picture just lets us better understand the model.\n<p style=\"text-align: center;\"><a class=\"lightbox\" href=\"https://s3-us-west-2.amazonaws.com/taywils.me.static.files/images/Simple_C%2B%2B_Part_1_2.png\"><img class=\"aligncenter size-thumbnail wp-image-92\" src=\"https://s3-us-west-2.amazonaws.com/taywils.me.static.files/images/Simple_C%2B%2B_Part_1_2.png\" alt=\"Photo\" width=\"150\" height=\"150\" /></a></p>\n\n## Initial Code\n\nNow lets start coding; call this file <strong>database.h,</strong> why we chose to name it database will be important in the future once we get to the multiplayer aspects of the game but enough talk.\n\n```c\n#include<iostream>\n#include<string>\n#include<list>\n#include<vector>\n#include<map>\n#include<algorithm>\n#include<iterator>\n#include<locale>\n#include<sstream>\n\nusing namespace std ;\n\nnamespace MUD\n{\n  class Player ;\n  class Item ;\n  class Room ;\n  class Dungeon ;\n  class Monster ;\n  class Dispatch ;\n  class Filter ;\n```\n\nOk so now we have our libraries all included and the forward declarations for our classes planned out. Don’t worry about the inclusion of the not so common libraries such as locale, and sstream yet as we’ll introduce them in the future.\n\n\n## Item and Monster Classes\n\nTo start off we begin with the Item class. The item class as you can guess will represent items within our rpg game. Due to this being a simple rpg game we will restrict ourselves to just three types; weapons, armor and health. At this moment you might be wondering why don’t we just make three different classes, one for each item. However, as you can see below, we’ll just stick with this one class and generalize it.\n\n```c\n    class Item\n    {\n      public:\n        enum TYPE { WEAPON, ARMOR, HEALTH } ;\n\n        Item( string name, Item::TYPE type, int power, int vitality, int health ) ;\n        Item operator=( Item& newItem ) ;\n        Item( void ) ;\n        //~Item()\n\n        void setPower( int value ) ;\n        int getPower( void ) ;\n\n        void setVitality( int value ) ;\n        int getVitality( void ) ;\n\n        void setHealth( int value ) ;\n        int getHealth( void ) ;\n\n        void setName( string name ) ;\n        string getName( void ) ;\n\n        void setType( TYPE newType ) ;\n        TYPE getType( void ) ;\n\n        string mName ;\n        int mPower ;\n        int mVitality ;\n        int mHealth ;\n        TYPE mType ;\n        bool mAvailiable ;\n    } ;\n```\n\nThe item class as you can look at above uses six different attributes, name, power, vitality, health, type and availability. We’ll discuss each of those further when we get to writing the actual methods for the class but for now try and think about how each of those attributes relate to the three different enum types or weapon, armor and health. Next, we are going to look at the monster class. This class being as its represents the monsters in our game should meet the following requirements. Monsters should have some measurement of life or hit points, a strength or attack power, a defense rating, a unique name and of course an indicator of whether or not they are currently in combat.\n\n```c\n    class Monster\n    {\n      public:\n        Monster( string name, int maxHp, int strength, int defence ) ;\n        //~Monster() \n\n        void setHp( int newHp ) ;\n        int getHp( void ) ;\n\n        void setStrength( int newStrength ) ;\n        int getStrength( void ) ;\n\n        void setDefence( int newDefence ) ;\n        int getDefence( void ) ;\n\n        void setName( string newName ) ;\n        string getName( void ) ;\n\n        void setMaxHp( int newMaxHp ) ;\n\n        int mMaxHp ;\n        int mHp ;\n        int mStrength ;\n        int mDefence ;\n        string mName ;\n        bool inCombat ;\n    } ;\n```\n\n## The Room Class and Player Classes\n\nFor more sophisticated games our monster class would probably have attributes for magic, speed, steal-able items and experience points rewarded if your into the experience points style of rpgs. But for this simple game; strength, hp and defense will do. Moving along we are ready to begin sketching out the code for the room class. The room class is a class which will represent a single room within our dungeon and will also contain items, monsters and allow players to traverse them. In order to best represent the interconnected nature of the rooms as they would appear in our game setting the data structure of choice will be a simple 4-way(technically 8-way since each rooms allows backtracking) linked list with each direction being the familiar north, south, east and west. When I first designed this application several months ago the room class was by far the most difficult class conceptually since most of the game revolves around traversing the rooms, finding items(within rooms), slaying monsters(again within rooms), updating the state of the player(moving about rooms) and keeping the state of the dungeon intact(managing the rooms). As you can tell the room class is key to this simple game we’re making.\n\n```c\n    class Room\n    {\n      public:\n        Room( string name, string description, Item* item = NULL ) ;\n        //Room( void ) ;\n        //~Room()\n\n        typedef bool success ;\n\n        void addMonster( Monster* newMonster ) ;\n        Monster& getMonsterRef( string monsterName ) ;\n        success killMonster( string monsterName ) ;\n        void itemTaken( void ) ;\n        string searchResponse( void ) ;\n        success link( char direction, Room& room ) ;\n        Room& north( void ) ;\n        Room& south( void ) ;\n        Room& east( void ) ;\n        Room& west( void ) ;\n\n        void setName( string newName ) ;\n\n        void setDescription( string newDescription ) ;\n        string getDescription( void ) ;\n\n        void setItem( Item* newItem ) ;\n\n        Item* mItem ;\n        Room* mNorth ;\n        Room* mSouth ;\n        Room* mEast ;\n        Room* mWest ;\n        list< Monster* > mMonsters ;\n        string mName ;\n        string mDescription ;\n    } ;\n```\n\nNext up is the player class, although for this simple game the player class resembles the monster class to an exceedingly high degree and you might be thinking “why are we not using inheritance from a general base class that has hp, str, def and such”. The answer to that question was due to me having originally planned out the player class to have multiple sub classes representing jobs such wizard, knight, archer, monk, ninja and such and to have different weapons and movement bonuses and so on until I realized that it was getting too large. So I cut all that stuff out and decided to keep things simple.\n\n```c\n    class Player\n    {\n      public:\n        Player( string name, Room* start = NULL ) ;\n        //~Player()\n\n        typedef bool dead ;\n\n        void setHp( int newHp ) ;\n        int getHp( void ) ;\n\n        void setStrength( int newStrength ) ;\n        int getStrength( void ) ;\n\n        void setDefence( int newDefence ) ;\n        int getDefence( void ) ;\n\n        string getLocation( void ) ;\n\n        void setName( string newName ) ;\n        string getName( void ) const ;\n\n        string equip( string itemName ) ;\n        string attack( string monsterName ) ;\n        string move( char direction ) ;\n        string search( void ) ;\n        dead death( void ) ;\n\n        int mMaxHp ;\n        int mHp ;\n        int mStrength ;\n        int mDefence ;\n        Room* mLocation ;\n        string mName ;\n        Item* mWeapon ;\n        Item* mArmor ;\n        dead mLife ;\n    } ;\n```\n\n## The Dungeon Class\n\nNow here is where the class design gets a little tricky. The dungeon class, the class we’re coding next will make use of two std::vector<> objects to hold both the current players and the references to the various rooms within the game. Also an interesting method within the dungeon class which we’ll describe in detail later on in this tutorial series is the combatLoop() method. If you recall from earlier, the player class already has an attack() method so why does the entire dungeon need to be aware of which players are in combat? Remember that the goal of this tutorial is a multiplayer game so important aspects of the dungeon such as which players are alive and which monsters have been slain should be propagated to each player. Ok, so here is the code.\n\n```c\nclass Dungeon\n{\n  public:\n    Dungeon( int maxPlayers, int maxRooms ) ;\n    //~Dungeon()\n\n    bool isComplete( void ) ;\n    string addPlayer( Player* newPlayer ) ;\n    string addRoom( Room* newRoom ) ;\n    string removePlayer( string playerName ) ;\n    void generatePlayerStats( Player* newPlayer ) ;\n    void combatLoop( Player& hero, Monster& villain ) ;\n    string* playerStatus( Player& player ) ;\n    void displayHelp( void ) ;\n\n    int mMaxRooms ;\n    int mMaxPlayers ;\n    vector< Room* > mRooms ;\n    vector< Player* > mPlayers ;\n} ;\n```\n\n## Utility helpers, \"Filter\" and \"Dispatch\"\n\nLastly there are two utility classes I wrote to help facilitate the ever important parsing of the user inputs into the game terminal. Being that this game is text based, players will undoubtedly type in all sorts of crazy commands and awkward inputs. So the design of the two utility classes dispatch and filter were put in place to basically filter all incoming messages to ensure validity and to dispatch valid messages based on a simple protocol I crafted to handle commands. In other words, in order to avoid players attempting to cheat the game say by equipping from rooms which they currently don’t occupy or grabbing all the health items from other players the filter class serves to clean up dirty commands before they even reach the dungeon class.\n\n```c\nclass Filter\n{\n  public:\n    typedef bool valid ;\n\n    valid validateMessage( string message ) ;\n    string chat( string message ) ;\n} ;\n\nclass Dispatch\n{\n  public:\n    char extractCommand( string fromFilter ) ;\n    string extractValue( string fromFilter ) ;\n} ;\n```\n\nOk folks that’s about all for now; just remember to stay tuned for the next parts of this tutorial which I’ll roll out when I get the time.\n\n-Thanks-\n\nOh and here is the whole code if you're in a hurry\n\n```c\n// database.h\n#include<iostream>\n#include<string>\n#include<list>\n#include<vector>\n#include<map>\n#include<algorithm>\n#include<iterator>\n#include<locale>\n#include<sstream>\n\nusing namespace std ;\n\nnamespace MUD\n{\n  class Player ;\n  class Item ;\n  class Room ;\n  class Dungeon ;\n  class Monster ;\n  class Dispatch ;\n  class Filter ;\n\n  class Item\n  {\n    public:\n      enum TYPE { WEAPON, ARMOR, HEALTH } ;\n\n      Item( string name, Item::TYPE type, int power, int vitality, int health ) ;\n      Item operator=( Item& newItem ) ;\n      Item( void ) ;\n      //~Item()\n\n      void setPower( int value ) ;\n      int getPower( void ) ;\n\n      void setVitality( int value ) ;\n      int getVitality( void ) ;\n\n      void setHealth( int value ) ;\n      int getHealth( void ) ;\n\n      void setName( string name ) ;\n      string getName( void ) ;\n\n      void setType( TYPE newType ) ;\n      TYPE getType( void ) ;\n\n      string mName ;\n      int mPower ;\n      int mVitality ;\n      int mHealth ;\n      TYPE mType ;\n      bool mAvailiable ;\n  } ;\n\n  class Monster\n  {\n    public:\n      Monster( string name, int maxHp, int strength, int defence ) ;\n      //~Monster() \n\n      void setHp( int newHp ) ;\n      int getHp( void ) ;\n\n      void setStrength( int newStrength ) ;\n      int getStrength( void ) ;\n\n      void setDefence( int newDefence ) ;\n      int getDefence( void ) ;\n\n      void setName( string newName ) ;\n      string getName( void ) ;\n\n      void setMaxHp( int newMaxHp ) ;\n\n      int mMaxHp ;\n      int mHp ;\n      int mStrength ;\n      int mDefence ;\n      string mName ;\n      bool inCombat ;\n  } ;\n\n  class Room \n  {\n    public:\n      Room( string name, string description, Item* item = NULL ) ;\n      //Room( void ) ;\n      //~Room()\n\n      typedef bool success ;\n\n      void addMonster( Monster* newMonster ) ;\n      Monster& getMonsterRef( string monsterName ) ;\n      success killMonster( string monsterName ) ;\n      void itemTaken( void ) ;\n      string searchResponse( void ) ;\n      success link( char direction, Room& room ) ;\n      Room& north( void ) ;\n      Room& south( void ) ;\n      Room& east( void ) ;\n      Room& west( void ) ;\n\n      void setName( string newName ) ;\n\n      void setDescription( string newDescription ) ;\n      string getDescription( void ) ;\n\n      void setItem( Item* newItem ) ;\n\n      Item* mItem ;\n      Room* mNorth ;\n      Room* mSouth ;\n      Room* mEast ;\n      Room* mWest ;\n      list< Monster* > mMonsters ;\n      string mName ;\n      string mDescription ;\n  } ;\n\n  class Player\n  {\n    public:\n      Player( string name, Room* start = NULL ) ;\n      //~Player()\n\n      typedef bool dead ;\n\n      void setHp( int newHp ) ;\n      int getHp( void ) ;\n\n      void setStrength( int newStrength ) ;\n      int getStrength( void ) ;\n\n      void setDefence( int newDefence ) ;\n      int getDefence( void ) ;\n\n      string getLocation( void ) ;\n\n      void setName( string newName ) ;\n      string getName( void ) const ;\n\n      string equip( string itemName ) ;\n      string attack( string monsterName ) ;\n      string move( char direction ) ;\n      string search( void ) ;\n      dead death( void ) ;\n\n      int mMaxHp ;\n      int mHp ;\n      int mStrength ;\n      int mDefence ;\n      Room* mLocation ;\n      string mName ;\n      Item* mWeapon ;\n      Item* mArmor ;\n      dead mLife ;\n  } ;\n\n  class Dungeon\n  {\n    public:\n      Dungeon( int maxPlayers, int maxRooms ) ;\n      //~Dungeon()\n\n      bool isComplete( void ) ;\n      string addPlayer( Player* newPlayer ) ;\n      string addRoom( Room* newRoom ) ;\n      string removePlayer( string playerName ) ;\n      void generatePlayerStats( Player* newPlayer ) ;\n      void combatLoop( Player& hero, Monster& villain ) ;\n      string* playerStatus( Player& player ) ;\n      void displayHelp( void ) ;\n\n      int mMaxRooms ;\n      int mMaxPlayers ;\n      vector< Room* > mRooms ;\n      vector< Player* > mPlayers ;\n  } ;\n\n  class Filter\n  {\n    public:\n      typedef bool valid ;\n\n      valid validateMessage( string message ) ;\n      string chat( string message ) ;\n  } ;\n\n  class Dispatch\n  {\n    public:\n      char extractCommand( string fromFilter ) ;\n      string extractValue( string fromFilter ) ;\n  } ;\n}\n```\n\n[Click here for part II][link_part_2]\n\n[link_part_2]: /2011/06/08/textbasedrpgpart2\n","slug":"textbasedrpgpart1","published":1,"updated":"2017-04-11T07:39:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr1z000q9uwvfaaxks3u","content":"<p><a href=\"/2011/06/08/textbasedrpgpart2\">Click here for part II</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>This is the first article in a multi-part series on how to develop a console based multiplayer MUD style RPG game. By the end of this series you will have a fully working console app that will run a typical client server model desktop application on Windows. This tutorial requires the Microsoft Visual C++ Compiler.</p>\n<h2 id=\"Review-Material\"><a href=\"#Review-Material\" class=\"headerlink\" title=\"Review Material\"></a>Review Material</h2><p><a href=\"http://cslibrary.stanford.edu/102/\" target=\"_blank\" rel=\"external\">Click here for a review on pointers if you need to brush up.</a><br><a href=\"http://www.cprogramming.com/tutorial/stl/iterators.html\" target=\"_blank\" rel=\"external\">Click here for a review on C++ iterators, if you can’t follow it then read the pointer review first.</a></p>\n<h2 id=\"Background\"><a href=\"#Background\" class=\"headerlink\" title=\"Background\"></a>Background</h2><p>If you happen to be curious as to what exactly a “text based role playing game(rpg)” is in my own words a text based rpg is simply a game in which the player or players input commands into a terminal and are fed back a description of the actions which took place within the game world. <a href=\"http://en.wikipedia.org/wiki/Online_text-based_role-playing_game\" target=\"_blank\" rel=\"external\">For more info see the Wikipedia entry on it</a>.</p>\n<p>Ok, now that we’re all familiar with the concept, lets first review why anyone would even want to build a text-based rpg in todays world of fancy <a href=\"http://us.battle.net/wow/en/\" target=\"_blank\" rel=\"external\">3D graphics, special effects and semi-realistic computer rendered player models</a>. I believe text based rpgs are a great start for programmers who want to build more serious/professional grade rpgs for several reasons. First, text based rpgs allow programmers to focus purely on the game engine itself without the overhead of graphics and or animation.</p>\n<p>Second, the core of any role playing game relies on the sophistication of its <a href=\"http://en.wikipedia.org/wiki/Role-playing_game_system\" target=\"_blank\" rel=\"external\">role playing system</a>; or the game mechanics. Without a unique and interesting core system, gamers will quickly dismiss your rpg as a rehash or just another D&amp;D clone.</p>\n<p>Lastly, from a programming perspective it’s a great excuse to practice data structures, socket programming and object oriented design. In this first part of series we’re going to begin by writing out the code base for the header class which will hold all the definitions for the objects which will appear within our game. However before we even write a single line of code lets first think about how we want all the game objects to fit together. Take a look at the picture below, and take note of all the objects that are identified. We have the <em>player</em>, <em>monster</em>, <em>items</em>, <em>dungeon</em> and <em>terminal </em>objects which are all clearly identified within our simple mock up. Although those won’t be our exact classes that we’ll code in a moment, the rough picture just lets us better understand the model.</p>\n<p style=\"text-align: center;\"><a class=\"lightbox\" href=\"https://s3-us-west-2.amazonaws.com/taywils.me.static.files/images/Simple_C%2B%2B_Part_1_2.png\" target=\"_blank\" rel=\"external\"><img class=\"aligncenter size-thumbnail wp-image-92\" src=\"https://s3-us-west-2.amazonaws.com/taywils.me.static.files/images/Simple_C%2B%2B_Part_1_2.png\" alt=\"Photo\" width=\"150\" height=\"150\"></a></p>\n\n<h2 id=\"Initial-Code\"><a href=\"#Initial-Code\" class=\"headerlink\" title=\"Initial Code\"></a>Initial Code</h2><p>Now lets start coding; call this file <strong>database.h,</strong> why we chose to name it database will be important in the future once we get to the multiplayer aspects of the game but enough talk.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;string&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;list&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;vector&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;map&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;algorithm&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iterator&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;locale&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;sstream&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span> ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">namespace</span> MUD</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">class</span> Player ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Item ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Room ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Dungeon ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Monster ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Dispatch ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Filter ;</div></pre></td></tr></table></figure>\n<p>Ok so now we have our libraries all included and the forward declarations for our classes planned out. Don’t worry about the inclusion of the not so common libraries such as locale, and sstream yet as we’ll introduce them in the future.</p>\n<h2 id=\"Item-and-Monster-Classes\"><a href=\"#Item-and-Monster-Classes\" class=\"headerlink\" title=\"Item and Monster Classes\"></a>Item and Monster Classes</h2><p>To start off we begin with the Item class. The item class as you can guess will represent items within our rpg game. Due to this being a simple rpg game we will restrict ourselves to just three types; weapons, armor and health. At this moment you might be wondering why don’t we just make three different classes, one for each item. However, as you can see below, we’ll just stick with this one class and generalize it.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Item</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"keyword\">enum</span> TYPE &#123; WEAPON, ARMOR, HEALTH &#125; ;</div><div class=\"line\"></div><div class=\"line\">    Item( <span class=\"built_in\">string</span> name, Item::TYPE type, <span class=\"keyword\">int</span> power, <span class=\"keyword\">int</span> vitality, <span class=\"keyword\">int</span> health ) ;</div><div class=\"line\">    Item <span class=\"keyword\">operator</span>=( Item&amp; newItem ) ;</div><div class=\"line\">    Item( <span class=\"keyword\">void</span> ) ;</div><div class=\"line\">    <span class=\"comment\">//~Item()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setPower</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getPower</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setVitality</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getVitality</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHealth</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHealth</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> name )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setType</span><span class=\"params\">( TYPE newType )</span> </span>;</div><div class=\"line\">    <span class=\"function\">TYPE <span class=\"title\">getType</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mPower ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mVitality ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mHealth ;</div><div class=\"line\">    TYPE mType ;</div><div class=\"line\">    <span class=\"keyword\">bool</span> mAvailiable ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<p>The item class as you can look at above uses six different attributes, name, power, vitality, health, type and availability. We’ll discuss each of those further when we get to writing the actual methods for the class but for now try and think about how each of those attributes relate to the three different enum types or weapon, armor and health. Next, we are going to look at the monster class. This class being as its represents the monsters in our game should meet the following requirements. Monsters should have some measurement of life or hit points, a strength or attack power, a defense rating, a unique name and of course an indicator of whether or not they are currently in combat.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Monster</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Monster( <span class=\"built_in\">string</span> name, <span class=\"keyword\">int</span> maxHp, <span class=\"keyword\">int</span> strength, <span class=\"keyword\">int</span> defence ) ;</div><div class=\"line\">    <span class=\"comment\">//~Monster() </span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newHp )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setStrength</span><span class=\"params\">( <span class=\"keyword\">int</span> newStrength )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getStrength</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDefence</span><span class=\"params\">( <span class=\"keyword\">int</span> newDefence )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getDefence</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newMaxHp )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">int</span> mMaxHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mStrength ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mDefence ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"keyword\">bool</span> inCombat ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<h2 id=\"The-Room-Class-and-Player-Classes\"><a href=\"#The-Room-Class-and-Player-Classes\" class=\"headerlink\" title=\"The Room Class and Player Classes\"></a>The Room Class and Player Classes</h2><p>For more sophisticated games our monster class would probably have attributes for magic, speed, steal-able items and experience points rewarded if your into the experience points style of rpgs. But for this simple game; strength, hp and defense will do. Moving along we are ready to begin sketching out the code for the room class. The room class is a class which will represent a single room within our dungeon and will also contain items, monsters and allow players to traverse them. In order to best represent the interconnected nature of the rooms as they would appear in our game setting the data structure of choice will be a simple 4-way(technically 8-way since each rooms allows backtracking) linked list with each direction being the familiar north, south, east and west. When I first designed this application several months ago the room class was by far the most difficult class conceptually since most of the game revolves around traversing the rooms, finding items(within rooms), slaying monsters(again within rooms), updating the state of the player(moving about rooms) and keeping the state of the dungeon intact(managing the rooms). As you can tell the room class is key to this simple game we’re making.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Room</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Room( <span class=\"built_in\">string</span> name, <span class=\"built_in\">string</span> description, Item* item = <span class=\"literal\">NULL</span> ) ;</div><div class=\"line\">    <span class=\"comment\">//Room( void ) ;</span></div><div class=\"line\">    <span class=\"comment\">//~Room()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> success ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">addMonster</span><span class=\"params\">( Monster* newMonster )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Monster&amp; <span class=\"title\">getMonsterRef</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">    <span class=\"function\">success <span class=\"title\">killMonster</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">itemTaken</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">searchResponse</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">success <span class=\"title\">link</span><span class=\"params\">( <span class=\"keyword\">char</span> direction, Room&amp; room )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">north</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">south</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">east</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">west</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDescription</span><span class=\"params\">( <span class=\"built_in\">string</span> newDescription )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getDescription</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setItem</span><span class=\"params\">( Item* newItem )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    Item* mItem ;</div><div class=\"line\">    Room* mNorth ;</div><div class=\"line\">    Room* mSouth ;</div><div class=\"line\">    Room* mEast ;</div><div class=\"line\">    Room* mWest ;</div><div class=\"line\">    <span class=\"built_in\">list</span>&lt; Monster* &gt; mMonsters ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mDescription ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<p>Next up is the player class, although for this simple game the player class resembles the monster class to an exceedingly high degree and you might be thinking “why are we not using inheritance from a general base class that has hp, str, def and such”. The answer to that question was due to me having originally planned out the player class to have multiple sub classes representing jobs such wizard, knight, archer, monk, ninja and such and to have different weapons and movement bonuses and so on until I realized that it was getting too large. So I cut all that stuff out and decided to keep things simple.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Player</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Player( <span class=\"built_in\">string</span> name, Room* start = <span class=\"literal\">NULL</span> ) ;</div><div class=\"line\">    <span class=\"comment\">//~Player()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> dead ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newHp )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setStrength</span><span class=\"params\">( <span class=\"keyword\">int</span> newStrength )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getStrength</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDefence</span><span class=\"params\">( <span class=\"keyword\">int</span> newDefence )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getDefence</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getLocation</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">equip</span><span class=\"params\">( <span class=\"built_in\">string</span> itemName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">attack</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">move</span><span class=\"params\">( <span class=\"keyword\">char</span> direction )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">search</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">dead <span class=\"title\">death</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">int</span> mMaxHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mStrength ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mDefence ;</div><div class=\"line\">    Room* mLocation ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    Item* mWeapon ;</div><div class=\"line\">    Item* mArmor ;</div><div class=\"line\">    dead mLife ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<h2 id=\"The-Dungeon-Class\"><a href=\"#The-Dungeon-Class\" class=\"headerlink\" title=\"The Dungeon Class\"></a>The Dungeon Class</h2><p>Now here is where the class design gets a little tricky. The dungeon class, the class we’re coding next will make use of two std::vector&lt;&gt; objects to hold both the current players and the references to the various rooms within the game. Also an interesting method within the dungeon class which we’ll describe in detail later on in this tutorial series is the combatLoop() method. If you recall from earlier, the player class already has an attack() method so why does the entire dungeon need to be aware of which players are in combat? Remember that the goal of this tutorial is a multiplayer game so important aspects of the dungeon such as which players are alive and which monsters have been slain should be propagated to each player. Ok, so here is the code.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Dungeon</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Dungeon( <span class=\"keyword\">int</span> maxPlayers, <span class=\"keyword\">int</span> maxRooms ) ;</div><div class=\"line\">    <span class=\"comment\">//~Dungeon()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">isComplete</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">addPlayer</span><span class=\"params\">( Player* newPlayer )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">addRoom</span><span class=\"params\">( Room* newRoom )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">removePlayer</span><span class=\"params\">( <span class=\"built_in\">string</span> playerName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">generatePlayerStats</span><span class=\"params\">( Player* newPlayer )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">combatLoop</span><span class=\"params\">( Player&amp; hero, Monster&amp; villain )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span>* <span class=\"title\">playerStatus</span><span class=\"params\">( Player&amp; player )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">displayHelp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">int</span> mMaxRooms ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mMaxPlayers ;</div><div class=\"line\">    <span class=\"built_in\">vector</span>&lt; Room* &gt; mRooms ;</div><div class=\"line\">    <span class=\"built_in\">vector</span>&lt; Player* &gt; mPlayers ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<h2 id=\"Utility-helpers-“Filter”-and-“Dispatch”\"><a href=\"#Utility-helpers-“Filter”-and-“Dispatch”\" class=\"headerlink\" title=\"Utility helpers, “Filter” and “Dispatch”\"></a>Utility helpers, “Filter” and “Dispatch”</h2><p>Lastly there are two utility classes I wrote to help facilitate the ever important parsing of the user inputs into the game terminal. Being that this game is text based, players will undoubtedly type in all sorts of crazy commands and awkward inputs. So the design of the two utility classes dispatch and filter were put in place to basically filter all incoming messages to ensure validity and to dispatch valid messages based on a simple protocol I crafted to handle commands. In other words, in order to avoid players attempting to cheat the game say by equipping from rooms which they currently don’t occupy or grabbing all the health items from other players the filter class serves to clean up dirty commands before they even reach the dungeon class.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Filter</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> valid ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\">valid <span class=\"title\">validateMessage</span><span class=\"params\">( <span class=\"built_in\">string</span> message )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">chat</span><span class=\"params\">( <span class=\"built_in\">string</span> message )</span> </span>;</div><div class=\"line\">&#125; ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">class</span> Dispatch</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">char</span> <span class=\"title\">extractCommand</span><span class=\"params\">( <span class=\"built_in\">string</span> fromFilter )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">extractValue</span><span class=\"params\">( <span class=\"built_in\">string</span> fromFilter )</span> </span>;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<p>Ok folks that’s about all for now; just remember to stay tuned for the next parts of this tutorial which I’ll roll out when I get the time.</p>\n<p>-Thanks-</p>\n<p>Oh and here is the whole code if you’re in a hurry</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// database.h</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;string&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;list&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;vector&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;map&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;algorithm&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iterator&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;locale&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;sstream&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span> ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">namespace</span> MUD</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">class</span> Player ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Item ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Room ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Dungeon ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Monster ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Dispatch ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Filter ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Item</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      <span class=\"keyword\">enum</span> TYPE &#123; WEAPON, ARMOR, HEALTH &#125; ;</div><div class=\"line\"></div><div class=\"line\">      Item( <span class=\"built_in\">string</span> name, Item::TYPE type, <span class=\"keyword\">int</span> power, <span class=\"keyword\">int</span> vitality, <span class=\"keyword\">int</span> health ) ;</div><div class=\"line\">      Item <span class=\"keyword\">operator</span>=( Item&amp; newItem ) ;</div><div class=\"line\">      Item( <span class=\"keyword\">void</span> ) ;</div><div class=\"line\">      <span class=\"comment\">//~Item()</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setPower</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getPower</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setVitality</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getVitality</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHealth</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHealth</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> name )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setType</span><span class=\"params\">( TYPE newType )</span> </span>;</div><div class=\"line\">      <span class=\"function\">TYPE <span class=\"title\">getType</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mPower ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mVitality ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mHealth ;</div><div class=\"line\">      TYPE mType ;</div><div class=\"line\">      <span class=\"keyword\">bool</span> mAvailiable ;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Monster</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      Monster( <span class=\"built_in\">string</span> name, <span class=\"keyword\">int</span> maxHp, <span class=\"keyword\">int</span> strength, <span class=\"keyword\">int</span> defence ) ;</div><div class=\"line\">      <span class=\"comment\">//~Monster() </span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newHp )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setStrength</span><span class=\"params\">( <span class=\"keyword\">int</span> newStrength )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getStrength</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDefence</span><span class=\"params\">( <span class=\"keyword\">int</span> newDefence )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getDefence</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newMaxHp )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">int</span> mMaxHp ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mHp ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mStrength ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mDefence ;</div><div class=\"line\">      <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">      <span class=\"keyword\">bool</span> inCombat ;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Room </div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      Room( <span class=\"built_in\">string</span> name, <span class=\"built_in\">string</span> description, Item* item = <span class=\"literal\">NULL</span> ) ;</div><div class=\"line\">      <span class=\"comment\">//Room( void ) ;</span></div><div class=\"line\">      <span class=\"comment\">//~Room()</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> success ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">addMonster</span><span class=\"params\">( Monster* newMonster )</span> </span>;</div><div class=\"line\">      <span class=\"function\">Monster&amp; <span class=\"title\">getMonsterRef</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">      <span class=\"function\">success <span class=\"title\">killMonster</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">itemTaken</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">searchResponse</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\">success <span class=\"title\">link</span><span class=\"params\">( <span class=\"keyword\">char</span> direction, Room&amp; room )</span> </span>;</div><div class=\"line\">      <span class=\"function\">Room&amp; <span class=\"title\">north</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\">Room&amp; <span class=\"title\">south</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\">Room&amp; <span class=\"title\">east</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\">Room&amp; <span class=\"title\">west</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDescription</span><span class=\"params\">( <span class=\"built_in\">string</span> newDescription )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getDescription</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setItem</span><span class=\"params\">( Item* newItem )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      Item* mItem ;</div><div class=\"line\">      Room* mNorth ;</div><div class=\"line\">      Room* mSouth ;</div><div class=\"line\">      Room* mEast ;</div><div class=\"line\">      Room* mWest ;</div><div class=\"line\">      <span class=\"built_in\">list</span>&lt; Monster* &gt; mMonsters ;</div><div class=\"line\">      <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">      <span class=\"built_in\">string</span> mDescription ;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Player</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      Player( <span class=\"built_in\">string</span> name, Room* start = <span class=\"literal\">NULL</span> ) ;</div><div class=\"line\">      <span class=\"comment\">//~Player()</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> dead ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newHp )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setStrength</span><span class=\"params\">( <span class=\"keyword\">int</span> newStrength )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getStrength</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDefence</span><span class=\"params\">( <span class=\"keyword\">int</span> newDefence )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getDefence</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getLocation</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">equip</span><span class=\"params\">( <span class=\"built_in\">string</span> itemName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">attack</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">move</span><span class=\"params\">( <span class=\"keyword\">char</span> direction )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">search</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\">dead <span class=\"title\">death</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">int</span> mMaxHp ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mHp ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mStrength ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mDefence ;</div><div class=\"line\">      Room* mLocation ;</div><div class=\"line\">      <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">      Item* mWeapon ;</div><div class=\"line\">      Item* mArmor ;</div><div class=\"line\">      dead mLife ;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Dungeon</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      Dungeon( <span class=\"keyword\">int</span> maxPlayers, <span class=\"keyword\">int</span> maxRooms ) ;</div><div class=\"line\">      <span class=\"comment\">//~Dungeon()</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">isComplete</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">addPlayer</span><span class=\"params\">( Player* newPlayer )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">addRoom</span><span class=\"params\">( Room* newRoom )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">removePlayer</span><span class=\"params\">( <span class=\"built_in\">string</span> playerName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">generatePlayerStats</span><span class=\"params\">( Player* newPlayer )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">combatLoop</span><span class=\"params\">( Player&amp; hero, Monster&amp; villain )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span>* <span class=\"title\">playerStatus</span><span class=\"params\">( Player&amp; player )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">displayHelp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">int</span> mMaxRooms ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mMaxPlayers ;</div><div class=\"line\">      <span class=\"built_in\">vector</span>&lt; Room* &gt; mRooms ;</div><div class=\"line\">      <span class=\"built_in\">vector</span>&lt; Player* &gt; mPlayers ;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Filter</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> valid ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\">valid <span class=\"title\">validateMessage</span><span class=\"params\">( <span class=\"built_in\">string</span> message )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">chat</span><span class=\"params\">( <span class=\"built_in\">string</span> message )</span> </span>;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Dispatch</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">char</span> <span class=\"title\">extractCommand</span><span class=\"params\">( <span class=\"built_in\">string</span> fromFilter )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">extractValue</span><span class=\"params\">( <span class=\"built_in\">string</span> fromFilter )</span> </span>;</div><div class=\"line\">  &#125; ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p><a href=\"/2011/06/08/textbasedrpgpart2\">Click here for part II</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"/2011/06/08/textbasedrpgpart2\">Click here for part II</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>This is the first article in a multi-part series on how to develop a console based multiplayer MUD style RPG game. By the end of this series you will have a fully working console app that will run a typical client server model desktop application on Windows. This tutorial requires the Microsoft Visual C++ Compiler.</p>\n<h2 id=\"Review-Material\"><a href=\"#Review-Material\" class=\"headerlink\" title=\"Review Material\"></a>Review Material</h2><p><a href=\"http://cslibrary.stanford.edu/102/\">Click here for a review on pointers if you need to brush up.</a><br><a href=\"http://www.cprogramming.com/tutorial/stl/iterators.html\">Click here for a review on C++ iterators, if you can’t follow it then read the pointer review first.</a></p>\n<h2 id=\"Background\"><a href=\"#Background\" class=\"headerlink\" title=\"Background\"></a>Background</h2><p>If you happen to be curious as to what exactly a “text based role playing game(rpg)” is in my own words a text based rpg is simply a game in which the player or players input commands into a terminal and are fed back a description of the actions which took place within the game world. <a href=\"http://en.wikipedia.org/wiki/Online_text-based_role-playing_game\">For more info see the Wikipedia entry on it</a>.</p>\n<p>Ok, now that we’re all familiar with the concept, lets first review why anyone would even want to build a text-based rpg in todays world of fancy <a href=\"http://us.battle.net/wow/en/\">3D graphics, special effects and semi-realistic computer rendered player models</a>. I believe text based rpgs are a great start for programmers who want to build more serious/professional grade rpgs for several reasons. First, text based rpgs allow programmers to focus purely on the game engine itself without the overhead of graphics and or animation.</p>\n<p>Second, the core of any role playing game relies on the sophistication of its <a href=\"http://en.wikipedia.org/wiki/Role-playing_game_system\">role playing system</a>; or the game mechanics. Without a unique and interesting core system, gamers will quickly dismiss your rpg as a rehash or just another D&amp;D clone.</p>\n<p>Lastly, from a programming perspective it’s a great excuse to practice data structures, socket programming and object oriented design. In this first part of series we’re going to begin by writing out the code base for the header class which will hold all the definitions for the objects which will appear within our game. However before we even write a single line of code lets first think about how we want all the game objects to fit together. Take a look at the picture below, and take note of all the objects that are identified. We have the <em>player</em>, <em>monster</em>, <em>items</em>, <em>dungeon</em> and <em>terminal </em>objects which are all clearly identified within our simple mock up. Although those won’t be our exact classes that we’ll code in a moment, the rough picture just lets us better understand the model.</p>\n<p style=\"text-align: center;\"><a class=\"lightbox\" href=\"https://s3-us-west-2.amazonaws.com/taywils.me.static.files/images/Simple_C%2B%2B_Part_1_2.png\"><img class=\"aligncenter size-thumbnail wp-image-92\" src=\"https://s3-us-west-2.amazonaws.com/taywils.me.static.files/images/Simple_C%2B%2B_Part_1_2.png\" alt=\"Photo\" width=\"150\" height=\"150\" /></a></p>\n\n<h2 id=\"Initial-Code\"><a href=\"#Initial-Code\" class=\"headerlink\" title=\"Initial Code\"></a>Initial Code</h2><p>Now lets start coding; call this file <strong>database.h,</strong> why we chose to name it database will be important in the future once we get to the multiplayer aspects of the game but enough talk.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;string&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;list&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;vector&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;map&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;algorithm&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iterator&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;locale&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;sstream&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span> ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">namespace</span> MUD</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">class</span> Player ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Item ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Room ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Dungeon ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Monster ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Dispatch ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Filter ;</div></pre></td></tr></table></figure>\n<p>Ok so now we have our libraries all included and the forward declarations for our classes planned out. Don’t worry about the inclusion of the not so common libraries such as locale, and sstream yet as we’ll introduce them in the future.</p>\n<h2 id=\"Item-and-Monster-Classes\"><a href=\"#Item-and-Monster-Classes\" class=\"headerlink\" title=\"Item and Monster Classes\"></a>Item and Monster Classes</h2><p>To start off we begin with the Item class. The item class as you can guess will represent items within our rpg game. Due to this being a simple rpg game we will restrict ourselves to just three types; weapons, armor and health. At this moment you might be wondering why don’t we just make three different classes, one for each item. However, as you can see below, we’ll just stick with this one class and generalize it.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Item</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"keyword\">enum</span> TYPE &#123; WEAPON, ARMOR, HEALTH &#125; ;</div><div class=\"line\"></div><div class=\"line\">    Item( <span class=\"built_in\">string</span> name, Item::TYPE type, <span class=\"keyword\">int</span> power, <span class=\"keyword\">int</span> vitality, <span class=\"keyword\">int</span> health ) ;</div><div class=\"line\">    Item <span class=\"keyword\">operator</span>=( Item&amp; newItem ) ;</div><div class=\"line\">    Item( <span class=\"keyword\">void</span> ) ;</div><div class=\"line\">    <span class=\"comment\">//~Item()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setPower</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getPower</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setVitality</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getVitality</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHealth</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHealth</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> name )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setType</span><span class=\"params\">( TYPE newType )</span> </span>;</div><div class=\"line\">    <span class=\"function\">TYPE <span class=\"title\">getType</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mPower ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mVitality ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mHealth ;</div><div class=\"line\">    TYPE mType ;</div><div class=\"line\">    <span class=\"keyword\">bool</span> mAvailiable ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<p>The item class as you can look at above uses six different attributes, name, power, vitality, health, type and availability. We’ll discuss each of those further when we get to writing the actual methods for the class but for now try and think about how each of those attributes relate to the three different enum types or weapon, armor and health. Next, we are going to look at the monster class. This class being as its represents the monsters in our game should meet the following requirements. Monsters should have some measurement of life or hit points, a strength or attack power, a defense rating, a unique name and of course an indicator of whether or not they are currently in combat.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Monster</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Monster( <span class=\"built_in\">string</span> name, <span class=\"keyword\">int</span> maxHp, <span class=\"keyword\">int</span> strength, <span class=\"keyword\">int</span> defence ) ;</div><div class=\"line\">    <span class=\"comment\">//~Monster() </span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newHp )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setStrength</span><span class=\"params\">( <span class=\"keyword\">int</span> newStrength )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getStrength</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDefence</span><span class=\"params\">( <span class=\"keyword\">int</span> newDefence )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getDefence</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newMaxHp )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">int</span> mMaxHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mStrength ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mDefence ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"keyword\">bool</span> inCombat ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<h2 id=\"The-Room-Class-and-Player-Classes\"><a href=\"#The-Room-Class-and-Player-Classes\" class=\"headerlink\" title=\"The Room Class and Player Classes\"></a>The Room Class and Player Classes</h2><p>For more sophisticated games our monster class would probably have attributes for magic, speed, steal-able items and experience points rewarded if your into the experience points style of rpgs. But for this simple game; strength, hp and defense will do. Moving along we are ready to begin sketching out the code for the room class. The room class is a class which will represent a single room within our dungeon and will also contain items, monsters and allow players to traverse them. In order to best represent the interconnected nature of the rooms as they would appear in our game setting the data structure of choice will be a simple 4-way(technically 8-way since each rooms allows backtracking) linked list with each direction being the familiar north, south, east and west. When I first designed this application several months ago the room class was by far the most difficult class conceptually since most of the game revolves around traversing the rooms, finding items(within rooms), slaying monsters(again within rooms), updating the state of the player(moving about rooms) and keeping the state of the dungeon intact(managing the rooms). As you can tell the room class is key to this simple game we’re making.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Room</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Room( <span class=\"built_in\">string</span> name, <span class=\"built_in\">string</span> description, Item* item = <span class=\"literal\">NULL</span> ) ;</div><div class=\"line\">    <span class=\"comment\">//Room( void ) ;</span></div><div class=\"line\">    <span class=\"comment\">//~Room()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> success ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">addMonster</span><span class=\"params\">( Monster* newMonster )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Monster&amp; <span class=\"title\">getMonsterRef</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">    <span class=\"function\">success <span class=\"title\">killMonster</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">itemTaken</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">searchResponse</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">success <span class=\"title\">link</span><span class=\"params\">( <span class=\"keyword\">char</span> direction, Room&amp; room )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">north</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">south</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">east</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">west</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDescription</span><span class=\"params\">( <span class=\"built_in\">string</span> newDescription )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getDescription</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setItem</span><span class=\"params\">( Item* newItem )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    Item* mItem ;</div><div class=\"line\">    Room* mNorth ;</div><div class=\"line\">    Room* mSouth ;</div><div class=\"line\">    Room* mEast ;</div><div class=\"line\">    Room* mWest ;</div><div class=\"line\">    <span class=\"built_in\">list</span>&lt; Monster* &gt; mMonsters ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mDescription ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<p>Next up is the player class, although for this simple game the player class resembles the monster class to an exceedingly high degree and you might be thinking “why are we not using inheritance from a general base class that has hp, str, def and such”. The answer to that question was due to me having originally planned out the player class to have multiple sub classes representing jobs such wizard, knight, archer, monk, ninja and such and to have different weapons and movement bonuses and so on until I realized that it was getting too large. So I cut all that stuff out and decided to keep things simple.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Player</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Player( <span class=\"built_in\">string</span> name, Room* start = <span class=\"literal\">NULL</span> ) ;</div><div class=\"line\">    <span class=\"comment\">//~Player()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> dead ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newHp )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setStrength</span><span class=\"params\">( <span class=\"keyword\">int</span> newStrength )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getStrength</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDefence</span><span class=\"params\">( <span class=\"keyword\">int</span> newDefence )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getDefence</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getLocation</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">equip</span><span class=\"params\">( <span class=\"built_in\">string</span> itemName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">attack</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">move</span><span class=\"params\">( <span class=\"keyword\">char</span> direction )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">search</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">dead <span class=\"title\">death</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">int</span> mMaxHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mStrength ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mDefence ;</div><div class=\"line\">    Room* mLocation ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    Item* mWeapon ;</div><div class=\"line\">    Item* mArmor ;</div><div class=\"line\">    dead mLife ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<h2 id=\"The-Dungeon-Class\"><a href=\"#The-Dungeon-Class\" class=\"headerlink\" title=\"The Dungeon Class\"></a>The Dungeon Class</h2><p>Now here is where the class design gets a little tricky. The dungeon class, the class we’re coding next will make use of two std::vector&lt;&gt; objects to hold both the current players and the references to the various rooms within the game. Also an interesting method within the dungeon class which we’ll describe in detail later on in this tutorial series is the combatLoop() method. If you recall from earlier, the player class already has an attack() method so why does the entire dungeon need to be aware of which players are in combat? Remember that the goal of this tutorial is a multiplayer game so important aspects of the dungeon such as which players are alive and which monsters have been slain should be propagated to each player. Ok, so here is the code.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Dungeon</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Dungeon( <span class=\"keyword\">int</span> maxPlayers, <span class=\"keyword\">int</span> maxRooms ) ;</div><div class=\"line\">    <span class=\"comment\">//~Dungeon()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">isComplete</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">addPlayer</span><span class=\"params\">( Player* newPlayer )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">addRoom</span><span class=\"params\">( Room* newRoom )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">removePlayer</span><span class=\"params\">( <span class=\"built_in\">string</span> playerName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">generatePlayerStats</span><span class=\"params\">( Player* newPlayer )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">combatLoop</span><span class=\"params\">( Player&amp; hero, Monster&amp; villain )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span>* <span class=\"title\">playerStatus</span><span class=\"params\">( Player&amp; player )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">displayHelp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">int</span> mMaxRooms ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mMaxPlayers ;</div><div class=\"line\">    <span class=\"built_in\">vector</span>&lt; Room* &gt; mRooms ;</div><div class=\"line\">    <span class=\"built_in\">vector</span>&lt; Player* &gt; mPlayers ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<h2 id=\"Utility-helpers-“Filter”-and-“Dispatch”\"><a href=\"#Utility-helpers-“Filter”-and-“Dispatch”\" class=\"headerlink\" title=\"Utility helpers, “Filter” and “Dispatch”\"></a>Utility helpers, “Filter” and “Dispatch”</h2><p>Lastly there are two utility classes I wrote to help facilitate the ever important parsing of the user inputs into the game terminal. Being that this game is text based, players will undoubtedly type in all sorts of crazy commands and awkward inputs. So the design of the two utility classes dispatch and filter were put in place to basically filter all incoming messages to ensure validity and to dispatch valid messages based on a simple protocol I crafted to handle commands. In other words, in order to avoid players attempting to cheat the game say by equipping from rooms which they currently don’t occupy or grabbing all the health items from other players the filter class serves to clean up dirty commands before they even reach the dungeon class.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Filter</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> valid ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\">valid <span class=\"title\">validateMessage</span><span class=\"params\">( <span class=\"built_in\">string</span> message )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">chat</span><span class=\"params\">( <span class=\"built_in\">string</span> message )</span> </span>;</div><div class=\"line\">&#125; ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">class</span> Dispatch</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">char</span> <span class=\"title\">extractCommand</span><span class=\"params\">( <span class=\"built_in\">string</span> fromFilter )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">extractValue</span><span class=\"params\">( <span class=\"built_in\">string</span> fromFilter )</span> </span>;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure>\n<p>Ok folks that’s about all for now; just remember to stay tuned for the next parts of this tutorial which I’ll roll out when I get the time.</p>\n<p>-Thanks-</p>\n<p>Oh and here is the whole code if you’re in a hurry</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// database.h</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;string&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;list&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;vector&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;map&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;algorithm&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iterator&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;locale&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;sstream&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span> ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">namespace</span> MUD</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">class</span> Player ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Item ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Room ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Dungeon ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Monster ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Dispatch ;</div><div class=\"line\">  <span class=\"keyword\">class</span> Filter ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Item</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      <span class=\"keyword\">enum</span> TYPE &#123; WEAPON, ARMOR, HEALTH &#125; ;</div><div class=\"line\"></div><div class=\"line\">      Item( <span class=\"built_in\">string</span> name, Item::TYPE type, <span class=\"keyword\">int</span> power, <span class=\"keyword\">int</span> vitality, <span class=\"keyword\">int</span> health ) ;</div><div class=\"line\">      Item <span class=\"keyword\">operator</span>=( Item&amp; newItem ) ;</div><div class=\"line\">      Item( <span class=\"keyword\">void</span> ) ;</div><div class=\"line\">      <span class=\"comment\">//~Item()</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setPower</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getPower</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setVitality</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getVitality</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHealth</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHealth</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> name )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setType</span><span class=\"params\">( TYPE newType )</span> </span>;</div><div class=\"line\">      <span class=\"function\">TYPE <span class=\"title\">getType</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mPower ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mVitality ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mHealth ;</div><div class=\"line\">      TYPE mType ;</div><div class=\"line\">      <span class=\"keyword\">bool</span> mAvailiable ;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Monster</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      Monster( <span class=\"built_in\">string</span> name, <span class=\"keyword\">int</span> maxHp, <span class=\"keyword\">int</span> strength, <span class=\"keyword\">int</span> defence ) ;</div><div class=\"line\">      <span class=\"comment\">//~Monster() </span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newHp )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setStrength</span><span class=\"params\">( <span class=\"keyword\">int</span> newStrength )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getStrength</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDefence</span><span class=\"params\">( <span class=\"keyword\">int</span> newDefence )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getDefence</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newMaxHp )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">int</span> mMaxHp ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mHp ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mStrength ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mDefence ;</div><div class=\"line\">      <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">      <span class=\"keyword\">bool</span> inCombat ;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Room </div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      Room( <span class=\"built_in\">string</span> name, <span class=\"built_in\">string</span> description, Item* item = <span class=\"literal\">NULL</span> ) ;</div><div class=\"line\">      <span class=\"comment\">//Room( void ) ;</span></div><div class=\"line\">      <span class=\"comment\">//~Room()</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> success ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">addMonster</span><span class=\"params\">( Monster* newMonster )</span> </span>;</div><div class=\"line\">      <span class=\"function\">Monster&amp; <span class=\"title\">getMonsterRef</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">      <span class=\"function\">success <span class=\"title\">killMonster</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">itemTaken</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">searchResponse</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\">success <span class=\"title\">link</span><span class=\"params\">( <span class=\"keyword\">char</span> direction, Room&amp; room )</span> </span>;</div><div class=\"line\">      <span class=\"function\">Room&amp; <span class=\"title\">north</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\">Room&amp; <span class=\"title\">south</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\">Room&amp; <span class=\"title\">east</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\">Room&amp; <span class=\"title\">west</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDescription</span><span class=\"params\">( <span class=\"built_in\">string</span> newDescription )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getDescription</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setItem</span><span class=\"params\">( Item* newItem )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      Item* mItem ;</div><div class=\"line\">      Room* mNorth ;</div><div class=\"line\">      Room* mSouth ;</div><div class=\"line\">      Room* mEast ;</div><div class=\"line\">      Room* mWest ;</div><div class=\"line\">      <span class=\"built_in\">list</span>&lt; Monster* &gt; mMonsters ;</div><div class=\"line\">      <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">      <span class=\"built_in\">string</span> mDescription ;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Player</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      Player( <span class=\"built_in\">string</span> name, Room* start = <span class=\"literal\">NULL</span> ) ;</div><div class=\"line\">      <span class=\"comment\">//~Player()</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> dead ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newHp )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setStrength</span><span class=\"params\">( <span class=\"keyword\">int</span> newStrength )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getStrength</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDefence</span><span class=\"params\">( <span class=\"keyword\">int</span> newDefence )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getDefence</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getLocation</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">equip</span><span class=\"params\">( <span class=\"built_in\">string</span> itemName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">attack</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">move</span><span class=\"params\">( <span class=\"keyword\">char</span> direction )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">search</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\">dead <span class=\"title\">death</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">int</span> mMaxHp ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mHp ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mStrength ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mDefence ;</div><div class=\"line\">      Room* mLocation ;</div><div class=\"line\">      <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">      Item* mWeapon ;</div><div class=\"line\">      Item* mArmor ;</div><div class=\"line\">      dead mLife ;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Dungeon</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      Dungeon( <span class=\"keyword\">int</span> maxPlayers, <span class=\"keyword\">int</span> maxRooms ) ;</div><div class=\"line\">      <span class=\"comment\">//~Dungeon()</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">isComplete</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">addPlayer</span><span class=\"params\">( Player* newPlayer )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">addRoom</span><span class=\"params\">( Room* newRoom )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">removePlayer</span><span class=\"params\">( <span class=\"built_in\">string</span> playerName )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">generatePlayerStats</span><span class=\"params\">( Player* newPlayer )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">combatLoop</span><span class=\"params\">( Player&amp; hero, Monster&amp; villain )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span>* <span class=\"title\">playerStatus</span><span class=\"params\">( Player&amp; player )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">displayHelp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">int</span> mMaxRooms ;</div><div class=\"line\">      <span class=\"keyword\">int</span> mMaxPlayers ;</div><div class=\"line\">      <span class=\"built_in\">vector</span>&lt; Room* &gt; mRooms ;</div><div class=\"line\">      <span class=\"built_in\">vector</span>&lt; Player* &gt; mPlayers ;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Filter</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> valid ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"function\">valid <span class=\"title\">validateMessage</span><span class=\"params\">( <span class=\"built_in\">string</span> message )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">chat</span><span class=\"params\">( <span class=\"built_in\">string</span> message )</span> </span>;</div><div class=\"line\">  &#125; ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">class</span> Dispatch</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">char</span> <span class=\"title\">extractCommand</span><span class=\"params\">( <span class=\"built_in\">string</span> fromFilter )</span> </span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">extractValue</span><span class=\"params\">( <span class=\"built_in\">string</span> fromFilter )</span> </span>;</div><div class=\"line\">  &#125; ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p><a href=\"/2011/06/08/textbasedrpgpart2\">Click here for part II</a></p>\n"},{"title":"Build A Text Based Multiplayer RPG Part II","date":"2011-06-08T07:00:00.000Z","_content":"[Click here for part I][link_part_1]\n[Click here for part III][link_part_3]\n\n# Intro\n\nIn this part of the tutorial we are going to write the methods and implement unit testing for the Item class introduced in part 1.\n\nUsing a test driven development style means that we have to think of the class design first as a set of tests which we want it to meet before we begin writing any of the code. However, before any of that we have to first design our test class.\n\n## The Test Singleton\n\nSo create a new C++ header file for your project and title it “Test.h” and type the following.\n\nIn this part of the tutorial we are going to write the methods and implement unit testing for the Item class introduced in part 1.\n\nUsing a test driven development style means that we have to think of the class design first as a set of tests which we want it to meet before we begin writing any of the code. However, before any of that we have to first design our test class.\n\nSo create a new C++ header file for your project and title it “Test.h” and type the following.\n```c\n// Filename Test.h\n#pragma once\n\n#include\"database.h\"\n\n#include<cassert>\n\nusing namespace MUD;\n```\n\nFor the test class we will implement it as a singleton. Singleton in short means that only a single reference to the class can be accessed at any given time during the program’s execution. However, there are some pitfalls to watch out for when using singleton for objects which clearly should not have a single instance, but in this case we only need to run our test cases once so having multiple test objects each running separate tests will only add confusion to our codebase. \n\n```c\n/*\n   The Test class uses the singleton design pattern in order to insure \n   that only one Test object will be availiable during program execution.\n */\nclass Test\n{\n  public:\n    // To call Test methods you have to get the Test instance reference.\n    static Test* get_instance();\n\n    // Place additional test methods here.\n    void test_item_class(void);\n\n  private:\n    // In singleton we have to keep the constuctor private\n    // to prevent accidental creation of more than one object.\n    Test(void){};\n    // Same deal with the copy constructor and the assignment operator,\n    // to prevent making duplicates.\n    Test(const Test& test_object){}; \n    Test& operator=(const Test& test_object){};\n\n    // This pointer will be the only instance of the Test class.\n    static Test* instance;\n};\n```\nNext, create a new C++ file and title it “Test.cpp”, now add the following lines of code.\n```c\n// Filename Test.cpp\n#include\"Test.h\"\n```\nIn order to utilize singleton we have to rely on a global reference to our Test instance which will only be initialized once as you can see below.\n```c\n// The only instance of the Test class we allow.\nTest* Test::instance = NULL; \n\n// Must be called in order to use the Test methods.\nTest* Test::get_instance()\n{\n  if(Test::instance == NULL)\n  {\n    instance = new Test;\n  }\n\n  return instance;\n}\n```\n\n<p>Therefore, whenever we want to run a method from our Test class we have to first get the reference and then call the proper test method.</p> <p>Enter the following code.</p> \n\n```c\nvoid Test::test_item_class(void)\n{\n```\n\n<p>If you recall from part 1 of this tutorial, the Item class represents things players can pick up and use to their advantage during the game. Thus we want to make sure that items can be named, have their effects set, their type set and lastly whether or not they are currently available within the dungeon for use. </p> <p>We’ll begin by testing the Item constructor, so enter the code below.</p> \n\n```c\n  // Item constructor test\n  Item test_sword(\"sword\", Item::WEAPON, 10, 0, 0);\n\n  assert(\"sword\" == test_sword.getName());\n  assert(Item::WEAPON == test_sword.getType());\n  assert(10 == test_sword.getPower());\n  assert(0 == test_sword.getVitality());\n  assert(0 == test_sword.getHealth());\n  assert(true == test_sword.mAvailiable);\n```\n<p>The idea with unit testing is that we check assertions or in other words we test our assumptions about how we believe the code should function. </p><p>There are many other types of testing such as functional testing and integration testing but all we need for this simple game is unit testing so don’t worry about testing becoming overkill we will get back to the game design soon enough.</p> <p>Next we test the assignment operator for the item class. Type the following,</p>\n\n```c\n// Item operator= test\nItem another_sword = test_sword;\n\nassert(\"sword\" == another_sword.getName());\nassert(Item::WEAPON == another_sword.getType());\nassert(10 == another_sword.getPower());\nassert(0 == another_sword.getVitality());\nassert(0 == another_sword.getHealth());\nassert(true == another_sword.mAvailiable);\n// The weapons shouldn't share the same memory address.\nassert(&another_sword != &test_sword);\n```\n\n<strong>Pay special attention to the last test.</strong>\n\n```c\n// The weapons shouldn't share the same memory address.\nassert(&another_sword != &test_sword);\n```\nOne of the reasons why C++ is considered a tough language to learn is that many programmers just want to avoid learning how pointers and references impact the use of C++’s object model. So lets check this out right quick with a short example.\n\nLets imagine the following scenario<strong><em>(don’t type these in yet since we haven’t implemented the actual methods in database.cpp)</em></strong>\n\n ```c\nItem woodsword = Item(\"woodsword\", Item::WEAPON, 9, 0, 0);\nItem barksword = woodsword;\n\ncout << \"barksword memory address = \" << &barksword << endl;\ncout << \"woodsword memory address = \" << &woodsword << endl;\ncout << \"woodsword->getName() == \" << woodsword.getName() << endl;\ncout << \"call barksword->setName(\\\"happysword\\\")\" << endl; \nbarksword.setName(\"happysword\");\ncout << \"woodsword->getName() == \" << woodsword.getName() << endl;\n```\n\nNote the different memory addresses of the two items. After changing the name of the “barksword” item, the “woodsword” remained intact. However, consider the next example...\n\n ```c\nItem* woodsword = new Item(\"woodsword\", Item::WEAPON, 9, 0, 0);\nItem* barksword = woodsword;\n\ncout << \"barksword memory address = \" << barksword << endl;\ncout << \"woodsword memory address = \" << woodsword << endl;\ncout << \"woodsword->getName() == \" << woodsword->getName() << endl;\ncout << \"call barksword->setName(\\\"happysword\\\")\" << endl; \nbarksword->setName(\"happysword\");\ncout << \"woodsword->getName() == \" << woodsword->getName() << endl;\n```\n\nDid you notice that changing the name of the “barksword” also changed the name of the “woodsword” to “happysword”. In addition look again at the memory address’, they are exactly the same. Here the C++ compiler did exactly what we told it to do and nothing more but we were unaware that the assignment of pointers meant that the bark and wood swords now reference the same item in memory. Here is what we meant to say to the compiler.\n\n ```c\nItem* woodsword = new Item(\"woodsword\", Item::WEAPON, 9, 0, 0);\nItem* barksword = new Item(woodsword->getName(), woodsword->getType(),\nwoodsword->getPower(), woodsword->getVitality(),\nwoodsword->getHealth());\n\ncout << \"barksword memory address = \" << barksword << endl;\ncout << \"woodsword memory address = \" << woodsword << endl;\ncout << \"woodsword->getName() == \" << woodsword->getName() << endl;\ncout << \"call barksword->setName(\\\"happysword\\\")\" << endl; \nbarksword->setName(\"happysword\");\ncout << \"woodsword->getName() == \" << woodsword->getName() << endl;\n```\n\nThus we meant for the attributes of the “woodsword” to be assigned to the “barksword” and for the “barksword” to have its own memory address. Now that we have demonstrated the reasoning behind the reference assertion in the unit test you can finally finish up the Item class test cases for the getter and setter methods.\n\n ```c\n  // Item void constructor test\n  Item void_sword;\n\n  assert(\"\" == void_sword.getName());\n  assert(Item::WEAPON == void_sword.getType());\n  assert(0 == void_sword.getPower());\n  assert(0 == void_sword.getVitality());\n  assert(0 == void_sword.getHealth());\n  assert(true == void_sword.mAvailiable);\n\n  // Item setters and getters test\n  void_sword.setPower(99);\n  void_sword.setName(\"steel sword\");\n  void_sword.setVitality(100);\n  void_sword.setType(Item::ARMOR);\n  void_sword.setHealth(36);\n  void_sword.mAvailiable = false;\n\n  assert(\"steel sword\" == void_sword.getName());\n  assert(Item::ARMOR == void_sword.getType());\n  assert(99 == void_sword.getPower());\n  assert(100 == void_sword.getVitality());\n  assert(36 == void_sword.getHealth());\n  assert(false == void_sword.mAvailiable);\n}\n```\n\nThat’s it for now. Oh wait, here is the whole source for Test.h and Test.cpp for reference.\n\n```c\n// Filename Test.h\n#pragma once\n\n#include\"database.h\"\n\n#include<cassert>\n\nusing namespace MUD;\n\n/*\n  The Test class uses the singleton design pattern in order to insure \n  that only one Test object will be availiable during program execution.\n*/\nclass Test\n{\n  public:\n    // To call Test methods you have to get the Test instance reference.\n    static Test* get_instance();\n\n    // Place additional test methods here.\n    void test_item_class(void);\n\n  private:\n    // In singleton we have to keep the constuctor private\n    // to prevent accidental creation of more than one object.\n    Test(void){};\n    // Same deal with the copy constructor and the assignment operator,\n    // to prevent making duplicates.\n    Test(const Test& test_object){}; \n    Test& operator=(const Test& test_object){};\n\n    // This pointer will be the only instance of the Test class.\n    static Test* instance;\n};\n```\n\n## Code Listing\n\n```c\n// Filename Test.cpp\n#include\"Test.h\"\n\n// The only instance of the Test class we allow.\nTest* Test::instance = NULL; \n\n// Must be called in order to use the Test methods.\nTest* Test::get_instance()\n{\n  if(Test::instance == NULL)\n  {\n    instance = new Test;\n  }\n\n  return instance;\n}\n\nvoid Test::test_item_class(void)\n{\n  // Item constructor test\n  Item test_sword(\"sword\", Item::WEAPON, 10, 0, 0);\n\n  assert(\"sword\" == test_sword.getName());\n  assert(Item::WEAPON == test_sword.getType());\n  assert(10 == test_sword.getPower());\n  assert(0 == test_sword.getVitality());\n  assert(0 == test_sword.getHealth());\n  assert(true == test_sword.mAvailiable);\n\n  // Item operator= test\n  Item another_sword = test_sword;\n\n  assert(\"sword\" == another_sword.getName());\n  assert(Item::WEAPON == another_sword.getType());\n  assert(10 == another_sword.getPower());\n  assert(0 == another_sword.getVitality());\n  assert(0 == another_sword.getHealth());\n  assert(true == another_sword.mAvailiable);\n  // The weapons shouldn't share the same memory address.\n  assert(&another_sword != &test_sword);\n\n  // Item void constructor test\n  Item void_sword;\n\n  assert(\"\" == void_sword.getName());\n  assert(Item::WEAPON == void_sword.getType());\n  assert(0 == void_sword.getPower());\n  assert(0 == void_sword.getVitality());\n  assert(0 == void_sword.getHealth());\n  assert(true == void_sword.mAvailiable);\n\n  // Item setters and getters test\n  void_sword.setPower(99);\n  void_sword.setName(\"steel sword\");\n  void_sword.setVitality(100);\n  void_sword.setType(Item::ARMOR);\n  void_sword.setHealth(36);\n  void_sword.mAvailiable = false;\n\n  assert(\"steel sword\" == void_sword.getName());\n  assert(Item::ARMOR == void_sword.getType());\n  assert(99 == void_sword.getPower());\n  assert(100 == void_sword.getVitality());\n  assert(36 == void_sword.getHealth());\n  assert(false == void_sword.mAvailiable);\n}\n```\n \n[Click here for part III][link_part_3]\n\n[link_part_1]: /2011/06/05/textbasedrpgpart1\n[link_part_3]: /2011/06/09/textbasedrpgpart3\n","source":"_posts/textbasedrpgpart2.md","raw":"---\ntitle: Build A Text Based Multiplayer RPG Part II\ndate: 2011-06-08\ncategories: [tutorial]\ntags: [cpp]\n---\n[Click here for part I][link_part_1]\n[Click here for part III][link_part_3]\n\n# Intro\n\nIn this part of the tutorial we are going to write the methods and implement unit testing for the Item class introduced in part 1.\n\nUsing a test driven development style means that we have to think of the class design first as a set of tests which we want it to meet before we begin writing any of the code. However, before any of that we have to first design our test class.\n\n## The Test Singleton\n\nSo create a new C++ header file for your project and title it “Test.h” and type the following.\n\nIn this part of the tutorial we are going to write the methods and implement unit testing for the Item class introduced in part 1.\n\nUsing a test driven development style means that we have to think of the class design first as a set of tests which we want it to meet before we begin writing any of the code. However, before any of that we have to first design our test class.\n\nSo create a new C++ header file for your project and title it “Test.h” and type the following.\n```c\n// Filename Test.h\n#pragma once\n\n#include\"database.h\"\n\n#include<cassert>\n\nusing namespace MUD;\n```\n\nFor the test class we will implement it as a singleton. Singleton in short means that only a single reference to the class can be accessed at any given time during the program’s execution. However, there are some pitfalls to watch out for when using singleton for objects which clearly should not have a single instance, but in this case we only need to run our test cases once so having multiple test objects each running separate tests will only add confusion to our codebase. \n\n```c\n/*\n   The Test class uses the singleton design pattern in order to insure \n   that only one Test object will be availiable during program execution.\n */\nclass Test\n{\n  public:\n    // To call Test methods you have to get the Test instance reference.\n    static Test* get_instance();\n\n    // Place additional test methods here.\n    void test_item_class(void);\n\n  private:\n    // In singleton we have to keep the constuctor private\n    // to prevent accidental creation of more than one object.\n    Test(void){};\n    // Same deal with the copy constructor and the assignment operator,\n    // to prevent making duplicates.\n    Test(const Test& test_object){}; \n    Test& operator=(const Test& test_object){};\n\n    // This pointer will be the only instance of the Test class.\n    static Test* instance;\n};\n```\nNext, create a new C++ file and title it “Test.cpp”, now add the following lines of code.\n```c\n// Filename Test.cpp\n#include\"Test.h\"\n```\nIn order to utilize singleton we have to rely on a global reference to our Test instance which will only be initialized once as you can see below.\n```c\n// The only instance of the Test class we allow.\nTest* Test::instance = NULL; \n\n// Must be called in order to use the Test methods.\nTest* Test::get_instance()\n{\n  if(Test::instance == NULL)\n  {\n    instance = new Test;\n  }\n\n  return instance;\n}\n```\n\n<p>Therefore, whenever we want to run a method from our Test class we have to first get the reference and then call the proper test method.</p> <p>Enter the following code.</p> \n\n```c\nvoid Test::test_item_class(void)\n{\n```\n\n<p>If you recall from part 1 of this tutorial, the Item class represents things players can pick up and use to their advantage during the game. Thus we want to make sure that items can be named, have their effects set, their type set and lastly whether or not they are currently available within the dungeon for use. </p> <p>We’ll begin by testing the Item constructor, so enter the code below.</p> \n\n```c\n  // Item constructor test\n  Item test_sword(\"sword\", Item::WEAPON, 10, 0, 0);\n\n  assert(\"sword\" == test_sword.getName());\n  assert(Item::WEAPON == test_sword.getType());\n  assert(10 == test_sword.getPower());\n  assert(0 == test_sword.getVitality());\n  assert(0 == test_sword.getHealth());\n  assert(true == test_sword.mAvailiable);\n```\n<p>The idea with unit testing is that we check assertions or in other words we test our assumptions about how we believe the code should function. </p><p>There are many other types of testing such as functional testing and integration testing but all we need for this simple game is unit testing so don’t worry about testing becoming overkill we will get back to the game design soon enough.</p> <p>Next we test the assignment operator for the item class. Type the following,</p>\n\n```c\n// Item operator= test\nItem another_sword = test_sword;\n\nassert(\"sword\" == another_sword.getName());\nassert(Item::WEAPON == another_sword.getType());\nassert(10 == another_sword.getPower());\nassert(0 == another_sword.getVitality());\nassert(0 == another_sword.getHealth());\nassert(true == another_sword.mAvailiable);\n// The weapons shouldn't share the same memory address.\nassert(&another_sword != &test_sword);\n```\n\n<strong>Pay special attention to the last test.</strong>\n\n```c\n// The weapons shouldn't share the same memory address.\nassert(&another_sword != &test_sword);\n```\nOne of the reasons why C++ is considered a tough language to learn is that many programmers just want to avoid learning how pointers and references impact the use of C++’s object model. So lets check this out right quick with a short example.\n\nLets imagine the following scenario<strong><em>(don’t type these in yet since we haven’t implemented the actual methods in database.cpp)</em></strong>\n\n ```c\nItem woodsword = Item(\"woodsword\", Item::WEAPON, 9, 0, 0);\nItem barksword = woodsword;\n\ncout << \"barksword memory address = \" << &barksword << endl;\ncout << \"woodsword memory address = \" << &woodsword << endl;\ncout << \"woodsword->getName() == \" << woodsword.getName() << endl;\ncout << \"call barksword->setName(\\\"happysword\\\")\" << endl; \nbarksword.setName(\"happysword\");\ncout << \"woodsword->getName() == \" << woodsword.getName() << endl;\n```\n\nNote the different memory addresses of the two items. After changing the name of the “barksword” item, the “woodsword” remained intact. However, consider the next example...\n\n ```c\nItem* woodsword = new Item(\"woodsword\", Item::WEAPON, 9, 0, 0);\nItem* barksword = woodsword;\n\ncout << \"barksword memory address = \" << barksword << endl;\ncout << \"woodsword memory address = \" << woodsword << endl;\ncout << \"woodsword->getName() == \" << woodsword->getName() << endl;\ncout << \"call barksword->setName(\\\"happysword\\\")\" << endl; \nbarksword->setName(\"happysword\");\ncout << \"woodsword->getName() == \" << woodsword->getName() << endl;\n```\n\nDid you notice that changing the name of the “barksword” also changed the name of the “woodsword” to “happysword”. In addition look again at the memory address’, they are exactly the same. Here the C++ compiler did exactly what we told it to do and nothing more but we were unaware that the assignment of pointers meant that the bark and wood swords now reference the same item in memory. Here is what we meant to say to the compiler.\n\n ```c\nItem* woodsword = new Item(\"woodsword\", Item::WEAPON, 9, 0, 0);\nItem* barksword = new Item(woodsword->getName(), woodsword->getType(),\nwoodsword->getPower(), woodsword->getVitality(),\nwoodsword->getHealth());\n\ncout << \"barksword memory address = \" << barksword << endl;\ncout << \"woodsword memory address = \" << woodsword << endl;\ncout << \"woodsword->getName() == \" << woodsword->getName() << endl;\ncout << \"call barksword->setName(\\\"happysword\\\")\" << endl; \nbarksword->setName(\"happysword\");\ncout << \"woodsword->getName() == \" << woodsword->getName() << endl;\n```\n\nThus we meant for the attributes of the “woodsword” to be assigned to the “barksword” and for the “barksword” to have its own memory address. Now that we have demonstrated the reasoning behind the reference assertion in the unit test you can finally finish up the Item class test cases for the getter and setter methods.\n\n ```c\n  // Item void constructor test\n  Item void_sword;\n\n  assert(\"\" == void_sword.getName());\n  assert(Item::WEAPON == void_sword.getType());\n  assert(0 == void_sword.getPower());\n  assert(0 == void_sword.getVitality());\n  assert(0 == void_sword.getHealth());\n  assert(true == void_sword.mAvailiable);\n\n  // Item setters and getters test\n  void_sword.setPower(99);\n  void_sword.setName(\"steel sword\");\n  void_sword.setVitality(100);\n  void_sword.setType(Item::ARMOR);\n  void_sword.setHealth(36);\n  void_sword.mAvailiable = false;\n\n  assert(\"steel sword\" == void_sword.getName());\n  assert(Item::ARMOR == void_sword.getType());\n  assert(99 == void_sword.getPower());\n  assert(100 == void_sword.getVitality());\n  assert(36 == void_sword.getHealth());\n  assert(false == void_sword.mAvailiable);\n}\n```\n\nThat’s it for now. Oh wait, here is the whole source for Test.h and Test.cpp for reference.\n\n```c\n// Filename Test.h\n#pragma once\n\n#include\"database.h\"\n\n#include<cassert>\n\nusing namespace MUD;\n\n/*\n  The Test class uses the singleton design pattern in order to insure \n  that only one Test object will be availiable during program execution.\n*/\nclass Test\n{\n  public:\n    // To call Test methods you have to get the Test instance reference.\n    static Test* get_instance();\n\n    // Place additional test methods here.\n    void test_item_class(void);\n\n  private:\n    // In singleton we have to keep the constuctor private\n    // to prevent accidental creation of more than one object.\n    Test(void){};\n    // Same deal with the copy constructor and the assignment operator,\n    // to prevent making duplicates.\n    Test(const Test& test_object){}; \n    Test& operator=(const Test& test_object){};\n\n    // This pointer will be the only instance of the Test class.\n    static Test* instance;\n};\n```\n\n## Code Listing\n\n```c\n// Filename Test.cpp\n#include\"Test.h\"\n\n// The only instance of the Test class we allow.\nTest* Test::instance = NULL; \n\n// Must be called in order to use the Test methods.\nTest* Test::get_instance()\n{\n  if(Test::instance == NULL)\n  {\n    instance = new Test;\n  }\n\n  return instance;\n}\n\nvoid Test::test_item_class(void)\n{\n  // Item constructor test\n  Item test_sword(\"sword\", Item::WEAPON, 10, 0, 0);\n\n  assert(\"sword\" == test_sword.getName());\n  assert(Item::WEAPON == test_sword.getType());\n  assert(10 == test_sword.getPower());\n  assert(0 == test_sword.getVitality());\n  assert(0 == test_sword.getHealth());\n  assert(true == test_sword.mAvailiable);\n\n  // Item operator= test\n  Item another_sword = test_sword;\n\n  assert(\"sword\" == another_sword.getName());\n  assert(Item::WEAPON == another_sword.getType());\n  assert(10 == another_sword.getPower());\n  assert(0 == another_sword.getVitality());\n  assert(0 == another_sword.getHealth());\n  assert(true == another_sword.mAvailiable);\n  // The weapons shouldn't share the same memory address.\n  assert(&another_sword != &test_sword);\n\n  // Item void constructor test\n  Item void_sword;\n\n  assert(\"\" == void_sword.getName());\n  assert(Item::WEAPON == void_sword.getType());\n  assert(0 == void_sword.getPower());\n  assert(0 == void_sword.getVitality());\n  assert(0 == void_sword.getHealth());\n  assert(true == void_sword.mAvailiable);\n\n  // Item setters and getters test\n  void_sword.setPower(99);\n  void_sword.setName(\"steel sword\");\n  void_sword.setVitality(100);\n  void_sword.setType(Item::ARMOR);\n  void_sword.setHealth(36);\n  void_sword.mAvailiable = false;\n\n  assert(\"steel sword\" == void_sword.getName());\n  assert(Item::ARMOR == void_sword.getType());\n  assert(99 == void_sword.getPower());\n  assert(100 == void_sword.getVitality());\n  assert(36 == void_sword.getHealth());\n  assert(false == void_sword.mAvailiable);\n}\n```\n \n[Click here for part III][link_part_3]\n\n[link_part_1]: /2011/06/05/textbasedrpgpart1\n[link_part_3]: /2011/06/09/textbasedrpgpart3\n","slug":"textbasedrpgpart2","published":1,"updated":"2017-04-12T03:24:54.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr22000s9uwvqkyttnbj","content":"<p><a href=\"/2011/06/05/textbasedrpgpart1\">Click here for part I</a><br><a href=\"/2011/06/09/textbasedrpgpart3\">Click here for part III</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>In this part of the tutorial we are going to write the methods and implement unit testing for the Item class introduced in part 1.</p>\n<p>Using a test driven development style means that we have to think of the class design first as a set of tests which we want it to meet before we begin writing any of the code. However, before any of that we have to first design our test class.</p>\n<h2 id=\"The-Test-Singleton\"><a href=\"#The-Test-Singleton\" class=\"headerlink\" title=\"The Test Singleton\"></a>The Test Singleton</h2><p>So create a new C++ header file for your project and title it “Test.h” and type the following.</p>\n<p>In this part of the tutorial we are going to write the methods and implement unit testing for the Item class introduced in part 1.</p>\n<p>Using a test driven development style means that we have to think of the class design first as a set of tests which we want it to meet before we begin writing any of the code. However, before any of that we have to first design our test class.</p>\n<p>So create a new C++ header file for your project and title it “Test.h” and type the following.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Filename Test.h</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"database.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cassert&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD;</div></pre></td></tr></table></figure></p>\n<p>For the test class we will implement it as a singleton. Singleton in short means that only a single reference to the class can be accessed at any given time during the program’s execution. However, there are some pitfalls to watch out for when using singleton for objects which clearly should not have a single instance, but in this case we only need to run our test cases once so having multiple test objects each running separate tests will only add confusion to our codebase. </p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/*</span></div><div class=\"line\">   The Test class uses the singleton design pattern in order to insure </div><div class=\"line\">   that only one Test object will be availiable during program execution.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">class</span> Test</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"comment\">// To call Test methods you have to get the Test instance reference.</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> Test* <span class=\"title\">get_instance</span><span class=\"params\">()</span></span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Place additional test methods here.</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_item_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span>:</div><div class=\"line\">    <span class=\"comment\">// In singleton we have to keep the constuctor private</span></div><div class=\"line\">    <span class=\"comment\">// to prevent accidental creation of more than one object.</span></div><div class=\"line\">    Test(<span class=\"keyword\">void</span>)&#123;&#125;;</div><div class=\"line\">    <span class=\"comment\">// Same deal with the copy constructor and the assignment operator,</span></div><div class=\"line\">    <span class=\"comment\">// to prevent making duplicates.</span></div><div class=\"line\">    Test(<span class=\"keyword\">const</span> Test&amp; test_object)&#123;&#125;; </div><div class=\"line\">    Test&amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> Test&amp; test_object)&#123;&#125;;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// This pointer will be the only instance of the Test class.</span></div><div class=\"line\">    <span class=\"keyword\">static</span> Test* instance;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<p>Next, create a new C++ file and title it “Test.cpp”, now add the following lines of code.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Filename Test.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"Test.h\"</span></span></div></pre></td></tr></table></figure></p>\n<p>In order to utilize singleton we have to rely on a global reference to our Test instance which will only be initialized once as you can see below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// The only instance of the Test class we allow.</span></div><div class=\"line\">Test* Test::instance = <span class=\"literal\">NULL</span>; </div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Must be called in order to use the Test methods.</span></div><div class=\"line\">Test* Test::get_instance()</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span>(Test::instance == <span class=\"literal\">NULL</span>)</div><div class=\"line\">  &#123;</div><div class=\"line\">    instance = <span class=\"keyword\">new</span> Test;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> instance;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Therefore, whenever we want to run a method from our Test class we have to first get the reference and then call the proper test method.</p> <p>Enter the following code.</p> \n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_item_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div></pre></td></tr></table></figure>\n<p>If you recall from part 1 of this tutorial, the Item class represents things players can pick up and use to their advantage during the game. Thus we want to make sure that items can be named, have their effects set, their type set and lastly whether or not they are currently available within the dungeon for use. </p> <p>We’ll begin by testing the Item constructor, so enter the code below.</p> \n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Item constructor test</span></div><div class=\"line\"><span class=\"function\">Item <span class=\"title\">test_sword</span><span class=\"params\">(<span class=\"string\">\"sword\"</span>, Item::WEAPON, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">assert(<span class=\"string\">\"sword\"</span> == test_sword.getName());</div><div class=\"line\">assert(Item::WEAPON == test_sword.getType());</div><div class=\"line\">assert(<span class=\"number\">10</span> == test_sword.getPower());</div><div class=\"line\">assert(<span class=\"number\">0</span> == test_sword.getVitality());</div><div class=\"line\">assert(<span class=\"number\">0</span> == test_sword.getHealth());</div><div class=\"line\">assert(<span class=\"literal\">true</span> == test_sword.mAvailiable);</div></pre></td></tr></table></figure>\n<p>The idea with unit testing is that we check assertions or in other words we test our assumptions about how we believe the code should function. </p><p>There are many other types of testing such as functional testing and integration testing but all we need for this simple game is unit testing so don’t worry about testing becoming overkill we will get back to the game design soon enough.</p> <p>Next we test the assignment operator for the item class. Type the following,</p>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Item operator= test</span></div><div class=\"line\">Item another_sword = test_sword;</div><div class=\"line\"></div><div class=\"line\">assert(<span class=\"string\">\"sword\"</span> == another_sword.getName());</div><div class=\"line\">assert(Item::WEAPON == another_sword.getType());</div><div class=\"line\">assert(<span class=\"number\">10</span> == another_sword.getPower());</div><div class=\"line\">assert(<span class=\"number\">0</span> == another_sword.getVitality());</div><div class=\"line\">assert(<span class=\"number\">0</span> == another_sword.getHealth());</div><div class=\"line\">assert(<span class=\"literal\">true</span> == another_sword.mAvailiable);</div><div class=\"line\"><span class=\"comment\">// The weapons shouldn't share the same memory address.</span></div><div class=\"line\">assert(&amp;another_sword != &amp;test_sword);</div></pre></td></tr></table></figure>\n<p><strong>Pay special attention to the last test.</strong></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// The weapons shouldn't share the same memory address.</span></div><div class=\"line\">assert(&amp;another_sword != &amp;test_sword);</div></pre></td></tr></table></figure>\n<p>One of the reasons why C++ is considered a tough language to learn is that many programmers just want to avoid learning how pointers and references impact the use of C++’s object model. So lets check this out right quick with a short example.</p>\n<p>Lets imagine the following scenario<strong><em>(don’t type these in yet since we haven’t implemented the actual methods in database.cpp)</em></strong></p>\n <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">Item woodsword = Item(<span class=\"string\">\"woodsword\"</span>, Item::WEAPON, <span class=\"number\">9</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">Item barksword = woodsword;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"barksword memory address = \"</span> &lt;&lt; &amp;barksword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword memory address = \"</span> &lt;&lt; &amp;woodsword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword.getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"call barksword-&gt;setName(\\\"happysword\\\")\"</span> &lt;&lt; <span class=\"built_in\">endl</span>; </div><div class=\"line\">barksword.setName(<span class=\"string\">\"happysword\"</span>);</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword.getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div></pre></td></tr></table></figure>\n<p>Note the different memory addresses of the two items. After changing the name of the “barksword” item, the “woodsword” remained intact. However, consider the next example…</p>\n <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">Item* woodsword = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"woodsword\"</span>, Item::WEAPON, <span class=\"number\">9</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">Item* barksword = woodsword;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"barksword memory address = \"</span> &lt;&lt; barksword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword memory address = \"</span> &lt;&lt; woodsword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword-&gt;getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"call barksword-&gt;setName(\\\"happysword\\\")\"</span> &lt;&lt; <span class=\"built_in\">endl</span>; </div><div class=\"line\">barksword-&gt;setName(<span class=\"string\">\"happysword\"</span>);</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword-&gt;getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div></pre></td></tr></table></figure>\n<p>Did you notice that changing the name of the “barksword” also changed the name of the “woodsword” to “happysword”. In addition look again at the memory address’, they are exactly the same. Here the C++ compiler did exactly what we told it to do and nothing more but we were unaware that the assignment of pointers meant that the bark and wood swords now reference the same item in memory. Here is what we meant to say to the compiler.</p>\n <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">Item* woodsword = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"woodsword\"</span>, Item::WEAPON, <span class=\"number\">9</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">Item* barksword = <span class=\"keyword\">new</span> Item(woodsword-&gt;getName(), woodsword-&gt;getType(),</div><div class=\"line\">woodsword-&gt;getPower(), woodsword-&gt;getVitality(),</div><div class=\"line\">woodsword-&gt;getHealth());</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"barksword memory address = \"</span> &lt;&lt; barksword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword memory address = \"</span> &lt;&lt; woodsword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword-&gt;getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"call barksword-&gt;setName(\\\"happysword\\\")\"</span> &lt;&lt; <span class=\"built_in\">endl</span>; </div><div class=\"line\">barksword-&gt;setName(<span class=\"string\">\"happysword\"</span>);</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword-&gt;getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div></pre></td></tr></table></figure>\n<p>Thus we meant for the attributes of the “woodsword” to be assigned to the “barksword” and for the “barksword” to have its own memory address. Now that we have demonstrated the reasoning behind the reference assertion in the unit test you can finally finish up the Item class test cases for the getter and setter methods.</p>\n <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Item void constructor test</span></div><div class=\"line\">  Item void_sword;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"\"</span> == void_sword.getName());</div><div class=\"line\">  assert(Item::WEAPON == void_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == void_sword.mAvailiable);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Item setters and getters test</span></div><div class=\"line\">  void_sword.setPower(<span class=\"number\">99</span>);</div><div class=\"line\">  void_sword.setName(<span class=\"string\">\"steel sword\"</span>);</div><div class=\"line\">  void_sword.setVitality(<span class=\"number\">100</span>);</div><div class=\"line\">  void_sword.setType(Item::ARMOR);</div><div class=\"line\">  void_sword.setHealth(<span class=\"number\">36</span>);</div><div class=\"line\">  void_sword.mAvailiable = <span class=\"literal\">false</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"steel sword\"</span> == void_sword.getName());</div><div class=\"line\">  assert(Item::ARMOR == void_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">99</span> == void_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">100</span> == void_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">36</span> == void_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == void_sword.mAvailiable);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>That’s it for now. Oh wait, here is the whole source for Test.h and Test.cpp for reference.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Filename Test.h</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"database.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cassert&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/*</span></div><div class=\"line\">  The Test class uses the singleton design pattern in order to insure </div><div class=\"line\">  that only one Test object will be availiable during program execution.</div><div class=\"line\">*/</div><div class=\"line\"><span class=\"keyword\">class</span> Test</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"comment\">// To call Test methods you have to get the Test instance reference.</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> Test* <span class=\"title\">get_instance</span><span class=\"params\">()</span></span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Place additional test methods here.</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_item_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span>:</div><div class=\"line\">    <span class=\"comment\">// In singleton we have to keep the constuctor private</span></div><div class=\"line\">    <span class=\"comment\">// to prevent accidental creation of more than one object.</span></div><div class=\"line\">    Test(<span class=\"keyword\">void</span>)&#123;&#125;;</div><div class=\"line\">    <span class=\"comment\">// Same deal with the copy constructor and the assignment operator,</span></div><div class=\"line\">    <span class=\"comment\">// to prevent making duplicates.</span></div><div class=\"line\">    Test(<span class=\"keyword\">const</span> Test&amp; test_object)&#123;&#125;; </div><div class=\"line\">    Test&amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> Test&amp; test_object)&#123;&#125;;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// This pointer will be the only instance of the Test class.</span></div><div class=\"line\">    <span class=\"keyword\">static</span> Test* instance;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<h2 id=\"Code-Listing\"><a href=\"#Code-Listing\" class=\"headerlink\" title=\"Code Listing\"></a>Code Listing</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Filename Test.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"Test.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// The only instance of the Test class we allow.</span></div><div class=\"line\">Test* Test::instance = <span class=\"literal\">NULL</span>; </div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Must be called in order to use the Test methods.</span></div><div class=\"line\">Test* Test::get_instance()</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span>(Test::instance == <span class=\"literal\">NULL</span>)</div><div class=\"line\">  &#123;</div><div class=\"line\">    instance = <span class=\"keyword\">new</span> Test;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> instance;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Test::test_item_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Item constructor test</span></div><div class=\"line\">  <span class=\"function\">Item <span class=\"title\">test_sword</span><span class=\"params\">(<span class=\"string\">\"sword\"</span>, Item::WEAPON, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"sword\"</span> == test_sword.getName());</div><div class=\"line\">  assert(Item::WEAPON == test_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">10</span> == test_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == test_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == test_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == test_sword.mAvailiable);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Item operator= test</span></div><div class=\"line\">  Item another_sword = test_sword;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"sword\"</span> == another_sword.getName());</div><div class=\"line\">  assert(Item::WEAPON == another_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">10</span> == another_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == another_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == another_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == another_sword.mAvailiable);</div><div class=\"line\">  <span class=\"comment\">// The weapons shouldn't share the same memory address.</span></div><div class=\"line\">  assert(&amp;another_sword != &amp;test_sword);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Item void constructor test</span></div><div class=\"line\">  Item void_sword;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"\"</span> == void_sword.getName());</div><div class=\"line\">  assert(Item::WEAPON == void_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == void_sword.mAvailiable);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Item setters and getters test</span></div><div class=\"line\">  void_sword.setPower(<span class=\"number\">99</span>);</div><div class=\"line\">  void_sword.setName(<span class=\"string\">\"steel sword\"</span>);</div><div class=\"line\">  void_sword.setVitality(<span class=\"number\">100</span>);</div><div class=\"line\">  void_sword.setType(Item::ARMOR);</div><div class=\"line\">  void_sword.setHealth(<span class=\"number\">36</span>);</div><div class=\"line\">  void_sword.mAvailiable = <span class=\"literal\">false</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"steel sword\"</span> == void_sword.getName());</div><div class=\"line\">  assert(Item::ARMOR == void_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">99</span> == void_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">100</span> == void_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">36</span> == void_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == void_sword.mAvailiable);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p><a href=\"/2011/06/09/textbasedrpgpart3\">Click here for part III</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"/2011/06/05/textbasedrpgpart1\">Click here for part I</a><br><a href=\"/2011/06/09/textbasedrpgpart3\">Click here for part III</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>In this part of the tutorial we are going to write the methods and implement unit testing for the Item class introduced in part 1.</p>\n<p>Using a test driven development style means that we have to think of the class design first as a set of tests which we want it to meet before we begin writing any of the code. However, before any of that we have to first design our test class.</p>\n<h2 id=\"The-Test-Singleton\"><a href=\"#The-Test-Singleton\" class=\"headerlink\" title=\"The Test Singleton\"></a>The Test Singleton</h2><p>So create a new C++ header file for your project and title it “Test.h” and type the following.</p>\n<p>In this part of the tutorial we are going to write the methods and implement unit testing for the Item class introduced in part 1.</p>\n<p>Using a test driven development style means that we have to think of the class design first as a set of tests which we want it to meet before we begin writing any of the code. However, before any of that we have to first design our test class.</p>\n<p>So create a new C++ header file for your project and title it “Test.h” and type the following.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Filename Test.h</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"database.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cassert&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD;</div></pre></td></tr></table></figure></p>\n<p>For the test class we will implement it as a singleton. Singleton in short means that only a single reference to the class can be accessed at any given time during the program’s execution. However, there are some pitfalls to watch out for when using singleton for objects which clearly should not have a single instance, but in this case we only need to run our test cases once so having multiple test objects each running separate tests will only add confusion to our codebase. </p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/*</div><div class=\"line\">   The Test class uses the singleton design pattern in order to insure </div><div class=\"line\">   that only one Test object will be availiable during program execution.</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">class</span> Test</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"comment\">// To call Test methods you have to get the Test instance reference.</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> Test* <span class=\"title\">get_instance</span><span class=\"params\">()</span></span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Place additional test methods here.</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_item_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span>:</div><div class=\"line\">    <span class=\"comment\">// In singleton we have to keep the constuctor private</span></div><div class=\"line\">    <span class=\"comment\">// to prevent accidental creation of more than one object.</span></div><div class=\"line\">    Test(<span class=\"keyword\">void</span>)&#123;&#125;;</div><div class=\"line\">    <span class=\"comment\">// Same deal with the copy constructor and the assignment operator,</span></div><div class=\"line\">    <span class=\"comment\">// to prevent making duplicates.</span></div><div class=\"line\">    Test(<span class=\"keyword\">const</span> Test&amp; test_object)&#123;&#125;; </div><div class=\"line\">    Test&amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> Test&amp; test_object)&#123;&#125;;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// This pointer will be the only instance of the Test class.</span></div><div class=\"line\">    <span class=\"keyword\">static</span> Test* instance;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<p>Next, create a new C++ file and title it “Test.cpp”, now add the following lines of code.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Filename Test.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"Test.h\"</span></span></div></pre></td></tr></table></figure></p>\n<p>In order to utilize singleton we have to rely on a global reference to our Test instance which will only be initialized once as you can see below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// The only instance of the Test class we allow.</span></div><div class=\"line\">Test* Test::instance = <span class=\"literal\">NULL</span>; </div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Must be called in order to use the Test methods.</span></div><div class=\"line\">Test* Test::get_instance()</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span>(Test::instance == <span class=\"literal\">NULL</span>)</div><div class=\"line\">  &#123;</div><div class=\"line\">    instance = <span class=\"keyword\">new</span> Test;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> instance;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Therefore, whenever we want to run a method from our Test class we have to first get the reference and then call the proper test method.</p> <p>Enter the following code.</p> \n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_item_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div></pre></td></tr></table></figure>\n<p>If you recall from part 1 of this tutorial, the Item class represents things players can pick up and use to their advantage during the game. Thus we want to make sure that items can be named, have their effects set, their type set and lastly whether or not they are currently available within the dungeon for use. </p> <p>We’ll begin by testing the Item constructor, so enter the code below.</p> \n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Item constructor test</span></div><div class=\"line\"><span class=\"function\">Item <span class=\"title\">test_sword</span><span class=\"params\">(<span class=\"string\">\"sword\"</span>, Item::WEAPON, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">assert(<span class=\"string\">\"sword\"</span> == test_sword.getName());</div><div class=\"line\">assert(Item::WEAPON == test_sword.getType());</div><div class=\"line\">assert(<span class=\"number\">10</span> == test_sword.getPower());</div><div class=\"line\">assert(<span class=\"number\">0</span> == test_sword.getVitality());</div><div class=\"line\">assert(<span class=\"number\">0</span> == test_sword.getHealth());</div><div class=\"line\">assert(<span class=\"literal\">true</span> == test_sword.mAvailiable);</div></pre></td></tr></table></figure>\n<p>The idea with unit testing is that we check assertions or in other words we test our assumptions about how we believe the code should function. </p><p>There are many other types of testing such as functional testing and integration testing but all we need for this simple game is unit testing so don’t worry about testing becoming overkill we will get back to the game design soon enough.</p> <p>Next we test the assignment operator for the item class. Type the following,</p>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Item operator= test</span></div><div class=\"line\">Item another_sword = test_sword;</div><div class=\"line\"></div><div class=\"line\">assert(<span class=\"string\">\"sword\"</span> == another_sword.getName());</div><div class=\"line\">assert(Item::WEAPON == another_sword.getType());</div><div class=\"line\">assert(<span class=\"number\">10</span> == another_sword.getPower());</div><div class=\"line\">assert(<span class=\"number\">0</span> == another_sword.getVitality());</div><div class=\"line\">assert(<span class=\"number\">0</span> == another_sword.getHealth());</div><div class=\"line\">assert(<span class=\"literal\">true</span> == another_sword.mAvailiable);</div><div class=\"line\"><span class=\"comment\">// The weapons shouldn't share the same memory address.</span></div><div class=\"line\">assert(&amp;another_sword != &amp;test_sword);</div></pre></td></tr></table></figure>\n<p><strong>Pay special attention to the last test.</strong></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// The weapons shouldn't share the same memory address.</span></div><div class=\"line\">assert(&amp;another_sword != &amp;test_sword);</div></pre></td></tr></table></figure>\n<p>One of the reasons why C++ is considered a tough language to learn is that many programmers just want to avoid learning how pointers and references impact the use of C++’s object model. So lets check this out right quick with a short example.</p>\n<p>Lets imagine the following scenario<strong><em>(don’t type these in yet since we haven’t implemented the actual methods in database.cpp)</em></strong></p>\n <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">Item woodsword = Item(<span class=\"string\">\"woodsword\"</span>, Item::WEAPON, <span class=\"number\">9</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">Item barksword = woodsword;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"barksword memory address = \"</span> &lt;&lt; &amp;barksword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword memory address = \"</span> &lt;&lt; &amp;woodsword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword.getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"call barksword-&gt;setName(\\\"happysword\\\")\"</span> &lt;&lt; <span class=\"built_in\">endl</span>; </div><div class=\"line\">barksword.setName(<span class=\"string\">\"happysword\"</span>);</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword.getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div></pre></td></tr></table></figure>\n<p>Note the different memory addresses of the two items. After changing the name of the “barksword” item, the “woodsword” remained intact. However, consider the next example…</p>\n <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">Item* woodsword = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"woodsword\"</span>, Item::WEAPON, <span class=\"number\">9</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">Item* barksword = woodsword;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"barksword memory address = \"</span> &lt;&lt; barksword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword memory address = \"</span> &lt;&lt; woodsword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword-&gt;getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"call barksword-&gt;setName(\\\"happysword\\\")\"</span> &lt;&lt; <span class=\"built_in\">endl</span>; </div><div class=\"line\">barksword-&gt;setName(<span class=\"string\">\"happysword\"</span>);</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword-&gt;getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div></pre></td></tr></table></figure>\n<p>Did you notice that changing the name of the “barksword” also changed the name of the “woodsword” to “happysword”. In addition look again at the memory address’, they are exactly the same. Here the C++ compiler did exactly what we told it to do and nothing more but we were unaware that the assignment of pointers meant that the bark and wood swords now reference the same item in memory. Here is what we meant to say to the compiler.</p>\n <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">Item* woodsword = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"woodsword\"</span>, Item::WEAPON, <span class=\"number\">9</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">Item* barksword = <span class=\"keyword\">new</span> Item(woodsword-&gt;getName(), woodsword-&gt;getType(),</div><div class=\"line\">woodsword-&gt;getPower(), woodsword-&gt;getVitality(),</div><div class=\"line\">woodsword-&gt;getHealth());</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"barksword memory address = \"</span> &lt;&lt; barksword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword memory address = \"</span> &lt;&lt; woodsword &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword-&gt;getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"call barksword-&gt;setName(\\\"happysword\\\")\"</span> &lt;&lt; <span class=\"built_in\">endl</span>; </div><div class=\"line\">barksword-&gt;setName(<span class=\"string\">\"happysword\"</span>);</div><div class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"woodsword-&gt;getName() == \"</span> &lt;&lt; woodsword-&gt;getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div></pre></td></tr></table></figure>\n<p>Thus we meant for the attributes of the “woodsword” to be assigned to the “barksword” and for the “barksword” to have its own memory address. Now that we have demonstrated the reasoning behind the reference assertion in the unit test you can finally finish up the Item class test cases for the getter and setter methods.</p>\n <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Item void constructor test</span></div><div class=\"line\">  Item void_sword;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"\"</span> == void_sword.getName());</div><div class=\"line\">  assert(Item::WEAPON == void_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == void_sword.mAvailiable);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Item setters and getters test</span></div><div class=\"line\">  void_sword.setPower(<span class=\"number\">99</span>);</div><div class=\"line\">  void_sword.setName(<span class=\"string\">\"steel sword\"</span>);</div><div class=\"line\">  void_sword.setVitality(<span class=\"number\">100</span>);</div><div class=\"line\">  void_sword.setType(Item::ARMOR);</div><div class=\"line\">  void_sword.setHealth(<span class=\"number\">36</span>);</div><div class=\"line\">  void_sword.mAvailiable = <span class=\"literal\">false</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"steel sword\"</span> == void_sword.getName());</div><div class=\"line\">  assert(Item::ARMOR == void_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">99</span> == void_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">100</span> == void_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">36</span> == void_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == void_sword.mAvailiable);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>That’s it for now. Oh wait, here is the whole source for Test.h and Test.cpp for reference.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Filename Test.h</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"database.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cassert&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/*</div><div class=\"line\">  The Test class uses the singleton design pattern in order to insure </div><div class=\"line\">  that only one Test object will be availiable during program execution.</div><div class=\"line\">*/</span></div><div class=\"line\"><span class=\"keyword\">class</span> Test</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"comment\">// To call Test methods you have to get the Test instance reference.</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> Test* <span class=\"title\">get_instance</span><span class=\"params\">()</span></span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Place additional test methods here.</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_item_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span>:</div><div class=\"line\">    <span class=\"comment\">// In singleton we have to keep the constuctor private</span></div><div class=\"line\">    <span class=\"comment\">// to prevent accidental creation of more than one object.</span></div><div class=\"line\">    Test(<span class=\"keyword\">void</span>)&#123;&#125;;</div><div class=\"line\">    <span class=\"comment\">// Same deal with the copy constructor and the assignment operator,</span></div><div class=\"line\">    <span class=\"comment\">// to prevent making duplicates.</span></div><div class=\"line\">    Test(<span class=\"keyword\">const</span> Test&amp; test_object)&#123;&#125;; </div><div class=\"line\">    Test&amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> Test&amp; test_object)&#123;&#125;;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// This pointer will be the only instance of the Test class.</span></div><div class=\"line\">    <span class=\"keyword\">static</span> Test* instance;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<h2 id=\"Code-Listing\"><a href=\"#Code-Listing\" class=\"headerlink\" title=\"Code Listing\"></a>Code Listing</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Filename Test.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"Test.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// The only instance of the Test class we allow.</span></div><div class=\"line\">Test* Test::instance = <span class=\"literal\">NULL</span>; </div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Must be called in order to use the Test methods.</span></div><div class=\"line\">Test* Test::get_instance()</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span>(Test::instance == <span class=\"literal\">NULL</span>)</div><div class=\"line\">  &#123;</div><div class=\"line\">    instance = <span class=\"keyword\">new</span> Test;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> instance;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Test::test_item_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Item constructor test</span></div><div class=\"line\">  <span class=\"function\">Item <span class=\"title\">test_sword</span><span class=\"params\">(<span class=\"string\">\"sword\"</span>, Item::WEAPON, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"sword\"</span> == test_sword.getName());</div><div class=\"line\">  assert(Item::WEAPON == test_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">10</span> == test_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == test_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == test_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == test_sword.mAvailiable);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Item operator= test</span></div><div class=\"line\">  Item another_sword = test_sword;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"sword\"</span> == another_sword.getName());</div><div class=\"line\">  assert(Item::WEAPON == another_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">10</span> == another_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == another_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == another_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == another_sword.mAvailiable);</div><div class=\"line\">  <span class=\"comment\">// The weapons shouldn't share the same memory address.</span></div><div class=\"line\">  assert(&amp;another_sword != &amp;test_sword);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Item void constructor test</span></div><div class=\"line\">  Item void_sword;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"\"</span> == void_sword.getName());</div><div class=\"line\">  assert(Item::WEAPON == void_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">0</span> == void_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == void_sword.mAvailiable);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Item setters and getters test</span></div><div class=\"line\">  void_sword.setPower(<span class=\"number\">99</span>);</div><div class=\"line\">  void_sword.setName(<span class=\"string\">\"steel sword\"</span>);</div><div class=\"line\">  void_sword.setVitality(<span class=\"number\">100</span>);</div><div class=\"line\">  void_sword.setType(Item::ARMOR);</div><div class=\"line\">  void_sword.setHealth(<span class=\"number\">36</span>);</div><div class=\"line\">  void_sword.mAvailiable = <span class=\"literal\">false</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"steel sword\"</span> == void_sword.getName());</div><div class=\"line\">  assert(Item::ARMOR == void_sword.getType());</div><div class=\"line\">  assert(<span class=\"number\">99</span> == void_sword.getPower());</div><div class=\"line\">  assert(<span class=\"number\">100</span> == void_sword.getVitality());</div><div class=\"line\">  assert(<span class=\"number\">36</span> == void_sword.getHealth());</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == void_sword.mAvailiable);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p><a href=\"/2011/06/09/textbasedrpgpart3\">Click here for part III</a></p>\n"},{"title":"Build A Text Based Multiplayer RPG Part III","date":"2011-06-09T07:00:00.000Z","_content":"[Click here for part II][link_part_2]\n[Click here for part IV][link_part_4]\n\n# Intro\n\nAfter writing the code to support the unit test in part II, beginning in this part we'll look at the code behind the test to verify that our test are sound and correct.\nWhere we left off we had just implemented the unit test for the Item class. However, before we can even run the test we have to first write out the methods. So create a new C++ file, title it “database.cpp” and add it to your project’s directory. Now go ahead and type in the following.\n```c\n// Filename database.cpp\n#include \"Database.h\"\n\nusing namespace MUD ;\n```\nFor the first method of the Item class we’ll define the method for the Item’s constructor. The Item constructor will just take a single argument for each of its attributes as we defined in the “database.h” file. Here is the Item class definition in the header file again as a refresher.\n```c\nclass Item\n{\n  public:\n    enum TYPE { WEAPON, ARMOR, HEALTH } ;\n\n    Item( string name, Item::TYPE type, int power, int vitality, int health ) ;\n    Item operator=( Item& newItem ) ;\n    Item( void ) ;\n    //~Item()\n\n    void setPower( int value ) ;\n    int getPower( void ) ;\n\n    void setVitality( int value ) ;\n    int getVitality( void ) ;\n\n    void setHealth( int value ) ;\n    int getHealth( void ) ;\n\n    void setName( string name ) ;\n    string getName( void ) ;\n\n    void setType( TYPE newType ) ;\n    TYPE getType( void ) ;\n\n    string mName ;\n    int mPower ;\n    int mVitality ;\n    int mHealth ;\n    TYPE mType ;\n    bool mAvailiable ;\n} ;\n```\nAs you’ll notice there are five attributes which have getter and setter methods while the sixth attribute of the Item class “mAvailiable” will not require getter and setter methods. Thus the constructor should allow a new Item to be created given some initial values for each of the five attributes we mentioned.\n```c\n  Item::Item( string name, Item::TYPE type, int power, int vitality, int health ) \n: mName(name), mType(type), mPower(power), mVitality(vitality), \n  mHealth(health)\n{\n  mAvailiable = true ;\n}\n```\nNext we’ll overload the assignment operator for the Item class. For this operator overload we just want to the copy one Item’s attributes to another Item’s.  \n```c\nItem Item::operator=( Item& newItem )\n{\n  setName( newItem.getName() ) ;\n  setType( newItem.getType() ) ;\n  setPower( newItem.getPower() ) ;\n  setVitality( newItem.getVitality() ) ;\n  setHealth( newItem.getHealth() ) ;\n  mAvailiable = newItem.mAvailiable ;\n\n  return *this ;\n}\n```\nAfterwards we turn our attention to the Item class’ default constructor. The default constructor for the Item should just create a blank Item that will be completely useless but still available for pickup. In addition since the item will not have a name, we can always check for the condition when a Item was accidently created in our game by seeing if the Item’s name is the empty string.\n```c\n// The default Item::TYPE doesn't have to be Item::TYPE::WEAPON\n// as long as its not NULL its fine.\nItem::Item( void )\n{\n  setName( \"\" ) ;\n  setType( Item::WEAPON ) ;\n  setPower( 0 ) ;\n  setVitality( 0 ) ;\n  setHealth( 0 ) ;\n  mAvailiable = true ;\n}\n```\nThe remaining methods are the getters and setters for the attributes power, vitality, health, name and type. Getters and setters in general for the C++ language are a pair of methods that allow you to write a value to an attribute or read the current value from an attribute. Anyways here they are below. \n```c\nvoid Item::setPower( int value )\n{\n  mPower = value ;\n}\n\nint Item::getPower( void )\n{\n  return mPower ;\n}\n\nvoid Item::setVitality( int value )\n{\n  mVitality = value ;\n}\n\nint Item::getVitality( void )\n{\n  return mVitality ;\n}\n\nvoid Item::setHealth( int value )\n{\n  mHealth = value ;\n}\n\nint Item::getHealth( void )\n{\n  return mHealth ;\n}\n\nvoid Item::setName( string name )\n{\n  mName = name ;\n}\n\nstring Item::getName( void )\n{\n  return mName ;\n}\n\nvoid Item::setType( Item::TYPE newType )\n{\n  mType = newType ;\n}\n\nItem::TYPE Item::getType( void )\n{\n  return mType ;\n}\n```\nLastly we’ll run the test for our Item class; to begin create a new C++ file and title it “main.cpp”. Add the the code below to “main.cpp”. Remember that to use our Test object we have to call the “get_instance()” method since we created Test as a singleton. \n```c\n//Filename main.cpp\n#include \"Database.h\"\n#include\"Test.h\"\n\nusing namespace MUD ;\n\nint main(void)\n{\n  Test::get_instance()->test_item_class();\n}\n```\nOk, that’s it for today.\n\n[link_part_2]: /2011/06/08/textbasedrpgpart2\n[link_part_4]: /2011/06/11/textbasedrpgpart4\n","source":"_posts/textbasedrpgpart3.md","raw":"---\ntitle: Build A Text Based Multiplayer RPG Part III\ndate: 2011-06-09\ncategories: [tutorial]\ntags: [cpp]\n---\n[Click here for part II][link_part_2]\n[Click here for part IV][link_part_4]\n\n# Intro\n\nAfter writing the code to support the unit test in part II, beginning in this part we'll look at the code behind the test to verify that our test are sound and correct.\nWhere we left off we had just implemented the unit test for the Item class. However, before we can even run the test we have to first write out the methods. So create a new C++ file, title it “database.cpp” and add it to your project’s directory. Now go ahead and type in the following.\n```c\n// Filename database.cpp\n#include \"Database.h\"\n\nusing namespace MUD ;\n```\nFor the first method of the Item class we’ll define the method for the Item’s constructor. The Item constructor will just take a single argument for each of its attributes as we defined in the “database.h” file. Here is the Item class definition in the header file again as a refresher.\n```c\nclass Item\n{\n  public:\n    enum TYPE { WEAPON, ARMOR, HEALTH } ;\n\n    Item( string name, Item::TYPE type, int power, int vitality, int health ) ;\n    Item operator=( Item& newItem ) ;\n    Item( void ) ;\n    //~Item()\n\n    void setPower( int value ) ;\n    int getPower( void ) ;\n\n    void setVitality( int value ) ;\n    int getVitality( void ) ;\n\n    void setHealth( int value ) ;\n    int getHealth( void ) ;\n\n    void setName( string name ) ;\n    string getName( void ) ;\n\n    void setType( TYPE newType ) ;\n    TYPE getType( void ) ;\n\n    string mName ;\n    int mPower ;\n    int mVitality ;\n    int mHealth ;\n    TYPE mType ;\n    bool mAvailiable ;\n} ;\n```\nAs you’ll notice there are five attributes which have getter and setter methods while the sixth attribute of the Item class “mAvailiable” will not require getter and setter methods. Thus the constructor should allow a new Item to be created given some initial values for each of the five attributes we mentioned.\n```c\n  Item::Item( string name, Item::TYPE type, int power, int vitality, int health ) \n: mName(name), mType(type), mPower(power), mVitality(vitality), \n  mHealth(health)\n{\n  mAvailiable = true ;\n}\n```\nNext we’ll overload the assignment operator for the Item class. For this operator overload we just want to the copy one Item’s attributes to another Item’s.  \n```c\nItem Item::operator=( Item& newItem )\n{\n  setName( newItem.getName() ) ;\n  setType( newItem.getType() ) ;\n  setPower( newItem.getPower() ) ;\n  setVitality( newItem.getVitality() ) ;\n  setHealth( newItem.getHealth() ) ;\n  mAvailiable = newItem.mAvailiable ;\n\n  return *this ;\n}\n```\nAfterwards we turn our attention to the Item class’ default constructor. The default constructor for the Item should just create a blank Item that will be completely useless but still available for pickup. In addition since the item will not have a name, we can always check for the condition when a Item was accidently created in our game by seeing if the Item’s name is the empty string.\n```c\n// The default Item::TYPE doesn't have to be Item::TYPE::WEAPON\n// as long as its not NULL its fine.\nItem::Item( void )\n{\n  setName( \"\" ) ;\n  setType( Item::WEAPON ) ;\n  setPower( 0 ) ;\n  setVitality( 0 ) ;\n  setHealth( 0 ) ;\n  mAvailiable = true ;\n}\n```\nThe remaining methods are the getters and setters for the attributes power, vitality, health, name and type. Getters and setters in general for the C++ language are a pair of methods that allow you to write a value to an attribute or read the current value from an attribute. Anyways here they are below. \n```c\nvoid Item::setPower( int value )\n{\n  mPower = value ;\n}\n\nint Item::getPower( void )\n{\n  return mPower ;\n}\n\nvoid Item::setVitality( int value )\n{\n  mVitality = value ;\n}\n\nint Item::getVitality( void )\n{\n  return mVitality ;\n}\n\nvoid Item::setHealth( int value )\n{\n  mHealth = value ;\n}\n\nint Item::getHealth( void )\n{\n  return mHealth ;\n}\n\nvoid Item::setName( string name )\n{\n  mName = name ;\n}\n\nstring Item::getName( void )\n{\n  return mName ;\n}\n\nvoid Item::setType( Item::TYPE newType )\n{\n  mType = newType ;\n}\n\nItem::TYPE Item::getType( void )\n{\n  return mType ;\n}\n```\nLastly we’ll run the test for our Item class; to begin create a new C++ file and title it “main.cpp”. Add the the code below to “main.cpp”. Remember that to use our Test object we have to call the “get_instance()” method since we created Test as a singleton. \n```c\n//Filename main.cpp\n#include \"Database.h\"\n#include\"Test.h\"\n\nusing namespace MUD ;\n\nint main(void)\n{\n  Test::get_instance()->test_item_class();\n}\n```\nOk, that’s it for today.\n\n[link_part_2]: /2011/06/08/textbasedrpgpart2\n[link_part_4]: /2011/06/11/textbasedrpgpart4\n","slug":"textbasedrpgpart3","published":1,"updated":"2017-04-14T06:18:37.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr25000v9uwvlqfmtp2n","content":"<p><a href=\"/2011/06/08/textbasedrpgpart2\">Click here for part II</a><br><a href=\"/2011/06/11/textbasedrpgpart4\">Click here for part IV</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>After writing the code to support the unit test in part II, beginning in this part we’ll look at the code behind the test to verify that our test are sound and correct.<br>Where we left off we had just implemented the unit test for the Item class. However, before we can even run the test we have to first write out the methods. So create a new C++ file, title it “database.cpp” and add it to your project’s directory. Now go ahead and type in the following.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Filename database.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Database.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD ;</div></pre></td></tr></table></figure></p>\n<p>For the first method of the Item class we’ll define the method for the Item’s constructor. The Item constructor will just take a single argument for each of its attributes as we defined in the “database.h” file. Here is the Item class definition in the header file again as a refresher.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Item</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"keyword\">enum</span> TYPE &#123; WEAPON, ARMOR, HEALTH &#125; ;</div><div class=\"line\"></div><div class=\"line\">    Item( <span class=\"built_in\">string</span> name, Item::TYPE type, <span class=\"keyword\">int</span> power, <span class=\"keyword\">int</span> vitality, <span class=\"keyword\">int</span> health ) ;</div><div class=\"line\">    Item <span class=\"keyword\">operator</span>=( Item&amp; newItem ) ;</div><div class=\"line\">    Item( <span class=\"keyword\">void</span> ) ;</div><div class=\"line\">    <span class=\"comment\">//~Item()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setPower</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getPower</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setVitality</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getVitality</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHealth</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHealth</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> name )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setType</span><span class=\"params\">( TYPE newType )</span> </span>;</div><div class=\"line\">    <span class=\"function\">TYPE <span class=\"title\">getType</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mPower ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mVitality ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mHealth ;</div><div class=\"line\">    TYPE mType ;</div><div class=\"line\">    <span class=\"keyword\">bool</span> mAvailiable ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure></p>\n<p>As you’ll notice there are five attributes which have getter and setter methods while the sixth attribute of the Item class “mAvailiable” will not require getter and setter methods. Thus the constructor should allow a new Item to be created given some initial values for each of the five attributes we mentioned.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">  Item::Item( <span class=\"built_in\">string</span> name, Item::TYPE type, <span class=\"keyword\">int</span> power, <span class=\"keyword\">int</span> vitality, <span class=\"keyword\">int</span> health ) </div><div class=\"line\">: mName(name), mType(type), mPower(power), mVitality(vitality), </div><div class=\"line\">  mHealth(health)</div><div class=\"line\">&#123;</div><div class=\"line\">  mAvailiable = <span class=\"literal\">true</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Next we’ll overload the assignment operator for the Item class. For this operator overload we just want to the copy one Item’s attributes to another Item’s.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">Item Item::<span class=\"keyword\">operator</span>=( Item&amp; newItem )</div><div class=\"line\">&#123;</div><div class=\"line\">  setName( newItem.getName() ) ;</div><div class=\"line\">  setType( newItem.getType() ) ;</div><div class=\"line\">  setPower( newItem.getPower() ) ;</div><div class=\"line\">  setVitality( newItem.getVitality() ) ;</div><div class=\"line\">  setHealth( newItem.getHealth() ) ;</div><div class=\"line\">  mAvailiable = newItem.mAvailiable ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> *<span class=\"keyword\">this</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Afterwards we turn our attention to the Item class’ default constructor. The default constructor for the Item should just create a blank Item that will be completely useless but still available for pickup. In addition since the item will not have a name, we can always check for the condition when a Item was accidently created in our game by seeing if the Item’s name is the empty string.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// The default Item::TYPE doesn't have to be Item::TYPE::WEAPON</span></div><div class=\"line\"><span class=\"comment\">// as long as its not NULL its fine.</span></div><div class=\"line\">Item::Item( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  setName( <span class=\"string\">\"\"</span> ) ;</div><div class=\"line\">  setType( Item::WEAPON ) ;</div><div class=\"line\">  setPower( <span class=\"number\">0</span> ) ;</div><div class=\"line\">  setVitality( <span class=\"number\">0</span> ) ;</div><div class=\"line\">  setHealth( <span class=\"number\">0</span> ) ;</div><div class=\"line\">  mAvailiable = <span class=\"literal\">true</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The remaining methods are the getters and setters for the attributes power, vitality, health, name and type. Getters and setters in general for the C++ language are a pair of methods that allow you to write a value to an attribute or read the current value from an attribute. Anyways here they are below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Item::setPower( <span class=\"keyword\">int</span> value )</div><div class=\"line\">&#123;</div><div class=\"line\">  mPower = value ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Item::getPower( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mPower ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Item::setVitality( <span class=\"keyword\">int</span> value )</div><div class=\"line\">&#123;</div><div class=\"line\">  mVitality = value ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Item::getVitality( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mVitality ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Item::setHealth( <span class=\"keyword\">int</span> value )</div><div class=\"line\">&#123;</div><div class=\"line\">  mHealth = value ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Item::getHealth( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mHealth ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Item::setName( <span class=\"built_in\">string</span> name )</div><div class=\"line\">&#123;</div><div class=\"line\">  mName = name ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Item::getName( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Item::setType( Item::TYPE newType )</div><div class=\"line\">&#123;</div><div class=\"line\">  mType = newType ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">Item::TYPE Item::getType( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mType ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Lastly we’ll run the test for our Item class; to begin create a new C++ file and title it “main.cpp”. Add the the code below to “main.cpp”. Remember that to use our Test object we have to call the “get_instance()” method since we created Test as a singleton.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Filename main.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Database.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"Test.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">  Test::get_instance()-&gt;test_item_class();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Ok, that’s it for today.</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"/2011/06/08/textbasedrpgpart2\">Click here for part II</a><br><a href=\"/2011/06/11/textbasedrpgpart4\">Click here for part IV</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>After writing the code to support the unit test in part II, beginning in this part we’ll look at the code behind the test to verify that our test are sound and correct.<br>Where we left off we had just implemented the unit test for the Item class. However, before we can even run the test we have to first write out the methods. So create a new C++ file, title it “database.cpp” and add it to your project’s directory. Now go ahead and type in the following.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Filename database.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Database.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD ;</div></pre></td></tr></table></figure></p>\n<p>For the first method of the Item class we’ll define the method for the Item’s constructor. The Item constructor will just take a single argument for each of its attributes as we defined in the “database.h” file. Here is the Item class definition in the header file again as a refresher.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Item</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    <span class=\"keyword\">enum</span> TYPE &#123; WEAPON, ARMOR, HEALTH &#125; ;</div><div class=\"line\"></div><div class=\"line\">    Item( <span class=\"built_in\">string</span> name, Item::TYPE type, <span class=\"keyword\">int</span> power, <span class=\"keyword\">int</span> vitality, <span class=\"keyword\">int</span> health ) ;</div><div class=\"line\">    Item <span class=\"keyword\">operator</span>=( Item&amp; newItem ) ;</div><div class=\"line\">    Item( <span class=\"keyword\">void</span> ) ;</div><div class=\"line\">    <span class=\"comment\">//~Item()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setPower</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getPower</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setVitality</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getVitality</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHealth</span><span class=\"params\">( <span class=\"keyword\">int</span> value )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHealth</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> name )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setType</span><span class=\"params\">( TYPE newType )</span> </span>;</div><div class=\"line\">    <span class=\"function\">TYPE <span class=\"title\">getType</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mPower ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mVitality ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mHealth ;</div><div class=\"line\">    TYPE mType ;</div><div class=\"line\">    <span class=\"keyword\">bool</span> mAvailiable ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure></p>\n<p>As you’ll notice there are five attributes which have getter and setter methods while the sixth attribute of the Item class “mAvailiable” will not require getter and setter methods. Thus the constructor should allow a new Item to be created given some initial values for each of the five attributes we mentioned.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">  Item::Item( <span class=\"built_in\">string</span> name, Item::TYPE type, <span class=\"keyword\">int</span> power, <span class=\"keyword\">int</span> vitality, <span class=\"keyword\">int</span> health ) </div><div class=\"line\">: mName(name), mType(type), mPower(power), mVitality(vitality), </div><div class=\"line\">  mHealth(health)</div><div class=\"line\">&#123;</div><div class=\"line\">  mAvailiable = <span class=\"literal\">true</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Next we’ll overload the assignment operator for the Item class. For this operator overload we just want to the copy one Item’s attributes to another Item’s.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">Item Item::<span class=\"keyword\">operator</span>=( Item&amp; newItem )</div><div class=\"line\">&#123;</div><div class=\"line\">  setName( newItem.getName() ) ;</div><div class=\"line\">  setType( newItem.getType() ) ;</div><div class=\"line\">  setPower( newItem.getPower() ) ;</div><div class=\"line\">  setVitality( newItem.getVitality() ) ;</div><div class=\"line\">  setHealth( newItem.getHealth() ) ;</div><div class=\"line\">  mAvailiable = newItem.mAvailiable ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> *<span class=\"keyword\">this</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Afterwards we turn our attention to the Item class’ default constructor. The default constructor for the Item should just create a blank Item that will be completely useless but still available for pickup. In addition since the item will not have a name, we can always check for the condition when a Item was accidently created in our game by seeing if the Item’s name is the empty string.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// The default Item::TYPE doesn't have to be Item::TYPE::WEAPON</span></div><div class=\"line\"><span class=\"comment\">// as long as its not NULL its fine.</span></div><div class=\"line\">Item::Item( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  setName( <span class=\"string\">\"\"</span> ) ;</div><div class=\"line\">  setType( Item::WEAPON ) ;</div><div class=\"line\">  setPower( <span class=\"number\">0</span> ) ;</div><div class=\"line\">  setVitality( <span class=\"number\">0</span> ) ;</div><div class=\"line\">  setHealth( <span class=\"number\">0</span> ) ;</div><div class=\"line\">  mAvailiable = <span class=\"literal\">true</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The remaining methods are the getters and setters for the attributes power, vitality, health, name and type. Getters and setters in general for the C++ language are a pair of methods that allow you to write a value to an attribute or read the current value from an attribute. Anyways here they are below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Item::setPower( <span class=\"keyword\">int</span> value )</div><div class=\"line\">&#123;</div><div class=\"line\">  mPower = value ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Item::getPower( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mPower ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Item::setVitality( <span class=\"keyword\">int</span> value )</div><div class=\"line\">&#123;</div><div class=\"line\">  mVitality = value ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Item::getVitality( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mVitality ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Item::setHealth( <span class=\"keyword\">int</span> value )</div><div class=\"line\">&#123;</div><div class=\"line\">  mHealth = value ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Item::getHealth( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mHealth ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Item::setName( <span class=\"built_in\">string</span> name )</div><div class=\"line\">&#123;</div><div class=\"line\">  mName = name ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Item::getName( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Item::setType( Item::TYPE newType )</div><div class=\"line\">&#123;</div><div class=\"line\">  mType = newType ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">Item::TYPE Item::getType( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mType ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Lastly we’ll run the test for our Item class; to begin create a new C++ file and title it “main.cpp”. Add the the code below to “main.cpp”. Remember that to use our Test object we have to call the “get_instance()” method since we created Test as a singleton.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Filename main.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Database.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"Test.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">  Test::get_instance()-&gt;test_item_class();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Ok, that’s it for today.</p>\n"},{"title":"Build A Text Based Multiplayer RPG Part IV","date":"2011-06-11T07:00:00.000Z","_content":"[Click here for part III][link_part_3]\n[Click here for part V][link_part_5]\n\n# Intro\nWe continue our quest to design a console based multiplayer RPG game in this article we'll implement the code for the Monster and Room classes. Both of these classes are critical to our application so pay close attention to the instructions.\nIn part 4 we’re going to implement the methods for two classes, the Monster class and the Room class. Due to its overall small code base we’ll look at the Monster class first. To jog your memory, below are the declarations for the Monster class from “database.h”. \n```c\nclass Monster\n{\n  public:\n    Monster( string name, int maxHp, int strength, int defence ) ;\n    //~Monster() \n\n    void setHp( int newHp ) ;\n    int getHp( void ) const ;\n\n    void setStrength( int newStrength ) ;\n    int getStrength( void ) const ;\n\n    void setDefence( int newDefence ) ;\n    int getDefence( void ) const ;\n\n    void setName( string newName ) ;\n    string getName( void ) const ;\n\n    void setMaxHp( int newMaxHp ) ;\n\n    int mMaxHp ;\n    int mHp ;\n    int mStrength ;\n    int mDefence ;\n    string mName ;\n    bool inCombat ;\n} ;\n```\nMuch like in previous parts we’ll write out the test cases prior to writing any of the methods. Go ahead and add this line to your “Test.h” file. \n```c\nvoid test_monster_class(void);\n```\nNext open up “Test.cpp”, the Monster class is very basic and just involves a constructor along with four getter/setter pairs. Again with the constructor test we just assert that each attribute is the same as the values we pass into it. \n```c\nvoid Test::test_monster_class(void)\n{\n  // Monster constuctor test\n  Monster test_monster(\"test\", 20, 10, 11);\n\n  assert(\"test\" == test_monster.mName);\n  assert(20 == test_monster.mHp);\n  assert(10 == test_monster.mStrength);\n  assert(11 == test_monster.mDefence);\n  assert(false == test_monster.inCombat);\n  assert(test_monster.mHp == test_monster.mMaxHp);\n```\nLastly for the monster test the getters/setters are pretty basic as well, just type in the code below. \n```c\n  // Monster getters and setters test\n  Monster monster(\"gettersetter\", 1, 2, 3);\n\n  monster.setName(\"dragon\");\n  monster.setHp(100);\n  monster.setMaxHp(999);\n  monster.setStrength(50);\n  monster.setDefence(200);\n\n  assert(\"dragon\" == monster.getName());\n  assert(100 == monster.getHp());\n  assert(50 == monster.getStrength());\n  assert(200 == monster.getDefence());\n  assert(999 == monster.mMaxHp);\n  assert(monster.getHp() != monster.mMaxHp);\n}\n```\nNow that the test have been defined we can now code up the methods for the monster class; so open up the “database.cpp” file and add the lines below. \n```c\n  Monster::Monster( string name, int maxHp, int strength, int defence )\n: mName(name), mMaxHp(maxHp), mStrength(strength), mDefence(defence)\n{\n  setHp(maxHp);\n  inCombat = false ;\n}\n\nvoid Monster::setHp( int newHp )\n{\n  mHp = newHp ;\n}\n\nint Monster::getHp( void ) const\n{\n  return mHp ;\n}\n\nvoid Monster::setStrength( int newStrength )\n{\n  mStrength = newStrength ;\n}\n\nint Monster::getStrength( void ) const\n{\n  return mStrength ;\n}\n\nvoid Monster::setDefence( int newDefence )\n{\n  mDefence = newDefence ;\n}\n\nint Monster::getDefence( void ) const\n{\n  return mDefence ;\n}\n\nvoid Monster::setName( string newName ) \n{\n  mName = newName ;\n}\n\nstring Monster::getName( void ) const\n{\n  return mName ;\n}\n\nvoid Monster::setMaxHp( const int newMaxHp ) \n{\n  mMaxHp = newMaxHp ;\n}\n```\nNow that the Monster class is complete we are now going to finish the Room class, for reference here it is again from the “database.h” file. \n```c\nclass Room \n{\n  public:\n    Room( string name, string description, Item* item = NULL ) ;\n    //Room( void ) ;\n    //~Room()\n\n    typedef bool success ;\n\n    void addMonster( Monster* newMonster ) ;\n    Monster& getMonsterRef( string monsterName ) ;\n    success killMonster( string monsterName ) ;\n    void itemTaken( void ) ;\n    string searchResponse( void ) ;\n    success link( char direction, Room& room ) ;\n    Room& north( void ) ;\n    Room& south( void ) ;\n    Room& east( void ) ;\n    Room& west( void ) ;\n\n    void setName( string newName ) ;\n\n    void setDescription( string newDescription ) ;\n    string getDescription( void ) const ;\n\n    void setItem( Item* newItem ) ;\n\n    Item* mItem ;\n    Room* mNorth ;\n    Room* mSouth ;\n    Room* mEast ;\n    Room* mWest ;\n    list< Monster* > mMonsters ;\n    string mName ;\n    string mDescription ;\n} ;\n```\nTo define the unit test lets open the “Test.cpp” file and begin with the Room class constructor. Based on our class declarations the Room constructor must be tested for the case where we initialize with and without a starting Item. \n```c\nvoid Test::test_room_class(void)\n{\n  // Room constructor test\n  Room room_no_item(\"Cave\", \"A dark cave\");\n\n  assert(\"Cave\" == room_no_item.mName);\n  assert(\"A dark cave\" == room_no_item.mDescription);\n  assert(NULL == room_no_item.mItem);\n  assert(NULL == room_no_item.mNorth);\n  assert(NULL == room_no_item.mSouth);\n  assert(NULL == room_no_item.mEast);\n  assert(NULL == room_no_item.mWest);\n\n  // Room constructor test\n  Room room_with_item(\"Pit\", \"A deep pit\", new Item);\n\n  assert(\"Pit\" == room_with_item.mName);\n  assert(\"A deep pit\" == room_with_item.mDescription);\n  assert(NULL != room_with_item.mItem);\n  assert(\"\" == room_with_item.mItem->getName());\n  assert(true == room_with_item.mItem->mAvailiable);\n```\n  Next we’re going to add a monster to a new room and successfully find the same monster within the room. Note that due to the choice of a List data structure to hold the Monsters we have two options for finding the Monster; either by checking the back of the list for the most recently added monster or by passing the monster’s name as a parameter to our “getMonsterRef()” method which gets the monster’s reference from our List. \n```c\n    // Room addMonster test\n    Monster monster(\"monster\", 1, 2, 3);\n  Room room_monster(\"House\", \"A haunted mansion\");\n\n  room_monster.addMonster(&monster);\n\n  assert(&monster == room_monster.mMonsters.back());\n\n  // Room getMonsterRef test\n  assert(&monster == &(room_monster.getMonsterRef(\n          monster.getName())));\n  assert(NULL == &(room_monster.getMonsterRef(\"sheep\")));\n  ```\n  Then we should test the ability for a monster to be removed from a room, if a monster is present we expect the kill monster method to return true else it should return false. In addition if the name of the monster we are trying to kill is not found then kill monster should also return false. \n  ```c\n    // Room killMonster test\n    assert(false == room_monster.killMonster(\"Invalid monster name\"));\n  assert(true == room_monster.killMonster(monster.getName()));\n  assert(false == room_monster.killMonster(monster.getName()));\n ```\n If the Room’s item is taken then the item itself should no longer be available.\n ```c\n    // Room itemTaken test\n    room_with_item.itemTaken();\n\n  assert(false == room_with_item.mItem->mAvailiable);\n```\nNext we have the ability to search the room for either monsters and or items. Thinking about this you might be wondering how many different responses are possible. Well the solution is rather simple. <blockquote>A room can hold monsters and a single item. So the item is either present or not present within the room. For the monsters they are also either present or all dead. So we have two possible outcomes for the items and two possible outcomes for the monsters</blockquote> \n\n```c\n// Room searchResponse\n// Possible game responses without monsters in the room\n// a) \"There is a Item.mName in this room.\"\n// b) \"After searching, you found nothing of value\"\nRoom room_a(\"Forest\", \"Many trees\", new Item(\"Suit\", Item::ARMOR, 0, \n      20, 0));\nstring response_a(\"There is a Suit in this room.\");\n\nassert(response_a == room_a.searchResponse());\n\nRoom room_b(\"Desert\", \"Sandy plains\");\nstring response_b(\"After searching, you found nothing of value\");\n\nassert(response_b == room_b.searchResponse());\n\n// Possible game responses with monsters\n// c) \"There is a Item.mName in this room.\\nThere is a monster nearby...\n//    Attack the Monster.mName\"\n// d) \"After searching, you found nothing of value\\nThere is a \n//    monster nearby... Attack the Monster.mName\"\nRoom room_c(\"Sea\", \"Water\", new Item(\"Blade\", Item::WEAPON, 5, 0, 0));\nMonster goblin(\"Goblin\", 1, 2, 3);\nroom_c.addMonster(&goblin);\nstring response_c(\"There is a Blade in this room.\\nThere is a monster nearby...\\nAttack the Goblin\");\n\nassert(response_c == room_c.searchResponse());\n\nRoom room_d(\"Space\", \"Outer space\");\nMonster alien(\"Alien\", 4, 5, 6);\nroom_d.addMonster(&alien);\nstring response_d(\"After searching, you found nothing of value\\nThere is a monster nearby...\\nAttack the Alien\");\n\nassert(response_d == room_d.searchResponse());\n```\nGiven that we want the players to be able to move freely about, every room has four possible directions leading from it; the usual north, south, east and west. By chance if we accidently tried to invent a new direction the Room linking method should return false.  \n```c\n  // Room link test\n  // The possible directions are 'n', 'e', 'w' or 's'\n  Room home_room(\"House\", \"A large building\");\n  Room north(\"Pool\", \"A swimming poool\");\n  Room south(\"Yard\", \"Front lawn\");\n  Room east(\"Garage\", \"Empty garage\");\n  Room west(\"Balcony\", \"Wooden balcony\");\n\n  // Bad direction\n  assert(false == home_room.link('z', north));\n  // Good directions\n  assert(true == home_room.link('n', north));\n  assert(true == home_room.link('s', south));\n  assert(true == home_room.link('e', east));\n  assert(true == home_room.link('w', west));\n  // Verify links\n  assert(&north == &(home_room.north()));\n  assert(&south == &(home_room.south()));\n  assert(&west == &(home_room.west()));\n  assert(&east == &(home_room.east()));\n```\nLastly you can just add the Room getters/setters into the “Test.cpp” file.\n```c\n  // Room getters and setters\n  home_room.setName(\"new room\");\n  assert(\"new room\" == home_room.mName);\n\n  home_room.setDescription(\"Your new room\");\n  assert(\"Your new room\" == home_room.getDescription());\n\n  Item* sword = new Item(\"sword\", Item::WEAPON, 10, 0, 0);\n  home_room.setItem(sword);\n  assert(sword == home_room.mItem);\n}\n```\nWhat we want to do next is to define the methods for the Room class. So open up the “database.cpp” file and lets get started, we’ll begin with the constructor for the Room so just pay attention to the use of the initialization list for the Room’s attributes. \n```c\n  Room::Room( string name, string description, Item* item )\n: mName(name), mDescription(description), mItem(item)\n{\n  mNorth = NULL ;\n  mSouth = NULL ;\n  mEast = NULL ;\n  mWest = NULL ;\n}\n```\nThe next method we define will be the “Room::Link()” method. Given that the input is a single char we just have to check whether it is valid or not and then connect the room to the appropriate link. So a switch case block will be sufficient. \n```c\nbool Room::link( char direction, MUD::Room& room )\n{\n  bool flag = false ;\n\n  switch( direction )\n  {\n    case 'n':\n    case 'N':\n      mNorth = &room ;\n      flag = true ;\n      break ;\n\n    case 's':\n    case 'S':\n      mSouth = &room ;\n      flag = true ;\n      break ;\n\n    case 'e':\n    case 'E':\n      mEast = &room ;\n      flag = true ;\n      break ;\n\n    case 'w':\n    case 'W':\n      mWest = &room ;\n      flag = true ;\n      break ;\n  }\n\n  return flag ;\n}\n```\nNow that we can link rooms together the next methods will consist of returning the room for a defined direction.\n```c\nRoom& Room::north( void ) \n{\n  return *mNorth ;\n}\n\nRoom& Room::south( void )\n{\n  return *mSouth ;\n}\n\nRoom& Room::east( void )\n{\n  return *mEast ;\n}\n\nRoom& Room::west( void )\n{\n  return *mWest ;\n}\n```\nWe define the setter for the name attribute. \n```c\nvoid Room::setName( string newName )\n{\n  mName = newName ;\n}\n```\nNext we have to define how the room should interact with monsters or rather adding, finding and or removing monsters. The first idea is simple, given that we are storing the Monster’s within a List data structure, to add a monster we simply append it to the back of the list.\n```c\nvoid Room::addMonster( Monster* newMonster )\n{\n  mMonsters.push_back( newMonster ) ;\n}\n```\nIn order to find a monster within our list of monsters we just iterate over the monster list until we match the name with the name of the monster we’re searching for; if no monster matched then we just return null.  \n```c\nMonster& Room::getMonsterRef( string monsterName ) \n{\n  list< Monster* >::iterator iter ;\n  Monster* monsterRef = NULL ;\n\n  for( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )\n  {\n    if( (*iter)->getName() == monsterName )\n    {\n      monsterRef = *iter ;\n      break ;\n    }\n  }\n\n  return *monsterRef ;\n}\n```\nFor removing i.e killing a monster the idea is the same as finding it but we then remove it from the list of monsters as opposed to returning its reference. When the monster is not found we return false to indicate that no removal occurred. \n```c\nRoom::success Room::killMonster( string monsterName )\n{\n  list< Monster* >::iterator iter ;\n  bool flag = false ;\n\n  for( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )\n  {\n    if( (*iter)->getName() == monsterName )\n    {\n      mMonsters.erase( iter ) ;\n      flag = true ;\n\n      break ;\n    }\n  }\n\n  return flag ;\n}\n```\nMoving on, when an Item is taken from the room we just mark that the Item is unavailable.\n```c\nvoid Room::itemTaken( void )\n{\n  mItem->mAvailiable = false ;\n}\n\nvoid Room::setItem( Item* newItem )\n{\n  mItem = newItem ;\n}\n```\nThe Room’s description is another getter/setter pair.\n```c\nvoid Room::setDescription( string newDescription )\n{\n  mDescription = newDescription ;\n}\n\nstring Room::getDescription( void ) const\n{\n  return mDescription ;\n}\n```\nFinally we have to define the “Room::searchResponse()” method. The objective is to return a string object with all the information gathered about the current Room’s monsters and items. So lets start out with just the lines below, \n```c\nstring Room::searchResponse( void )\n{\n  string response ;\n```\nFirst we’re going to check if an item is currently in the room. An item exist within a room if its both not NULL and is currently available, else there is no item in the room. \n```c\n    if( mItem != NULL && true == mItem->mAvailiable )\n    {\n      response = \"There is a \" + mItem->getName() + \" in this room.\" ;\n    }\n    else\n    {\n      response = \"After searching, you found nothing of value\" ;\n    }\n```\nThen, if there are monsters present(the monster list is non empty) and for the monsters who are not currently in combat with another player we should present the player with the option to attack it; finally adding this information to the response string.  \n```c\n    if( !mMonsters.empty() )\n    {\n      response = response + \"\\nThere is a monster nearby...\" ;\n\n      list< Monster* >::iterator iter ;\n\n      for( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )\n      {\n        if( false == (*iter)->inCombat )\n        {\n          response = response + \"\\nAttack the \" + (*iter)->getName() ;\n        }\n      }\n    }\n\n  return response ;\n}\n```\nLets run the test by changing our “main.cpp” file to look like the one below.\n```c\n//Filename main.cpp\n#include \"Database.h\"\n#include\"Test.h\"\n\nusing namespace MUD ;\n\nint main(void)\n{\n  Test::get_instance()->test_item_class();\n  Test::get_instance()->test_monster_class();\n  Test::get_instance()->test_room_class();\n}\n```\n\n[link_part_3]: /2011/06/09/textbasedrpgpart3\n[link_part_5]: /2011/06/15/textbasedrpgpart5\n","source":"_posts/textbasedrpgpart4.md","raw":"---\ntitle: Build A Text Based Multiplayer RPG Part IV\ndate: 2011-06-11\ncategories: [tutorial]\ntags: [cpp]\n---\n[Click here for part III][link_part_3]\n[Click here for part V][link_part_5]\n\n# Intro\nWe continue our quest to design a console based multiplayer RPG game in this article we'll implement the code for the Monster and Room classes. Both of these classes are critical to our application so pay close attention to the instructions.\nIn part 4 we’re going to implement the methods for two classes, the Monster class and the Room class. Due to its overall small code base we’ll look at the Monster class first. To jog your memory, below are the declarations for the Monster class from “database.h”. \n```c\nclass Monster\n{\n  public:\n    Monster( string name, int maxHp, int strength, int defence ) ;\n    //~Monster() \n\n    void setHp( int newHp ) ;\n    int getHp( void ) const ;\n\n    void setStrength( int newStrength ) ;\n    int getStrength( void ) const ;\n\n    void setDefence( int newDefence ) ;\n    int getDefence( void ) const ;\n\n    void setName( string newName ) ;\n    string getName( void ) const ;\n\n    void setMaxHp( int newMaxHp ) ;\n\n    int mMaxHp ;\n    int mHp ;\n    int mStrength ;\n    int mDefence ;\n    string mName ;\n    bool inCombat ;\n} ;\n```\nMuch like in previous parts we’ll write out the test cases prior to writing any of the methods. Go ahead and add this line to your “Test.h” file. \n```c\nvoid test_monster_class(void);\n```\nNext open up “Test.cpp”, the Monster class is very basic and just involves a constructor along with four getter/setter pairs. Again with the constructor test we just assert that each attribute is the same as the values we pass into it. \n```c\nvoid Test::test_monster_class(void)\n{\n  // Monster constuctor test\n  Monster test_monster(\"test\", 20, 10, 11);\n\n  assert(\"test\" == test_monster.mName);\n  assert(20 == test_monster.mHp);\n  assert(10 == test_monster.mStrength);\n  assert(11 == test_monster.mDefence);\n  assert(false == test_monster.inCombat);\n  assert(test_monster.mHp == test_monster.mMaxHp);\n```\nLastly for the monster test the getters/setters are pretty basic as well, just type in the code below. \n```c\n  // Monster getters and setters test\n  Monster monster(\"gettersetter\", 1, 2, 3);\n\n  monster.setName(\"dragon\");\n  monster.setHp(100);\n  monster.setMaxHp(999);\n  monster.setStrength(50);\n  monster.setDefence(200);\n\n  assert(\"dragon\" == monster.getName());\n  assert(100 == monster.getHp());\n  assert(50 == monster.getStrength());\n  assert(200 == monster.getDefence());\n  assert(999 == monster.mMaxHp);\n  assert(monster.getHp() != monster.mMaxHp);\n}\n```\nNow that the test have been defined we can now code up the methods for the monster class; so open up the “database.cpp” file and add the lines below. \n```c\n  Monster::Monster( string name, int maxHp, int strength, int defence )\n: mName(name), mMaxHp(maxHp), mStrength(strength), mDefence(defence)\n{\n  setHp(maxHp);\n  inCombat = false ;\n}\n\nvoid Monster::setHp( int newHp )\n{\n  mHp = newHp ;\n}\n\nint Monster::getHp( void ) const\n{\n  return mHp ;\n}\n\nvoid Monster::setStrength( int newStrength )\n{\n  mStrength = newStrength ;\n}\n\nint Monster::getStrength( void ) const\n{\n  return mStrength ;\n}\n\nvoid Monster::setDefence( int newDefence )\n{\n  mDefence = newDefence ;\n}\n\nint Monster::getDefence( void ) const\n{\n  return mDefence ;\n}\n\nvoid Monster::setName( string newName ) \n{\n  mName = newName ;\n}\n\nstring Monster::getName( void ) const\n{\n  return mName ;\n}\n\nvoid Monster::setMaxHp( const int newMaxHp ) \n{\n  mMaxHp = newMaxHp ;\n}\n```\nNow that the Monster class is complete we are now going to finish the Room class, for reference here it is again from the “database.h” file. \n```c\nclass Room \n{\n  public:\n    Room( string name, string description, Item* item = NULL ) ;\n    //Room( void ) ;\n    //~Room()\n\n    typedef bool success ;\n\n    void addMonster( Monster* newMonster ) ;\n    Monster& getMonsterRef( string monsterName ) ;\n    success killMonster( string monsterName ) ;\n    void itemTaken( void ) ;\n    string searchResponse( void ) ;\n    success link( char direction, Room& room ) ;\n    Room& north( void ) ;\n    Room& south( void ) ;\n    Room& east( void ) ;\n    Room& west( void ) ;\n\n    void setName( string newName ) ;\n\n    void setDescription( string newDescription ) ;\n    string getDescription( void ) const ;\n\n    void setItem( Item* newItem ) ;\n\n    Item* mItem ;\n    Room* mNorth ;\n    Room* mSouth ;\n    Room* mEast ;\n    Room* mWest ;\n    list< Monster* > mMonsters ;\n    string mName ;\n    string mDescription ;\n} ;\n```\nTo define the unit test lets open the “Test.cpp” file and begin with the Room class constructor. Based on our class declarations the Room constructor must be tested for the case where we initialize with and without a starting Item. \n```c\nvoid Test::test_room_class(void)\n{\n  // Room constructor test\n  Room room_no_item(\"Cave\", \"A dark cave\");\n\n  assert(\"Cave\" == room_no_item.mName);\n  assert(\"A dark cave\" == room_no_item.mDescription);\n  assert(NULL == room_no_item.mItem);\n  assert(NULL == room_no_item.mNorth);\n  assert(NULL == room_no_item.mSouth);\n  assert(NULL == room_no_item.mEast);\n  assert(NULL == room_no_item.mWest);\n\n  // Room constructor test\n  Room room_with_item(\"Pit\", \"A deep pit\", new Item);\n\n  assert(\"Pit\" == room_with_item.mName);\n  assert(\"A deep pit\" == room_with_item.mDescription);\n  assert(NULL != room_with_item.mItem);\n  assert(\"\" == room_with_item.mItem->getName());\n  assert(true == room_with_item.mItem->mAvailiable);\n```\n  Next we’re going to add a monster to a new room and successfully find the same monster within the room. Note that due to the choice of a List data structure to hold the Monsters we have two options for finding the Monster; either by checking the back of the list for the most recently added monster or by passing the monster’s name as a parameter to our “getMonsterRef()” method which gets the monster’s reference from our List. \n```c\n    // Room addMonster test\n    Monster monster(\"monster\", 1, 2, 3);\n  Room room_monster(\"House\", \"A haunted mansion\");\n\n  room_monster.addMonster(&monster);\n\n  assert(&monster == room_monster.mMonsters.back());\n\n  // Room getMonsterRef test\n  assert(&monster == &(room_monster.getMonsterRef(\n          monster.getName())));\n  assert(NULL == &(room_monster.getMonsterRef(\"sheep\")));\n  ```\n  Then we should test the ability for a monster to be removed from a room, if a monster is present we expect the kill monster method to return true else it should return false. In addition if the name of the monster we are trying to kill is not found then kill monster should also return false. \n  ```c\n    // Room killMonster test\n    assert(false == room_monster.killMonster(\"Invalid monster name\"));\n  assert(true == room_monster.killMonster(monster.getName()));\n  assert(false == room_monster.killMonster(monster.getName()));\n ```\n If the Room’s item is taken then the item itself should no longer be available.\n ```c\n    // Room itemTaken test\n    room_with_item.itemTaken();\n\n  assert(false == room_with_item.mItem->mAvailiable);\n```\nNext we have the ability to search the room for either monsters and or items. Thinking about this you might be wondering how many different responses are possible. Well the solution is rather simple. <blockquote>A room can hold monsters and a single item. So the item is either present or not present within the room. For the monsters they are also either present or all dead. So we have two possible outcomes for the items and two possible outcomes for the monsters</blockquote> \n\n```c\n// Room searchResponse\n// Possible game responses without monsters in the room\n// a) \"There is a Item.mName in this room.\"\n// b) \"After searching, you found nothing of value\"\nRoom room_a(\"Forest\", \"Many trees\", new Item(\"Suit\", Item::ARMOR, 0, \n      20, 0));\nstring response_a(\"There is a Suit in this room.\");\n\nassert(response_a == room_a.searchResponse());\n\nRoom room_b(\"Desert\", \"Sandy plains\");\nstring response_b(\"After searching, you found nothing of value\");\n\nassert(response_b == room_b.searchResponse());\n\n// Possible game responses with monsters\n// c) \"There is a Item.mName in this room.\\nThere is a monster nearby...\n//    Attack the Monster.mName\"\n// d) \"After searching, you found nothing of value\\nThere is a \n//    monster nearby... Attack the Monster.mName\"\nRoom room_c(\"Sea\", \"Water\", new Item(\"Blade\", Item::WEAPON, 5, 0, 0));\nMonster goblin(\"Goblin\", 1, 2, 3);\nroom_c.addMonster(&goblin);\nstring response_c(\"There is a Blade in this room.\\nThere is a monster nearby...\\nAttack the Goblin\");\n\nassert(response_c == room_c.searchResponse());\n\nRoom room_d(\"Space\", \"Outer space\");\nMonster alien(\"Alien\", 4, 5, 6);\nroom_d.addMonster(&alien);\nstring response_d(\"After searching, you found nothing of value\\nThere is a monster nearby...\\nAttack the Alien\");\n\nassert(response_d == room_d.searchResponse());\n```\nGiven that we want the players to be able to move freely about, every room has four possible directions leading from it; the usual north, south, east and west. By chance if we accidently tried to invent a new direction the Room linking method should return false.  \n```c\n  // Room link test\n  // The possible directions are 'n', 'e', 'w' or 's'\n  Room home_room(\"House\", \"A large building\");\n  Room north(\"Pool\", \"A swimming poool\");\n  Room south(\"Yard\", \"Front lawn\");\n  Room east(\"Garage\", \"Empty garage\");\n  Room west(\"Balcony\", \"Wooden balcony\");\n\n  // Bad direction\n  assert(false == home_room.link('z', north));\n  // Good directions\n  assert(true == home_room.link('n', north));\n  assert(true == home_room.link('s', south));\n  assert(true == home_room.link('e', east));\n  assert(true == home_room.link('w', west));\n  // Verify links\n  assert(&north == &(home_room.north()));\n  assert(&south == &(home_room.south()));\n  assert(&west == &(home_room.west()));\n  assert(&east == &(home_room.east()));\n```\nLastly you can just add the Room getters/setters into the “Test.cpp” file.\n```c\n  // Room getters and setters\n  home_room.setName(\"new room\");\n  assert(\"new room\" == home_room.mName);\n\n  home_room.setDescription(\"Your new room\");\n  assert(\"Your new room\" == home_room.getDescription());\n\n  Item* sword = new Item(\"sword\", Item::WEAPON, 10, 0, 0);\n  home_room.setItem(sword);\n  assert(sword == home_room.mItem);\n}\n```\nWhat we want to do next is to define the methods for the Room class. So open up the “database.cpp” file and lets get started, we’ll begin with the constructor for the Room so just pay attention to the use of the initialization list for the Room’s attributes. \n```c\n  Room::Room( string name, string description, Item* item )\n: mName(name), mDescription(description), mItem(item)\n{\n  mNorth = NULL ;\n  mSouth = NULL ;\n  mEast = NULL ;\n  mWest = NULL ;\n}\n```\nThe next method we define will be the “Room::Link()” method. Given that the input is a single char we just have to check whether it is valid or not and then connect the room to the appropriate link. So a switch case block will be sufficient. \n```c\nbool Room::link( char direction, MUD::Room& room )\n{\n  bool flag = false ;\n\n  switch( direction )\n  {\n    case 'n':\n    case 'N':\n      mNorth = &room ;\n      flag = true ;\n      break ;\n\n    case 's':\n    case 'S':\n      mSouth = &room ;\n      flag = true ;\n      break ;\n\n    case 'e':\n    case 'E':\n      mEast = &room ;\n      flag = true ;\n      break ;\n\n    case 'w':\n    case 'W':\n      mWest = &room ;\n      flag = true ;\n      break ;\n  }\n\n  return flag ;\n}\n```\nNow that we can link rooms together the next methods will consist of returning the room for a defined direction.\n```c\nRoom& Room::north( void ) \n{\n  return *mNorth ;\n}\n\nRoom& Room::south( void )\n{\n  return *mSouth ;\n}\n\nRoom& Room::east( void )\n{\n  return *mEast ;\n}\n\nRoom& Room::west( void )\n{\n  return *mWest ;\n}\n```\nWe define the setter for the name attribute. \n```c\nvoid Room::setName( string newName )\n{\n  mName = newName ;\n}\n```\nNext we have to define how the room should interact with monsters or rather adding, finding and or removing monsters. The first idea is simple, given that we are storing the Monster’s within a List data structure, to add a monster we simply append it to the back of the list.\n```c\nvoid Room::addMonster( Monster* newMonster )\n{\n  mMonsters.push_back( newMonster ) ;\n}\n```\nIn order to find a monster within our list of monsters we just iterate over the monster list until we match the name with the name of the monster we’re searching for; if no monster matched then we just return null.  \n```c\nMonster& Room::getMonsterRef( string monsterName ) \n{\n  list< Monster* >::iterator iter ;\n  Monster* monsterRef = NULL ;\n\n  for( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )\n  {\n    if( (*iter)->getName() == monsterName )\n    {\n      monsterRef = *iter ;\n      break ;\n    }\n  }\n\n  return *monsterRef ;\n}\n```\nFor removing i.e killing a monster the idea is the same as finding it but we then remove it from the list of monsters as opposed to returning its reference. When the monster is not found we return false to indicate that no removal occurred. \n```c\nRoom::success Room::killMonster( string monsterName )\n{\n  list< Monster* >::iterator iter ;\n  bool flag = false ;\n\n  for( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )\n  {\n    if( (*iter)->getName() == monsterName )\n    {\n      mMonsters.erase( iter ) ;\n      flag = true ;\n\n      break ;\n    }\n  }\n\n  return flag ;\n}\n```\nMoving on, when an Item is taken from the room we just mark that the Item is unavailable.\n```c\nvoid Room::itemTaken( void )\n{\n  mItem->mAvailiable = false ;\n}\n\nvoid Room::setItem( Item* newItem )\n{\n  mItem = newItem ;\n}\n```\nThe Room’s description is another getter/setter pair.\n```c\nvoid Room::setDescription( string newDescription )\n{\n  mDescription = newDescription ;\n}\n\nstring Room::getDescription( void ) const\n{\n  return mDescription ;\n}\n```\nFinally we have to define the “Room::searchResponse()” method. The objective is to return a string object with all the information gathered about the current Room’s monsters and items. So lets start out with just the lines below, \n```c\nstring Room::searchResponse( void )\n{\n  string response ;\n```\nFirst we’re going to check if an item is currently in the room. An item exist within a room if its both not NULL and is currently available, else there is no item in the room. \n```c\n    if( mItem != NULL && true == mItem->mAvailiable )\n    {\n      response = \"There is a \" + mItem->getName() + \" in this room.\" ;\n    }\n    else\n    {\n      response = \"After searching, you found nothing of value\" ;\n    }\n```\nThen, if there are monsters present(the monster list is non empty) and for the monsters who are not currently in combat with another player we should present the player with the option to attack it; finally adding this information to the response string.  \n```c\n    if( !mMonsters.empty() )\n    {\n      response = response + \"\\nThere is a monster nearby...\" ;\n\n      list< Monster* >::iterator iter ;\n\n      for( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )\n      {\n        if( false == (*iter)->inCombat )\n        {\n          response = response + \"\\nAttack the \" + (*iter)->getName() ;\n        }\n      }\n    }\n\n  return response ;\n}\n```\nLets run the test by changing our “main.cpp” file to look like the one below.\n```c\n//Filename main.cpp\n#include \"Database.h\"\n#include\"Test.h\"\n\nusing namespace MUD ;\n\nint main(void)\n{\n  Test::get_instance()->test_item_class();\n  Test::get_instance()->test_monster_class();\n  Test::get_instance()->test_room_class();\n}\n```\n\n[link_part_3]: /2011/06/09/textbasedrpgpart3\n[link_part_5]: /2011/06/15/textbasedrpgpart5\n","slug":"textbasedrpgpart4","published":1,"updated":"2017-04-14T06:18:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr27000y9uwv6iujkpoc","content":"<p><a href=\"/2011/06/09/textbasedrpgpart3\">Click here for part III</a><br><a href=\"/2011/06/15/textbasedrpgpart5\">Click here for part V</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>We continue our quest to design a console based multiplayer RPG game in this article we’ll implement the code for the Monster and Room classes. Both of these classes are critical to our application so pay close attention to the instructions.<br>In part 4 we’re going to implement the methods for two classes, the Monster class and the Room class. Due to its overall small code base we’ll look at the Monster class first. To jog your memory, below are the declarations for the Monster class from “database.h”.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Monster</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Monster( <span class=\"built_in\">string</span> name, <span class=\"keyword\">int</span> maxHp, <span class=\"keyword\">int</span> strength, <span class=\"keyword\">int</span> defence ) ;</div><div class=\"line\">    <span class=\"comment\">//~Monster() </span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newHp )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setStrength</span><span class=\"params\">( <span class=\"keyword\">int</span> newStrength )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getStrength</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDefence</span><span class=\"params\">( <span class=\"keyword\">int</span> newDefence )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getDefence</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newMaxHp )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">int</span> mMaxHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mStrength ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mDefence ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"keyword\">bool</span> inCombat ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure></p>\n<p>Much like in previous parts we’ll write out the test cases prior to writing any of the methods. Go ahead and add this line to your “Test.h” file.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_monster_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div></pre></td></tr></table></figure></p>\n<p>Next open up “Test.cpp”, the Monster class is very basic and just involves a constructor along with four getter/setter pairs. Again with the constructor test we just assert that each attribute is the same as the values we pass into it.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_monster_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Monster constuctor test</span></div><div class=\"line\">  <span class=\"function\">Monster <span class=\"title\">test_monster</span><span class=\"params\">(<span class=\"string\">\"test\"</span>, <span class=\"number\">20</span>, <span class=\"number\">10</span>, <span class=\"number\">11</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"test\"</span> == test_monster.mName);</div><div class=\"line\">  assert(<span class=\"number\">20</span> == test_monster.mHp);</div><div class=\"line\">  assert(<span class=\"number\">10</span> == test_monster.mStrength);</div><div class=\"line\">  assert(<span class=\"number\">11</span> == test_monster.mDefence);</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == test_monster.inCombat);</div><div class=\"line\">  assert(test_monster.mHp == test_monster.mMaxHp);</div></pre></td></tr></table></figure></p>\n<p>Lastly for the monster test the getters/setters are pretty basic as well, just type in the code below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Monster getters and setters test</span></div><div class=\"line\">  <span class=\"function\">Monster <span class=\"title\">monster</span><span class=\"params\">(<span class=\"string\">\"gettersetter\"</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  monster.setName(<span class=\"string\">\"dragon\"</span>);</div><div class=\"line\">  monster.setHp(<span class=\"number\">100</span>);</div><div class=\"line\">  monster.setMaxHp(<span class=\"number\">999</span>);</div><div class=\"line\">  monster.setStrength(<span class=\"number\">50</span>);</div><div class=\"line\">  monster.setDefence(<span class=\"number\">200</span>);</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"dragon\"</span> == monster.getName());</div><div class=\"line\">  assert(<span class=\"number\">100</span> == monster.getHp());</div><div class=\"line\">  assert(<span class=\"number\">50</span> == monster.getStrength());</div><div class=\"line\">  assert(<span class=\"number\">200</span> == monster.getDefence());</div><div class=\"line\">  assert(<span class=\"number\">999</span> == monster.mMaxHp);</div><div class=\"line\">  assert(monster.getHp() != monster.mMaxHp);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now that the test have been defined we can now code up the methods for the monster class; so open up the “database.cpp” file and add the lines below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div></pre></td><td class=\"code\"><pre><div class=\"line\">  Monster::Monster( <span class=\"built_in\">string</span> name, <span class=\"keyword\">int</span> maxHp, <span class=\"keyword\">int</span> strength, <span class=\"keyword\">int</span> defence )</div><div class=\"line\">: mName(name), mMaxHp(maxHp), mStrength(strength), mDefence(defence)</div><div class=\"line\">&#123;</div><div class=\"line\">  setHp(maxHp);</div><div class=\"line\">  inCombat = <span class=\"literal\">false</span> ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Monster::setHp( <span class=\"keyword\">int</span> newHp )</div><div class=\"line\">&#123;</div><div class=\"line\">  mHp = newHp ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Monster::getHp( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mHp ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Monster::setStrength( <span class=\"keyword\">int</span> newStrength )</div><div class=\"line\">&#123;</div><div class=\"line\">  mStrength = newStrength ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Monster::getStrength( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mStrength ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Monster::setDefence( <span class=\"keyword\">int</span> newDefence )</div><div class=\"line\">&#123;</div><div class=\"line\">  mDefence = newDefence ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Monster::getDefence( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mDefence ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Monster::setName( <span class=\"built_in\">string</span> newName ) </div><div class=\"line\">&#123;</div><div class=\"line\">  mName = newName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Monster::getName( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Monster::setMaxHp( <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> newMaxHp ) </div><div class=\"line\">&#123;</div><div class=\"line\">  mMaxHp = newMaxHp ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now that the Monster class is complete we are now going to finish the Room class, for reference here it is again from the “database.h” file.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Room </div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Room( <span class=\"built_in\">string</span> name, <span class=\"built_in\">string</span> description, Item* item = <span class=\"literal\">NULL</span> ) ;</div><div class=\"line\">    <span class=\"comment\">//Room( void ) ;</span></div><div class=\"line\">    <span class=\"comment\">//~Room()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> success ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">addMonster</span><span class=\"params\">( Monster* newMonster )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Monster&amp; <span class=\"title\">getMonsterRef</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">    <span class=\"function\">success <span class=\"title\">killMonster</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">itemTaken</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">searchResponse</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">success <span class=\"title\">link</span><span class=\"params\">( <span class=\"keyword\">char</span> direction, Room&amp; room )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">north</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">south</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">east</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">west</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDescription</span><span class=\"params\">( <span class=\"built_in\">string</span> newDescription )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getDescription</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setItem</span><span class=\"params\">( Item* newItem )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    Item* mItem ;</div><div class=\"line\">    Room* mNorth ;</div><div class=\"line\">    Room* mSouth ;</div><div class=\"line\">    Room* mEast ;</div><div class=\"line\">    Room* mWest ;</div><div class=\"line\">    <span class=\"built_in\">list</span>&lt; Monster* &gt; mMonsters ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mDescription ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure></p>\n<p>To define the unit test lets open the “Test.cpp” file and begin with the Room class constructor. Based on our class declarations the Room constructor must be tested for the case where we initialize with and without a starting Item.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_room_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Room constructor test</span></div><div class=\"line\">  <span class=\"function\">Room <span class=\"title\">room_no_item</span><span class=\"params\">(<span class=\"string\">\"Cave\"</span>, <span class=\"string\">\"A dark cave\"</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"Cave\"</span> == room_no_item.mName);</div><div class=\"line\">  assert(<span class=\"string\">\"A dark cave\"</span> == room_no_item.mDescription);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> == room_no_item.mItem);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> == room_no_item.mNorth);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> == room_no_item.mSouth);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> == room_no_item.mEast);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> == room_no_item.mWest);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Room constructor test</span></div><div class=\"line\">  <span class=\"function\">Room <span class=\"title\">room_with_item</span><span class=\"params\">(<span class=\"string\">\"Pit\"</span>, <span class=\"string\">\"A deep pit\"</span>, <span class=\"keyword\">new</span> Item)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"Pit\"</span> == room_with_item.mName);</div><div class=\"line\">  assert(<span class=\"string\">\"A deep pit\"</span> == room_with_item.mDescription);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> != room_with_item.mItem);</div><div class=\"line\">  assert(<span class=\"string\">\"\"</span> == room_with_item.mItem-&gt;getName());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == room_with_item.mItem-&gt;mAvailiable);</div></pre></td></tr></table></figure></p>\n<p>  Next we’re going to add a monster to a new room and successfully find the same monster within the room. Note that due to the choice of a List data structure to hold the Monsters we have two options for finding the Monster; either by checking the back of the list for the most recently added monster or by passing the monster’s name as a parameter to our “getMonsterRef()” method which gets the monster’s reference from our List.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Room addMonster test</span></div><div class=\"line\">  <span class=\"function\">Monster <span class=\"title\">monster</span><span class=\"params\">(<span class=\"string\">\"monster\"</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</span></span>;</div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">room_monster</span><span class=\"params\">(<span class=\"string\">\"House\"</span>, <span class=\"string\">\"A haunted mansion\"</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">room_monster.addMonster(&amp;monster);</div><div class=\"line\"></div><div class=\"line\">assert(&amp;monster == room_monster.mMonsters.back());</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Room getMonsterRef test</span></div><div class=\"line\">assert(&amp;monster == &amp;(room_monster.getMonsterRef(</div><div class=\"line\">        monster.getName())));</div><div class=\"line\">assert(<span class=\"literal\">NULL</span> == &amp;(room_monster.getMonsterRef(<span class=\"string\">\"sheep\"</span>)));</div></pre></td></tr></table></figure></p>\n<p>  Then we should test the ability for a monster to be removed from a room, if a monster is present we expect the kill monster method to return true else it should return false. In addition if the name of the monster we are trying to kill is not found then kill monster should also return false.<br>  <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Room killMonster test</span></div><div class=\"line\">  assert(<span class=\"literal\">false</span> == room_monster.killMonster(<span class=\"string\">\"Invalid monster name\"</span>));</div><div class=\"line\">assert(<span class=\"literal\">true</span> == room_monster.killMonster(monster.getName()));</div><div class=\"line\">assert(<span class=\"literal\">false</span> == room_monster.killMonster(monster.getName()));</div></pre></td></tr></table></figure></p>\n<p> If the Room’s item is taken then the item itself should no longer be available.<br> <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Room itemTaken test</span></div><div class=\"line\">  room_with_item.itemTaken();</div><div class=\"line\"></div><div class=\"line\">assert(<span class=\"literal\">false</span> == room_with_item.mItem-&gt;mAvailiable);</div></pre></td></tr></table></figure></p>\n<p>Next we have the ability to search the room for either monsters and or items. Thinking about this you might be wondering how many different responses are possible. Well the solution is rather simple. <blockquote>A room can hold monsters and a single item. So the item is either present or not present within the room. For the monsters they are also either present or all dead. So we have two possible outcomes for the items and two possible outcomes for the monsters</blockquote> </p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">// Room searchResponse</div><div class=\"line\">// Possible game responses without monsters in the room</div><div class=\"line\">// a) \"There is a Item.mName in this room.\"</div><div class=\"line\">// b) \"After searching, you found nothing of value\"</div><div class=\"line\">Room room_a(\"Forest\", \"Many trees\", new Item(\"Suit\", Item::ARMOR, 0, </div><div class=\"line\">      20, 0));</div><div class=\"line\">string response_a(\"There is a Suit in this room.\");</div><div class=\"line\"></div><div class=\"line\">assert(response_a == room_a.searchResponse());</div><div class=\"line\"></div><div class=\"line\">Room room_b(\"Desert\", \"Sandy plains\");</div><div class=\"line\">string response_b(\"After searching, you found nothing of value\");</div><div class=\"line\"></div><div class=\"line\">assert(response_b == room_b.searchResponse());</div><div class=\"line\"></div><div class=\"line\">// Possible game responses with monsters</div><div class=\"line\">// c) \"There is a Item.mName in this room.\\nThere is a monster nearby...</div><div class=\"line\">//    Attack the Monster.mName\"</div><div class=\"line\">// d) \"After searching, you found nothing of value\\nThere is a </div><div class=\"line\">//    monster nearby... Attack the Monster.mName\"</div><div class=\"line\">Room room_c(\"Sea\", \"Water\", new Item(\"Blade\", Item::WEAPON, 5, 0, 0));</div><div class=\"line\">Monster goblin(\"Goblin\", 1, 2, 3);</div><div class=\"line\">room_c.addMonster(&amp;goblin);</div><div class=\"line\">string response_c(\"There is a Blade in this room.\\nThere is a monster nearby...\\nAttack the Goblin\");</div><div class=\"line\"></div><div class=\"line\">assert(response_c == room_c.searchResponse());</div><div class=\"line\"></div><div class=\"line\">Room room_d(\"Space\", \"Outer space\");</div><div class=\"line\">Monster alien(\"Alien\", 4, 5, 6);</div><div class=\"line\">room_d.addMonster(&amp;alien);</div><div class=\"line\">string response_d(\"After searching, you found nothing of value\\nThere is a monster nearby...\\nAttack the Alien\");</div><div class=\"line\"></div><div class=\"line\">assert(response_d == room_d.searchResponse());</div></pre></td></tr></table></figure>\n<p>Given that we want the players to be able to move freely about, every room has four possible directions leading from it; the usual north, south, east and west. By chance if we accidently tried to invent a new direction the Room linking method should return false.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Room link test</span></div><div class=\"line\"><span class=\"comment\">// The possible directions are 'n', 'e', 'w' or 's'</span></div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">home_room</span><span class=\"params\">(<span class=\"string\">\"House\"</span>, <span class=\"string\">\"A large building\"</span>)</span></span>;</div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">north</span><span class=\"params\">(<span class=\"string\">\"Pool\"</span>, <span class=\"string\">\"A swimming poool\"</span>)</span></span>;</div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">south</span><span class=\"params\">(<span class=\"string\">\"Yard\"</span>, <span class=\"string\">\"Front lawn\"</span>)</span></span>;</div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">east</span><span class=\"params\">(<span class=\"string\">\"Garage\"</span>, <span class=\"string\">\"Empty garage\"</span>)</span></span>;</div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">west</span><span class=\"params\">(<span class=\"string\">\"Balcony\"</span>, <span class=\"string\">\"Wooden balcony\"</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Bad direction</span></div><div class=\"line\">assert(<span class=\"literal\">false</span> == home_room.link(<span class=\"string\">'z'</span>, north));</div><div class=\"line\"><span class=\"comment\">// Good directions</span></div><div class=\"line\">assert(<span class=\"literal\">true</span> == home_room.link(<span class=\"string\">'n'</span>, north));</div><div class=\"line\">assert(<span class=\"literal\">true</span> == home_room.link(<span class=\"string\">'s'</span>, south));</div><div class=\"line\">assert(<span class=\"literal\">true</span> == home_room.link(<span class=\"string\">'e'</span>, east));</div><div class=\"line\">assert(<span class=\"literal\">true</span> == home_room.link(<span class=\"string\">'w'</span>, west));</div><div class=\"line\"><span class=\"comment\">// Verify links</span></div><div class=\"line\">assert(&amp;north == &amp;(home_room.north()));</div><div class=\"line\">assert(&amp;south == &amp;(home_room.south()));</div><div class=\"line\">assert(&amp;west == &amp;(home_room.west()));</div><div class=\"line\">assert(&amp;east == &amp;(home_room.east()));</div></pre></td></tr></table></figure></p>\n<p>Lastly you can just add the Room getters/setters into the “Test.cpp” file.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Room getters and setters</span></div><div class=\"line\">  home_room.setName(<span class=\"string\">\"new room\"</span>);</div><div class=\"line\">  assert(<span class=\"string\">\"new room\"</span> == home_room.mName);</div><div class=\"line\"></div><div class=\"line\">  home_room.setDescription(<span class=\"string\">\"Your new room\"</span>);</div><div class=\"line\">  assert(<span class=\"string\">\"Your new room\"</span> == home_room.getDescription());</div><div class=\"line\"></div><div class=\"line\">  Item* sword = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"sword\"</span>, Item::WEAPON, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">  home_room.setItem(sword);</div><div class=\"line\">  assert(sword == home_room.mItem);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>What we want to do next is to define the methods for the Room class. So open up the “database.cpp” file and lets get started, we’ll begin with the constructor for the Room so just pay attention to the use of the initialization list for the Room’s attributes.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">  Room::Room( <span class=\"built_in\">string</span> name, <span class=\"built_in\">string</span> description, Item* item )</div><div class=\"line\">: mName(name), mDescription(description), mItem(item)</div><div class=\"line\">&#123;</div><div class=\"line\">  mNorth = <span class=\"literal\">NULL</span> ;</div><div class=\"line\">  mSouth = <span class=\"literal\">NULL</span> ;</div><div class=\"line\">  mEast = <span class=\"literal\">NULL</span> ;</div><div class=\"line\">  mWest = <span class=\"literal\">NULL</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The next method we define will be the “Room::Link()” method. Given that the input is a single char we just have to check whether it is valid or not and then connect the room to the appropriate link. So a switch case block will be sufficient.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">bool</span> Room::link( <span class=\"keyword\">char</span> direction, MUD::Room&amp; room )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">bool</span> flag = <span class=\"literal\">false</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">switch</span>( direction )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'n'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'N'</span>:</div><div class=\"line\">      mNorth = &amp;room ;</div><div class=\"line\">      flag = <span class=\"literal\">true</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'s'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'S'</span>:</div><div class=\"line\">      mSouth = &amp;room ;</div><div class=\"line\">      flag = <span class=\"literal\">true</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'e'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'E'</span>:</div><div class=\"line\">      mEast = &amp;room ;</div><div class=\"line\">      flag = <span class=\"literal\">true</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'w'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'W'</span>:</div><div class=\"line\">      mWest = &amp;room ;</div><div class=\"line\">      flag = <span class=\"literal\">true</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> flag ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now that we can link rooms together the next methods will consist of returning the room for a defined direction.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">Room&amp; Room::north( <span class=\"keyword\">void</span> ) </div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> *mNorth ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">Room&amp; Room::south( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> *mSouth ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">Room&amp; Room::east( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> *mEast ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">Room&amp; Room::west( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> *mWest ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>We define the setter for the name attribute.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Room::setName( <span class=\"built_in\">string</span> newName )</div><div class=\"line\">&#123;</div><div class=\"line\">  mName = newName ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Next we have to define how the room should interact with monsters or rather adding, finding and or removing monsters. The first idea is simple, given that we are storing the Monster’s within a List data structure, to add a monster we simply append it to the back of the list.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Room::addMonster( Monster* newMonster )</div><div class=\"line\">&#123;</div><div class=\"line\">  mMonsters.push_back( newMonster ) ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>In order to find a monster within our list of monsters we just iterate over the monster list until we match the name with the name of the monster we’re searching for; if no monster matched then we just return null.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">Monster&amp; Room::getMonsterRef( <span class=\"built_in\">string</span> monsterName ) </div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">list</span>&lt; Monster* &gt;::iterator iter ;</div><div class=\"line\">  Monster* monsterRef = <span class=\"literal\">NULL</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( (*iter)-&gt;getName() == monsterName )</div><div class=\"line\">    &#123;</div><div class=\"line\">      monsterRef = *iter ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> *monsterRef ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>For removing i.e killing a monster the idea is the same as finding it but we then remove it from the list of monsters as opposed to returning its reference. When the monster is not found we return false to indicate that no removal occurred.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">Room::success Room::killMonster( <span class=\"built_in\">string</span> monsterName )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">list</span>&lt; Monster* &gt;::iterator iter ;</div><div class=\"line\">  <span class=\"keyword\">bool</span> flag = <span class=\"literal\">false</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( (*iter)-&gt;getName() == monsterName )</div><div class=\"line\">    &#123;</div><div class=\"line\">      mMonsters.erase( iter ) ;</div><div class=\"line\">      flag = <span class=\"literal\">true</span> ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> flag ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Moving on, when an Item is taken from the room we just mark that the Item is unavailable.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Room::itemTaken( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  mItem-&gt;mAvailiable = <span class=\"literal\">false</span> ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Room::setItem( Item* newItem )</div><div class=\"line\">&#123;</div><div class=\"line\">  mItem = newItem ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The Room’s description is another getter/setter pair.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Room::setDescription( <span class=\"built_in\">string</span> newDescription )</div><div class=\"line\">&#123;</div><div class=\"line\">  mDescription = newDescription ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Room::getDescription( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mDescription ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Finally we have to define the “Room::searchResponse()” method. The objective is to return a string object with all the information gathered about the current Room’s monsters and items. So lets start out with just the lines below,<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">string</span> Room::searchResponse( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">string</span> response ;</div></pre></td></tr></table></figure></p>\n<p>First we’re going to check if an item is currently in the room. An item exist within a room if its both not NULL and is currently available, else there is no item in the room.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span>( mItem != <span class=\"literal\">NULL</span> &amp;&amp; <span class=\"literal\">true</span> == mItem-&gt;mAvailiable )</div><div class=\"line\">&#123;</div><div class=\"line\">  response = <span class=\"string\">\"There is a \"</span> + mItem-&gt;getName() + <span class=\"string\">\" in this room.\"</span> ;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">else</span></div><div class=\"line\">&#123;</div><div class=\"line\">  response = <span class=\"string\">\"After searching, you found nothing of value\"</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Then, if there are monsters present(the monster list is non empty) and for the monsters who are not currently in combat with another player we should present the player with the option to attack it; finally adding this information to the response string.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"keyword\">if</span>( !mMonsters.empty() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      response = response + <span class=\"string\">\"\\nThere is a monster nearby...\"</span> ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"built_in\">list</span>&lt; Monster* &gt;::iterator iter ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )</div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>( <span class=\"literal\">false</span> == (*iter)-&gt;inCombat )</div><div class=\"line\">        &#123;</div><div class=\"line\">          response = response + <span class=\"string\">\"\\nAttack the \"</span> + (*iter)-&gt;getName() ;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Lets run the test by changing our “main.cpp” file to look like the one below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Filename main.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Database.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"Test.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">  Test::get_instance()-&gt;test_item_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_monster_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_room_class();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"/2011/06/09/textbasedrpgpart3\">Click here for part III</a><br><a href=\"/2011/06/15/textbasedrpgpart5\">Click here for part V</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>We continue our quest to design a console based multiplayer RPG game in this article we’ll implement the code for the Monster and Room classes. Both of these classes are critical to our application so pay close attention to the instructions.<br>In part 4 we’re going to implement the methods for two classes, the Monster class and the Room class. Due to its overall small code base we’ll look at the Monster class first. To jog your memory, below are the declarations for the Monster class from “database.h”.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Monster</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Monster( <span class=\"built_in\">string</span> name, <span class=\"keyword\">int</span> maxHp, <span class=\"keyword\">int</span> strength, <span class=\"keyword\">int</span> defence ) ;</div><div class=\"line\">    <span class=\"comment\">//~Monster() </span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newHp )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getHp</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setStrength</span><span class=\"params\">( <span class=\"keyword\">int</span> newStrength )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getStrength</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDefence</span><span class=\"params\">( <span class=\"keyword\">int</span> newDefence )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getDefence</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getName</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxHp</span><span class=\"params\">( <span class=\"keyword\">int</span> newMaxHp )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">int</span> mMaxHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mHp ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mStrength ;</div><div class=\"line\">    <span class=\"keyword\">int</span> mDefence ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"keyword\">bool</span> inCombat ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure></p>\n<p>Much like in previous parts we’ll write out the test cases prior to writing any of the methods. Go ahead and add this line to your “Test.h” file.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_monster_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div></pre></td></tr></table></figure></p>\n<p>Next open up “Test.cpp”, the Monster class is very basic and just involves a constructor along with four getter/setter pairs. Again with the constructor test we just assert that each attribute is the same as the values we pass into it.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_monster_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Monster constuctor test</span></div><div class=\"line\">  <span class=\"function\">Monster <span class=\"title\">test_monster</span><span class=\"params\">(<span class=\"string\">\"test\"</span>, <span class=\"number\">20</span>, <span class=\"number\">10</span>, <span class=\"number\">11</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"test\"</span> == test_monster.mName);</div><div class=\"line\">  assert(<span class=\"number\">20</span> == test_monster.mHp);</div><div class=\"line\">  assert(<span class=\"number\">10</span> == test_monster.mStrength);</div><div class=\"line\">  assert(<span class=\"number\">11</span> == test_monster.mDefence);</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == test_monster.inCombat);</div><div class=\"line\">  assert(test_monster.mHp == test_monster.mMaxHp);</div></pre></td></tr></table></figure></p>\n<p>Lastly for the monster test the getters/setters are pretty basic as well, just type in the code below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Monster getters and setters test</span></div><div class=\"line\">  <span class=\"function\">Monster <span class=\"title\">monster</span><span class=\"params\">(<span class=\"string\">\"gettersetter\"</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  monster.setName(<span class=\"string\">\"dragon\"</span>);</div><div class=\"line\">  monster.setHp(<span class=\"number\">100</span>);</div><div class=\"line\">  monster.setMaxHp(<span class=\"number\">999</span>);</div><div class=\"line\">  monster.setStrength(<span class=\"number\">50</span>);</div><div class=\"line\">  monster.setDefence(<span class=\"number\">200</span>);</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"dragon\"</span> == monster.getName());</div><div class=\"line\">  assert(<span class=\"number\">100</span> == monster.getHp());</div><div class=\"line\">  assert(<span class=\"number\">50</span> == monster.getStrength());</div><div class=\"line\">  assert(<span class=\"number\">200</span> == monster.getDefence());</div><div class=\"line\">  assert(<span class=\"number\">999</span> == monster.mMaxHp);</div><div class=\"line\">  assert(monster.getHp() != monster.mMaxHp);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now that the test have been defined we can now code up the methods for the monster class; so open up the “database.cpp” file and add the lines below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div></pre></td><td class=\"code\"><pre><div class=\"line\">  Monster::Monster( <span class=\"built_in\">string</span> name, <span class=\"keyword\">int</span> maxHp, <span class=\"keyword\">int</span> strength, <span class=\"keyword\">int</span> defence )</div><div class=\"line\">: mName(name), mMaxHp(maxHp), mStrength(strength), mDefence(defence)</div><div class=\"line\">&#123;</div><div class=\"line\">  setHp(maxHp);</div><div class=\"line\">  inCombat = <span class=\"literal\">false</span> ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Monster::setHp( <span class=\"keyword\">int</span> newHp )</div><div class=\"line\">&#123;</div><div class=\"line\">  mHp = newHp ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Monster::getHp( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mHp ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Monster::setStrength( <span class=\"keyword\">int</span> newStrength )</div><div class=\"line\">&#123;</div><div class=\"line\">  mStrength = newStrength ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Monster::getStrength( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mStrength ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Monster::setDefence( <span class=\"keyword\">int</span> newDefence )</div><div class=\"line\">&#123;</div><div class=\"line\">  mDefence = newDefence ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Monster::getDefence( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mDefence ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Monster::setName( <span class=\"built_in\">string</span> newName ) </div><div class=\"line\">&#123;</div><div class=\"line\">  mName = newName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Monster::getName( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Monster::setMaxHp( <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> newMaxHp ) </div><div class=\"line\">&#123;</div><div class=\"line\">  mMaxHp = newMaxHp ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now that the Monster class is complete we are now going to finish the Room class, for reference here it is again from the “database.h” file.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">class</span> Room </div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    Room( <span class=\"built_in\">string</span> name, <span class=\"built_in\">string</span> description, Item* item = <span class=\"literal\">NULL</span> ) ;</div><div class=\"line\">    <span class=\"comment\">//Room( void ) ;</span></div><div class=\"line\">    <span class=\"comment\">//~Room()</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">typedef</span> <span class=\"keyword\">bool</span> success ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">addMonster</span><span class=\"params\">( Monster* newMonster )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Monster&amp; <span class=\"title\">getMonsterRef</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">    <span class=\"function\">success <span class=\"title\">killMonster</span><span class=\"params\">( <span class=\"built_in\">string</span> monsterName )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">itemTaken</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">searchResponse</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">success <span class=\"title\">link</span><span class=\"params\">( <span class=\"keyword\">char</span> direction, Room&amp; room )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">north</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">south</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">east</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\">    <span class=\"function\">Room&amp; <span class=\"title\">west</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">( <span class=\"built_in\">string</span> newName )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setDescription</span><span class=\"params\">( <span class=\"built_in\">string</span> newDescription )</span> </span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">getDescription</span><span class=\"params\">( <span class=\"keyword\">void</span> )</span> <span class=\"keyword\">const</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setItem</span><span class=\"params\">( Item* newItem )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">    Item* mItem ;</div><div class=\"line\">    Room* mNorth ;</div><div class=\"line\">    Room* mSouth ;</div><div class=\"line\">    Room* mEast ;</div><div class=\"line\">    Room* mWest ;</div><div class=\"line\">    <span class=\"built_in\">list</span>&lt; Monster* &gt; mMonsters ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mName ;</div><div class=\"line\">    <span class=\"built_in\">string</span> mDescription ;</div><div class=\"line\">&#125; ;</div></pre></td></tr></table></figure></p>\n<p>To define the unit test lets open the “Test.cpp” file and begin with the Room class constructor. Based on our class declarations the Room constructor must be tested for the case where we initialize with and without a starting Item.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_room_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Room constructor test</span></div><div class=\"line\">  <span class=\"function\">Room <span class=\"title\">room_no_item</span><span class=\"params\">(<span class=\"string\">\"Cave\"</span>, <span class=\"string\">\"A dark cave\"</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"Cave\"</span> == room_no_item.mName);</div><div class=\"line\">  assert(<span class=\"string\">\"A dark cave\"</span> == room_no_item.mDescription);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> == room_no_item.mItem);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> == room_no_item.mNorth);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> == room_no_item.mSouth);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> == room_no_item.mEast);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> == room_no_item.mWest);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Room constructor test</span></div><div class=\"line\">  <span class=\"function\">Room <span class=\"title\">room_with_item</span><span class=\"params\">(<span class=\"string\">\"Pit\"</span>, <span class=\"string\">\"A deep pit\"</span>, <span class=\"keyword\">new</span> Item)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">\"Pit\"</span> == room_with_item.mName);</div><div class=\"line\">  assert(<span class=\"string\">\"A deep pit\"</span> == room_with_item.mDescription);</div><div class=\"line\">  assert(<span class=\"literal\">NULL</span> != room_with_item.mItem);</div><div class=\"line\">  assert(<span class=\"string\">\"\"</span> == room_with_item.mItem-&gt;getName());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == room_with_item.mItem-&gt;mAvailiable);</div></pre></td></tr></table></figure></p>\n<p>  Next we’re going to add a monster to a new room and successfully find the same monster within the room. Note that due to the choice of a List data structure to hold the Monsters we have two options for finding the Monster; either by checking the back of the list for the most recently added monster or by passing the monster’s name as a parameter to our “getMonsterRef()” method which gets the monster’s reference from our List.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Room addMonster test</span></div><div class=\"line\">  <span class=\"function\">Monster <span class=\"title\">monster</span><span class=\"params\">(<span class=\"string\">\"monster\"</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</span></span>;</div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">room_monster</span><span class=\"params\">(<span class=\"string\">\"House\"</span>, <span class=\"string\">\"A haunted mansion\"</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">room_monster.addMonster(&amp;monster);</div><div class=\"line\"></div><div class=\"line\">assert(&amp;monster == room_monster.mMonsters.back());</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Room getMonsterRef test</span></div><div class=\"line\">assert(&amp;monster == &amp;(room_monster.getMonsterRef(</div><div class=\"line\">        monster.getName())));</div><div class=\"line\">assert(<span class=\"literal\">NULL</span> == &amp;(room_monster.getMonsterRef(<span class=\"string\">\"sheep\"</span>)));</div></pre></td></tr></table></figure></p>\n<p>  Then we should test the ability for a monster to be removed from a room, if a monster is present we expect the kill monster method to return true else it should return false. In addition if the name of the monster we are trying to kill is not found then kill monster should also return false.<br>  <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Room killMonster test</span></div><div class=\"line\">  assert(<span class=\"literal\">false</span> == room_monster.killMonster(<span class=\"string\">\"Invalid monster name\"</span>));</div><div class=\"line\">assert(<span class=\"literal\">true</span> == room_monster.killMonster(monster.getName()));</div><div class=\"line\">assert(<span class=\"literal\">false</span> == room_monster.killMonster(monster.getName()));</div></pre></td></tr></table></figure></p>\n<p> If the Room’s item is taken then the item itself should no longer be available.<br> <figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Room itemTaken test</span></div><div class=\"line\">  room_with_item.itemTaken();</div><div class=\"line\"></div><div class=\"line\">assert(<span class=\"literal\">false</span> == room_with_item.mItem-&gt;mAvailiable);</div></pre></td></tr></table></figure></p>\n<p>Next we have the ability to search the room for either monsters and or items. Thinking about this you might be wondering how many different responses are possible. Well the solution is rather simple. <blockquote>A room can hold monsters and a single item. So the item is either present or not present within the room. For the monsters they are also either present or all dead. So we have two possible outcomes for the items and two possible outcomes for the monsters</blockquote> </p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">// Room searchResponse</div><div class=\"line\">// Possible game responses without monsters in the room</div><div class=\"line\">// a) \"There is a Item.mName in this room.\"</div><div class=\"line\">// b) \"After searching, you found nothing of value\"</div><div class=\"line\">Room room_a(\"Forest\", \"Many trees\", new Item(\"Suit\", Item::ARMOR, 0, </div><div class=\"line\">      20, 0));</div><div class=\"line\">string response_a(\"There is a Suit in this room.\");</div><div class=\"line\"></div><div class=\"line\">assert(response_a == room_a.searchResponse());</div><div class=\"line\"></div><div class=\"line\">Room room_b(\"Desert\", \"Sandy plains\");</div><div class=\"line\">string response_b(\"After searching, you found nothing of value\");</div><div class=\"line\"></div><div class=\"line\">assert(response_b == room_b.searchResponse());</div><div class=\"line\"></div><div class=\"line\">// Possible game responses with monsters</div><div class=\"line\">// c) \"There is a Item.mName in this room.\\nThere is a monster nearby...</div><div class=\"line\">//    Attack the Monster.mName\"</div><div class=\"line\">// d) \"After searching, you found nothing of value\\nThere is a </div><div class=\"line\">//    monster nearby... Attack the Monster.mName\"</div><div class=\"line\">Room room_c(\"Sea\", \"Water\", new Item(\"Blade\", Item::WEAPON, 5, 0, 0));</div><div class=\"line\">Monster goblin(\"Goblin\", 1, 2, 3);</div><div class=\"line\">room_c.addMonster(&amp;goblin);</div><div class=\"line\">string response_c(\"There is a Blade in this room.\\nThere is a monster nearby...\\nAttack the Goblin\");</div><div class=\"line\"></div><div class=\"line\">assert(response_c == room_c.searchResponse());</div><div class=\"line\"></div><div class=\"line\">Room room_d(\"Space\", \"Outer space\");</div><div class=\"line\">Monster alien(\"Alien\", 4, 5, 6);</div><div class=\"line\">room_d.addMonster(&amp;alien);</div><div class=\"line\">string response_d(\"After searching, you found nothing of value\\nThere is a monster nearby...\\nAttack the Alien\");</div><div class=\"line\"></div><div class=\"line\">assert(response_d == room_d.searchResponse());</div></pre></td></tr></table></figure>\n<p>Given that we want the players to be able to move freely about, every room has four possible directions leading from it; the usual north, south, east and west. By chance if we accidently tried to invent a new direction the Room linking method should return false.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Room link test</span></div><div class=\"line\"><span class=\"comment\">// The possible directions are 'n', 'e', 'w' or 's'</span></div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">home_room</span><span class=\"params\">(<span class=\"string\">\"House\"</span>, <span class=\"string\">\"A large building\"</span>)</span></span>;</div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">north</span><span class=\"params\">(<span class=\"string\">\"Pool\"</span>, <span class=\"string\">\"A swimming poool\"</span>)</span></span>;</div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">south</span><span class=\"params\">(<span class=\"string\">\"Yard\"</span>, <span class=\"string\">\"Front lawn\"</span>)</span></span>;</div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">east</span><span class=\"params\">(<span class=\"string\">\"Garage\"</span>, <span class=\"string\">\"Empty garage\"</span>)</span></span>;</div><div class=\"line\"><span class=\"function\">Room <span class=\"title\">west</span><span class=\"params\">(<span class=\"string\">\"Balcony\"</span>, <span class=\"string\">\"Wooden balcony\"</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Bad direction</span></div><div class=\"line\">assert(<span class=\"literal\">false</span> == home_room.link(<span class=\"string\">'z'</span>, north));</div><div class=\"line\"><span class=\"comment\">// Good directions</span></div><div class=\"line\">assert(<span class=\"literal\">true</span> == home_room.link(<span class=\"string\">'n'</span>, north));</div><div class=\"line\">assert(<span class=\"literal\">true</span> == home_room.link(<span class=\"string\">'s'</span>, south));</div><div class=\"line\">assert(<span class=\"literal\">true</span> == home_room.link(<span class=\"string\">'e'</span>, east));</div><div class=\"line\">assert(<span class=\"literal\">true</span> == home_room.link(<span class=\"string\">'w'</span>, west));</div><div class=\"line\"><span class=\"comment\">// Verify links</span></div><div class=\"line\">assert(&amp;north == &amp;(home_room.north()));</div><div class=\"line\">assert(&amp;south == &amp;(home_room.south()));</div><div class=\"line\">assert(&amp;west == &amp;(home_room.west()));</div><div class=\"line\">assert(&amp;east == &amp;(home_room.east()));</div></pre></td></tr></table></figure></p>\n<p>Lastly you can just add the Room getters/setters into the “Test.cpp” file.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">// Room getters and setters</span></div><div class=\"line\">  home_room.setName(<span class=\"string\">\"new room\"</span>);</div><div class=\"line\">  assert(<span class=\"string\">\"new room\"</span> == home_room.mName);</div><div class=\"line\"></div><div class=\"line\">  home_room.setDescription(<span class=\"string\">\"Your new room\"</span>);</div><div class=\"line\">  assert(<span class=\"string\">\"Your new room\"</span> == home_room.getDescription());</div><div class=\"line\"></div><div class=\"line\">  Item* sword = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"sword\"</span>, Item::WEAPON, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">  home_room.setItem(sword);</div><div class=\"line\">  assert(sword == home_room.mItem);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>What we want to do next is to define the methods for the Room class. So open up the “database.cpp” file and lets get started, we’ll begin with the constructor for the Room so just pay attention to the use of the initialization list for the Room’s attributes.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">  Room::Room( <span class=\"built_in\">string</span> name, <span class=\"built_in\">string</span> description, Item* item )</div><div class=\"line\">: mName(name), mDescription(description), mItem(item)</div><div class=\"line\">&#123;</div><div class=\"line\">  mNorth = <span class=\"literal\">NULL</span> ;</div><div class=\"line\">  mSouth = <span class=\"literal\">NULL</span> ;</div><div class=\"line\">  mEast = <span class=\"literal\">NULL</span> ;</div><div class=\"line\">  mWest = <span class=\"literal\">NULL</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The next method we define will be the “Room::Link()” method. Given that the input is a single char we just have to check whether it is valid or not and then connect the room to the appropriate link. So a switch case block will be sufficient.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">bool</span> Room::link( <span class=\"keyword\">char</span> direction, MUD::Room&amp; room )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">bool</span> flag = <span class=\"literal\">false</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">switch</span>( direction )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'n'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'N'</span>:</div><div class=\"line\">      mNorth = &amp;room ;</div><div class=\"line\">      flag = <span class=\"literal\">true</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'s'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'S'</span>:</div><div class=\"line\">      mSouth = &amp;room ;</div><div class=\"line\">      flag = <span class=\"literal\">true</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'e'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'E'</span>:</div><div class=\"line\">      mEast = &amp;room ;</div><div class=\"line\">      flag = <span class=\"literal\">true</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'w'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'W'</span>:</div><div class=\"line\">      mWest = &amp;room ;</div><div class=\"line\">      flag = <span class=\"literal\">true</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> flag ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now that we can link rooms together the next methods will consist of returning the room for a defined direction.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">Room&amp; Room::north( <span class=\"keyword\">void</span> ) </div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> *mNorth ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">Room&amp; Room::south( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> *mSouth ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">Room&amp; Room::east( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> *mEast ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">Room&amp; Room::west( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> *mWest ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>We define the setter for the name attribute.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Room::setName( <span class=\"built_in\">string</span> newName )</div><div class=\"line\">&#123;</div><div class=\"line\">  mName = newName ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Next we have to define how the room should interact with monsters or rather adding, finding and or removing monsters. The first idea is simple, given that we are storing the Monster’s within a List data structure, to add a monster we simply append it to the back of the list.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Room::addMonster( Monster* newMonster )</div><div class=\"line\">&#123;</div><div class=\"line\">  mMonsters.push_back( newMonster ) ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>In order to find a monster within our list of monsters we just iterate over the monster list until we match the name with the name of the monster we’re searching for; if no monster matched then we just return null.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">Monster&amp; Room::getMonsterRef( <span class=\"built_in\">string</span> monsterName ) </div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">list</span>&lt; Monster* &gt;::iterator iter ;</div><div class=\"line\">  Monster* monsterRef = <span class=\"literal\">NULL</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( (*iter)-&gt;getName() == monsterName )</div><div class=\"line\">    &#123;</div><div class=\"line\">      monsterRef = *iter ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> *monsterRef ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>For removing i.e killing a monster the idea is the same as finding it but we then remove it from the list of monsters as opposed to returning its reference. When the monster is not found we return false to indicate that no removal occurred.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">Room::success Room::killMonster( <span class=\"built_in\">string</span> monsterName )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">list</span>&lt; Monster* &gt;::iterator iter ;</div><div class=\"line\">  <span class=\"keyword\">bool</span> flag = <span class=\"literal\">false</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( (*iter)-&gt;getName() == monsterName )</div><div class=\"line\">    &#123;</div><div class=\"line\">      mMonsters.erase( iter ) ;</div><div class=\"line\">      flag = <span class=\"literal\">true</span> ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> flag ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Moving on, when an Item is taken from the room we just mark that the Item is unavailable.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Room::itemTaken( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  mItem-&gt;mAvailiable = <span class=\"literal\">false</span> ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Room::setItem( Item* newItem )</div><div class=\"line\">&#123;</div><div class=\"line\">  mItem = newItem ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The Room’s description is another getter/setter pair.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Room::setDescription( <span class=\"built_in\">string</span> newDescription )</div><div class=\"line\">&#123;</div><div class=\"line\">  mDescription = newDescription ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Room::getDescription( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mDescription ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Finally we have to define the “Room::searchResponse()” method. The objective is to return a string object with all the information gathered about the current Room’s monsters and items. So lets start out with just the lines below,<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">string</span> Room::searchResponse( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">string</span> response ;</div></pre></td></tr></table></figure></p>\n<p>First we’re going to check if an item is currently in the room. An item exist within a room if its both not NULL and is currently available, else there is no item in the room.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span>( mItem != <span class=\"literal\">NULL</span> &amp;&amp; <span class=\"literal\">true</span> == mItem-&gt;mAvailiable )</div><div class=\"line\">&#123;</div><div class=\"line\">  response = <span class=\"string\">\"There is a \"</span> + mItem-&gt;getName() + <span class=\"string\">\" in this room.\"</span> ;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">else</span></div><div class=\"line\">&#123;</div><div class=\"line\">  response = <span class=\"string\">\"After searching, you found nothing of value\"</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Then, if there are monsters present(the monster list is non empty) and for the monsters who are not currently in combat with another player we should present the player with the option to attack it; finally adding this information to the response string.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"keyword\">if</span>( !mMonsters.empty() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      response = response + <span class=\"string\">\"\\nThere is a monster nearby...\"</span> ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"built_in\">list</span>&lt; Monster* &gt;::iterator iter ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">for</span>( iter = mMonsters.begin() ; iter != mMonsters.end() ; ++iter )</div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>( <span class=\"literal\">false</span> == (*iter)-&gt;inCombat )</div><div class=\"line\">        &#123;</div><div class=\"line\">          response = response + <span class=\"string\">\"\\nAttack the \"</span> + (*iter)-&gt;getName() ;</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Lets run the test by changing our “main.cpp” file to look like the one below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Filename main.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Database.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"Test.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">  Test::get_instance()-&gt;test_item_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_monster_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_room_class();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n"},{"title":"Build A Text Based Multiplayer RPG Part V","date":"2011-06-15T07:00:00.000Z","_content":"- [Click here for part IV][link_part_4]\n- [Click here for part VI][link_part_6]\n\n# Intro\nThe fifth part of the tutorial on creating a text based multiplayer RPG game will see us creating the last part of the testing and game mechanics before the next section where we'll launch the client and server code to actually test our game in action.\n\nIn this part of the tutorial we will complete the test and methods necessary to get the full functionality for the stand alone single player version. In the next part of the tutorial part 6, we will begin to develop both the client and server code that allows other users to connect and play our game over a local area network. So lets continue with the testing and move onto the player class. Go ahead and open up the “test.h\" file and add line below.\n\n```c\nvoid test_player_class();\n```\n\nThen open up the file “test.cpp\" and add the methods for the player test class beginning at the line indicated.\n\n```c\nvoid Test::test_player_class(void)\n{\n  // Player constructor w/o initial room\n  Player no_room_player(\"hero\");\n\n  assert(10 == no_room_player.mMaxHp);\n  assert(10 == no_room_player.mHp);\n  assert(1 == no_room_player.mStrength);\n  assert(0 == no_room_player.mDefence);\n  assert(NULL == no_room_player.mLocation);\n  assert(\"hero\" == no_room_player.mName);\n  assert(NULL == no_room_player.mWeapon);\n  assert(NULL == no_room_player.mArmor);\n\n  // Player constructor w/room\n  Player room_player(\"dude\", new Room(\"Home\", \"A big house\"));\n\n  assert(NULL != room_player.mLocation);\n\n  // Player getters/setters\n  Player get_set(\"setter\", new Room(\"Lake\", \"A clean lake\"));\n\n  get_set.setDefence(1);\n  get_set.setHp(10);\n  get_set.setName(\"getter\");\n  get_set.setStrength(2);\n\n  assert(1 == get_set.getDefence());\n  assert(10 == get_set.getHp());\n  assert(\"getter\" == get_set.getName());\n  assert(2 == get_set.getStrength());\n  assert(\"Lake\" == get_set.getLocation());\n\n  // Player equip test\n  // The Item is not found\n  // - There is no item within the room \"There is no item to equip in this rooom\"\n  // - The player misspelled the item name \"To equip an item you must type its full name correctly\"\n  Room no_item_room(\"Itemless\", \"There is no item here\");\n  Player no_item_player(\"Hi\");\n  no_item_player.mLocation = &no_item_room;\n  string response(\"There is no item to equip in this room\");\n\n  assert(response == no_item_player.equip(\"Bad Item name\"));\n\n  Room with_item(\"Item room\", \"Item filled room\", new Item(\"dagger\", Item::WEAPON, 10, 0, 0));\n  no_item_player.mLocation = &with_item;\n  response = \"To equip an item you must type its full name correctly\";\n\n  assert(response == no_item_player.equip(\"daggers\"));\n\n  // Weapon is found\n  // - The weapon becomes unavailable\n  // - The players strength is set equal to the weapons power value\n  // - The response returned is \"You equipped the Item.mName\"      Player item_player(\"Bye\", &with_item);\n  response = \"You equipped the dagger\";\n\n  assert(response == item_player.equip(\"dagger\"));\n  assert(false == with_item.mItem->mAvailiable);\n  assert(with_item.mItem->getPower() == item_player.getStrength());\n\n  // Armor is found\n  // - The armor becomes unavailable\n  // - The players vitality is set equal to the armor's defence  // - The response returned is \"You equipped the Item.mName\"\n  // - The armor's health value is added to the players max hp\n  Item* steel_plate = new Item(\"steelplate\", Item::ARMOR, 0, 10, 20);\n  with_item.setItem(steel_plate);\n  response = \"You equipped the steelplate\";\n\n  assert(response == item_player.equip(\"steelplate\"));\n  assert(with_item.mItem->mAvailiable == false);\n  assert(steel_plate->getHealth() + item_player.getHp()\n      == item_player.mMaxHp);\n  assert(with_item.mItem->getVitality() == item_player.getDefence());\n\n  // Health is found\n  // - The health item becomes unavailable\n  // - The player's hp is fully restored\n  // - The response is \"You were healed\"\n  Item* herb = new Item(\"herbs\", Item::HEALTH, 0, 0, 0);\n  with_item.setItem(herb);\n  response = \"You were healed\";\n\n  assert(response == item_player.equip(\"herbs\"));\n  assert(with_item.mItem->mAvailiable == false);\n  assert(item_player.getHp() == item_player.mMaxHp);\n\n  // Player attack test\n  // a- There are no monsters within the Room then the method should  //methodreturn \"There are no monsters in this room to fight\"\n  // b- The player mis-typed the monster name then\n  //name\"The Monster.mName is not here\"\n  // c- If damage was dealt to the monster then the message should say\n  //should\"Monster.mName was dealt X damage\"  // d- If no damage was dealt to the monster then the message should say\n  //should\"Monster.mName dodged the attack\"\n  string response_a(\"There are no monsters in this room to fight\");\n  string response_b(\"The roll is not here\");\n  string response_c(\"troll was dealt 30 damage\");\n  string response_d(\"supertroll dodged the attack\");\n\n  Item* great_sword = new Item(\"greatsword\", Item::WEAPON, 30, 0, 0);\n  Room* arena = new Room(\"arena\", \"A large crowd gathers\", great_sword);\n  Monster* troll = new Monster(\"troll\", 50, 0, 0);\n\n  arena->setItem(great_sword);\n  Player* attacker = new Player(\"Fighter\", arena);\n  attacker->equip(\"greatsword\");\n\n  assert(response_a == attacker->attack(\"troll\"));\n\n  arena->addMonster(troll);\n\n  assert(response_b == attacker->attack(\"roll\"));\n  assert(response_c == attacker->attack(\"troll\"));\n\n  Monster* super_troll = new Monster(\"supertroll\", 8, 0, 999);\n  arena->addMonster(super_troll);\n  assert(response_d == attacker->attack(\"supertroll\"));\n\n  // Player move test\n  // - If the player moves in an invalid direction then  //direction\"You traveled nowhere\" should be returned\n  // - If the direction is valid but no room is connected\n  //is\"There is nothing in that direction\"\n  // - If the direction is valid and a room exist\n  //room\"You traveled directionname\\nmLocation->getDescription()\"\n  Room* moving_room = new Room(\"Moving room\", \"You can move from here\");\n  Room* moving_north = new Room(\"Moving north\",  \"North of the moving room\");\n  Room* moving_south = new Room(\"Moving south\",  \"South of the moving room\");\n  Room* moving_west = new Room(\"Moving west\",\n      \"West of the moving room\");\n  Room* moving_east = new Room(\"Moving east\",\n      \"East of the moving room\");\n\n  Player* moving_player = new Player(\"Jill\", moving_room);\n  response = \"You traveled nowhere\";\n\n  assert(response == moving_player->move('p'));\n\n  response = \"There is nothing in that direction\";\n\n  assert(response == moving_player->move('n'));\n  assert(response == moving_player->move('e'));\n  assert(response == moving_player->move('w'));\n  assert(response == moving_player->move('s'));\n\n  moving_player->mLocation = moving_room;\n  response = \"You traveled North\\n\" + moving_north->getDescription();\n  moving_room->link('n', *moving_north);\n  assert(response == moving_player->move('n'));\n\n  moving_player->mLocation = moving_room;\n  response = \"You traveled South\\n\" + moving_south->getDescription();\n  moving_room->link('s', *moving_south);\n  assert(response == moving_player->move('s'));\n\n  moving_player->mLocation = moving_room;\n  response = \"You traveled West\\n\" + moving_west->getDescription();\n  moving_room->link('w', *moving_west);\n  assert(response == moving_player->move('w'));\n\n  moving_player->mLocation = moving_room;\n  response = \"You traveled East\\n\" + moving_east->getDescription();\n  moving_room->link('e', *moving_east);\n  assert(response == moving_player->move('e'));\n\n  // Player search test\n  // Exact same as the string Room::searchResponse( void )  // method so it has already been tested\n\n  // Player death test\n  // -Returns true when the player's hp is less than zero\n  // -Returns false when the player's hp is greater than zero\n  Player* death_test = new Player(\"Dead guy\");\n\n  assert(false == death_test->death());\n\n  death_test->setHp(-1);\n  assert(true == death_test->death());\n}\n```\n\nNow that we have the methods for the player class all set the next thing we have to do is to write out the methods for the player class. To do so open up the file “database.cpp\" and add the methods for the player class below.\n\n```c\nPlayer::Player( string name, Room* start )  : mName(name), mLocation(start), mWeapon(NULL), mArmor(NULL),\n  mHp(10), mMaxHp(10), mStrength(1), mDefence(0)\n{\n}\n\nvoid Player::setHp( int newHp )\n{\n  mHp = newHp ;\n}\n\nint Player::getHp( void ) const\n{\n  return mHp ;\n}\n\nvoid Player::setStrength( int newStrength )\n{\n  mStrength = newStrength ;\n}\n\nint Player::getStrength( void ) const\n{\n  return mStrength ;\n}\n\nvoid Player::setDefence( int newDefence )\n{\n  mDefence = newDefence ;\n}\n\nint Player::getDefence( void ) const\n{\n  return mDefence ;\n}\n\nstring Player::getLocation( void )\n{\n  return mLocation->mName ;\n}\n\nvoid Player::setName( string newName )\n{\n  mName = newName ;\n}\n\nstring Player::getName( void ) const  {\n  return mName ;\n}\n\nstring Player::attack( string monsterName )\n{\n  list< Monster* >::iterator iter ;\n  int damage = 0 ;\n  string response( \"The \" + monsterName + \" is not here\" ) ;  stringstream ss ;\n  string strDamage ;\n\n  if( mLocation->mMonsters.empty() )\n  {\n    return \"There are no monsters in this room to fight\" ;\n  }\n\n  for( iter = mLocation->mMonsters.begin() ; iter != mLocation->mMonsters.end() ; ++iter )\n  {\n    if( (*iter)->getName() == monsterName )\n    {\n      damage = getStrength() - (*iter)->getDefence() ;\n      ss << damage ;\n      ss >> strDamage ;\n      ss.clear() ;\n\n      if( damage > 0 )\n      {\n        (*iter)->setHp( (*iter)->getHp() - damage ) ;\n        response = (*iter)->getName() + \" was dealt \" + strDamage + \" damage\" ;\n      }\n      else\n      {\n        response = (*iter)->getName() + \" dodged the attack\" ;\n      }\n\n      break ;\n    }\n  }\n\n  return response ;\n}\n\nstring Player::equip( string itemName )\n{\n  string response ;\n\n  if( mLocation->mItem != NULL && mLocation->mItem->getName() == itemName )\n  {\n    if( Item::WEAPON == mLocation->mItem->getType() && true == mLocation->mItem->mAvailiable )\n    {\n      mWeapon = mLocation->mItem ;\n      mLocation->itemTaken() ;\n      setStrength( mWeapon->getPower() ) ;\n      response = \"You equipped the \" + mWeapon->getName() ;\n      return response ;\n    }\n    else if( Item::ARMOR == mLocation->mItem->getType() && true == mLocation->mItem->mAvailiable )\n    {\n      mArmor = mLocation->mItem ;\n      mLocation->itemTaken() ;\n      setDefence( mArmor->getVitality() ) ;\n      mMaxHp += mArmor->getHealth() ;\n      response = \"You equipped the \" + mArmor->getName() ;\n      return response ;\n    }\n    else\n    {\n      setHp( mMaxHp ) ;\n      mLocation->itemTaken() ;\n      response = \"You were healed\" ;\n      return response ;\n    }\n  }\n  else\n  {\n    if( mLocation->mItem == NULL )\n    {\n      return \"There is no item to equip in this room\" ;\n    }\n    response = \"To equip an item you must type its full name correctly\" ;\n\n    return response ;\n  }\n}\n\nstring Player::move( char direction )\n{\n  string response = \"You traveled \" ;\n  switch( direction )\n  {\n    case 'n':\n    case 'N':\n      if( NULL == mLocation->mNorth )\n      {\n        response = \"There is nothing in that direction\" ;\n        break ;\n      }\n      mLocation = &(mLocation->north()) ;\n      response = response + \"North\\n\" + mLocation->getDescription() ;\n      break ;\n\n    case 's':\n    case 'S':\n      if( NULL == mLocation->mSouth )\n      {\n        response = \"There is nothing in that direction\" ;\n        break ;\n      }\n      mLocation = &(mLocation->south()) ;\n      response = response + \"South\\n\" + mLocation->getDescription() ;\n      break ;\n\n    case 'e':\n    case 'E':\n      if( NULL == mLocation->mEast )\n      {\n        response = \"There is nothing in that direction\" ;\n        break ;\n      }\n      mLocation = &(mLocation->east()) ;\n      response = response + \"East\\n\" + mLocation->getDescription() ;\n      break ;\n\n    case 'w':\n    case 'W':\n      if( NULL == mLocation->mWest )\n      {\n        response = \"There is nothing in that direction\" ;\n        break ;\n      }\n      mLocation = &(mLocation->west()) ;\n      response = response + \"West\\n\" + mLocation->getDescription() ;\n      break ;\n\n    default:\n      response = response + \"nowhere\" ;\n  }\n\n  return response ;\n}\n\nstring Player::search( void )\n{\n  return mLocation->searchResponse() ;\n}\n\nPlayer::dead Player::death( void )\n{\n  if( getHp() <= 0 )\n  {\n    return true ;\n  }\n\n  return false ;\n}\n```\nAfterwards you can begin to test the Dungeon class, so open up the file “test.h\" file and add the following line.\n\n```c\nvoid test_dungeon_class(void);\n```\n\nHere are the methods for the dungeon test, it is quite long so you can copy it if you want to but I suggest typing it out and reading through the comments in order to better understand the codebase; the file for the code below is “test.cpp\"\n\n```c\nvoid Test::test_dungeon_class(void)\n{\n  // Dungeon constructor test\n  Dungeon* test_dungeon = new Dungeon(1, 1);\n\n  assert(1 == test_dungeon->mMaxPlayers);\n  assert(1 == test_dungeon->mMaxRooms);\n  assert(true == test_dungeon->mPlayers.empty());\n  assert(true == test_dungeon->mRooms.empty());\n  // - A dungeon without monsters is considered complete\n  assert(true == test_dungeon->isComplete());\n\n  // Dungeon addPlayer test\n  // - Successful addition of a new player should display the following\n  //the\"The player named newPlayer->getName() entered the Dungeon\"\n  Player* newbie = new Player(\"Noob\");\n  string response(\"The player named Noob entered the Dungeon\");\n\n  assert(response == test_dungeon->addPlayer(newbie));\n  assert(false == test_dungeon->mPlayers.empty());\n\n  // Dungeon addRoom test\n  // - \"The room: newRoom->mName was added\" will be displayed\n  //beif the addition was successful\n  Room* main_room = new Room(\"Main hall\", \"The main hall\");\n  response = \"The room: Main hall was added\";\n\n  assert(response == test_dungeon->addRoom(main_room));\n  assert(false == test_dungeon->mRooms.empty());\n\n  // Dungeon removePlayer test\n  response = \"Noob has left the dungeon\";\n  assert(response == test_dungeon->removePlayer(newbie->getName()));\n\n  // Dungeon generatePlayerStats test\n  // -Sets the players max hp to 10, strength and defence to 2\n  test_dungeon->generatePlayerStats(newbie);\n\n  assert(10 == newbie->getHp());\n  assert(2 == newbie->getStrength());\n  assert(2 == newbie->getDefence());\n\n  // Dungeon combatLoop test\n  // - If the hero is stronger than the monster then the monster  //theshould die else the hero should die\n  Dungeon* combat_test = new Dungeon(1, 1);\n  Room* combat_room = new Room(\"Battle\", \"Fight here\");\n  Item* longsword = new Item(\"longsword\", Item::WEAPON, 100, 0, 0);\n  Player* brawler = new Player(\"brawler\", combat_room);\n  Monster* ogre = new Monster(\"ogre\", 10, 0, 0);  Monster* superogre = new Monster(\"superogre\", 100, 100, 100);  combat_room->setItem(longsword);\n  combat_room->addMonster(ogre);\n  combat_room->addMonster(superogre);\n  combat_test->addRoom(combat_room);\n  combat_test->addPlayer(brawler);\n  combat_test->generatePlayerStats(brawler);\n  brawler->mLocation = combat_room;\n  brawler->equip(\"longsword\");\n\n  combat_test->combatLoop(*brawler, *ogre);\n  assert(combat_room->mMonsters.empty() == false);\n  assert(combat_test->isComplete() == false);\n\n  Item* badsword = new Item(\"badsword\", Item::WEAPON, 0, 0, 0);\n  combat_room->setItem(badsword);\n  brawler->equip(\"badsword\");\n\n  combat_test->combatLoop(*brawler, *superogre);\n  assert(true == brawler->death());\n\n  // Dungeon playerStatus test\n  Dungeon* status_test = new Dungeon(1, 2);\n  Room* start_room = new Room(\"Starting room\", \"Start here\");\n  Room* end_room = new Room(\"Ending room\", \"End here\");\n  Player* stats_hero = new Player(\"Mike\", start_room);\n  Item* weapon_x = new Item(\"weaponx\", Item::WEAPON, 20, 0, 0);\n  Item* armor_x = new Item(\"armorx\", Item::ARMOR, 0, 20, 10);\n\n  start_room->link('e', *end_room);\n  end_room->link('w', *start_room);\n  start_room->setItem(weapon_x);\n  end_room->setItem(armor_x);\n  status_test->addRoom(start_room);\n  status_test->addRoom(end_room);\n  status_test->addPlayer(stats_hero);\n\n  // The stats reported are the following\n  /*\n     1. Hp\n     2. Strength\n     3. Defence\n     4. Location\n     5. Name\n     6. Weapon\n     7. Armor\n   */\n  const int stat_total = 7;\n  string* status_before_weapon = new string[stat_total];\n  string* status_with_weapon = new string[stat_total];\n  string* status_with_armor = new string[stat_total];\n\n  status_before_weapon[0] = \"Current HP: 10 out of 10\";\n  status_before_weapon[1] = \"Current Strength: 2\";\n  status_before_weapon[2] = \"Current Defence: 2\";\n  status_before_weapon[3] = \"Current Location: Starting room\";\n  status_before_weapon[4] = \"Current Name: Mike\";\n  status_before_weapon[5] = \"Current Weapon: none equipped\";\n  status_before_weapon[6] = \"Current Armor: none equipped\";\n\n  assert(status_before_weapon = status_test->playerStatus(*stats_hero));\n\n  stats_hero->equip(\"weaponx\");\n\n  status_with_weapon[0] = \"Current HP: 10 out of 10\";\n  status_with_weapon[1] = \"Current Strength: 20\";\n  status_with_weapon[2] = \"Current Defence: 2\";\n  status_with_weapon[3] = \"Current Location: Starting room\";\n  status_with_weapon[4] = \"Current Name: Mike\";\n  status_with_weapon[5] = \"Current Weapon: weaponx\";\n  status_with_weapon[6] = \"Current Armor: none equipped\";\n\n  assert(status_with_weapon = status_test->playerStatus(*stats_hero));\n\n  stats_hero->move('e');\n  stats_hero->equip(\"armorx\");\n\n  status_with_armor[0] = \"Current HP: 10 out of 20\";\n  status_with_armor[1] = \"Current Strength: 20\";\n  status_with_armor[2] = \"Current Defence: 20\";\n  status_with_armor[3] = \"Current Location: Ending room\";\n  status_with_armor[4] = \"Current Name: Mike\";\n  status_with_armor[5] = \"Current Weapon: weaponx\";\n  status_with_armor[6] = \"Current Armor: armorx\";\n\n  assert(status_with_armor = status_test->playerStatus(*stats_hero));\n}\n```\nNow we can write out the methods for the dungeon class itself. Go open up the file “database.cpp\" and add the lines below to the file, remember to start at the line of code indicated in the margins.\n\n```c\nDungeon::Dungeon( int maxPlayers, int maxRooms )  : mMaxPlayers(maxPlayers), mMaxRooms(maxRooms)\n{\n  mRooms.reserve( maxRooms ) ;\n  mPlayers.reserve( maxPlayers ) ;\n}\n\nbool Dungeon::isComplete( void )\n{\n  bool flag = true ;\n\n  for( unsigned int i = 0 ; i < mRooms.size() ; ++i )\n  {\n    if( mRooms[i]->mMonsters.empty() )\n    {\n      continue ;\n    }\n    else\n    {\n      flag = false ;\n      break ;\n    }\n  }\n\n  return flag ;\n}\n\nstring Dungeon::addPlayer( Player *newPlayer )\n{\n  mPlayers.push_back( newPlayer ) ;\n  string response = \"The player named \" + newPlayer->getName() + \" entered the Dungeon\" ;\n\n  generatePlayerStats( newPlayer ) ;\n\n  return response ;\n}\n\nvoid Dungeon::generatePlayerStats( Player* newPlayer )\n{\n  newPlayer->mMaxHp = 10 ;\n  newPlayer->setHp( newPlayer->mMaxHp ) ;\n  newPlayer->setStrength( 2 ) ;\n  newPlayer->setDefence( 2 ) ;\n}\n\nstring Dungeon::addRoom( Room *newRoom )\n{\n  mRooms.push_back( newRoom ) ;\n  string response = \"The room: \" + newRoom->mName + \" was added\" ;\n\n  return response ;\n}\n\nstring Dungeon::removePlayer( std::string playerName )\n{\n  string response = playerName + \" has left the dungeon\" ;\n\n  for( unsigned int i = 0 ; i < mPlayers.size() ; ++i )\n  {\n    if( playerName == mPlayers[i]->getName() )\n    {\n      mPlayers.erase( mPlayers.begin() + i ) ;\n      break ;\n    }\n  }\n\n  return response ;\n}\n\n//Should change this to have the monstersName as an argument\nvoid Dungeon::combatLoop( Player& hero, Monster& villain )\n{\n  villain.inCombat = true ;\n\n  while( true )\n  {\n    cout << hero.attack( villain.getName() ) << endl ;\n    if( villain.getHp() <= 0 )\n    {\n      cout << villain.getName() + \" was slain by the valiant \" << hero.getName() << endl;\n      hero.mLocation->killMonster( villain.getName() ) ;\n      return ;\n    }\n    else\n    {\n      int damage = 0 ;\n      damage = villain.getStrength() - hero.getDefence() ;\n\n      if( damage > 0 )\n      {\n        hero.setHp( hero.getHp() - damage ) ;\n        cout << hero.getName() + \" was dealt \" << damage << \" damage\" << endl ;\n      }\n      else\n      {\n        cout << hero.getName() + \" dodged the attack\" << endl ;\n      }\n\n      if( hero.death() )\n      {\n        cout << hero.getName() + \" was slain by the horrible \" + villain.getName() << endl;\n        return ;\n      }\n    }\n  }\n}\n\nstring* Dungeon::playerStatus( Player& player )\n{\n  stringstream ss ;\n  string temp ;\n  const int statusCount = 7 ;\n  string* response = new string[statusCount] ;\n\n  ss << player.getHp() ;\n  ss >> temp ;\n  response[0] = \"Current HP: \" + temp ;\n  ss.clear() ;\n  temp.clear() ;\n  ss << player.mMaxHp ;\n  ss >> temp ;\n  response[0] = response[0] + \" out of \" + temp ;\n  temp.clear() ;\n  ss.clear() ;\n\n  ss << player.getStrength() ;\n  ss >> temp ;\n  response[1] = \"Current Strength: \" + temp ;\n  ss.clear() ;\n  temp.clear() ;\n\n  ss << player.getDefence() ;\n  ss >> temp ;\n  response[2] = \"Current Defence: \" + temp ;\n  ss.clear() ;\n  temp.clear() ;\n\n  if( NULL == player.mLocation )\n  {\n    response[3] = \"Error: BAD LOCATION\" ;\n  }\n  else\n  {\n    response[3] = \"Current Location: \" + player.getLocation() ;\n  }\n\n  response[4] = \"Current Name: \" + player.getName() ;\n\n  if( NULL == player.mWeapon )\n  {\n    response[5] = \"Current Weapon: none equipped\" ;\n  }\n  else\n  {\n    response[5] = \"Current Weapon: \" + player.mWeapon->getName() ;\n  }\n\n  if( NULL == player.mArmor )\n  {\n    response[6] = \"Current Armor: none equipped\" ;\n  }\n  else\n  {\n    response[6] = \"Current Armor: \" + player.mArmor->getName() ;\n  }\n\n  return response ;\n}\n\nvoid Dungeon::displayHelp( void )\n{\n  cout << \"////////////////\" << endl ;\n  cout << \"Help menu\" << endl ;\n  cout << \"////////////////\" << endl ;\n  cout << \"Attack a monster type -> a:monster_name_here\" << endl ;\n  cout << \"Move to a new location type -> mv:location_name_here\" << endl ;\n  cout << \"Look for items type -> find:\" << endl ;\n  cout << \"Search the room for exits and monsters type -> loc:\" << endl ;\n  cout << \"Equip new items type -> eq:weapon_or_armor_name\" << endl;\n  cout << \"See your current status type -> you:\" << endl;\n}\n```\n\nThe next class we have to test is the filter class, if you recall from previous parts, the filter class’ job is to validate user input to check if it is safe to “dispatch\" to the database. You can think of the filter as a sanitizer for bad commands just like you can image a filter swearing words on message boards. Now go open up “test.h\" and add the following line.\n\n```c\nvoid test_filter_class(void);\n```\n\nYou know the drill, create the test methods within the file “test.cpp\" for the filter class(don’t worry this class is short).\n\n```c\nvoid Test::test_filter_class(void)\n{\n  // Filter chat test\n  // string Filter::chat() just truncates the command from the  //fromchat message if it was t:message  Filter filter;\n  string input(\"t:Hello world\");\n  string response(\"Hello world\");\n\n  assert(response == filter.chat(input));\n\n  // Filter validateMessage test\n  /*\n     The valid commands are the following\n    a:\n    mv:\n    find:\n    loc:\n    eq:\n    you:\n    help:\n   */\n  assert(true == filter.validateMessage(\"mv:n\"));\n  assert(true == filter.validateMessage(\"a:goblin\"));\n  assert(true == filter.validateMessage(\"find:\"));\n  assert(true == filter.validateMessage(\"loc:\"));\n  assert(true == filter.validateMessage(\"eq:weapon\"));\n  assert(true == filter.validateMessage(\"you:\"));\n  assert(true == filter.validateMessage(\"help:\"));\n\n  assert(false == filter.validateMessage(\"move:north\"));\n  assert(false == filter.validateMessage(\"move:south\"));\n  assert(false == filter.validateMessage(\"move:east\"));\n  assert(false == filter.validateMessage(\"move:west\"));\n  assert(false == filter.validateMessage(\"attack:goblin\"));\n  assert(false == filter.validateMessage(\"fid:\"));\n  assert(false == filter.validateMessage(\"location:\"));\n  assert(false == filter.validateMessage(\"eqip:weapon\"));\n  assert(false == filter.validateMessage(\"me:\"));\n  assert(false == filter.validateMessage(\"zelpeafaf:\"));\n  assert(false == filter.validateMessage(\"gg:\"));\n  assert(false == filter.validateMessage(\"Pi:affg\"));\n  assert(false == filter.validateMessage(\"Eqip:weapon\"));\n  assert(false == filter.validateMessage(\"Ye:\"));\n  assert(false == filter.validateMessage(\"no command input\"));\n}\n```\nThere are only two methods for the filter class, chat and validate message. As you can probably guess, chat just sends out the text following the chat command “t:\". However validate message a bit more involved. Validate message works by running three distinct test, the “keywordtest\" the “commandtest\" and the movecommandtest\". Keyword just makes sure that the user entered a keyword such as “a:\" for attack, “you:\" for player status or any of the others. The “commandtest\" just checks after the keyword has been validated that the fullname of the command matches the possible command inputs. Lastly the “movecommandtest\" ensures that the direction of travel for the move command is north, south, east or west. So go open up “database.cpp\" and add the lines below paying attention to which line the code begins on as shown in the margin.\n```c\nFilter::valid Filter::validateMessage( std::string message )\n{\n  //Necessary for the std::tolower() method\n  locale loc ;\n\n  for( unsigned int i = 0 ; i < message.length() ; ++i )\n  {\n    message [ i ] = tolower( message[ i ], loc ) ;\n  }\n\n  bool keywordTest = false ;  bool commandTest = false ;  bool moveCommandTest = true ; // Checks for a valid direction\n  unsigned int inputIndex = 0;\n\n  switch( message[ 0 ] )\n  {\n    case 'a': //Attack  case 'm': //Move\n    case 'f': //Find\n    case 'l': //Location\n    case 'e': //Equip\n    case 'y': //You\n    case 't': //Talk\n    case 'h': //Help Menu\n      keywordTest = true ;\n      break ;break\n\n    default:\n        keywordTest = false ;\n  }\n\n  if( false == keywordTest )\n  {\n    return false ;\n  }\n\n  string subMessage ;\n\n  for( unsigned int i = 0 ; i < message.size() ; ++i )\n  {\n    if( message[ i ] == ':' )\n    {\n      inputIndex = i;\n      subMessage += message[ i ] ;\n      break ;\n    }\n    else\n    {\n      subMessage += message[ i ] ;\n      continue ;\n    }\n  }\n\n  if( subMessage == \"a:\" ||\n      subMessage == \"mv:\" ||\n      subMessage == \"find:\" ||\n      subMessage == \"loc:\" ||\n      subMessage == \"eq:\" ||\n      subMessage == \"you:\" ||\n      subMessage == \"t:\" ||\n      subMessage == \"help:\" )\n  {\n    commandTest = true ;\n  }\n  else\n  {\n    return false;\n  }\n\n  if( subMessage == \"mv:\" )\n  {\n    //Checks if a direction was entered by the player,\n    // accomplishes this by seeing if the mv: command\n    // is followed by at most a single character representing\n    // the directions 'n' or 'e' or 'w' or 's'\n    if( inputIndex + 1 == message.size() )\n    {\n      moveCommandTest = false;\n    }\n\n    while( inputIndex < message.size() )\n    {\n      if( false == moveCommandTest )\n      {\n        break ;\n      }\n\n      if(message[ inputIndex ] == ' ')\n      {\n        moveCommandTest = false;\n        break ;\n      }\n\n      ++inputIndex ;\n    }inputIndex\n  }\n\n  if( true == commandTest && true == keywordTest && true == moveCommandTest )\n  {\n    return true ;\n  }\n  else\n  {\n    return false ;\n  }\n}\n\nstring Filter::chat( string message )\n{\n  return message.substr( 2, message.length() ) ;\n} \n```\nThe dispatch class is the last class we need for thesingle player version of the game. Being the dispatchits sole purpose is to separate the value and command fromthe filtered user input and “dispatch\" it to the database.Now lets open up “test.h\" and add the line below. \n```c\nvoid test_dispatch_class(void);\n```\nNext we’ll write out the test for the dispatch class within \"test.cpp\", so go open that file and insert the code below.\n```c\nvoid Test::test_dispatch_class()\n{\n  // Dispatch extractCommand test\n  //a Attack  //m Move\n  //f Find\n  //l Location\n  //e Equip\n  //y You\n  //t Talk\n  //h Help Menu\n  Dispatch dispatch;\n\n  assert('a' == dispatch.extractCommand(\"a:\"));\n  assert('m' == dispatch.extractCommand(\"mv:\"));\n  assert('f' == dispatch.extractCommand(\"find:\"));\n  assert('l' == dispatch.extractCommand(\"loc:\"));\n  assert('e' == dispatch.extractCommand(\"eq:\"));\n  assert('y' == dispatch.extractCommand(\"you:\"));\n  assert('t' == dispatch.extractCommand(\"t:\"));\n  assert('h' == dispatch.extractCommand(\"help:\"));\n\n  // Dispatch extractValue test\n  /*\n     The only commands that take values.\n\n     attack  move  equip\n     talk  */\n  assert(\"goblin\" == dispatch.extractValue(\"a:goblin\"));\n  assert(\"north\" == dispatch.extractValue(\"mv:north\"));\n  assert(\"armor\" == dispatch.extractValue(\"eq:armor\"));\n  assert(\"hello world\" == dispatch.extractValue(\"t:hello world\"));\n  assert(\"  s p a c  e  s  \" == dispatch.extractValue(\n        \"t:  s p a c  e  s  \"));\n} \n```\nNow we can add the methods for the dispatch class to our “database.cpp\"file. Open up the file “database.cpp\" and add the lines below.\n```c\nchar Dispatch::extractCommand(std::string fromFilter)\n{\n  //a Attack  //m Move\n  //f Find\n  //l Location\n  //e Equip\n  //y You\n  //t Talk\n  //h Help Menu\n\n  return fromFilter[ 0 ] ;\n}\n\nstring Dispatch::extractValue(std::string fromFilter)\n{\n  /*\n     The value of the string from the filter is all of the text\n     that follows the command.\n\n     -Example-\na:goblin\n\nThe command is a:\nThe value is goblin\n   */\n\n  // For single character commands such as t:\n  if( fromFilter[ 1 ] == ':' )\n  {\n    return fromFilter.substr( 2, fromFilter.length() ) ;\n  }\n\n  return fromFilter.substr( 3, fromFilter.length() ) ;\n} \n```\nThe last thing we have to do before we can call our single player version of the game complete is to make sure all the test pass with flying colors. Beingthat we only implemented unit test, you will be notified when a test failsby the console giving you a “assertion failed at line:XYZ\" where XYZ is the line number. So open up “main.cpp\" and make sure it looks like the code below. \n```c\n//Filename main.cpp\n#include \"Database.h\"\n#include\"Test.h\"\n\nusing namespace MUD ;\n\nvoid run_test(void)\n{\n  cout << \"Ignore the combat printouts from the\\n\";\n  cout << \"test_dungeon_class() method\\n\" << endl;\n\n  Test::get_instance()->test_item_class();\n  Test::get_instance()->test_monster_class();\n  Test::get_instance()->test_room_class();\n  Test::get_instance()->test_player_class();\n  Test::get_instance()->test_dungeon_class();\n  Test::get_instance()->test_filter_class();\n  Test::get_instance()->test_dispatch_class();\n}\n\nvoid run_sample_game(void);\n\nint main(void)\n{\n  run_test();\n  //run_sample_game();\n  return 0;\n}\n\nvoid run_sample_game(void)\n{\n  //Construct Dungeon\n  Dungeon caves( 2, 21 ) ;\n\n  //Items power vitality health\n  Item* herb_a = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_b = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_c = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_d = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_e = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_f = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_g = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n\n  Item* woodsword = new Item( \"woodsword\", Item::WEAPON, 10, 0, 0 ) ;\n  Item* steelblade = new Item( \"steelblade\", Item::WEAPON, 20, 0, 0 ) ;\n  Item* crystalsword = new Item( \"crystalsword\", Item::WEAPON, 35, 0, 0 ) ;\n  Item* genjiblade = new Item( \"genjiblade\", Item::WEAPON, 60, 0, 0 ) ;\n  Item* angelicsword = new Item( \"angelicsword\", Item::WEAPON, 80, 0, 0 ) ;\n  Item* finalweapon = new Item( \"dragonslayer\", Item::WEAPON, 2000, 0, 0 ) ;\n\n  Item* woodarmor = new Item( \"woodarmor\", Item::ARMOR, 0, 5, 15 ) ;\n  Item* steelarmor = new Item( \"steelarmor\", Item::ARMOR, 0, 7, 20 ) ;\n  Item* diamondarmor = new Item( \"diamondarmor\", Item::ARMOR, 0, 12, 30 ) ;\n  Item* crystalarmor = new Item( \"crystalarmor\", Item::ARMOR, 0, 15, 35 ) ;\n  Item* dragonarmor = new Item( \"dragonarmor\", Item::ARMOR, 0, 20, 100 ) ;\n  Item* ultimatearmor = new Item( \"ultimatearmor\", Item::ARMOR, 0, 1000, 1000 ) ;\n\n  //Monsters hp str def\n  Monster* bear = new Monster( \"bear\", 15, 2, 3 ) ;\n  Monster* goblin = new Monster( \"goblin\", 5, 3, 1 ) ;\n  Monster* imp = new Monster( \"imp\", 5, 5, 2 ) ;\n  Monster* redgoblin = new Monster( \"redgoblin\", 5, 5, 5 ) ;\n  Monster* demon = new Monster( \"demon\", 6, 3, 7 ) ;\n  Monster* zergling = new Monster( \"zergling\", 10, 10, 9 ) ;\n  Monster* bats = new Monster( \"bats\", 20, 15, 3 ) ;\n  Monster* morebats = new Monster( \"morebats\", 25, 20, 15 ) ;\n  Monster* golem = new Monster( \"golem\", 50, 21, 9 ) ;\n  Monster* goatdemon = new Monster( \"goatdemon\", 100, 10, 10 ) ;\n  Monster* cyclops = new Monster( \"cyclops\", 150, 90, 0 ) ;\n  Monster* behemoth = new Monster( \"behemoth\", 250, 30, 40 ) ;\n  Monster* alien = new Monster( \"alien\", 50, 21, 4 ) ;\n  Monster* giantrat = new Monster( \"giantrat\", 55, 40, 1 ) ;\n  Monster* fallenangel = new Monster( \"fallenangel\", 300, 100, 100 ) ;\n  Monster* greatdragon = new Monster( \"greatdragon\", 500, 300, 1 ) ;\n  Monster* invincibledragon = new Monster( \"invincibledragon\", 999, 999, 999 ) ;\n\n  //Rooms name description item\n  Room* mainHall = new Room( \"The main cavern\", \"A murkey swamp cavern\", woodsword ) ;\n  Room* river = new Room( \"The black river\", \"A river with dark water\", woodarmor ) ;\n  Room* greencave = new Room( \"The greencave\", \"A moss covered cave\", herb_a ) ;\n  Room* bluecave = new Room( \"The bluecave\", \"A frosty cave\", steelblade ) ;\n  Room* darkpit = new Room( \"The darkpit\", \"An endless hole lies before you\", steelarmor ) ;\n  Room* morbidfield = new Room( \"The morbidfield\", \"Pitch black grass surrounds you\", herb_b ) ;\n  Room* graveyard = new Room( \"The graveyard\", \"Tombstones abound\", diamondarmor ) ;\n  Room* crypt = new Room( \"The crypt\", \"A nasty rotten crypt\", crystalsword ) ;\n  Room* evilpassage = new Room( \"The evil passage\", \"An evil pasage\", crystalarmor ) ;\n  Room* darklair = new Room( \"The dark lair\", \"A dark lair\", herb_c ) ;\n  Room* firepit = new Room( \"The firey pits\", \"Fire is every where\", herb_d ) ;\n  Room* greenpasture = new Room( \"The greenpastures\", \"A meadow is before you\", genjiblade ) ;\n  Room* icecave = new Room( \"The icy caves\", \"Ice everywhere you look\", herb_e ) ;\n  Room* livingroom = new Room( \"The living room\", \"The room is alive\", dragonarmor ) ;\n  Room* cellar = new Room( \"The cellar\", \"A dirty cellar filled with rats\", angelicsword ) ;\n  Room* lifespring = new Room( \"The lifespring\", \"A beautiful fountain stands\", herb_f ) ;\n  Room* waterfall = new Room( \"The waterfall\", \"Clear blue water falls\", herb_g ) ;\n  Room* hellsgate = new Room( \"The gates of hell\", \"Large rusty doors lead to hell\", ultimatearmor ) ;\n  Room* dragoncave = new Room( \"The dragon's cave\", \"An ancient cave...\" ) ;\n  Room* dragonsden = new Room( \"The dragon's den\", \"A powerful monster awaits\" ) ;\n  Room* lostforest = new Room( \"The secret forest\", \"The strongest sword lies hidden here\", finalweapon ) ;\n\n  //Link Rooms\n  mainHall->link( 'e', *river ) ;\n  river->link( 's', *greencave ) ;\n  river->link( 'e', *bluecave ) ;\n  river->link( 'w', *mainHall ) ;\n  greencave->link( 'n', *river ) ;\n  bluecave->link( 'w', *river ) ;\n  bluecave->link( 'n', *darkpit ) ;\n  darkpit->link( 's', *bluecave ) ;\n  darkpit->link( 'n', *morbidfield ) ;\n  morbidfield->link( 's', *darkpit ) ;\n  morbidfield->link( 'e', *graveyard ) ;\n  graveyard->link( 'w', *morbidfield ) ;\n  graveyard->link( 'n', *crypt ) ;\n  graveyard->link( 'e', *evilpassage ) ;\n  crypt->link( 's', *graveyard ) ;\n  evilpassage->link( 'w', *graveyard ) ;\n  evilpassage->link( 's', *darklair ) ;\n  darklair->link( 'n', *evilpassage ) ;\n  darklair->link( 's', *firepit ) ;\n  firepit->link( 'n', *darklair ) ;\n  firepit->link( 'e', *greenpasture ) ;\n  greenpasture->link( 'w', *firepit ) ;\n  greenpasture->link( 's', *icecave ) ;\n  greenpasture->link( 'e', *livingroom ) ;\n  icecave->link( 'n', *greenpasture ) ;\n  livingroom->link( 'w', *greenpasture ) ;\n  livingroom->link( 'e', *cellar ) ;\n  cellar->link( 'w', *livingroom ) ;\n  cellar->link( 'n', *lifespring ) ;\n  cellar->link( 'e', *hellsgate ) ;\n  lifespring->link( 's', *cellar ) ;\n  lifespring->link( 'n', *waterfall ) ;\n  waterfall->link( 's', *lifespring ) ;\n  hellsgate->link( 'w', *cellar ) ;\n  hellsgate->link( 'e', *dragoncave ) ;\n  dragoncave->link( 'w', *hellsgate ) ;\n  dragoncave->link( 'e', *dragonsden ) ;\n  dragonsden->link( 'w', *dragoncave ) ;\n  dragonsden->link( 'e', *lostforest ) ;\n  lostforest->link( 'w', *dragonsden ) ;\n\n  //Add monsters to rooms\n  mainHall->addMonster( goblin ) ;\n  mainHall->addMonster( imp ) ;\n  river->addMonster( bear ) ;\n  river->addMonster( redgoblin ) ;\n  bluecave->addMonster( demon ) ;\n  bluecave->addMonster( zergling ) ;\n  morbidfield->addMonster( bats ) ;\n  morbidfield->addMonster( morebats ) ;\n  graveyard->addMonster( golem ) ;\n  evilpassage->addMonster( goatdemon ) ;\n  firepit->addMonster( cyclops ) ;\n  greenpasture->addMonster( behemoth ) ;\n  livingroom->addMonster( alien ) ;\n  cellar->addMonster( giantrat ) ;\n  hellsgate->addMonster( fallenangel ) ;\n  dragoncave->addMonster( greatdragon ) ;\n  dragonsden->addMonster( invincibledragon ) ;\n\n  //Add the rooms to the dungeon\n  caves.addRoom( mainHall ) ;\n  caves.addRoom( river ) ;\n  caves.addRoom( greencave ) ;\n  caves.addRoom( bluecave ) ;\n  caves.addRoom( darkpit ) ;\n  caves.addRoom( morbidfield ) ;\n  caves.addRoom( graveyard ) ;\n  caves.addRoom( crypt ) ;\n  caves.addRoom( evilpassage ) ;\n  caves.addRoom( darklair ) ;\n  caves.addRoom( firepit ) ;\n  caves.addRoom( greenpasture ) ;\n  caves.addRoom( icecave ) ;\n  caves.addRoom( livingroom ) ;\n  caves.addRoom( cellar ) ;\n  caves.addRoom( lifespring ) ;\n  caves.addRoom( waterfall ) ;\n  caves.addRoom( hellsgate ) ;\n  caves.addRoom( dragoncave ) ;\n  caves.addRoom( dragonsden ) ;\n  caves.addRoom( lostforest ) ;\n\n  //Create a filter  Filter filter ;\n\n  //Create a dispatch object with a command char and a value string\n  Dispatch dispatch ;\n  char command ;\n  string value ;\n\n  //Simulate a new game\n  //Create a new player and add to the dungeon\n  string input ;\n  cout << \"Welcome to the game\\nEnter in a new name: \" ;\n  getline(cin, input, '\\n');\n\n  Player* one = new Player( input, mainHall ) ;\n  cout << caves.addPlayer( one ) << endl ;\n\n  //Display needed info for the players\n  cout << \"The objective is to clear the dungeon of all monsters. Good Luck\" << endl ;\n  cout << \"Enter in a new command to start, to display help type the following command\" << endl ;\n  cout << \"help:\" << endl ;\n  cout << \"To quit simply enter \\\"quit\\\" without the quotes as a new command\" << endl ;\n  cout << \"New Command\" << endl ;\n  getline(cin, input, '\\n');\n\n  //Start the game loop\n  while( input != \"quit\" )\n  {\n    //Pass the users message through the filter\n    if( filter.validateMessage( input ) )\n    {\n      //Split the users message into a command and value pair\n      command = dispatch.extractCommand( input ) ;\n      value = dispatch.extractValue( input ) ;\n\n      //Match the command and forward the value\n      switch( command )\n      {\n\n        case 'a': //Attack\n          //If the monster does not exist or the name was mispelled\n          if( &(one->mLocation->getMonsterRef( value )) == NULL )\n          {\n            cout << \"There is no \" + value + \" at this location\" << endl ;\n            break ;\n          }\n          //If the monster is there but in combat the player cannot fight it\n          if( one->mLocation->getMonsterRef( value ).inCombat == true )\n          {\n            cout << \"The \" + value + \" is currently fighting\" << endl ;\n            break ;\n          }\n\n          caves.combatLoop( *one, one->mLocation->getMonsterRef( value ) ) ;\n          break ;\n\n        case 'm': //Move\n          cout << one->move( value[ 0 ] ) ;\n          break ;\n\n        case 'f': //Find\n          cout << one->search() ;\n          break ;\n\n        case 'l': //Location\n          cout << one->getLocation() ;\n          break ;\n\n        case 'e': //Equip\n          cout << one->equip( value ) ;\n          break ;\n\n        case 'y': //You\n          {\n            string* playerStats = new string ;\n            playerStats = caves.playerStatus( *one ) ;\n\n            for( int i = 0 ; i < 7 ; ++i )\n            {\n              cout << playerStats[i] << endl ;\n            }endl\n          }\n          break ;\n\n          //case 't': //Talk\n\n        case 'h': //Help Menu\n          caves.displayHelp();\n          break ;\n      }\n    }\n    else\n    {\n      cout << \"Invalid command please refer to the help menu.\\nhelp:\" << endl ;\n      cout << \"Or type \\\"quit\\\" to quit the game\" << endl ;\n    }\n\n    if( caves.isComplete() )\n    {\n      cout << \"Dungeon Cleared, YOU WIN!\" << endl ;\n      break ;\n    }\n\n    if( one->death() )\n    {\n      cout << one->getName() + \" was slain by the \" + one->mLocation->getMonsterRef( value ).getName() << endl ;\n      one->mLocation->getMonsterRef( value ).inCombat = false ;\n      cout << \"*Hint* Secret rooms hidden abound; find them and victory shall be yours\" << endl ;\n      input = \"quit\" ;\n    }\n    else\n    {\n      //Get the next command\n      cout << \"\\n\\nNew Command\" << endl ;\n      getline(cin, input, '\\n');\n    }\n  }\n\n  caves.removePlayer( one->getName() ) ;\n}\n```\nFor reference here are all the files for the project below.If none of the dropbox links are working then mention it in the comments section and I’ll re-upload the files. \n<p>\n<a  href=\"http://dl.dropbox.com/u/22280460/database.cpp\">http://dl.dropbox.com/u/22280460/database.cpp</a>\n<br />\n<a href=\"http://dl.dropbox.com/u/22280460/database.h\">http://dl.dropbox.com/u/22280460/database.h</a>\n<br />\n<a href=\"http://dl.dropbox.com/u/22280460/main.cpp\">http://dl.dropbox.com/u/22280460/main.cpp</a>\n<br />\n<a href=\"http://dl.dropbox.com/u/22280460/Test.cpp\">http://dl.dropbox.com/u/22280460/Test.cpp</a>\n<br />\n<a href=\"http://dl.dropbox.com/u/22280460/Test.h\">http://dl.dropbox.com/u/22280460/Test.h</a>\n</p>\n\n<a href=\"/2011/06/16/textbasedrpgpart6.html\">Click here for part 6</a>\n[Click here for part VI][link_part_6]\n\n[link_part_4]: /2011/06/11/textbasedrpgpart4\n[link_part_6]: /2011/06/16/textbasedrpgpart6\n","source":"_posts/textbasedrpgpart5.md","raw":"---\ntitle: Build A Text Based Multiplayer RPG Part V\ndate: 2011-06-15\ncategories: [tutorial]\ntags: [cpp]\n---\n- [Click here for part IV][link_part_4]\n- [Click here for part VI][link_part_6]\n\n# Intro\nThe fifth part of the tutorial on creating a text based multiplayer RPG game will see us creating the last part of the testing and game mechanics before the next section where we'll launch the client and server code to actually test our game in action.\n\nIn this part of the tutorial we will complete the test and methods necessary to get the full functionality for the stand alone single player version. In the next part of the tutorial part 6, we will begin to develop both the client and server code that allows other users to connect and play our game over a local area network. So lets continue with the testing and move onto the player class. Go ahead and open up the “test.h\" file and add line below.\n\n```c\nvoid test_player_class();\n```\n\nThen open up the file “test.cpp\" and add the methods for the player test class beginning at the line indicated.\n\n```c\nvoid Test::test_player_class(void)\n{\n  // Player constructor w/o initial room\n  Player no_room_player(\"hero\");\n\n  assert(10 == no_room_player.mMaxHp);\n  assert(10 == no_room_player.mHp);\n  assert(1 == no_room_player.mStrength);\n  assert(0 == no_room_player.mDefence);\n  assert(NULL == no_room_player.mLocation);\n  assert(\"hero\" == no_room_player.mName);\n  assert(NULL == no_room_player.mWeapon);\n  assert(NULL == no_room_player.mArmor);\n\n  // Player constructor w/room\n  Player room_player(\"dude\", new Room(\"Home\", \"A big house\"));\n\n  assert(NULL != room_player.mLocation);\n\n  // Player getters/setters\n  Player get_set(\"setter\", new Room(\"Lake\", \"A clean lake\"));\n\n  get_set.setDefence(1);\n  get_set.setHp(10);\n  get_set.setName(\"getter\");\n  get_set.setStrength(2);\n\n  assert(1 == get_set.getDefence());\n  assert(10 == get_set.getHp());\n  assert(\"getter\" == get_set.getName());\n  assert(2 == get_set.getStrength());\n  assert(\"Lake\" == get_set.getLocation());\n\n  // Player equip test\n  // The Item is not found\n  // - There is no item within the room \"There is no item to equip in this rooom\"\n  // - The player misspelled the item name \"To equip an item you must type its full name correctly\"\n  Room no_item_room(\"Itemless\", \"There is no item here\");\n  Player no_item_player(\"Hi\");\n  no_item_player.mLocation = &no_item_room;\n  string response(\"There is no item to equip in this room\");\n\n  assert(response == no_item_player.equip(\"Bad Item name\"));\n\n  Room with_item(\"Item room\", \"Item filled room\", new Item(\"dagger\", Item::WEAPON, 10, 0, 0));\n  no_item_player.mLocation = &with_item;\n  response = \"To equip an item you must type its full name correctly\";\n\n  assert(response == no_item_player.equip(\"daggers\"));\n\n  // Weapon is found\n  // - The weapon becomes unavailable\n  // - The players strength is set equal to the weapons power value\n  // - The response returned is \"You equipped the Item.mName\"      Player item_player(\"Bye\", &with_item);\n  response = \"You equipped the dagger\";\n\n  assert(response == item_player.equip(\"dagger\"));\n  assert(false == with_item.mItem->mAvailiable);\n  assert(with_item.mItem->getPower() == item_player.getStrength());\n\n  // Armor is found\n  // - The armor becomes unavailable\n  // - The players vitality is set equal to the armor's defence  // - The response returned is \"You equipped the Item.mName\"\n  // - The armor's health value is added to the players max hp\n  Item* steel_plate = new Item(\"steelplate\", Item::ARMOR, 0, 10, 20);\n  with_item.setItem(steel_plate);\n  response = \"You equipped the steelplate\";\n\n  assert(response == item_player.equip(\"steelplate\"));\n  assert(with_item.mItem->mAvailiable == false);\n  assert(steel_plate->getHealth() + item_player.getHp()\n      == item_player.mMaxHp);\n  assert(with_item.mItem->getVitality() == item_player.getDefence());\n\n  // Health is found\n  // - The health item becomes unavailable\n  // - The player's hp is fully restored\n  // - The response is \"You were healed\"\n  Item* herb = new Item(\"herbs\", Item::HEALTH, 0, 0, 0);\n  with_item.setItem(herb);\n  response = \"You were healed\";\n\n  assert(response == item_player.equip(\"herbs\"));\n  assert(with_item.mItem->mAvailiable == false);\n  assert(item_player.getHp() == item_player.mMaxHp);\n\n  // Player attack test\n  // a- There are no monsters within the Room then the method should  //methodreturn \"There are no monsters in this room to fight\"\n  // b- The player mis-typed the monster name then\n  //name\"The Monster.mName is not here\"\n  // c- If damage was dealt to the monster then the message should say\n  //should\"Monster.mName was dealt X damage\"  // d- If no damage was dealt to the monster then the message should say\n  //should\"Monster.mName dodged the attack\"\n  string response_a(\"There are no monsters in this room to fight\");\n  string response_b(\"The roll is not here\");\n  string response_c(\"troll was dealt 30 damage\");\n  string response_d(\"supertroll dodged the attack\");\n\n  Item* great_sword = new Item(\"greatsword\", Item::WEAPON, 30, 0, 0);\n  Room* arena = new Room(\"arena\", \"A large crowd gathers\", great_sword);\n  Monster* troll = new Monster(\"troll\", 50, 0, 0);\n\n  arena->setItem(great_sword);\n  Player* attacker = new Player(\"Fighter\", arena);\n  attacker->equip(\"greatsword\");\n\n  assert(response_a == attacker->attack(\"troll\"));\n\n  arena->addMonster(troll);\n\n  assert(response_b == attacker->attack(\"roll\"));\n  assert(response_c == attacker->attack(\"troll\"));\n\n  Monster* super_troll = new Monster(\"supertroll\", 8, 0, 999);\n  arena->addMonster(super_troll);\n  assert(response_d == attacker->attack(\"supertroll\"));\n\n  // Player move test\n  // - If the player moves in an invalid direction then  //direction\"You traveled nowhere\" should be returned\n  // - If the direction is valid but no room is connected\n  //is\"There is nothing in that direction\"\n  // - If the direction is valid and a room exist\n  //room\"You traveled directionname\\nmLocation->getDescription()\"\n  Room* moving_room = new Room(\"Moving room\", \"You can move from here\");\n  Room* moving_north = new Room(\"Moving north\",  \"North of the moving room\");\n  Room* moving_south = new Room(\"Moving south\",  \"South of the moving room\");\n  Room* moving_west = new Room(\"Moving west\",\n      \"West of the moving room\");\n  Room* moving_east = new Room(\"Moving east\",\n      \"East of the moving room\");\n\n  Player* moving_player = new Player(\"Jill\", moving_room);\n  response = \"You traveled nowhere\";\n\n  assert(response == moving_player->move('p'));\n\n  response = \"There is nothing in that direction\";\n\n  assert(response == moving_player->move('n'));\n  assert(response == moving_player->move('e'));\n  assert(response == moving_player->move('w'));\n  assert(response == moving_player->move('s'));\n\n  moving_player->mLocation = moving_room;\n  response = \"You traveled North\\n\" + moving_north->getDescription();\n  moving_room->link('n', *moving_north);\n  assert(response == moving_player->move('n'));\n\n  moving_player->mLocation = moving_room;\n  response = \"You traveled South\\n\" + moving_south->getDescription();\n  moving_room->link('s', *moving_south);\n  assert(response == moving_player->move('s'));\n\n  moving_player->mLocation = moving_room;\n  response = \"You traveled West\\n\" + moving_west->getDescription();\n  moving_room->link('w', *moving_west);\n  assert(response == moving_player->move('w'));\n\n  moving_player->mLocation = moving_room;\n  response = \"You traveled East\\n\" + moving_east->getDescription();\n  moving_room->link('e', *moving_east);\n  assert(response == moving_player->move('e'));\n\n  // Player search test\n  // Exact same as the string Room::searchResponse( void )  // method so it has already been tested\n\n  // Player death test\n  // -Returns true when the player's hp is less than zero\n  // -Returns false when the player's hp is greater than zero\n  Player* death_test = new Player(\"Dead guy\");\n\n  assert(false == death_test->death());\n\n  death_test->setHp(-1);\n  assert(true == death_test->death());\n}\n```\n\nNow that we have the methods for the player class all set the next thing we have to do is to write out the methods for the player class. To do so open up the file “database.cpp\" and add the methods for the player class below.\n\n```c\nPlayer::Player( string name, Room* start )  : mName(name), mLocation(start), mWeapon(NULL), mArmor(NULL),\n  mHp(10), mMaxHp(10), mStrength(1), mDefence(0)\n{\n}\n\nvoid Player::setHp( int newHp )\n{\n  mHp = newHp ;\n}\n\nint Player::getHp( void ) const\n{\n  return mHp ;\n}\n\nvoid Player::setStrength( int newStrength )\n{\n  mStrength = newStrength ;\n}\n\nint Player::getStrength( void ) const\n{\n  return mStrength ;\n}\n\nvoid Player::setDefence( int newDefence )\n{\n  mDefence = newDefence ;\n}\n\nint Player::getDefence( void ) const\n{\n  return mDefence ;\n}\n\nstring Player::getLocation( void )\n{\n  return mLocation->mName ;\n}\n\nvoid Player::setName( string newName )\n{\n  mName = newName ;\n}\n\nstring Player::getName( void ) const  {\n  return mName ;\n}\n\nstring Player::attack( string monsterName )\n{\n  list< Monster* >::iterator iter ;\n  int damage = 0 ;\n  string response( \"The \" + monsterName + \" is not here\" ) ;  stringstream ss ;\n  string strDamage ;\n\n  if( mLocation->mMonsters.empty() )\n  {\n    return \"There are no monsters in this room to fight\" ;\n  }\n\n  for( iter = mLocation->mMonsters.begin() ; iter != mLocation->mMonsters.end() ; ++iter )\n  {\n    if( (*iter)->getName() == monsterName )\n    {\n      damage = getStrength() - (*iter)->getDefence() ;\n      ss << damage ;\n      ss >> strDamage ;\n      ss.clear() ;\n\n      if( damage > 0 )\n      {\n        (*iter)->setHp( (*iter)->getHp() - damage ) ;\n        response = (*iter)->getName() + \" was dealt \" + strDamage + \" damage\" ;\n      }\n      else\n      {\n        response = (*iter)->getName() + \" dodged the attack\" ;\n      }\n\n      break ;\n    }\n  }\n\n  return response ;\n}\n\nstring Player::equip( string itemName )\n{\n  string response ;\n\n  if( mLocation->mItem != NULL && mLocation->mItem->getName() == itemName )\n  {\n    if( Item::WEAPON == mLocation->mItem->getType() && true == mLocation->mItem->mAvailiable )\n    {\n      mWeapon = mLocation->mItem ;\n      mLocation->itemTaken() ;\n      setStrength( mWeapon->getPower() ) ;\n      response = \"You equipped the \" + mWeapon->getName() ;\n      return response ;\n    }\n    else if( Item::ARMOR == mLocation->mItem->getType() && true == mLocation->mItem->mAvailiable )\n    {\n      mArmor = mLocation->mItem ;\n      mLocation->itemTaken() ;\n      setDefence( mArmor->getVitality() ) ;\n      mMaxHp += mArmor->getHealth() ;\n      response = \"You equipped the \" + mArmor->getName() ;\n      return response ;\n    }\n    else\n    {\n      setHp( mMaxHp ) ;\n      mLocation->itemTaken() ;\n      response = \"You were healed\" ;\n      return response ;\n    }\n  }\n  else\n  {\n    if( mLocation->mItem == NULL )\n    {\n      return \"There is no item to equip in this room\" ;\n    }\n    response = \"To equip an item you must type its full name correctly\" ;\n\n    return response ;\n  }\n}\n\nstring Player::move( char direction )\n{\n  string response = \"You traveled \" ;\n  switch( direction )\n  {\n    case 'n':\n    case 'N':\n      if( NULL == mLocation->mNorth )\n      {\n        response = \"There is nothing in that direction\" ;\n        break ;\n      }\n      mLocation = &(mLocation->north()) ;\n      response = response + \"North\\n\" + mLocation->getDescription() ;\n      break ;\n\n    case 's':\n    case 'S':\n      if( NULL == mLocation->mSouth )\n      {\n        response = \"There is nothing in that direction\" ;\n        break ;\n      }\n      mLocation = &(mLocation->south()) ;\n      response = response + \"South\\n\" + mLocation->getDescription() ;\n      break ;\n\n    case 'e':\n    case 'E':\n      if( NULL == mLocation->mEast )\n      {\n        response = \"There is nothing in that direction\" ;\n        break ;\n      }\n      mLocation = &(mLocation->east()) ;\n      response = response + \"East\\n\" + mLocation->getDescription() ;\n      break ;\n\n    case 'w':\n    case 'W':\n      if( NULL == mLocation->mWest )\n      {\n        response = \"There is nothing in that direction\" ;\n        break ;\n      }\n      mLocation = &(mLocation->west()) ;\n      response = response + \"West\\n\" + mLocation->getDescription() ;\n      break ;\n\n    default:\n      response = response + \"nowhere\" ;\n  }\n\n  return response ;\n}\n\nstring Player::search( void )\n{\n  return mLocation->searchResponse() ;\n}\n\nPlayer::dead Player::death( void )\n{\n  if( getHp() <= 0 )\n  {\n    return true ;\n  }\n\n  return false ;\n}\n```\nAfterwards you can begin to test the Dungeon class, so open up the file “test.h\" file and add the following line.\n\n```c\nvoid test_dungeon_class(void);\n```\n\nHere are the methods for the dungeon test, it is quite long so you can copy it if you want to but I suggest typing it out and reading through the comments in order to better understand the codebase; the file for the code below is “test.cpp\"\n\n```c\nvoid Test::test_dungeon_class(void)\n{\n  // Dungeon constructor test\n  Dungeon* test_dungeon = new Dungeon(1, 1);\n\n  assert(1 == test_dungeon->mMaxPlayers);\n  assert(1 == test_dungeon->mMaxRooms);\n  assert(true == test_dungeon->mPlayers.empty());\n  assert(true == test_dungeon->mRooms.empty());\n  // - A dungeon without monsters is considered complete\n  assert(true == test_dungeon->isComplete());\n\n  // Dungeon addPlayer test\n  // - Successful addition of a new player should display the following\n  //the\"The player named newPlayer->getName() entered the Dungeon\"\n  Player* newbie = new Player(\"Noob\");\n  string response(\"The player named Noob entered the Dungeon\");\n\n  assert(response == test_dungeon->addPlayer(newbie));\n  assert(false == test_dungeon->mPlayers.empty());\n\n  // Dungeon addRoom test\n  // - \"The room: newRoom->mName was added\" will be displayed\n  //beif the addition was successful\n  Room* main_room = new Room(\"Main hall\", \"The main hall\");\n  response = \"The room: Main hall was added\";\n\n  assert(response == test_dungeon->addRoom(main_room));\n  assert(false == test_dungeon->mRooms.empty());\n\n  // Dungeon removePlayer test\n  response = \"Noob has left the dungeon\";\n  assert(response == test_dungeon->removePlayer(newbie->getName()));\n\n  // Dungeon generatePlayerStats test\n  // -Sets the players max hp to 10, strength and defence to 2\n  test_dungeon->generatePlayerStats(newbie);\n\n  assert(10 == newbie->getHp());\n  assert(2 == newbie->getStrength());\n  assert(2 == newbie->getDefence());\n\n  // Dungeon combatLoop test\n  // - If the hero is stronger than the monster then the monster  //theshould die else the hero should die\n  Dungeon* combat_test = new Dungeon(1, 1);\n  Room* combat_room = new Room(\"Battle\", \"Fight here\");\n  Item* longsword = new Item(\"longsword\", Item::WEAPON, 100, 0, 0);\n  Player* brawler = new Player(\"brawler\", combat_room);\n  Monster* ogre = new Monster(\"ogre\", 10, 0, 0);  Monster* superogre = new Monster(\"superogre\", 100, 100, 100);  combat_room->setItem(longsword);\n  combat_room->addMonster(ogre);\n  combat_room->addMonster(superogre);\n  combat_test->addRoom(combat_room);\n  combat_test->addPlayer(brawler);\n  combat_test->generatePlayerStats(brawler);\n  brawler->mLocation = combat_room;\n  brawler->equip(\"longsword\");\n\n  combat_test->combatLoop(*brawler, *ogre);\n  assert(combat_room->mMonsters.empty() == false);\n  assert(combat_test->isComplete() == false);\n\n  Item* badsword = new Item(\"badsword\", Item::WEAPON, 0, 0, 0);\n  combat_room->setItem(badsword);\n  brawler->equip(\"badsword\");\n\n  combat_test->combatLoop(*brawler, *superogre);\n  assert(true == brawler->death());\n\n  // Dungeon playerStatus test\n  Dungeon* status_test = new Dungeon(1, 2);\n  Room* start_room = new Room(\"Starting room\", \"Start here\");\n  Room* end_room = new Room(\"Ending room\", \"End here\");\n  Player* stats_hero = new Player(\"Mike\", start_room);\n  Item* weapon_x = new Item(\"weaponx\", Item::WEAPON, 20, 0, 0);\n  Item* armor_x = new Item(\"armorx\", Item::ARMOR, 0, 20, 10);\n\n  start_room->link('e', *end_room);\n  end_room->link('w', *start_room);\n  start_room->setItem(weapon_x);\n  end_room->setItem(armor_x);\n  status_test->addRoom(start_room);\n  status_test->addRoom(end_room);\n  status_test->addPlayer(stats_hero);\n\n  // The stats reported are the following\n  /*\n     1. Hp\n     2. Strength\n     3. Defence\n     4. Location\n     5. Name\n     6. Weapon\n     7. Armor\n   */\n  const int stat_total = 7;\n  string* status_before_weapon = new string[stat_total];\n  string* status_with_weapon = new string[stat_total];\n  string* status_with_armor = new string[stat_total];\n\n  status_before_weapon[0] = \"Current HP: 10 out of 10\";\n  status_before_weapon[1] = \"Current Strength: 2\";\n  status_before_weapon[2] = \"Current Defence: 2\";\n  status_before_weapon[3] = \"Current Location: Starting room\";\n  status_before_weapon[4] = \"Current Name: Mike\";\n  status_before_weapon[5] = \"Current Weapon: none equipped\";\n  status_before_weapon[6] = \"Current Armor: none equipped\";\n\n  assert(status_before_weapon = status_test->playerStatus(*stats_hero));\n\n  stats_hero->equip(\"weaponx\");\n\n  status_with_weapon[0] = \"Current HP: 10 out of 10\";\n  status_with_weapon[1] = \"Current Strength: 20\";\n  status_with_weapon[2] = \"Current Defence: 2\";\n  status_with_weapon[3] = \"Current Location: Starting room\";\n  status_with_weapon[4] = \"Current Name: Mike\";\n  status_with_weapon[5] = \"Current Weapon: weaponx\";\n  status_with_weapon[6] = \"Current Armor: none equipped\";\n\n  assert(status_with_weapon = status_test->playerStatus(*stats_hero));\n\n  stats_hero->move('e');\n  stats_hero->equip(\"armorx\");\n\n  status_with_armor[0] = \"Current HP: 10 out of 20\";\n  status_with_armor[1] = \"Current Strength: 20\";\n  status_with_armor[2] = \"Current Defence: 20\";\n  status_with_armor[3] = \"Current Location: Ending room\";\n  status_with_armor[4] = \"Current Name: Mike\";\n  status_with_armor[5] = \"Current Weapon: weaponx\";\n  status_with_armor[6] = \"Current Armor: armorx\";\n\n  assert(status_with_armor = status_test->playerStatus(*stats_hero));\n}\n```\nNow we can write out the methods for the dungeon class itself. Go open up the file “database.cpp\" and add the lines below to the file, remember to start at the line of code indicated in the margins.\n\n```c\nDungeon::Dungeon( int maxPlayers, int maxRooms )  : mMaxPlayers(maxPlayers), mMaxRooms(maxRooms)\n{\n  mRooms.reserve( maxRooms ) ;\n  mPlayers.reserve( maxPlayers ) ;\n}\n\nbool Dungeon::isComplete( void )\n{\n  bool flag = true ;\n\n  for( unsigned int i = 0 ; i < mRooms.size() ; ++i )\n  {\n    if( mRooms[i]->mMonsters.empty() )\n    {\n      continue ;\n    }\n    else\n    {\n      flag = false ;\n      break ;\n    }\n  }\n\n  return flag ;\n}\n\nstring Dungeon::addPlayer( Player *newPlayer )\n{\n  mPlayers.push_back( newPlayer ) ;\n  string response = \"The player named \" + newPlayer->getName() + \" entered the Dungeon\" ;\n\n  generatePlayerStats( newPlayer ) ;\n\n  return response ;\n}\n\nvoid Dungeon::generatePlayerStats( Player* newPlayer )\n{\n  newPlayer->mMaxHp = 10 ;\n  newPlayer->setHp( newPlayer->mMaxHp ) ;\n  newPlayer->setStrength( 2 ) ;\n  newPlayer->setDefence( 2 ) ;\n}\n\nstring Dungeon::addRoom( Room *newRoom )\n{\n  mRooms.push_back( newRoom ) ;\n  string response = \"The room: \" + newRoom->mName + \" was added\" ;\n\n  return response ;\n}\n\nstring Dungeon::removePlayer( std::string playerName )\n{\n  string response = playerName + \" has left the dungeon\" ;\n\n  for( unsigned int i = 0 ; i < mPlayers.size() ; ++i )\n  {\n    if( playerName == mPlayers[i]->getName() )\n    {\n      mPlayers.erase( mPlayers.begin() + i ) ;\n      break ;\n    }\n  }\n\n  return response ;\n}\n\n//Should change this to have the monstersName as an argument\nvoid Dungeon::combatLoop( Player& hero, Monster& villain )\n{\n  villain.inCombat = true ;\n\n  while( true )\n  {\n    cout << hero.attack( villain.getName() ) << endl ;\n    if( villain.getHp() <= 0 )\n    {\n      cout << villain.getName() + \" was slain by the valiant \" << hero.getName() << endl;\n      hero.mLocation->killMonster( villain.getName() ) ;\n      return ;\n    }\n    else\n    {\n      int damage = 0 ;\n      damage = villain.getStrength() - hero.getDefence() ;\n\n      if( damage > 0 )\n      {\n        hero.setHp( hero.getHp() - damage ) ;\n        cout << hero.getName() + \" was dealt \" << damage << \" damage\" << endl ;\n      }\n      else\n      {\n        cout << hero.getName() + \" dodged the attack\" << endl ;\n      }\n\n      if( hero.death() )\n      {\n        cout << hero.getName() + \" was slain by the horrible \" + villain.getName() << endl;\n        return ;\n      }\n    }\n  }\n}\n\nstring* Dungeon::playerStatus( Player& player )\n{\n  stringstream ss ;\n  string temp ;\n  const int statusCount = 7 ;\n  string* response = new string[statusCount] ;\n\n  ss << player.getHp() ;\n  ss >> temp ;\n  response[0] = \"Current HP: \" + temp ;\n  ss.clear() ;\n  temp.clear() ;\n  ss << player.mMaxHp ;\n  ss >> temp ;\n  response[0] = response[0] + \" out of \" + temp ;\n  temp.clear() ;\n  ss.clear() ;\n\n  ss << player.getStrength() ;\n  ss >> temp ;\n  response[1] = \"Current Strength: \" + temp ;\n  ss.clear() ;\n  temp.clear() ;\n\n  ss << player.getDefence() ;\n  ss >> temp ;\n  response[2] = \"Current Defence: \" + temp ;\n  ss.clear() ;\n  temp.clear() ;\n\n  if( NULL == player.mLocation )\n  {\n    response[3] = \"Error: BAD LOCATION\" ;\n  }\n  else\n  {\n    response[3] = \"Current Location: \" + player.getLocation() ;\n  }\n\n  response[4] = \"Current Name: \" + player.getName() ;\n\n  if( NULL == player.mWeapon )\n  {\n    response[5] = \"Current Weapon: none equipped\" ;\n  }\n  else\n  {\n    response[5] = \"Current Weapon: \" + player.mWeapon->getName() ;\n  }\n\n  if( NULL == player.mArmor )\n  {\n    response[6] = \"Current Armor: none equipped\" ;\n  }\n  else\n  {\n    response[6] = \"Current Armor: \" + player.mArmor->getName() ;\n  }\n\n  return response ;\n}\n\nvoid Dungeon::displayHelp( void )\n{\n  cout << \"////////////////\" << endl ;\n  cout << \"Help menu\" << endl ;\n  cout << \"////////////////\" << endl ;\n  cout << \"Attack a monster type -> a:monster_name_here\" << endl ;\n  cout << \"Move to a new location type -> mv:location_name_here\" << endl ;\n  cout << \"Look for items type -> find:\" << endl ;\n  cout << \"Search the room for exits and monsters type -> loc:\" << endl ;\n  cout << \"Equip new items type -> eq:weapon_or_armor_name\" << endl;\n  cout << \"See your current status type -> you:\" << endl;\n}\n```\n\nThe next class we have to test is the filter class, if you recall from previous parts, the filter class’ job is to validate user input to check if it is safe to “dispatch\" to the database. You can think of the filter as a sanitizer for bad commands just like you can image a filter swearing words on message boards. Now go open up “test.h\" and add the following line.\n\n```c\nvoid test_filter_class(void);\n```\n\nYou know the drill, create the test methods within the file “test.cpp\" for the filter class(don’t worry this class is short).\n\n```c\nvoid Test::test_filter_class(void)\n{\n  // Filter chat test\n  // string Filter::chat() just truncates the command from the  //fromchat message if it was t:message  Filter filter;\n  string input(\"t:Hello world\");\n  string response(\"Hello world\");\n\n  assert(response == filter.chat(input));\n\n  // Filter validateMessage test\n  /*\n     The valid commands are the following\n    a:\n    mv:\n    find:\n    loc:\n    eq:\n    you:\n    help:\n   */\n  assert(true == filter.validateMessage(\"mv:n\"));\n  assert(true == filter.validateMessage(\"a:goblin\"));\n  assert(true == filter.validateMessage(\"find:\"));\n  assert(true == filter.validateMessage(\"loc:\"));\n  assert(true == filter.validateMessage(\"eq:weapon\"));\n  assert(true == filter.validateMessage(\"you:\"));\n  assert(true == filter.validateMessage(\"help:\"));\n\n  assert(false == filter.validateMessage(\"move:north\"));\n  assert(false == filter.validateMessage(\"move:south\"));\n  assert(false == filter.validateMessage(\"move:east\"));\n  assert(false == filter.validateMessage(\"move:west\"));\n  assert(false == filter.validateMessage(\"attack:goblin\"));\n  assert(false == filter.validateMessage(\"fid:\"));\n  assert(false == filter.validateMessage(\"location:\"));\n  assert(false == filter.validateMessage(\"eqip:weapon\"));\n  assert(false == filter.validateMessage(\"me:\"));\n  assert(false == filter.validateMessage(\"zelpeafaf:\"));\n  assert(false == filter.validateMessage(\"gg:\"));\n  assert(false == filter.validateMessage(\"Pi:affg\"));\n  assert(false == filter.validateMessage(\"Eqip:weapon\"));\n  assert(false == filter.validateMessage(\"Ye:\"));\n  assert(false == filter.validateMessage(\"no command input\"));\n}\n```\nThere are only two methods for the filter class, chat and validate message. As you can probably guess, chat just sends out the text following the chat command “t:\". However validate message a bit more involved. Validate message works by running three distinct test, the “keywordtest\" the “commandtest\" and the movecommandtest\". Keyword just makes sure that the user entered a keyword such as “a:\" for attack, “you:\" for player status or any of the others. The “commandtest\" just checks after the keyword has been validated that the fullname of the command matches the possible command inputs. Lastly the “movecommandtest\" ensures that the direction of travel for the move command is north, south, east or west. So go open up “database.cpp\" and add the lines below paying attention to which line the code begins on as shown in the margin.\n```c\nFilter::valid Filter::validateMessage( std::string message )\n{\n  //Necessary for the std::tolower() method\n  locale loc ;\n\n  for( unsigned int i = 0 ; i < message.length() ; ++i )\n  {\n    message [ i ] = tolower( message[ i ], loc ) ;\n  }\n\n  bool keywordTest = false ;  bool commandTest = false ;  bool moveCommandTest = true ; // Checks for a valid direction\n  unsigned int inputIndex = 0;\n\n  switch( message[ 0 ] )\n  {\n    case 'a': //Attack  case 'm': //Move\n    case 'f': //Find\n    case 'l': //Location\n    case 'e': //Equip\n    case 'y': //You\n    case 't': //Talk\n    case 'h': //Help Menu\n      keywordTest = true ;\n      break ;break\n\n    default:\n        keywordTest = false ;\n  }\n\n  if( false == keywordTest )\n  {\n    return false ;\n  }\n\n  string subMessage ;\n\n  for( unsigned int i = 0 ; i < message.size() ; ++i )\n  {\n    if( message[ i ] == ':' )\n    {\n      inputIndex = i;\n      subMessage += message[ i ] ;\n      break ;\n    }\n    else\n    {\n      subMessage += message[ i ] ;\n      continue ;\n    }\n  }\n\n  if( subMessage == \"a:\" ||\n      subMessage == \"mv:\" ||\n      subMessage == \"find:\" ||\n      subMessage == \"loc:\" ||\n      subMessage == \"eq:\" ||\n      subMessage == \"you:\" ||\n      subMessage == \"t:\" ||\n      subMessage == \"help:\" )\n  {\n    commandTest = true ;\n  }\n  else\n  {\n    return false;\n  }\n\n  if( subMessage == \"mv:\" )\n  {\n    //Checks if a direction was entered by the player,\n    // accomplishes this by seeing if the mv: command\n    // is followed by at most a single character representing\n    // the directions 'n' or 'e' or 'w' or 's'\n    if( inputIndex + 1 == message.size() )\n    {\n      moveCommandTest = false;\n    }\n\n    while( inputIndex < message.size() )\n    {\n      if( false == moveCommandTest )\n      {\n        break ;\n      }\n\n      if(message[ inputIndex ] == ' ')\n      {\n        moveCommandTest = false;\n        break ;\n      }\n\n      ++inputIndex ;\n    }inputIndex\n  }\n\n  if( true == commandTest && true == keywordTest && true == moveCommandTest )\n  {\n    return true ;\n  }\n  else\n  {\n    return false ;\n  }\n}\n\nstring Filter::chat( string message )\n{\n  return message.substr( 2, message.length() ) ;\n} \n```\nThe dispatch class is the last class we need for thesingle player version of the game. Being the dispatchits sole purpose is to separate the value and command fromthe filtered user input and “dispatch\" it to the database.Now lets open up “test.h\" and add the line below. \n```c\nvoid test_dispatch_class(void);\n```\nNext we’ll write out the test for the dispatch class within \"test.cpp\", so go open that file and insert the code below.\n```c\nvoid Test::test_dispatch_class()\n{\n  // Dispatch extractCommand test\n  //a Attack  //m Move\n  //f Find\n  //l Location\n  //e Equip\n  //y You\n  //t Talk\n  //h Help Menu\n  Dispatch dispatch;\n\n  assert('a' == dispatch.extractCommand(\"a:\"));\n  assert('m' == dispatch.extractCommand(\"mv:\"));\n  assert('f' == dispatch.extractCommand(\"find:\"));\n  assert('l' == dispatch.extractCommand(\"loc:\"));\n  assert('e' == dispatch.extractCommand(\"eq:\"));\n  assert('y' == dispatch.extractCommand(\"you:\"));\n  assert('t' == dispatch.extractCommand(\"t:\"));\n  assert('h' == dispatch.extractCommand(\"help:\"));\n\n  // Dispatch extractValue test\n  /*\n     The only commands that take values.\n\n     attack  move  equip\n     talk  */\n  assert(\"goblin\" == dispatch.extractValue(\"a:goblin\"));\n  assert(\"north\" == dispatch.extractValue(\"mv:north\"));\n  assert(\"armor\" == dispatch.extractValue(\"eq:armor\"));\n  assert(\"hello world\" == dispatch.extractValue(\"t:hello world\"));\n  assert(\"  s p a c  e  s  \" == dispatch.extractValue(\n        \"t:  s p a c  e  s  \"));\n} \n```\nNow we can add the methods for the dispatch class to our “database.cpp\"file. Open up the file “database.cpp\" and add the lines below.\n```c\nchar Dispatch::extractCommand(std::string fromFilter)\n{\n  //a Attack  //m Move\n  //f Find\n  //l Location\n  //e Equip\n  //y You\n  //t Talk\n  //h Help Menu\n\n  return fromFilter[ 0 ] ;\n}\n\nstring Dispatch::extractValue(std::string fromFilter)\n{\n  /*\n     The value of the string from the filter is all of the text\n     that follows the command.\n\n     -Example-\na:goblin\n\nThe command is a:\nThe value is goblin\n   */\n\n  // For single character commands such as t:\n  if( fromFilter[ 1 ] == ':' )\n  {\n    return fromFilter.substr( 2, fromFilter.length() ) ;\n  }\n\n  return fromFilter.substr( 3, fromFilter.length() ) ;\n} \n```\nThe last thing we have to do before we can call our single player version of the game complete is to make sure all the test pass with flying colors. Beingthat we only implemented unit test, you will be notified when a test failsby the console giving you a “assertion failed at line:XYZ\" where XYZ is the line number. So open up “main.cpp\" and make sure it looks like the code below. \n```c\n//Filename main.cpp\n#include \"Database.h\"\n#include\"Test.h\"\n\nusing namespace MUD ;\n\nvoid run_test(void)\n{\n  cout << \"Ignore the combat printouts from the\\n\";\n  cout << \"test_dungeon_class() method\\n\" << endl;\n\n  Test::get_instance()->test_item_class();\n  Test::get_instance()->test_monster_class();\n  Test::get_instance()->test_room_class();\n  Test::get_instance()->test_player_class();\n  Test::get_instance()->test_dungeon_class();\n  Test::get_instance()->test_filter_class();\n  Test::get_instance()->test_dispatch_class();\n}\n\nvoid run_sample_game(void);\n\nint main(void)\n{\n  run_test();\n  //run_sample_game();\n  return 0;\n}\n\nvoid run_sample_game(void)\n{\n  //Construct Dungeon\n  Dungeon caves( 2, 21 ) ;\n\n  //Items power vitality health\n  Item* herb_a = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_b = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_c = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_d = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_e = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_f = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n  Item* herb_g = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n\n  Item* woodsword = new Item( \"woodsword\", Item::WEAPON, 10, 0, 0 ) ;\n  Item* steelblade = new Item( \"steelblade\", Item::WEAPON, 20, 0, 0 ) ;\n  Item* crystalsword = new Item( \"crystalsword\", Item::WEAPON, 35, 0, 0 ) ;\n  Item* genjiblade = new Item( \"genjiblade\", Item::WEAPON, 60, 0, 0 ) ;\n  Item* angelicsword = new Item( \"angelicsword\", Item::WEAPON, 80, 0, 0 ) ;\n  Item* finalweapon = new Item( \"dragonslayer\", Item::WEAPON, 2000, 0, 0 ) ;\n\n  Item* woodarmor = new Item( \"woodarmor\", Item::ARMOR, 0, 5, 15 ) ;\n  Item* steelarmor = new Item( \"steelarmor\", Item::ARMOR, 0, 7, 20 ) ;\n  Item* diamondarmor = new Item( \"diamondarmor\", Item::ARMOR, 0, 12, 30 ) ;\n  Item* crystalarmor = new Item( \"crystalarmor\", Item::ARMOR, 0, 15, 35 ) ;\n  Item* dragonarmor = new Item( \"dragonarmor\", Item::ARMOR, 0, 20, 100 ) ;\n  Item* ultimatearmor = new Item( \"ultimatearmor\", Item::ARMOR, 0, 1000, 1000 ) ;\n\n  //Monsters hp str def\n  Monster* bear = new Monster( \"bear\", 15, 2, 3 ) ;\n  Monster* goblin = new Monster( \"goblin\", 5, 3, 1 ) ;\n  Monster* imp = new Monster( \"imp\", 5, 5, 2 ) ;\n  Monster* redgoblin = new Monster( \"redgoblin\", 5, 5, 5 ) ;\n  Monster* demon = new Monster( \"demon\", 6, 3, 7 ) ;\n  Monster* zergling = new Monster( \"zergling\", 10, 10, 9 ) ;\n  Monster* bats = new Monster( \"bats\", 20, 15, 3 ) ;\n  Monster* morebats = new Monster( \"morebats\", 25, 20, 15 ) ;\n  Monster* golem = new Monster( \"golem\", 50, 21, 9 ) ;\n  Monster* goatdemon = new Monster( \"goatdemon\", 100, 10, 10 ) ;\n  Monster* cyclops = new Monster( \"cyclops\", 150, 90, 0 ) ;\n  Monster* behemoth = new Monster( \"behemoth\", 250, 30, 40 ) ;\n  Monster* alien = new Monster( \"alien\", 50, 21, 4 ) ;\n  Monster* giantrat = new Monster( \"giantrat\", 55, 40, 1 ) ;\n  Monster* fallenangel = new Monster( \"fallenangel\", 300, 100, 100 ) ;\n  Monster* greatdragon = new Monster( \"greatdragon\", 500, 300, 1 ) ;\n  Monster* invincibledragon = new Monster( \"invincibledragon\", 999, 999, 999 ) ;\n\n  //Rooms name description item\n  Room* mainHall = new Room( \"The main cavern\", \"A murkey swamp cavern\", woodsword ) ;\n  Room* river = new Room( \"The black river\", \"A river with dark water\", woodarmor ) ;\n  Room* greencave = new Room( \"The greencave\", \"A moss covered cave\", herb_a ) ;\n  Room* bluecave = new Room( \"The bluecave\", \"A frosty cave\", steelblade ) ;\n  Room* darkpit = new Room( \"The darkpit\", \"An endless hole lies before you\", steelarmor ) ;\n  Room* morbidfield = new Room( \"The morbidfield\", \"Pitch black grass surrounds you\", herb_b ) ;\n  Room* graveyard = new Room( \"The graveyard\", \"Tombstones abound\", diamondarmor ) ;\n  Room* crypt = new Room( \"The crypt\", \"A nasty rotten crypt\", crystalsword ) ;\n  Room* evilpassage = new Room( \"The evil passage\", \"An evil pasage\", crystalarmor ) ;\n  Room* darklair = new Room( \"The dark lair\", \"A dark lair\", herb_c ) ;\n  Room* firepit = new Room( \"The firey pits\", \"Fire is every where\", herb_d ) ;\n  Room* greenpasture = new Room( \"The greenpastures\", \"A meadow is before you\", genjiblade ) ;\n  Room* icecave = new Room( \"The icy caves\", \"Ice everywhere you look\", herb_e ) ;\n  Room* livingroom = new Room( \"The living room\", \"The room is alive\", dragonarmor ) ;\n  Room* cellar = new Room( \"The cellar\", \"A dirty cellar filled with rats\", angelicsword ) ;\n  Room* lifespring = new Room( \"The lifespring\", \"A beautiful fountain stands\", herb_f ) ;\n  Room* waterfall = new Room( \"The waterfall\", \"Clear blue water falls\", herb_g ) ;\n  Room* hellsgate = new Room( \"The gates of hell\", \"Large rusty doors lead to hell\", ultimatearmor ) ;\n  Room* dragoncave = new Room( \"The dragon's cave\", \"An ancient cave...\" ) ;\n  Room* dragonsden = new Room( \"The dragon's den\", \"A powerful monster awaits\" ) ;\n  Room* lostforest = new Room( \"The secret forest\", \"The strongest sword lies hidden here\", finalweapon ) ;\n\n  //Link Rooms\n  mainHall->link( 'e', *river ) ;\n  river->link( 's', *greencave ) ;\n  river->link( 'e', *bluecave ) ;\n  river->link( 'w', *mainHall ) ;\n  greencave->link( 'n', *river ) ;\n  bluecave->link( 'w', *river ) ;\n  bluecave->link( 'n', *darkpit ) ;\n  darkpit->link( 's', *bluecave ) ;\n  darkpit->link( 'n', *morbidfield ) ;\n  morbidfield->link( 's', *darkpit ) ;\n  morbidfield->link( 'e', *graveyard ) ;\n  graveyard->link( 'w', *morbidfield ) ;\n  graveyard->link( 'n', *crypt ) ;\n  graveyard->link( 'e', *evilpassage ) ;\n  crypt->link( 's', *graveyard ) ;\n  evilpassage->link( 'w', *graveyard ) ;\n  evilpassage->link( 's', *darklair ) ;\n  darklair->link( 'n', *evilpassage ) ;\n  darklair->link( 's', *firepit ) ;\n  firepit->link( 'n', *darklair ) ;\n  firepit->link( 'e', *greenpasture ) ;\n  greenpasture->link( 'w', *firepit ) ;\n  greenpasture->link( 's', *icecave ) ;\n  greenpasture->link( 'e', *livingroom ) ;\n  icecave->link( 'n', *greenpasture ) ;\n  livingroom->link( 'w', *greenpasture ) ;\n  livingroom->link( 'e', *cellar ) ;\n  cellar->link( 'w', *livingroom ) ;\n  cellar->link( 'n', *lifespring ) ;\n  cellar->link( 'e', *hellsgate ) ;\n  lifespring->link( 's', *cellar ) ;\n  lifespring->link( 'n', *waterfall ) ;\n  waterfall->link( 's', *lifespring ) ;\n  hellsgate->link( 'w', *cellar ) ;\n  hellsgate->link( 'e', *dragoncave ) ;\n  dragoncave->link( 'w', *hellsgate ) ;\n  dragoncave->link( 'e', *dragonsden ) ;\n  dragonsden->link( 'w', *dragoncave ) ;\n  dragonsden->link( 'e', *lostforest ) ;\n  lostforest->link( 'w', *dragonsden ) ;\n\n  //Add monsters to rooms\n  mainHall->addMonster( goblin ) ;\n  mainHall->addMonster( imp ) ;\n  river->addMonster( bear ) ;\n  river->addMonster( redgoblin ) ;\n  bluecave->addMonster( demon ) ;\n  bluecave->addMonster( zergling ) ;\n  morbidfield->addMonster( bats ) ;\n  morbidfield->addMonster( morebats ) ;\n  graveyard->addMonster( golem ) ;\n  evilpassage->addMonster( goatdemon ) ;\n  firepit->addMonster( cyclops ) ;\n  greenpasture->addMonster( behemoth ) ;\n  livingroom->addMonster( alien ) ;\n  cellar->addMonster( giantrat ) ;\n  hellsgate->addMonster( fallenangel ) ;\n  dragoncave->addMonster( greatdragon ) ;\n  dragonsden->addMonster( invincibledragon ) ;\n\n  //Add the rooms to the dungeon\n  caves.addRoom( mainHall ) ;\n  caves.addRoom( river ) ;\n  caves.addRoom( greencave ) ;\n  caves.addRoom( bluecave ) ;\n  caves.addRoom( darkpit ) ;\n  caves.addRoom( morbidfield ) ;\n  caves.addRoom( graveyard ) ;\n  caves.addRoom( crypt ) ;\n  caves.addRoom( evilpassage ) ;\n  caves.addRoom( darklair ) ;\n  caves.addRoom( firepit ) ;\n  caves.addRoom( greenpasture ) ;\n  caves.addRoom( icecave ) ;\n  caves.addRoom( livingroom ) ;\n  caves.addRoom( cellar ) ;\n  caves.addRoom( lifespring ) ;\n  caves.addRoom( waterfall ) ;\n  caves.addRoom( hellsgate ) ;\n  caves.addRoom( dragoncave ) ;\n  caves.addRoom( dragonsden ) ;\n  caves.addRoom( lostforest ) ;\n\n  //Create a filter  Filter filter ;\n\n  //Create a dispatch object with a command char and a value string\n  Dispatch dispatch ;\n  char command ;\n  string value ;\n\n  //Simulate a new game\n  //Create a new player and add to the dungeon\n  string input ;\n  cout << \"Welcome to the game\\nEnter in a new name: \" ;\n  getline(cin, input, '\\n');\n\n  Player* one = new Player( input, mainHall ) ;\n  cout << caves.addPlayer( one ) << endl ;\n\n  //Display needed info for the players\n  cout << \"The objective is to clear the dungeon of all monsters. Good Luck\" << endl ;\n  cout << \"Enter in a new command to start, to display help type the following command\" << endl ;\n  cout << \"help:\" << endl ;\n  cout << \"To quit simply enter \\\"quit\\\" without the quotes as a new command\" << endl ;\n  cout << \"New Command\" << endl ;\n  getline(cin, input, '\\n');\n\n  //Start the game loop\n  while( input != \"quit\" )\n  {\n    //Pass the users message through the filter\n    if( filter.validateMessage( input ) )\n    {\n      //Split the users message into a command and value pair\n      command = dispatch.extractCommand( input ) ;\n      value = dispatch.extractValue( input ) ;\n\n      //Match the command and forward the value\n      switch( command )\n      {\n\n        case 'a': //Attack\n          //If the monster does not exist or the name was mispelled\n          if( &(one->mLocation->getMonsterRef( value )) == NULL )\n          {\n            cout << \"There is no \" + value + \" at this location\" << endl ;\n            break ;\n          }\n          //If the monster is there but in combat the player cannot fight it\n          if( one->mLocation->getMonsterRef( value ).inCombat == true )\n          {\n            cout << \"The \" + value + \" is currently fighting\" << endl ;\n            break ;\n          }\n\n          caves.combatLoop( *one, one->mLocation->getMonsterRef( value ) ) ;\n          break ;\n\n        case 'm': //Move\n          cout << one->move( value[ 0 ] ) ;\n          break ;\n\n        case 'f': //Find\n          cout << one->search() ;\n          break ;\n\n        case 'l': //Location\n          cout << one->getLocation() ;\n          break ;\n\n        case 'e': //Equip\n          cout << one->equip( value ) ;\n          break ;\n\n        case 'y': //You\n          {\n            string* playerStats = new string ;\n            playerStats = caves.playerStatus( *one ) ;\n\n            for( int i = 0 ; i < 7 ; ++i )\n            {\n              cout << playerStats[i] << endl ;\n            }endl\n          }\n          break ;\n\n          //case 't': //Talk\n\n        case 'h': //Help Menu\n          caves.displayHelp();\n          break ;\n      }\n    }\n    else\n    {\n      cout << \"Invalid command please refer to the help menu.\\nhelp:\" << endl ;\n      cout << \"Or type \\\"quit\\\" to quit the game\" << endl ;\n    }\n\n    if( caves.isComplete() )\n    {\n      cout << \"Dungeon Cleared, YOU WIN!\" << endl ;\n      break ;\n    }\n\n    if( one->death() )\n    {\n      cout << one->getName() + \" was slain by the \" + one->mLocation->getMonsterRef( value ).getName() << endl ;\n      one->mLocation->getMonsterRef( value ).inCombat = false ;\n      cout << \"*Hint* Secret rooms hidden abound; find them and victory shall be yours\" << endl ;\n      input = \"quit\" ;\n    }\n    else\n    {\n      //Get the next command\n      cout << \"\\n\\nNew Command\" << endl ;\n      getline(cin, input, '\\n');\n    }\n  }\n\n  caves.removePlayer( one->getName() ) ;\n}\n```\nFor reference here are all the files for the project below.If none of the dropbox links are working then mention it in the comments section and I’ll re-upload the files. \n<p>\n<a  href=\"http://dl.dropbox.com/u/22280460/database.cpp\">http://dl.dropbox.com/u/22280460/database.cpp</a>\n<br />\n<a href=\"http://dl.dropbox.com/u/22280460/database.h\">http://dl.dropbox.com/u/22280460/database.h</a>\n<br />\n<a href=\"http://dl.dropbox.com/u/22280460/main.cpp\">http://dl.dropbox.com/u/22280460/main.cpp</a>\n<br />\n<a href=\"http://dl.dropbox.com/u/22280460/Test.cpp\">http://dl.dropbox.com/u/22280460/Test.cpp</a>\n<br />\n<a href=\"http://dl.dropbox.com/u/22280460/Test.h\">http://dl.dropbox.com/u/22280460/Test.h</a>\n</p>\n\n<a href=\"/2011/06/16/textbasedrpgpart6.html\">Click here for part 6</a>\n[Click here for part VI][link_part_6]\n\n[link_part_4]: /2011/06/11/textbasedrpgpart4\n[link_part_6]: /2011/06/16/textbasedrpgpart6\n","slug":"textbasedrpgpart5","published":1,"updated":"2017-04-14T05:37:29.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr2n00129uwvz1gvhmr1","content":"<ul>\n<li><a href=\"/2011/06/11/textbasedrpgpart4\">Click here for part IV</a></li>\n<li><a href=\"/2011/06/16/textbasedrpgpart6\">Click here for part VI</a></li>\n</ul>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>The fifth part of the tutorial on creating a text based multiplayer RPG game will see us creating the last part of the testing and game mechanics before the next section where we’ll launch the client and server code to actually test our game in action.</p>\n<p>In this part of the tutorial we will complete the test and methods necessary to get the full functionality for the stand alone single player version. In the next part of the tutorial part 6, we will begin to develop both the client and server code that allows other users to connect and play our game over a local area network. So lets continue with the testing and move onto the player class. Go ahead and open up the “test.h” file and add line below.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_player_class</span><span class=\"params\">()</span></span>;</div></pre></td></tr></table></figure>\n<p>Then open up the file “test.cpp” and add the methods for the player test class beginning at the line indicated.</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div></pre></td><td class=\"code\"><pre><div class=\"line\">void Test::test_player_class(void)</div><div class=\"line\">&#123;</div><div class=\"line\">  // Player constructor w/o initial room</div><div class=\"line\">  Player no_room_player(\"hero\");</div><div class=\"line\"></div><div class=\"line\">  assert(10 == no_room_player.mMaxHp);</div><div class=\"line\">  assert(10 == no_room_player.mHp);</div><div class=\"line\">  assert(1 == no_room_player.mStrength);</div><div class=\"line\">  assert(0 == no_room_player.mDefence);</div><div class=\"line\">  assert(NULL == no_room_player.mLocation);</div><div class=\"line\">  assert(\"hero\" == no_room_player.mName);</div><div class=\"line\">  assert(NULL == no_room_player.mWeapon);</div><div class=\"line\">  assert(NULL == no_room_player.mArmor);</div><div class=\"line\"></div><div class=\"line\">  // Player constructor w/room</div><div class=\"line\">  Player room_player(\"dude\", new Room(\"Home\", \"A big house\"));</div><div class=\"line\"></div><div class=\"line\">  assert(NULL != room_player.mLocation);</div><div class=\"line\"></div><div class=\"line\">  // Player getters/setters</div><div class=\"line\">  Player get_set(\"setter\", new Room(\"Lake\", \"A clean lake\"));</div><div class=\"line\"></div><div class=\"line\">  get_set.setDefence(1);</div><div class=\"line\">  get_set.setHp(10);</div><div class=\"line\">  get_set.setName(\"getter\");</div><div class=\"line\">  get_set.setStrength(2);</div><div class=\"line\"></div><div class=\"line\">  assert(1 == get_set.getDefence());</div><div class=\"line\">  assert(10 == get_set.getHp());</div><div class=\"line\">  assert(\"getter\" == get_set.getName());</div><div class=\"line\">  assert(2 == get_set.getStrength());</div><div class=\"line\">  assert(\"Lake\" == get_set.getLocation());</div><div class=\"line\"></div><div class=\"line\">  // Player equip test</div><div class=\"line\">  // The Item is not found</div><div class=\"line\">  // - There is no item within the room \"There is no item to equip in this rooom\"</div><div class=\"line\">  // - The player misspelled the item name \"To equip an item you must type its full name correctly\"</div><div class=\"line\">  Room no_item_room(\"Itemless\", \"There is no item here\");</div><div class=\"line\">  Player no_item_player(\"Hi\");</div><div class=\"line\">  no_item_player.mLocation = &amp;no_item_room;</div><div class=\"line\">  string response(\"There is no item to equip in this room\");</div><div class=\"line\"></div><div class=\"line\">  assert(response == no_item_player.equip(\"Bad Item name\"));</div><div class=\"line\"></div><div class=\"line\">  Room with_item(\"Item room\", \"Item filled room\", new Item(\"dagger\", Item::WEAPON, 10, 0, 0));</div><div class=\"line\">  no_item_player.mLocation = &amp;with_item;</div><div class=\"line\">  response = \"To equip an item you must type its full name correctly\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == no_item_player.equip(\"daggers\"));</div><div class=\"line\"></div><div class=\"line\">  // Weapon is found</div><div class=\"line\">  // - The weapon becomes unavailable</div><div class=\"line\">  // - The players strength is set equal to the weapons power value</div><div class=\"line\">  // - The response returned is \"You equipped the Item.mName\"      Player item_player(\"Bye\", &amp;with_item);</div><div class=\"line\">  response = \"You equipped the dagger\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == item_player.equip(\"dagger\"));</div><div class=\"line\">  assert(false == with_item.mItem-&gt;mAvailiable);</div><div class=\"line\">  assert(with_item.mItem-&gt;getPower() == item_player.getStrength());</div><div class=\"line\"></div><div class=\"line\">  // Armor is found</div><div class=\"line\">  // - The armor becomes unavailable</div><div class=\"line\">  // - The players vitality is set equal to the armor's defence  // - The response returned is \"You equipped the Item.mName\"</div><div class=\"line\">  // - The armor's health value is added to the players max hp</div><div class=\"line\">  Item* steel_plate = new Item(\"steelplate\", Item::ARMOR, 0, 10, 20);</div><div class=\"line\">  with_item.setItem(steel_plate);</div><div class=\"line\">  response = \"You equipped the steelplate\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == item_player.equip(\"steelplate\"));</div><div class=\"line\">  assert(with_item.mItem-&gt;mAvailiable == false);</div><div class=\"line\">  assert(steel_plate-&gt;getHealth() + item_player.getHp()</div><div class=\"line\">      == item_player.mMaxHp);</div><div class=\"line\">  assert(with_item.mItem-&gt;getVitality() == item_player.getDefence());</div><div class=\"line\"></div><div class=\"line\">  // Health is found</div><div class=\"line\">  // - The health item becomes unavailable</div><div class=\"line\">  // - The player's hp is fully restored</div><div class=\"line\">  // - The response is \"You were healed\"</div><div class=\"line\">  Item* herb = new Item(\"herbs\", Item::HEALTH, 0, 0, 0);</div><div class=\"line\">  with_item.setItem(herb);</div><div class=\"line\">  response = \"You were healed\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == item_player.equip(\"herbs\"));</div><div class=\"line\">  assert(with_item.mItem-&gt;mAvailiable == false);</div><div class=\"line\">  assert(item_player.getHp() == item_player.mMaxHp);</div><div class=\"line\"></div><div class=\"line\">  // Player attack test</div><div class=\"line\">  // a- There are no monsters within the Room then the method should  //methodreturn \"There are no monsters in this room to fight\"</div><div class=\"line\">  // b- The player mis-typed the monster name then</div><div class=\"line\">  //name\"The Monster.mName is not here\"</div><div class=\"line\">  // c- If damage was dealt to the monster then the message should say</div><div class=\"line\">  //should\"Monster.mName was dealt X damage\"  // d- If no damage was dealt to the monster then the message should say</div><div class=\"line\">  //should\"Monster.mName dodged the attack\"</div><div class=\"line\">  string response_a(\"There are no monsters in this room to fight\");</div><div class=\"line\">  string response_b(\"The roll is not here\");</div><div class=\"line\">  string response_c(\"troll was dealt 30 damage\");</div><div class=\"line\">  string response_d(\"supertroll dodged the attack\");</div><div class=\"line\"></div><div class=\"line\">  Item* great_sword = new Item(\"greatsword\", Item::WEAPON, 30, 0, 0);</div><div class=\"line\">  Room* arena = new Room(\"arena\", \"A large crowd gathers\", great_sword);</div><div class=\"line\">  Monster* troll = new Monster(\"troll\", 50, 0, 0);</div><div class=\"line\"></div><div class=\"line\">  arena-&gt;setItem(great_sword);</div><div class=\"line\">  Player* attacker = new Player(\"Fighter\", arena);</div><div class=\"line\">  attacker-&gt;equip(\"greatsword\");</div><div class=\"line\"></div><div class=\"line\">  assert(response_a == attacker-&gt;attack(\"troll\"));</div><div class=\"line\"></div><div class=\"line\">  arena-&gt;addMonster(troll);</div><div class=\"line\"></div><div class=\"line\">  assert(response_b == attacker-&gt;attack(\"roll\"));</div><div class=\"line\">  assert(response_c == attacker-&gt;attack(\"troll\"));</div><div class=\"line\"></div><div class=\"line\">  Monster* super_troll = new Monster(\"supertroll\", 8, 0, 999);</div><div class=\"line\">  arena-&gt;addMonster(super_troll);</div><div class=\"line\">  assert(response_d == attacker-&gt;attack(\"supertroll\"));</div><div class=\"line\"></div><div class=\"line\">  // Player move test</div><div class=\"line\">  // - If the player moves in an invalid direction then  //direction\"You traveled nowhere\" should be returned</div><div class=\"line\">  // - If the direction is valid but no room is connected</div><div class=\"line\">  //is\"There is nothing in that direction\"</div><div class=\"line\">  // - If the direction is valid and a room exist</div><div class=\"line\">  //room\"You traveled directionname\\nmLocation-&gt;getDescription()\"</div><div class=\"line\">  Room* moving_room = new Room(\"Moving room\", \"You can move from here\");</div><div class=\"line\">  Room* moving_north = new Room(\"Moving north\",  \"North of the moving room\");</div><div class=\"line\">  Room* moving_south = new Room(\"Moving south\",  \"South of the moving room\");</div><div class=\"line\">  Room* moving_west = new Room(\"Moving west\",</div><div class=\"line\">      \"West of the moving room\");</div><div class=\"line\">  Room* moving_east = new Room(\"Moving east\",</div><div class=\"line\">      \"East of the moving room\");</div><div class=\"line\"></div><div class=\"line\">  Player* moving_player = new Player(\"Jill\", moving_room);</div><div class=\"line\">  response = \"You traveled nowhere\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == moving_player-&gt;move('p'));</div><div class=\"line\"></div><div class=\"line\">  response = \"There is nothing in that direction\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == moving_player-&gt;move('n'));</div><div class=\"line\">  assert(response == moving_player-&gt;move('e'));</div><div class=\"line\">  assert(response == moving_player-&gt;move('w'));</div><div class=\"line\">  assert(response == moving_player-&gt;move('s'));</div><div class=\"line\"></div><div class=\"line\">  moving_player-&gt;mLocation = moving_room;</div><div class=\"line\">  response = \"You traveled North\\n\" + moving_north-&gt;getDescription();</div><div class=\"line\">  moving_room-&gt;link('n', *moving_north);</div><div class=\"line\">  assert(response == moving_player-&gt;move('n'));</div><div class=\"line\"></div><div class=\"line\">  moving_player-&gt;mLocation = moving_room;</div><div class=\"line\">  response = \"You traveled South\\n\" + moving_south-&gt;getDescription();</div><div class=\"line\">  moving_room-&gt;link('s', *moving_south);</div><div class=\"line\">  assert(response == moving_player-&gt;move('s'));</div><div class=\"line\"></div><div class=\"line\">  moving_player-&gt;mLocation = moving_room;</div><div class=\"line\">  response = \"You traveled West\\n\" + moving_west-&gt;getDescription();</div><div class=\"line\">  moving_room-&gt;link('w', *moving_west);</div><div class=\"line\">  assert(response == moving_player-&gt;move('w'));</div><div class=\"line\"></div><div class=\"line\">  moving_player-&gt;mLocation = moving_room;</div><div class=\"line\">  response = \"You traveled East\\n\" + moving_east-&gt;getDescription();</div><div class=\"line\">  moving_room-&gt;link('e', *moving_east);</div><div class=\"line\">  assert(response == moving_player-&gt;move('e'));</div><div class=\"line\"></div><div class=\"line\">  // Player search test</div><div class=\"line\">  // Exact same as the string Room::searchResponse( void )  // method so it has already been tested</div><div class=\"line\"></div><div class=\"line\">  // Player death test</div><div class=\"line\">  // -Returns true when the player's hp is less than zero</div><div class=\"line\">  // -Returns false when the player's hp is greater than zero</div><div class=\"line\">  Player* death_test = new Player(\"Dead guy\");</div><div class=\"line\"></div><div class=\"line\">  assert(false == death_test-&gt;death());</div><div class=\"line\"></div><div class=\"line\">  death_test-&gt;setHp(-1);</div><div class=\"line\">  assert(true == death_test-&gt;death());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Now that we have the methods for the player class all set the next thing we have to do is to write out the methods for the player class. To do so open up the file “database.cpp” and add the methods for the player class below.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div></pre></td><td class=\"code\"><pre><div class=\"line\">Player::Player( <span class=\"built_in\">string</span> name, Room* start )  : mName(name), mLocation(start), mWeapon(<span class=\"literal\">NULL</span>), mArmor(<span class=\"literal\">NULL</span>),</div><div class=\"line\">  mHp(<span class=\"number\">10</span>), mMaxHp(<span class=\"number\">10</span>), mStrength(<span class=\"number\">1</span>), mDefence(<span class=\"number\">0</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Player::setHp( <span class=\"keyword\">int</span> newHp )</div><div class=\"line\">&#123;</div><div class=\"line\">  mHp = newHp ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Player::getHp( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mHp ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Player::setStrength( <span class=\"keyword\">int</span> newStrength )</div><div class=\"line\">&#123;</div><div class=\"line\">  mStrength = newStrength ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Player::getStrength( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mStrength ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Player::setDefence( <span class=\"keyword\">int</span> newDefence )</div><div class=\"line\">&#123;</div><div class=\"line\">  mDefence = newDefence ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Player::getDefence( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mDefence ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::getLocation( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mLocation-&gt;mName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Player::setName( <span class=\"built_in\">string</span> newName )</div><div class=\"line\">&#123;</div><div class=\"line\">  mName = newName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::getName( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span>  &#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::attack( <span class=\"built_in\">string</span> monsterName )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">list</span>&lt; Monster* &gt;::iterator iter ;</div><div class=\"line\">  <span class=\"keyword\">int</span> damage = <span class=\"number\">0</span> ;</div><div class=\"line\">  <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">response</span><span class=\"params\">( <span class=\"string\">\"The \"</span> + monsterName + <span class=\"string\">\" is not here\"</span> )</span> </span>;  <span class=\"built_in\">stringstream</span> ss ;</div><div class=\"line\">  <span class=\"built_in\">string</span> strDamage ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( mLocation-&gt;mMonsters.empty() )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"There are no monsters in this room to fight\"</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( iter = mLocation-&gt;mMonsters.begin() ; iter != mLocation-&gt;mMonsters.end() ; ++iter )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( (*iter)-&gt;getName() == monsterName )</div><div class=\"line\">    &#123;</div><div class=\"line\">      damage = getStrength() - (*iter)-&gt;getDefence() ;</div><div class=\"line\">      ss &lt;&lt; damage ;</div><div class=\"line\">      ss &gt;&gt; strDamage ;</div><div class=\"line\">      ss.clear() ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>( damage &gt; <span class=\"number\">0</span> )</div><div class=\"line\">      &#123;</div><div class=\"line\">        (*iter)-&gt;setHp( (*iter)-&gt;getHp() - damage ) ;</div><div class=\"line\">        response = (*iter)-&gt;getName() + <span class=\"string\">\" was dealt \"</span> + strDamage + <span class=\"string\">\" damage\"</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">else</span></div><div class=\"line\">      &#123;</div><div class=\"line\">        response = (*iter)-&gt;getName() + <span class=\"string\">\" dodged the attack\"</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::equip( <span class=\"built_in\">string</span> itemName )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">string</span> response ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( mLocation-&gt;mItem != <span class=\"literal\">NULL</span> &amp;&amp; mLocation-&gt;mItem-&gt;getName() == itemName )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( Item::WEAPON == mLocation-&gt;mItem-&gt;getType() &amp;&amp; <span class=\"literal\">true</span> == mLocation-&gt;mItem-&gt;mAvailiable )</div><div class=\"line\">    &#123;</div><div class=\"line\">      mWeapon = mLocation-&gt;mItem ;</div><div class=\"line\">      mLocation-&gt;itemTaken() ;</div><div class=\"line\">      setStrength( mWeapon-&gt;getPower() ) ;</div><div class=\"line\">      response = <span class=\"string\">\"You equipped the \"</span> + mWeapon-&gt;getName() ;</div><div class=\"line\">      <span class=\"keyword\">return</span> response ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>( Item::ARMOR == mLocation-&gt;mItem-&gt;getType() &amp;&amp; <span class=\"literal\">true</span> == mLocation-&gt;mItem-&gt;mAvailiable )</div><div class=\"line\">    &#123;</div><div class=\"line\">      mArmor = mLocation-&gt;mItem ;</div><div class=\"line\">      mLocation-&gt;itemTaken() ;</div><div class=\"line\">      setDefence( mArmor-&gt;getVitality() ) ;</div><div class=\"line\">      mMaxHp += mArmor-&gt;getHealth() ;</div><div class=\"line\">      response = <span class=\"string\">\"You equipped the \"</span> + mArmor-&gt;getName() ;</div><div class=\"line\">      <span class=\"keyword\">return</span> response ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      setHp( mMaxHp ) ;</div><div class=\"line\">      mLocation-&gt;itemTaken() ;</div><div class=\"line\">      response = <span class=\"string\">\"You were healed\"</span> ;</div><div class=\"line\">      <span class=\"keyword\">return</span> response ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( mLocation-&gt;mItem == <span class=\"literal\">NULL</span> )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"There is no item to equip in this room\"</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    response = <span class=\"string\">\"To equip an item you must type its full name correctly\"</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> response ;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::move( <span class=\"keyword\">char</span> direction )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">string</span> response = <span class=\"string\">\"You traveled \"</span> ;</div><div class=\"line\">  <span class=\"keyword\">switch</span>( direction )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'n'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'N'</span>:</div><div class=\"line\">      <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == mLocation-&gt;mNorth )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = <span class=\"string\">\"There is nothing in that direction\"</span> ;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      mLocation = &amp;(mLocation-&gt;north()) ;</div><div class=\"line\">      response = response + <span class=\"string\">\"North\\n\"</span> + mLocation-&gt;getDescription() ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'s'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'S'</span>:</div><div class=\"line\">      <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == mLocation-&gt;mSouth )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = <span class=\"string\">\"There is nothing in that direction\"</span> ;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      mLocation = &amp;(mLocation-&gt;south()) ;</div><div class=\"line\">      response = response + <span class=\"string\">\"South\\n\"</span> + mLocation-&gt;getDescription() ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'e'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'E'</span>:</div><div class=\"line\">      <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == mLocation-&gt;mEast )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = <span class=\"string\">\"There is nothing in that direction\"</span> ;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      mLocation = &amp;(mLocation-&gt;east()) ;</div><div class=\"line\">      response = response + <span class=\"string\">\"East\\n\"</span> + mLocation-&gt;getDescription() ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'w'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'W'</span>:</div><div class=\"line\">      <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == mLocation-&gt;mWest )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = <span class=\"string\">\"There is nothing in that direction\"</span> ;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      mLocation = &amp;(mLocation-&gt;west()) ;</div><div class=\"line\">      response = response + <span class=\"string\">\"West\\n\"</span> + mLocation-&gt;getDescription() ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">default</span>:</div><div class=\"line\">      response = response + <span class=\"string\">\"nowhere\"</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::search( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mLocation-&gt;searchResponse() ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">Player::dead Player::death( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span>( getHp() &lt;= <span class=\"number\">0</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Afterwards you can begin to test the Dungeon class, so open up the file “test.h” file and add the following line.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_dungeon_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div></pre></td></tr></table></figure>\n<p>Here are the methods for the dungeon test, it is quite long so you can copy it if you want to but I suggest typing it out and reading through the comments in order to better understand the codebase; the file for the code below is “test.cpp”</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_dungeon_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Dungeon constructor test</span></div><div class=\"line\">  Dungeon* test_dungeon = <span class=\"keyword\">new</span> Dungeon(<span class=\"number\">1</span>, <span class=\"number\">1</span>);</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"number\">1</span> == test_dungeon-&gt;mMaxPlayers);</div><div class=\"line\">  assert(<span class=\"number\">1</span> == test_dungeon-&gt;mMaxRooms);</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == test_dungeon-&gt;mPlayers.empty());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == test_dungeon-&gt;mRooms.empty());</div><div class=\"line\">  <span class=\"comment\">// - A dungeon without monsters is considered complete</span></div><div class=\"line\">  assert(<span class=\"literal\">true</span> == test_dungeon-&gt;isComplete());</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon addPlayer test</span></div><div class=\"line\">  <span class=\"comment\">// - Successful addition of a new player should display the following</span></div><div class=\"line\">  <span class=\"comment\">//the\"The player named newPlayer-&gt;getName() entered the Dungeon\"</span></div><div class=\"line\">  Player* newbie = <span class=\"keyword\">new</span> Player(<span class=\"string\">\"Noob\"</span>);</div><div class=\"line\">  <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">response</span><span class=\"params\">(<span class=\"string\">\"The player named Noob entered the Dungeon\"</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(response == test_dungeon-&gt;addPlayer(newbie));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == test_dungeon-&gt;mPlayers.empty());</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon addRoom test</span></div><div class=\"line\">  <span class=\"comment\">// - \"The room: newRoom-&gt;mName was added\" will be displayed</span></div><div class=\"line\">  <span class=\"comment\">//beif the addition was successful</span></div><div class=\"line\">  Room* main_room = <span class=\"keyword\">new</span> Room(<span class=\"string\">\"Main hall\"</span>, <span class=\"string\">\"The main hall\"</span>);</div><div class=\"line\">  response = <span class=\"string\">\"The room: Main hall was added\"</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(response == test_dungeon-&gt;addRoom(main_room));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == test_dungeon-&gt;mRooms.empty());</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon removePlayer test</span></div><div class=\"line\">  response = <span class=\"string\">\"Noob has left the dungeon\"</span>;</div><div class=\"line\">  assert(response == test_dungeon-&gt;removePlayer(newbie-&gt;getName()));</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon generatePlayerStats test</span></div><div class=\"line\">  <span class=\"comment\">// -Sets the players max hp to 10, strength and defence to 2</span></div><div class=\"line\">  test_dungeon-&gt;generatePlayerStats(newbie);</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"number\">10</span> == newbie-&gt;getHp());</div><div class=\"line\">  assert(<span class=\"number\">2</span> == newbie-&gt;getStrength());</div><div class=\"line\">  assert(<span class=\"number\">2</span> == newbie-&gt;getDefence());</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon combatLoop test</span></div><div class=\"line\">  <span class=\"comment\">// - If the hero is stronger than the monster then the monster  //theshould die else the hero should die</span></div><div class=\"line\">  Dungeon* combat_test = <span class=\"keyword\">new</span> Dungeon(<span class=\"number\">1</span>, <span class=\"number\">1</span>);</div><div class=\"line\">  Room* combat_room = <span class=\"keyword\">new</span> Room(<span class=\"string\">\"Battle\"</span>, <span class=\"string\">\"Fight here\"</span>);</div><div class=\"line\">  Item* longsword = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"longsword\"</span>, Item::WEAPON, <span class=\"number\">100</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">  Player* brawler = <span class=\"keyword\">new</span> Player(<span class=\"string\">\"brawler\"</span>, combat_room);</div><div class=\"line\">  Monster* ogre = <span class=\"keyword\">new</span> Monster(<span class=\"string\">\"ogre\"</span>, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);  Monster* superogre = <span class=\"keyword\">new</span> Monster(<span class=\"string\">\"superogre\"</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>);  combat_room-&gt;setItem(longsword);</div><div class=\"line\">  combat_room-&gt;addMonster(ogre);</div><div class=\"line\">  combat_room-&gt;addMonster(superogre);</div><div class=\"line\">  combat_test-&gt;addRoom(combat_room);</div><div class=\"line\">  combat_test-&gt;addPlayer(brawler);</div><div class=\"line\">  combat_test-&gt;generatePlayerStats(brawler);</div><div class=\"line\">  brawler-&gt;mLocation = combat_room;</div><div class=\"line\">  brawler-&gt;equip(<span class=\"string\">\"longsword\"</span>);</div><div class=\"line\"></div><div class=\"line\">  combat_test-&gt;combatLoop(*brawler, *ogre);</div><div class=\"line\">  assert(combat_room-&gt;mMonsters.empty() == <span class=\"literal\">false</span>);</div><div class=\"line\">  assert(combat_test-&gt;isComplete() == <span class=\"literal\">false</span>);</div><div class=\"line\"></div><div class=\"line\">  Item* badsword = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"badsword\"</span>, Item::WEAPON, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">  combat_room-&gt;setItem(badsword);</div><div class=\"line\">  brawler-&gt;equip(<span class=\"string\">\"badsword\"</span>);</div><div class=\"line\"></div><div class=\"line\">  combat_test-&gt;combatLoop(*brawler, *superogre);</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == brawler-&gt;death());</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon playerStatus test</span></div><div class=\"line\">  Dungeon* status_test = <span class=\"keyword\">new</span> Dungeon(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</div><div class=\"line\">  Room* start_room = <span class=\"keyword\">new</span> Room(<span class=\"string\">\"Starting room\"</span>, <span class=\"string\">\"Start here\"</span>);</div><div class=\"line\">  Room* end_room = <span class=\"keyword\">new</span> Room(<span class=\"string\">\"Ending room\"</span>, <span class=\"string\">\"End here\"</span>);</div><div class=\"line\">  Player* stats_hero = <span class=\"keyword\">new</span> Player(<span class=\"string\">\"Mike\"</span>, start_room);</div><div class=\"line\">  Item* weapon_x = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"weaponx\"</span>, Item::WEAPON, <span class=\"number\">20</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">  Item* armor_x = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"armorx\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">20</span>, <span class=\"number\">10</span>);</div><div class=\"line\"></div><div class=\"line\">  start_room-&gt;link(<span class=\"string\">'e'</span>, *end_room);</div><div class=\"line\">  end_room-&gt;link(<span class=\"string\">'w'</span>, *start_room);</div><div class=\"line\">  start_room-&gt;setItem(weapon_x);</div><div class=\"line\">  end_room-&gt;setItem(armor_x);</div><div class=\"line\">  status_test-&gt;addRoom(start_room);</div><div class=\"line\">  status_test-&gt;addRoom(end_room);</div><div class=\"line\">  status_test-&gt;addPlayer(stats_hero);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// The stats reported are the following</span></div><div class=\"line\">  <span class=\"comment\">/*</span></div><div class=\"line\">     1. Hp</div><div class=\"line\">     2. Strength</div><div class=\"line\">     3. Defence</div><div class=\"line\">     4. Location</div><div class=\"line\">     5. Name</div><div class=\"line\">     6. Weapon</div><div class=\"line\">     7. Armor</div><div class=\"line\">   */</div><div class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> stat_total = <span class=\"number\">7</span>;</div><div class=\"line\">  <span class=\"built_in\">string</span>* status_before_weapon = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[stat_total];</div><div class=\"line\">  <span class=\"built_in\">string</span>* status_with_weapon = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[stat_total];</div><div class=\"line\">  <span class=\"built_in\">string</span>* status_with_armor = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[stat_total];</div><div class=\"line\"></div><div class=\"line\">  status_before_weapon[<span class=\"number\">0</span>] = <span class=\"string\">\"Current HP: 10 out of 10\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">1</span>] = <span class=\"string\">\"Current Strength: 2\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">2</span>] = <span class=\"string\">\"Current Defence: 2\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">3</span>] = <span class=\"string\">\"Current Location: Starting room\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">4</span>] = <span class=\"string\">\"Current Name: Mike\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">5</span>] = <span class=\"string\">\"Current Weapon: none equipped\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">6</span>] = <span class=\"string\">\"Current Armor: none equipped\"</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(status_before_weapon = status_test-&gt;playerStatus(*stats_hero));</div><div class=\"line\"></div><div class=\"line\">  stats_hero-&gt;equip(<span class=\"string\">\"weaponx\"</span>);</div><div class=\"line\"></div><div class=\"line\">  status_with_weapon[<span class=\"number\">0</span>] = <span class=\"string\">\"Current HP: 10 out of 10\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">1</span>] = <span class=\"string\">\"Current Strength: 20\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">2</span>] = <span class=\"string\">\"Current Defence: 2\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">3</span>] = <span class=\"string\">\"Current Location: Starting room\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">4</span>] = <span class=\"string\">\"Current Name: Mike\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">5</span>] = <span class=\"string\">\"Current Weapon: weaponx\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">6</span>] = <span class=\"string\">\"Current Armor: none equipped\"</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(status_with_weapon = status_test-&gt;playerStatus(*stats_hero));</div><div class=\"line\"></div><div class=\"line\">  stats_hero-&gt;move(<span class=\"string\">'e'</span>);</div><div class=\"line\">  stats_hero-&gt;equip(<span class=\"string\">\"armorx\"</span>);</div><div class=\"line\"></div><div class=\"line\">  status_with_armor[<span class=\"number\">0</span>] = <span class=\"string\">\"Current HP: 10 out of 20\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">1</span>] = <span class=\"string\">\"Current Strength: 20\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">2</span>] = <span class=\"string\">\"Current Defence: 20\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">3</span>] = <span class=\"string\">\"Current Location: Ending room\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">4</span>] = <span class=\"string\">\"Current Name: Mike\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">5</span>] = <span class=\"string\">\"Current Weapon: weaponx\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">6</span>] = <span class=\"string\">\"Current Armor: armorx\"</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(status_with_armor = status_test-&gt;playerStatus(*stats_hero));</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Now we can write out the methods for the dungeon class itself. Go open up the file “database.cpp” and add the lines below to the file, remember to start at the line of code indicated in the margins.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div></pre></td><td class=\"code\"><pre><div class=\"line\">Dungeon::Dungeon( <span class=\"keyword\">int</span> maxPlayers, <span class=\"keyword\">int</span> maxRooms )  : mMaxPlayers(maxPlayers), mMaxRooms(maxRooms)</div><div class=\"line\">&#123;</div><div class=\"line\">  mRooms.reserve( maxRooms ) ;</div><div class=\"line\">  mPlayers.reserve( maxPlayers ) ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">bool</span> Dungeon::isComplete( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">bool</span> flag = <span class=\"literal\">true</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; mRooms.size() ; ++i )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( mRooms[i]-&gt;mMonsters.empty() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">continue</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      flag = <span class=\"literal\">false</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> flag ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Dungeon::addPlayer( Player *newPlayer )</div><div class=\"line\">&#123;</div><div class=\"line\">  mPlayers.push_back( newPlayer ) ;</div><div class=\"line\">  <span class=\"built_in\">string</span> response = <span class=\"string\">\"The player named \"</span> + newPlayer-&gt;getName() + <span class=\"string\">\" entered the Dungeon\"</span> ;</div><div class=\"line\"></div><div class=\"line\">  generatePlayerStats( newPlayer ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Dungeon::generatePlayerStats( Player* newPlayer )</div><div class=\"line\">&#123;</div><div class=\"line\">  newPlayer-&gt;mMaxHp = <span class=\"number\">10</span> ;</div><div class=\"line\">  newPlayer-&gt;setHp( newPlayer-&gt;mMaxHp ) ;</div><div class=\"line\">  newPlayer-&gt;setStrength( <span class=\"number\">2</span> ) ;</div><div class=\"line\">  newPlayer-&gt;setDefence( <span class=\"number\">2</span> ) ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Dungeon::addRoom( Room *newRoom )</div><div class=\"line\">&#123;</div><div class=\"line\">  mRooms.push_back( newRoom ) ;</div><div class=\"line\">  <span class=\"built_in\">string</span> response = <span class=\"string\">\"The room: \"</span> + newRoom-&gt;mName + <span class=\"string\">\" was added\"</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Dungeon::removePlayer( <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> playerName )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">string</span> response = playerName + <span class=\"string\">\" has left the dungeon\"</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; mPlayers.size() ; ++i )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( playerName == mPlayers[i]-&gt;getName() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      mPlayers.erase( mPlayers.begin() + i ) ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">//Should change this to have the monstersName as an argument</span></div><div class=\"line\"><span class=\"keyword\">void</span> Dungeon::combatLoop( Player&amp; hero, Monster&amp; villain )</div><div class=\"line\">&#123;</div><div class=\"line\">  villain.inCombat = <span class=\"literal\">true</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">while</span>( <span class=\"literal\">true</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; hero.attack( villain.getName() ) &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">    <span class=\"keyword\">if</span>( villain.getHp() &lt;= <span class=\"number\">0</span> )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; villain.getName() + <span class=\"string\">\" was slain by the valiant \"</span> &lt;&lt; hero.getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">      hero.mLocation-&gt;killMonster( villain.getName() ) ;</div><div class=\"line\">      <span class=\"keyword\">return</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">int</span> damage = <span class=\"number\">0</span> ;</div><div class=\"line\">      damage = villain.getStrength() - hero.getDefence() ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>( damage &gt; <span class=\"number\">0</span> )</div><div class=\"line\">      &#123;</div><div class=\"line\">        hero.setHp( hero.getHp() - damage ) ;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; hero.getName() + <span class=\"string\">\" was dealt \"</span> &lt;&lt; damage &lt;&lt; <span class=\"string\">\" damage\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">else</span></div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; hero.getName() + <span class=\"string\">\" dodged the attack\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>( hero.death() )</div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; hero.getName() + <span class=\"string\">\" was slain by the horrible \"</span> + villain.getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span>* Dungeon::playerStatus( Player&amp; player )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">stringstream</span> ss ;</div><div class=\"line\">  <span class=\"built_in\">string</span> temp ;</div><div class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> statusCount = <span class=\"number\">7</span> ;</div><div class=\"line\">  <span class=\"built_in\">string</span>* response = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[statusCount] ;</div><div class=\"line\"></div><div class=\"line\">  ss &lt;&lt; player.getHp() ;</div><div class=\"line\">  ss &gt;&gt; temp ;</div><div class=\"line\">  response[<span class=\"number\">0</span>] = <span class=\"string\">\"Current HP: \"</span> + temp ;</div><div class=\"line\">  ss.clear() ;</div><div class=\"line\">  temp.clear() ;</div><div class=\"line\">  ss &lt;&lt; player.mMaxHp ;</div><div class=\"line\">  ss &gt;&gt; temp ;</div><div class=\"line\">  response[<span class=\"number\">0</span>] = response[<span class=\"number\">0</span>] + <span class=\"string\">\" out of \"</span> + temp ;</div><div class=\"line\">  temp.clear() ;</div><div class=\"line\">  ss.clear() ;</div><div class=\"line\"></div><div class=\"line\">  ss &lt;&lt; player.getStrength() ;</div><div class=\"line\">  ss &gt;&gt; temp ;</div><div class=\"line\">  response[<span class=\"number\">1</span>] = <span class=\"string\">\"Current Strength: \"</span> + temp ;</div><div class=\"line\">  ss.clear() ;</div><div class=\"line\">  temp.clear() ;</div><div class=\"line\"></div><div class=\"line\">  ss &lt;&lt; player.getDefence() ;</div><div class=\"line\">  ss &gt;&gt; temp ;</div><div class=\"line\">  response[<span class=\"number\">2</span>] = <span class=\"string\">\"Current Defence: \"</span> + temp ;</div><div class=\"line\">  ss.clear() ;</div><div class=\"line\">  temp.clear() ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == player.mLocation )</div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">3</span>] = <span class=\"string\">\"Error: BAD LOCATION\"</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">3</span>] = <span class=\"string\">\"Current Location: \"</span> + player.getLocation() ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  response[<span class=\"number\">4</span>] = <span class=\"string\">\"Current Name: \"</span> + player.getName() ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == player.mWeapon )</div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">5</span>] = <span class=\"string\">\"Current Weapon: none equipped\"</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">5</span>] = <span class=\"string\">\"Current Weapon: \"</span> + player.mWeapon-&gt;getName() ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == player.mArmor )</div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">6</span>] = <span class=\"string\">\"Current Armor: none equipped\"</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">6</span>] = <span class=\"string\">\"Current Armor: \"</span> + player.mArmor-&gt;getName() ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Dungeon::displayHelp( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"////////////////\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Help menu\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"////////////////\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Attack a monster type -&gt; a:monster_name_here\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Move to a new location type -&gt; mv:location_name_here\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Look for items type -&gt; find:\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Search the room for exits and monsters type -&gt; loc:\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Equip new items type -&gt; eq:weapon_or_armor_name\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"See your current status type -&gt; you:\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next class we have to test is the filter class, if you recall from previous parts, the filter class’ job is to validate user input to check if it is safe to “dispatch” to the database. You can think of the filter as a sanitizer for bad commands just like you can image a filter swearing words on message boards. Now go open up “test.h” and add the following line.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_filter_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div></pre></td></tr></table></figure>\n<p>You know the drill, create the test methods within the file “test.cpp” for the filter class(don’t worry this class is short).</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_filter_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Filter chat test</span></div><div class=\"line\">  <span class=\"comment\">// string Filter::chat() just truncates the command from the  //fromchat message if it was t:message  Filter filter;</span></div><div class=\"line\">  <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">input</span><span class=\"params\">(<span class=\"string\">\"t:Hello world\"</span>)</span></span>;</div><div class=\"line\">  <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">response</span><span class=\"params\">(<span class=\"string\">\"Hello world\"</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(response == filter.chat(input));</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Filter validateMessage test</span></div><div class=\"line\">  <span class=\"comment\">/*</span></div><div class=\"line\">     The valid commands are the following</div><div class=\"line\">    a:</div><div class=\"line\">    mv:</div><div class=\"line\">    find:</div><div class=\"line\">    loc:</div><div class=\"line\">    eq:</div><div class=\"line\">    you:</div><div class=\"line\">    help:</div><div class=\"line\">   */</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"mv:n\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"a:goblin\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"find:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"loc:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"eq:weapon\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"you:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"help:\"</span>));</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"move:north\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"move:south\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"move:east\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"move:west\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"attack:goblin\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"fid:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"location:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"eqip:weapon\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"me:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"zelpeafaf:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"gg:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"Pi:affg\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"Eqip:weapon\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"Ye:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"no command input\"</span>));</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>There are only two methods for the filter class, chat and validate message. As you can probably guess, chat just sends out the text following the chat command “t:”. However validate message a bit more involved. Validate message works by running three distinct test, the “keywordtest” the “commandtest” and the movecommandtest”. Keyword just makes sure that the user entered a keyword such as “a:” for attack, “you:” for player status or any of the others. The “commandtest” just checks after the keyword has been validated that the fullname of the command matches the possible command inputs. Lastly the “movecommandtest” ensures that the direction of travel for the move command is north, south, east or west. So go open up “database.cpp” and add the lines below paying attention to which line the code begins on as shown in the margin.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div></pre></td><td class=\"code\"><pre><div class=\"line\">Filter::valid Filter::validateMessage( <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> message )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">//Necessary for the std::tolower() method</span></div><div class=\"line\">  locale loc ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; message.length() ; ++i )</div><div class=\"line\">  &#123;</div><div class=\"line\">    message [ i ] = <span class=\"built_in\">tolower</span>( message[ i ], loc ) ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">bool</span> keywordTest = <span class=\"literal\">false</span> ;  <span class=\"keyword\">bool</span> commandTest = <span class=\"literal\">false</span> ;  <span class=\"keyword\">bool</span> moveCommandTest = <span class=\"literal\">true</span> ; <span class=\"comment\">// Checks for a valid direction</span></div><div class=\"line\">  <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> inputIndex = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">switch</span>( message[ <span class=\"number\">0</span> ] )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'a'</span>: <span class=\"comment\">//Attack  case 'm': //Move</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'f'</span>: <span class=\"comment\">//Find</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'l'</span>: <span class=\"comment\">//Location</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'e'</span>: <span class=\"comment\">//Equip</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'y'</span>: <span class=\"comment\">//You</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'t'</span>: <span class=\"comment\">//Talk</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'h'</span>: <span class=\"comment\">//Help Menu</span></div><div class=\"line\">      keywordTest = <span class=\"literal\">true</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;<span class=\"keyword\">break</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">default</span>:</div><div class=\"line\">        keywordTest = <span class=\"literal\">false</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"literal\">false</span> == keywordTest )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">string</span> subMessage ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; message.size() ; ++i )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( message[ i ] == <span class=\"string\">':'</span> )</div><div class=\"line\">    &#123;</div><div class=\"line\">      inputIndex = i;</div><div class=\"line\">      subMessage += message[ i ] ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      subMessage += message[ i ] ;</div><div class=\"line\">      <span class=\"keyword\">continue</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( subMessage == <span class=\"string\">\"a:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"mv:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"find:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"loc:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"eq:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"you:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"t:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"help:\"</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    commandTest = <span class=\"literal\">true</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( subMessage == <span class=\"string\">\"mv:\"</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"comment\">//Checks if a direction was entered by the player,</span></div><div class=\"line\">    <span class=\"comment\">// accomplishes this by seeing if the mv: command</span></div><div class=\"line\">    <span class=\"comment\">// is followed by at most a single character representing</span></div><div class=\"line\">    <span class=\"comment\">// the directions 'n' or 'e' or 'w' or 's'</span></div><div class=\"line\">    <span class=\"keyword\">if</span>( inputIndex + <span class=\"number\">1</span> == message.size() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      moveCommandTest = <span class=\"literal\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span>( inputIndex &lt; message.size() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>( <span class=\"literal\">false</span> == moveCommandTest )</div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>(message[ inputIndex ] == <span class=\"string\">' '</span>)</div><div class=\"line\">      &#123;</div><div class=\"line\">        moveCommandTest = <span class=\"literal\">false</span>;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      ++inputIndex ;</div><div class=\"line\">    &#125;inputIndex</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"literal\">true</span> == commandTest &amp;&amp; <span class=\"literal\">true</span> == keywordTest &amp;&amp; <span class=\"literal\">true</span> == moveCommandTest )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Filter::chat( <span class=\"built_in\">string</span> message )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> message.substr( <span class=\"number\">2</span>, message.length() ) ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The dispatch class is the last class we need for thesingle player version of the game. Being the dispatchits sole purpose is to separate the value and command fromthe filtered user input and “dispatch” it to the database.Now lets open up “test.h” and add the line below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_dispatch_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div></pre></td></tr></table></figure></p>\n<p>Next we’ll write out the test for the dispatch class within “test.cpp”, so go open that file and insert the code below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_dispatch_class()</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Dispatch extractCommand test</span></div><div class=\"line\">  <span class=\"comment\">//a Attack  //m Move</span></div><div class=\"line\">  <span class=\"comment\">//f Find</span></div><div class=\"line\">  <span class=\"comment\">//l Location</span></div><div class=\"line\">  <span class=\"comment\">//e Equip</span></div><div class=\"line\">  <span class=\"comment\">//y You</span></div><div class=\"line\">  <span class=\"comment\">//t Talk</span></div><div class=\"line\">  <span class=\"comment\">//h Help Menu</span></div><div class=\"line\">  Dispatch dispatch;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">'a'</span> == dispatch.extractCommand(<span class=\"string\">\"a:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'m'</span> == dispatch.extractCommand(<span class=\"string\">\"mv:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'f'</span> == dispatch.extractCommand(<span class=\"string\">\"find:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'l'</span> == dispatch.extractCommand(<span class=\"string\">\"loc:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'e'</span> == dispatch.extractCommand(<span class=\"string\">\"eq:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'y'</span> == dispatch.extractCommand(<span class=\"string\">\"you:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'t'</span> == dispatch.extractCommand(<span class=\"string\">\"t:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'h'</span> == dispatch.extractCommand(<span class=\"string\">\"help:\"</span>));</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dispatch extractValue test</span></div><div class=\"line\">  <span class=\"comment\">/*</span></div><div class=\"line\">     The only commands that take values.</div><div class=\"line\"></div><div class=\"line\">     attack  move  equip</div><div class=\"line\">     talk  */</div><div class=\"line\">  assert(<span class=\"string\">\"goblin\"</span> == dispatch.extractValue(<span class=\"string\">\"a:goblin\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">\"north\"</span> == dispatch.extractValue(<span class=\"string\">\"mv:north\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">\"armor\"</span> == dispatch.extractValue(<span class=\"string\">\"eq:armor\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">\"hello world\"</span> == dispatch.extractValue(<span class=\"string\">\"t:hello world\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">\"  s p a c  e  s  \"</span> == dispatch.extractValue(</div><div class=\"line\">        <span class=\"string\">\"t:  s p a c  e  s  \"</span>));</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now we can add the methods for the dispatch class to our “database.cpp”file. Open up the file “database.cpp” and add the lines below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">char</span> Dispatch::extractCommand(<span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> fromFilter)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">//a Attack  //m Move</span></div><div class=\"line\">  <span class=\"comment\">//f Find</span></div><div class=\"line\">  <span class=\"comment\">//l Location</span></div><div class=\"line\">  <span class=\"comment\">//e Equip</span></div><div class=\"line\">  <span class=\"comment\">//y You</span></div><div class=\"line\">  <span class=\"comment\">//t Talk</span></div><div class=\"line\">  <span class=\"comment\">//h Help Menu</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> fromFilter[ <span class=\"number\">0</span> ] ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Dispatch::extractValue(<span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> fromFilter)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">/*</span></div><div class=\"line\">     The value of the string from the filter is all of the text</div><div class=\"line\">     that follows the command.</div><div class=\"line\"></div><div class=\"line\">     -Example-</div><div class=\"line\">a:goblin</div><div class=\"line\"></div><div class=\"line\">The command is a:</div><div class=\"line\">The value is goblin</div><div class=\"line\">   */</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// For single character commands such as t:</span></div><div class=\"line\">  <span class=\"keyword\">if</span>( fromFilter[ <span class=\"number\">1</span> ] == <span class=\"string\">':'</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> fromFilter.substr( <span class=\"number\">2</span>, fromFilter.length() ) ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> fromFilter.substr( <span class=\"number\">3</span>, fromFilter.length() ) ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The last thing we have to do before we can call our single player version of the game complete is to make sure all the test pass with flying colors. Beingthat we only implemented unit test, you will be notified when a test failsby the console giving you a “assertion failed at line:XYZ” where XYZ is the line number. So open up “main.cpp” and make sure it looks like the code below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Filename main.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Database.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"Test.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">run_test</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Ignore the combat printouts from the\\n\"</span>;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"test_dungeon_class() method\\n\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"></div><div class=\"line\">  Test::get_instance()-&gt;test_item_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_monster_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_room_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_player_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_dungeon_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_filter_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_dispatch_class();</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">run_sample_game</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">  run_test();</div><div class=\"line\">  <span class=\"comment\">//run_sample_game();</span></div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">run_sample_game</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">//Construct Dungeon</span></div><div class=\"line\">  <span class=\"function\">Dungeon <span class=\"title\">caves</span><span class=\"params\">( <span class=\"number\">2</span>, <span class=\"number\">21</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Items power vitality health</span></div><div class=\"line\">  Item* herb_a = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_b = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_c = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_d = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_e = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_f = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_g = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  Item* woodsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"woodsword\"</span>, Item::WEAPON, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* steelblade = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"steelblade\"</span>, Item::WEAPON, <span class=\"number\">20</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* crystalsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"crystalsword\"</span>, Item::WEAPON, <span class=\"number\">35</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* genjiblade = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"genjiblade\"</span>, Item::WEAPON, <span class=\"number\">60</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* angelicsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"angelicsword\"</span>, Item::WEAPON, <span class=\"number\">80</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* finalweapon = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"dragonslayer\"</span>, Item::WEAPON, <span class=\"number\">2000</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  Item* woodarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"woodarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">5</span>, <span class=\"number\">15</span> ) ;</div><div class=\"line\">  Item* steelarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"steelarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">7</span>, <span class=\"number\">20</span> ) ;</div><div class=\"line\">  Item* diamondarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"diamondarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">12</span>, <span class=\"number\">30</span> ) ;</div><div class=\"line\">  Item* crystalarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"crystalarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">15</span>, <span class=\"number\">35</span> ) ;</div><div class=\"line\">  Item* dragonarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"dragonarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">20</span>, <span class=\"number\">100</span> ) ;</div><div class=\"line\">  Item* ultimatearmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"ultimatearmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">1000</span>, <span class=\"number\">1000</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Monsters hp str def</span></div><div class=\"line\">  Monster* bear = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"bear\"</span>, <span class=\"number\">15</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span> ) ;</div><div class=\"line\">  Monster* goblin = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"goblin\"</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">  Monster* imp = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"imp\"</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span>, <span class=\"number\">2</span> ) ;</div><div class=\"line\">  Monster* redgoblin = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"redgoblin\"</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span> ) ;</div><div class=\"line\">  Monster* demon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"demon\"</span>, <span class=\"number\">6</span>, <span class=\"number\">3</span>, <span class=\"number\">7</span> ) ;</div><div class=\"line\">  Monster* zergling = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"zergling\"</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">9</span> ) ;</div><div class=\"line\">  Monster* bats = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"bats\"</span>, <span class=\"number\">20</span>, <span class=\"number\">15</span>, <span class=\"number\">3</span> ) ;</div><div class=\"line\">  Monster* morebats = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"morebats\"</span>, <span class=\"number\">25</span>, <span class=\"number\">20</span>, <span class=\"number\">15</span> ) ;</div><div class=\"line\">  Monster* golem = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"golem\"</span>, <span class=\"number\">50</span>, <span class=\"number\">21</span>, <span class=\"number\">9</span> ) ;</div><div class=\"line\">  Monster* goatdemon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"goatdemon\"</span>, <span class=\"number\">100</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span> ) ;</div><div class=\"line\">  Monster* cyclops = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"cyclops\"</span>, <span class=\"number\">150</span>, <span class=\"number\">90</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Monster* behemoth = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"behemoth\"</span>, <span class=\"number\">250</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span> ) ;</div><div class=\"line\">  Monster* alien = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"alien\"</span>, <span class=\"number\">50</span>, <span class=\"number\">21</span>, <span class=\"number\">4</span> ) ;</div><div class=\"line\">  Monster* giantrat = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"giantrat\"</span>, <span class=\"number\">55</span>, <span class=\"number\">40</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">  Monster* fallenangel = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"fallenangel\"</span>, <span class=\"number\">300</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span> ) ;</div><div class=\"line\">  Monster* greatdragon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"greatdragon\"</span>, <span class=\"number\">500</span>, <span class=\"number\">300</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">  Monster* invincibledragon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"invincibledragon\"</span>, <span class=\"number\">999</span>, <span class=\"number\">999</span>, <span class=\"number\">999</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Rooms name description item</span></div><div class=\"line\">  Room* mainHall = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The main cavern\"</span>, <span class=\"string\">\"A murkey swamp cavern\"</span>, woodsword ) ;</div><div class=\"line\">  Room* river = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The black river\"</span>, <span class=\"string\">\"A river with dark water\"</span>, woodarmor ) ;</div><div class=\"line\">  Room* greencave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The greencave\"</span>, <span class=\"string\">\"A moss covered cave\"</span>, herb_a ) ;</div><div class=\"line\">  Room* bluecave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The bluecave\"</span>, <span class=\"string\">\"A frosty cave\"</span>, steelblade ) ;</div><div class=\"line\">  Room* darkpit = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The darkpit\"</span>, <span class=\"string\">\"An endless hole lies before you\"</span>, steelarmor ) ;</div><div class=\"line\">  Room* morbidfield = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The morbidfield\"</span>, <span class=\"string\">\"Pitch black grass surrounds you\"</span>, herb_b ) ;</div><div class=\"line\">  Room* graveyard = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The graveyard\"</span>, <span class=\"string\">\"Tombstones abound\"</span>, diamondarmor ) ;</div><div class=\"line\">  Room* crypt = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The crypt\"</span>, <span class=\"string\">\"A nasty rotten crypt\"</span>, crystalsword ) ;</div><div class=\"line\">  Room* evilpassage = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The evil passage\"</span>, <span class=\"string\">\"An evil pasage\"</span>, crystalarmor ) ;</div><div class=\"line\">  Room* darklair = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dark lair\"</span>, <span class=\"string\">\"A dark lair\"</span>, herb_c ) ;</div><div class=\"line\">  Room* firepit = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The firey pits\"</span>, <span class=\"string\">\"Fire is every where\"</span>, herb_d ) ;</div><div class=\"line\">  Room* greenpasture = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The greenpastures\"</span>, <span class=\"string\">\"A meadow is before you\"</span>, genjiblade ) ;</div><div class=\"line\">  Room* icecave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The icy caves\"</span>, <span class=\"string\">\"Ice everywhere you look\"</span>, herb_e ) ;</div><div class=\"line\">  Room* livingroom = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The living room\"</span>, <span class=\"string\">\"The room is alive\"</span>, dragonarmor ) ;</div><div class=\"line\">  Room* cellar = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The cellar\"</span>, <span class=\"string\">\"A dirty cellar filled with rats\"</span>, angelicsword ) ;</div><div class=\"line\">  Room* lifespring = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The lifespring\"</span>, <span class=\"string\">\"A beautiful fountain stands\"</span>, herb_f ) ;</div><div class=\"line\">  Room* waterfall = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The waterfall\"</span>, <span class=\"string\">\"Clear blue water falls\"</span>, herb_g ) ;</div><div class=\"line\">  Room* hellsgate = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The gates of hell\"</span>, <span class=\"string\">\"Large rusty doors lead to hell\"</span>, ultimatearmor ) ;</div><div class=\"line\">  Room* dragoncave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dragon's cave\"</span>, <span class=\"string\">\"An ancient cave...\"</span> ) ;</div><div class=\"line\">  Room* dragonsden = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dragon's den\"</span>, <span class=\"string\">\"A powerful monster awaits\"</span> ) ;</div><div class=\"line\">  Room* lostforest = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The secret forest\"</span>, <span class=\"string\">\"The strongest sword lies hidden here\"</span>, finalweapon ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Link Rooms</span></div><div class=\"line\">  mainHall-&gt;link( <span class=\"string\">'e'</span>, *river ) ;</div><div class=\"line\">  river-&gt;link( <span class=\"string\">'s'</span>, *greencave ) ;</div><div class=\"line\">  river-&gt;link( <span class=\"string\">'e'</span>, *bluecave ) ;</div><div class=\"line\">  river-&gt;link( <span class=\"string\">'w'</span>, *mainHall ) ;</div><div class=\"line\">  greencave-&gt;link( <span class=\"string\">'n'</span>, *river ) ;</div><div class=\"line\">  bluecave-&gt;link( <span class=\"string\">'w'</span>, *river ) ;</div><div class=\"line\">  bluecave-&gt;link( <span class=\"string\">'n'</span>, *darkpit ) ;</div><div class=\"line\">  darkpit-&gt;link( <span class=\"string\">'s'</span>, *bluecave ) ;</div><div class=\"line\">  darkpit-&gt;link( <span class=\"string\">'n'</span>, *morbidfield ) ;</div><div class=\"line\">  morbidfield-&gt;link( <span class=\"string\">'s'</span>, *darkpit ) ;</div><div class=\"line\">  morbidfield-&gt;link( <span class=\"string\">'e'</span>, *graveyard ) ;</div><div class=\"line\">  graveyard-&gt;link( <span class=\"string\">'w'</span>, *morbidfield ) ;</div><div class=\"line\">  graveyard-&gt;link( <span class=\"string\">'n'</span>, *crypt ) ;</div><div class=\"line\">  graveyard-&gt;link( <span class=\"string\">'e'</span>, *evilpassage ) ;</div><div class=\"line\">  crypt-&gt;link( <span class=\"string\">'s'</span>, *graveyard ) ;</div><div class=\"line\">  evilpassage-&gt;link( <span class=\"string\">'w'</span>, *graveyard ) ;</div><div class=\"line\">  evilpassage-&gt;link( <span class=\"string\">'s'</span>, *darklair ) ;</div><div class=\"line\">  darklair-&gt;link( <span class=\"string\">'n'</span>, *evilpassage ) ;</div><div class=\"line\">  darklair-&gt;link( <span class=\"string\">'s'</span>, *firepit ) ;</div><div class=\"line\">  firepit-&gt;link( <span class=\"string\">'n'</span>, *darklair ) ;</div><div class=\"line\">  firepit-&gt;link( <span class=\"string\">'e'</span>, *greenpasture ) ;</div><div class=\"line\">  greenpasture-&gt;link( <span class=\"string\">'w'</span>, *firepit ) ;</div><div class=\"line\">  greenpasture-&gt;link( <span class=\"string\">'s'</span>, *icecave ) ;</div><div class=\"line\">  greenpasture-&gt;link( <span class=\"string\">'e'</span>, *livingroom ) ;</div><div class=\"line\">  icecave-&gt;link( <span class=\"string\">'n'</span>, *greenpasture ) ;</div><div class=\"line\">  livingroom-&gt;link( <span class=\"string\">'w'</span>, *greenpasture ) ;</div><div class=\"line\">  livingroom-&gt;link( <span class=\"string\">'e'</span>, *cellar ) ;</div><div class=\"line\">  cellar-&gt;link( <span class=\"string\">'w'</span>, *livingroom ) ;</div><div class=\"line\">  cellar-&gt;link( <span class=\"string\">'n'</span>, *lifespring ) ;</div><div class=\"line\">  cellar-&gt;link( <span class=\"string\">'e'</span>, *hellsgate ) ;</div><div class=\"line\">  lifespring-&gt;link( <span class=\"string\">'s'</span>, *cellar ) ;</div><div class=\"line\">  lifespring-&gt;link( <span class=\"string\">'n'</span>, *waterfall ) ;</div><div class=\"line\">  waterfall-&gt;link( <span class=\"string\">'s'</span>, *lifespring ) ;</div><div class=\"line\">  hellsgate-&gt;link( <span class=\"string\">'w'</span>, *cellar ) ;</div><div class=\"line\">  hellsgate-&gt;link( <span class=\"string\">'e'</span>, *dragoncave ) ;</div><div class=\"line\">  dragoncave-&gt;link( <span class=\"string\">'w'</span>, *hellsgate ) ;</div><div class=\"line\">  dragoncave-&gt;link( <span class=\"string\">'e'</span>, *dragonsden ) ;</div><div class=\"line\">  dragonsden-&gt;link( <span class=\"string\">'w'</span>, *dragoncave ) ;</div><div class=\"line\">  dragonsden-&gt;link( <span class=\"string\">'e'</span>, *lostforest ) ;</div><div class=\"line\">  lostforest-&gt;link( <span class=\"string\">'w'</span>, *dragonsden ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Add monsters to rooms</span></div><div class=\"line\">  mainHall-&gt;addMonster( goblin ) ;</div><div class=\"line\">  mainHall-&gt;addMonster( imp ) ;</div><div class=\"line\">  river-&gt;addMonster( bear ) ;</div><div class=\"line\">  river-&gt;addMonster( redgoblin ) ;</div><div class=\"line\">  bluecave-&gt;addMonster( demon ) ;</div><div class=\"line\">  bluecave-&gt;addMonster( zergling ) ;</div><div class=\"line\">  morbidfield-&gt;addMonster( bats ) ;</div><div class=\"line\">  morbidfield-&gt;addMonster( morebats ) ;</div><div class=\"line\">  graveyard-&gt;addMonster( golem ) ;</div><div class=\"line\">  evilpassage-&gt;addMonster( goatdemon ) ;</div><div class=\"line\">  firepit-&gt;addMonster( cyclops ) ;</div><div class=\"line\">  greenpasture-&gt;addMonster( behemoth ) ;</div><div class=\"line\">  livingroom-&gt;addMonster( alien ) ;</div><div class=\"line\">  cellar-&gt;addMonster( giantrat ) ;</div><div class=\"line\">  hellsgate-&gt;addMonster( fallenangel ) ;</div><div class=\"line\">  dragoncave-&gt;addMonster( greatdragon ) ;</div><div class=\"line\">  dragonsden-&gt;addMonster( invincibledragon ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Add the rooms to the dungeon</span></div><div class=\"line\">  caves.addRoom( mainHall ) ;</div><div class=\"line\">  caves.addRoom( river ) ;</div><div class=\"line\">  caves.addRoom( greencave ) ;</div><div class=\"line\">  caves.addRoom( bluecave ) ;</div><div class=\"line\">  caves.addRoom( darkpit ) ;</div><div class=\"line\">  caves.addRoom( morbidfield ) ;</div><div class=\"line\">  caves.addRoom( graveyard ) ;</div><div class=\"line\">  caves.addRoom( crypt ) ;</div><div class=\"line\">  caves.addRoom( evilpassage ) ;</div><div class=\"line\">  caves.addRoom( darklair ) ;</div><div class=\"line\">  caves.addRoom( firepit ) ;</div><div class=\"line\">  caves.addRoom( greenpasture ) ;</div><div class=\"line\">  caves.addRoom( icecave ) ;</div><div class=\"line\">  caves.addRoom( livingroom ) ;</div><div class=\"line\">  caves.addRoom( cellar ) ;</div><div class=\"line\">  caves.addRoom( lifespring ) ;</div><div class=\"line\">  caves.addRoom( waterfall ) ;</div><div class=\"line\">  caves.addRoom( hellsgate ) ;</div><div class=\"line\">  caves.addRoom( dragoncave ) ;</div><div class=\"line\">  caves.addRoom( dragonsden ) ;</div><div class=\"line\">  caves.addRoom( lostforest ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Create a filter  Filter filter ;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Create a dispatch object with a command char and a value string</span></div><div class=\"line\">  Dispatch dispatch ;</div><div class=\"line\">  <span class=\"keyword\">char</span> command ;</div><div class=\"line\">  <span class=\"built_in\">string</span> value ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Simulate a new game</span></div><div class=\"line\">  <span class=\"comment\">//Create a new player and add to the dungeon</span></div><div class=\"line\">  <span class=\"built_in\">string</span> input ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Welcome to the game\\nEnter in a new name: \"</span> ;</div><div class=\"line\">  getline(<span class=\"built_in\">cin</span>, input, <span class=\"string\">'\\n'</span>);</div><div class=\"line\"></div><div class=\"line\">  Player* one = <span class=\"keyword\">new</span> Player( input, mainHall ) ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; caves.addPlayer( one ) &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Display needed info for the players</span></div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"The objective is to clear the dungeon of all monsters. Good Luck\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Enter in a new command to start, to display help type the following command\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"help:\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"To quit simply enter \\\"quit\\\" without the quotes as a new command\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"New Command\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  getline(<span class=\"built_in\">cin</span>, input, <span class=\"string\">'\\n'</span>);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Start the game loop</span></div><div class=\"line\">  <span class=\"keyword\">while</span>( input != <span class=\"string\">\"quit\"</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"comment\">//Pass the users message through the filter</span></div><div class=\"line\">    <span class=\"keyword\">if</span>( filter.validateMessage( input ) )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//Split the users message into a command and value pair</span></div><div class=\"line\">      command = dispatch.extractCommand( input ) ;</div><div class=\"line\">      value = dispatch.extractValue( input ) ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Match the command and forward the value</span></div><div class=\"line\">      <span class=\"keyword\">switch</span>( command )</div><div class=\"line\">      &#123;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'a'</span>: <span class=\"comment\">//Attack</span></div><div class=\"line\">          <span class=\"comment\">//If the monster does not exist or the name was mispelled</span></div><div class=\"line\">          <span class=\"keyword\">if</span>( &amp;(one-&gt;mLocation-&gt;getMonsterRef( value )) == <span class=\"literal\">NULL</span> )</div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"There is no \"</span> + value + <span class=\"string\">\" at this location\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">            <span class=\"keyword\">break</span> ;</div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"comment\">//If the monster is there but in combat the player cannot fight it</span></div><div class=\"line\">          <span class=\"keyword\">if</span>( one-&gt;mLocation-&gt;getMonsterRef( value ).inCombat == <span class=\"literal\">true</span> )</div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"The \"</span> + value + <span class=\"string\">\" is currently fighting\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">            <span class=\"keyword\">break</span> ;</div><div class=\"line\">          &#125;</div><div class=\"line\"></div><div class=\"line\">          caves.combatLoop( *one, one-&gt;mLocation-&gt;getMonsterRef( value ) ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'m'</span>: <span class=\"comment\">//Move</span></div><div class=\"line\">          <span class=\"built_in\">cout</span> &lt;&lt; one-&gt;move( value[ <span class=\"number\">0</span> ] ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'f'</span>: <span class=\"comment\">//Find</span></div><div class=\"line\">          <span class=\"built_in\">cout</span> &lt;&lt; one-&gt;search() ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'l'</span>: <span class=\"comment\">//Location</span></div><div class=\"line\">          <span class=\"built_in\">cout</span> &lt;&lt; one-&gt;getLocation() ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'e'</span>: <span class=\"comment\">//Equip</span></div><div class=\"line\">          <span class=\"built_in\">cout</span> &lt;&lt; one-&gt;equip( value ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'y'</span>: <span class=\"comment\">//You</span></div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"built_in\">string</span>* playerStats = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span> ;</div><div class=\"line\">            playerStats = caves.playerStatus( *one ) ;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">for</span>( <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; <span class=\"number\">7</span> ; ++i )</div><div class=\"line\">            &#123;</div><div class=\"line\">              <span class=\"built_in\">cout</span> &lt;&lt; playerStats[i] &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">            &#125;<span class=\"built_in\">endl</span></div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">          <span class=\"comment\">//case 't': //Talk</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'h'</span>: <span class=\"comment\">//Help Menu</span></div><div class=\"line\">          caves.displayHelp();</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Invalid command please refer to the help menu.\\nhelp:\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Or type \\\"quit\\\" to quit the game\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( caves.isComplete() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Dungeon Cleared, YOU WIN!\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( one-&gt;death() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; one-&gt;getName() + <span class=\"string\">\" was slain by the \"</span> + one-&gt;mLocation-&gt;getMonsterRef( value ).getName() &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      one-&gt;mLocation-&gt;getMonsterRef( value ).inCombat = <span class=\"literal\">false</span> ;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"*Hint* Secret rooms hidden abound; find them and victory shall be yours\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      input = <span class=\"string\">\"quit\"</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//Get the next command</span></div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"\\n\\nNew Command\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      getline(<span class=\"built_in\">cin</span>, input, <span class=\"string\">'\\n'</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  caves.removePlayer( one-&gt;getName() ) ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>For reference here are all the files for the project below.If none of the dropbox links are working then mention it in the comments section and I’ll re-upload the files. </p>\n<p><br><a href=\"http://dl.dropbox.com/u/22280460/database.cpp\" target=\"_blank\" rel=\"external\">http://dl.dropbox.com/u/22280460/database.cpp</a><br><br><br><a href=\"http://dl.dropbox.com/u/22280460/database.h\" target=\"_blank\" rel=\"external\">http://dl.dropbox.com/u/22280460/database.h</a><br><br><br><a href=\"http://dl.dropbox.com/u/22280460/main.cpp\" target=\"_blank\" rel=\"external\">http://dl.dropbox.com/u/22280460/main.cpp</a><br><br><br><a href=\"http://dl.dropbox.com/u/22280460/Test.cpp\" target=\"_blank\" rel=\"external\">http://dl.dropbox.com/u/22280460/Test.cpp</a><br><br><br><a href=\"http://dl.dropbox.com/u/22280460/Test.h\" target=\"_blank\" rel=\"external\">http://dl.dropbox.com/u/22280460/Test.h</a><br></p>\n\n<p><a href=\"/2011/06/16/textbasedrpgpart6.html\">Click here for part 6</a><br><a href=\"/2011/06/16/textbasedrpgpart6\">Click here for part VI</a></p>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li><a href=\"/2011/06/11/textbasedrpgpart4\">Click here for part IV</a></li>\n<li><a href=\"/2011/06/16/textbasedrpgpart6\">Click here for part VI</a></li>\n</ul>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>The fifth part of the tutorial on creating a text based multiplayer RPG game will see us creating the last part of the testing and game mechanics before the next section where we’ll launch the client and server code to actually test our game in action.</p>\n<p>In this part of the tutorial we will complete the test and methods necessary to get the full functionality for the stand alone single player version. In the next part of the tutorial part 6, we will begin to develop both the client and server code that allows other users to connect and play our game over a local area network. So lets continue with the testing and move onto the player class. Go ahead and open up the “test.h” file and add line below.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_player_class</span><span class=\"params\">()</span></span>;</div></pre></td></tr></table></figure>\n<p>Then open up the file “test.cpp” and add the methods for the player test class beginning at the line indicated.</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div></pre></td><td class=\"code\"><pre><div class=\"line\">void Test::test_player_class(void)</div><div class=\"line\">&#123;</div><div class=\"line\">  // Player constructor w/o initial room</div><div class=\"line\">  Player no_room_player(\"hero\");</div><div class=\"line\"></div><div class=\"line\">  assert(10 == no_room_player.mMaxHp);</div><div class=\"line\">  assert(10 == no_room_player.mHp);</div><div class=\"line\">  assert(1 == no_room_player.mStrength);</div><div class=\"line\">  assert(0 == no_room_player.mDefence);</div><div class=\"line\">  assert(NULL == no_room_player.mLocation);</div><div class=\"line\">  assert(\"hero\" == no_room_player.mName);</div><div class=\"line\">  assert(NULL == no_room_player.mWeapon);</div><div class=\"line\">  assert(NULL == no_room_player.mArmor);</div><div class=\"line\"></div><div class=\"line\">  // Player constructor w/room</div><div class=\"line\">  Player room_player(\"dude\", new Room(\"Home\", \"A big house\"));</div><div class=\"line\"></div><div class=\"line\">  assert(NULL != room_player.mLocation);</div><div class=\"line\"></div><div class=\"line\">  // Player getters/setters</div><div class=\"line\">  Player get_set(\"setter\", new Room(\"Lake\", \"A clean lake\"));</div><div class=\"line\"></div><div class=\"line\">  get_set.setDefence(1);</div><div class=\"line\">  get_set.setHp(10);</div><div class=\"line\">  get_set.setName(\"getter\");</div><div class=\"line\">  get_set.setStrength(2);</div><div class=\"line\"></div><div class=\"line\">  assert(1 == get_set.getDefence());</div><div class=\"line\">  assert(10 == get_set.getHp());</div><div class=\"line\">  assert(\"getter\" == get_set.getName());</div><div class=\"line\">  assert(2 == get_set.getStrength());</div><div class=\"line\">  assert(\"Lake\" == get_set.getLocation());</div><div class=\"line\"></div><div class=\"line\">  // Player equip test</div><div class=\"line\">  // The Item is not found</div><div class=\"line\">  // - There is no item within the room \"There is no item to equip in this rooom\"</div><div class=\"line\">  // - The player misspelled the item name \"To equip an item you must type its full name correctly\"</div><div class=\"line\">  Room no_item_room(\"Itemless\", \"There is no item here\");</div><div class=\"line\">  Player no_item_player(\"Hi\");</div><div class=\"line\">  no_item_player.mLocation = &amp;no_item_room;</div><div class=\"line\">  string response(\"There is no item to equip in this room\");</div><div class=\"line\"></div><div class=\"line\">  assert(response == no_item_player.equip(\"Bad Item name\"));</div><div class=\"line\"></div><div class=\"line\">  Room with_item(\"Item room\", \"Item filled room\", new Item(\"dagger\", Item::WEAPON, 10, 0, 0));</div><div class=\"line\">  no_item_player.mLocation = &amp;with_item;</div><div class=\"line\">  response = \"To equip an item you must type its full name correctly\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == no_item_player.equip(\"daggers\"));</div><div class=\"line\"></div><div class=\"line\">  // Weapon is found</div><div class=\"line\">  // - The weapon becomes unavailable</div><div class=\"line\">  // - The players strength is set equal to the weapons power value</div><div class=\"line\">  // - The response returned is \"You equipped the Item.mName\"      Player item_player(\"Bye\", &amp;with_item);</div><div class=\"line\">  response = \"You equipped the dagger\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == item_player.equip(\"dagger\"));</div><div class=\"line\">  assert(false == with_item.mItem-&gt;mAvailiable);</div><div class=\"line\">  assert(with_item.mItem-&gt;getPower() == item_player.getStrength());</div><div class=\"line\"></div><div class=\"line\">  // Armor is found</div><div class=\"line\">  // - The armor becomes unavailable</div><div class=\"line\">  // - The players vitality is set equal to the armor's defence  // - The response returned is \"You equipped the Item.mName\"</div><div class=\"line\">  // - The armor's health value is added to the players max hp</div><div class=\"line\">  Item* steel_plate = new Item(\"steelplate\", Item::ARMOR, 0, 10, 20);</div><div class=\"line\">  with_item.setItem(steel_plate);</div><div class=\"line\">  response = \"You equipped the steelplate\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == item_player.equip(\"steelplate\"));</div><div class=\"line\">  assert(with_item.mItem-&gt;mAvailiable == false);</div><div class=\"line\">  assert(steel_plate-&gt;getHealth() + item_player.getHp()</div><div class=\"line\">      == item_player.mMaxHp);</div><div class=\"line\">  assert(with_item.mItem-&gt;getVitality() == item_player.getDefence());</div><div class=\"line\"></div><div class=\"line\">  // Health is found</div><div class=\"line\">  // - The health item becomes unavailable</div><div class=\"line\">  // - The player's hp is fully restored</div><div class=\"line\">  // - The response is \"You were healed\"</div><div class=\"line\">  Item* herb = new Item(\"herbs\", Item::HEALTH, 0, 0, 0);</div><div class=\"line\">  with_item.setItem(herb);</div><div class=\"line\">  response = \"You were healed\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == item_player.equip(\"herbs\"));</div><div class=\"line\">  assert(with_item.mItem-&gt;mAvailiable == false);</div><div class=\"line\">  assert(item_player.getHp() == item_player.mMaxHp);</div><div class=\"line\"></div><div class=\"line\">  // Player attack test</div><div class=\"line\">  // a- There are no monsters within the Room then the method should  //methodreturn \"There are no monsters in this room to fight\"</div><div class=\"line\">  // b- The player mis-typed the monster name then</div><div class=\"line\">  //name\"The Monster.mName is not here\"</div><div class=\"line\">  // c- If damage was dealt to the monster then the message should say</div><div class=\"line\">  //should\"Monster.mName was dealt X damage\"  // d- If no damage was dealt to the monster then the message should say</div><div class=\"line\">  //should\"Monster.mName dodged the attack\"</div><div class=\"line\">  string response_a(\"There are no monsters in this room to fight\");</div><div class=\"line\">  string response_b(\"The roll is not here\");</div><div class=\"line\">  string response_c(\"troll was dealt 30 damage\");</div><div class=\"line\">  string response_d(\"supertroll dodged the attack\");</div><div class=\"line\"></div><div class=\"line\">  Item* great_sword = new Item(\"greatsword\", Item::WEAPON, 30, 0, 0);</div><div class=\"line\">  Room* arena = new Room(\"arena\", \"A large crowd gathers\", great_sword);</div><div class=\"line\">  Monster* troll = new Monster(\"troll\", 50, 0, 0);</div><div class=\"line\"></div><div class=\"line\">  arena-&gt;setItem(great_sword);</div><div class=\"line\">  Player* attacker = new Player(\"Fighter\", arena);</div><div class=\"line\">  attacker-&gt;equip(\"greatsword\");</div><div class=\"line\"></div><div class=\"line\">  assert(response_a == attacker-&gt;attack(\"troll\"));</div><div class=\"line\"></div><div class=\"line\">  arena-&gt;addMonster(troll);</div><div class=\"line\"></div><div class=\"line\">  assert(response_b == attacker-&gt;attack(\"roll\"));</div><div class=\"line\">  assert(response_c == attacker-&gt;attack(\"troll\"));</div><div class=\"line\"></div><div class=\"line\">  Monster* super_troll = new Monster(\"supertroll\", 8, 0, 999);</div><div class=\"line\">  arena-&gt;addMonster(super_troll);</div><div class=\"line\">  assert(response_d == attacker-&gt;attack(\"supertroll\"));</div><div class=\"line\"></div><div class=\"line\">  // Player move test</div><div class=\"line\">  // - If the player moves in an invalid direction then  //direction\"You traveled nowhere\" should be returned</div><div class=\"line\">  // - If the direction is valid but no room is connected</div><div class=\"line\">  //is\"There is nothing in that direction\"</div><div class=\"line\">  // - If the direction is valid and a room exist</div><div class=\"line\">  //room\"You traveled directionname\\nmLocation-&gt;getDescription()\"</div><div class=\"line\">  Room* moving_room = new Room(\"Moving room\", \"You can move from here\");</div><div class=\"line\">  Room* moving_north = new Room(\"Moving north\",  \"North of the moving room\");</div><div class=\"line\">  Room* moving_south = new Room(\"Moving south\",  \"South of the moving room\");</div><div class=\"line\">  Room* moving_west = new Room(\"Moving west\",</div><div class=\"line\">      \"West of the moving room\");</div><div class=\"line\">  Room* moving_east = new Room(\"Moving east\",</div><div class=\"line\">      \"East of the moving room\");</div><div class=\"line\"></div><div class=\"line\">  Player* moving_player = new Player(\"Jill\", moving_room);</div><div class=\"line\">  response = \"You traveled nowhere\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == moving_player-&gt;move('p'));</div><div class=\"line\"></div><div class=\"line\">  response = \"There is nothing in that direction\";</div><div class=\"line\"></div><div class=\"line\">  assert(response == moving_player-&gt;move('n'));</div><div class=\"line\">  assert(response == moving_player-&gt;move('e'));</div><div class=\"line\">  assert(response == moving_player-&gt;move('w'));</div><div class=\"line\">  assert(response == moving_player-&gt;move('s'));</div><div class=\"line\"></div><div class=\"line\">  moving_player-&gt;mLocation = moving_room;</div><div class=\"line\">  response = \"You traveled North\\n\" + moving_north-&gt;getDescription();</div><div class=\"line\">  moving_room-&gt;link('n', *moving_north);</div><div class=\"line\">  assert(response == moving_player-&gt;move('n'));</div><div class=\"line\"></div><div class=\"line\">  moving_player-&gt;mLocation = moving_room;</div><div class=\"line\">  response = \"You traveled South\\n\" + moving_south-&gt;getDescription();</div><div class=\"line\">  moving_room-&gt;link('s', *moving_south);</div><div class=\"line\">  assert(response == moving_player-&gt;move('s'));</div><div class=\"line\"></div><div class=\"line\">  moving_player-&gt;mLocation = moving_room;</div><div class=\"line\">  response = \"You traveled West\\n\" + moving_west-&gt;getDescription();</div><div class=\"line\">  moving_room-&gt;link('w', *moving_west);</div><div class=\"line\">  assert(response == moving_player-&gt;move('w'));</div><div class=\"line\"></div><div class=\"line\">  moving_player-&gt;mLocation = moving_room;</div><div class=\"line\">  response = \"You traveled East\\n\" + moving_east-&gt;getDescription();</div><div class=\"line\">  moving_room-&gt;link('e', *moving_east);</div><div class=\"line\">  assert(response == moving_player-&gt;move('e'));</div><div class=\"line\"></div><div class=\"line\">  // Player search test</div><div class=\"line\">  // Exact same as the string Room::searchResponse( void )  // method so it has already been tested</div><div class=\"line\"></div><div class=\"line\">  // Player death test</div><div class=\"line\">  // -Returns true when the player's hp is less than zero</div><div class=\"line\">  // -Returns false when the player's hp is greater than zero</div><div class=\"line\">  Player* death_test = new Player(\"Dead guy\");</div><div class=\"line\"></div><div class=\"line\">  assert(false == death_test-&gt;death());</div><div class=\"line\"></div><div class=\"line\">  death_test-&gt;setHp(-1);</div><div class=\"line\">  assert(true == death_test-&gt;death());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Now that we have the methods for the player class all set the next thing we have to do is to write out the methods for the player class. To do so open up the file “database.cpp” and add the methods for the player class below.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div></pre></td><td class=\"code\"><pre><div class=\"line\">Player::Player( <span class=\"built_in\">string</span> name, Room* start )  : mName(name), mLocation(start), mWeapon(<span class=\"literal\">NULL</span>), mArmor(<span class=\"literal\">NULL</span>),</div><div class=\"line\">  mHp(<span class=\"number\">10</span>), mMaxHp(<span class=\"number\">10</span>), mStrength(<span class=\"number\">1</span>), mDefence(<span class=\"number\">0</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Player::setHp( <span class=\"keyword\">int</span> newHp )</div><div class=\"line\">&#123;</div><div class=\"line\">  mHp = newHp ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Player::getHp( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mHp ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Player::setStrength( <span class=\"keyword\">int</span> newStrength )</div><div class=\"line\">&#123;</div><div class=\"line\">  mStrength = newStrength ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Player::getStrength( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mStrength ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Player::setDefence( <span class=\"keyword\">int</span> newDefence )</div><div class=\"line\">&#123;</div><div class=\"line\">  mDefence = newDefence ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> Player::getDefence( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mDefence ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::getLocation( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mLocation-&gt;mName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Player::setName( <span class=\"built_in\">string</span> newName )</div><div class=\"line\">&#123;</div><div class=\"line\">  mName = newName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::getName( <span class=\"keyword\">void</span> ) <span class=\"keyword\">const</span>  &#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mName ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::attack( <span class=\"built_in\">string</span> monsterName )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">list</span>&lt; Monster* &gt;::iterator iter ;</div><div class=\"line\">  <span class=\"keyword\">int</span> damage = <span class=\"number\">0</span> ;</div><div class=\"line\">  <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">response</span><span class=\"params\">( <span class=\"string\">\"The \"</span> + monsterName + <span class=\"string\">\" is not here\"</span> )</span> </span>;  <span class=\"built_in\">stringstream</span> ss ;</div><div class=\"line\">  <span class=\"built_in\">string</span> strDamage ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( mLocation-&gt;mMonsters.empty() )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"There are no monsters in this room to fight\"</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( iter = mLocation-&gt;mMonsters.begin() ; iter != mLocation-&gt;mMonsters.end() ; ++iter )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( (*iter)-&gt;getName() == monsterName )</div><div class=\"line\">    &#123;</div><div class=\"line\">      damage = getStrength() - (*iter)-&gt;getDefence() ;</div><div class=\"line\">      ss &lt;&lt; damage ;</div><div class=\"line\">      ss &gt;&gt; strDamage ;</div><div class=\"line\">      ss.clear() ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>( damage &gt; <span class=\"number\">0</span> )</div><div class=\"line\">      &#123;</div><div class=\"line\">        (*iter)-&gt;setHp( (*iter)-&gt;getHp() - damage ) ;</div><div class=\"line\">        response = (*iter)-&gt;getName() + <span class=\"string\">\" was dealt \"</span> + strDamage + <span class=\"string\">\" damage\"</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">else</span></div><div class=\"line\">      &#123;</div><div class=\"line\">        response = (*iter)-&gt;getName() + <span class=\"string\">\" dodged the attack\"</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::equip( <span class=\"built_in\">string</span> itemName )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">string</span> response ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( mLocation-&gt;mItem != <span class=\"literal\">NULL</span> &amp;&amp; mLocation-&gt;mItem-&gt;getName() == itemName )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( Item::WEAPON == mLocation-&gt;mItem-&gt;getType() &amp;&amp; <span class=\"literal\">true</span> == mLocation-&gt;mItem-&gt;mAvailiable )</div><div class=\"line\">    &#123;</div><div class=\"line\">      mWeapon = mLocation-&gt;mItem ;</div><div class=\"line\">      mLocation-&gt;itemTaken() ;</div><div class=\"line\">      setStrength( mWeapon-&gt;getPower() ) ;</div><div class=\"line\">      response = <span class=\"string\">\"You equipped the \"</span> + mWeapon-&gt;getName() ;</div><div class=\"line\">      <span class=\"keyword\">return</span> response ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>( Item::ARMOR == mLocation-&gt;mItem-&gt;getType() &amp;&amp; <span class=\"literal\">true</span> == mLocation-&gt;mItem-&gt;mAvailiable )</div><div class=\"line\">    &#123;</div><div class=\"line\">      mArmor = mLocation-&gt;mItem ;</div><div class=\"line\">      mLocation-&gt;itemTaken() ;</div><div class=\"line\">      setDefence( mArmor-&gt;getVitality() ) ;</div><div class=\"line\">      mMaxHp += mArmor-&gt;getHealth() ;</div><div class=\"line\">      response = <span class=\"string\">\"You equipped the \"</span> + mArmor-&gt;getName() ;</div><div class=\"line\">      <span class=\"keyword\">return</span> response ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      setHp( mMaxHp ) ;</div><div class=\"line\">      mLocation-&gt;itemTaken() ;</div><div class=\"line\">      response = <span class=\"string\">\"You were healed\"</span> ;</div><div class=\"line\">      <span class=\"keyword\">return</span> response ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( mLocation-&gt;mItem == <span class=\"literal\">NULL</span> )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"There is no item to equip in this room\"</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    response = <span class=\"string\">\"To equip an item you must type its full name correctly\"</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> response ;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::move( <span class=\"keyword\">char</span> direction )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">string</span> response = <span class=\"string\">\"You traveled \"</span> ;</div><div class=\"line\">  <span class=\"keyword\">switch</span>( direction )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'n'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'N'</span>:</div><div class=\"line\">      <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == mLocation-&gt;mNorth )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = <span class=\"string\">\"There is nothing in that direction\"</span> ;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      mLocation = &amp;(mLocation-&gt;north()) ;</div><div class=\"line\">      response = response + <span class=\"string\">\"North\\n\"</span> + mLocation-&gt;getDescription() ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'s'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'S'</span>:</div><div class=\"line\">      <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == mLocation-&gt;mSouth )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = <span class=\"string\">\"There is nothing in that direction\"</span> ;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      mLocation = &amp;(mLocation-&gt;south()) ;</div><div class=\"line\">      response = response + <span class=\"string\">\"South\\n\"</span> + mLocation-&gt;getDescription() ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'e'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'E'</span>:</div><div class=\"line\">      <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == mLocation-&gt;mEast )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = <span class=\"string\">\"There is nothing in that direction\"</span> ;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      mLocation = &amp;(mLocation-&gt;east()) ;</div><div class=\"line\">      response = response + <span class=\"string\">\"East\\n\"</span> + mLocation-&gt;getDescription() ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'w'</span>:</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'W'</span>:</div><div class=\"line\">      <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == mLocation-&gt;mWest )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = <span class=\"string\">\"There is nothing in that direction\"</span> ;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      mLocation = &amp;(mLocation-&gt;west()) ;</div><div class=\"line\">      response = response + <span class=\"string\">\"West\\n\"</span> + mLocation-&gt;getDescription() ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">default</span>:</div><div class=\"line\">      response = response + <span class=\"string\">\"nowhere\"</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Player::search( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> mLocation-&gt;searchResponse() ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">Player::dead Player::death( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span>( getHp() &lt;= <span class=\"number\">0</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span> ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Afterwards you can begin to test the Dungeon class, so open up the file “test.h” file and add the following line.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_dungeon_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div></pre></td></tr></table></figure>\n<p>Here are the methods for the dungeon test, it is quite long so you can copy it if you want to but I suggest typing it out and reading through the comments in order to better understand the codebase; the file for the code below is “test.cpp”</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_dungeon_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Dungeon constructor test</span></div><div class=\"line\">  Dungeon* test_dungeon = <span class=\"keyword\">new</span> Dungeon(<span class=\"number\">1</span>, <span class=\"number\">1</span>);</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"number\">1</span> == test_dungeon-&gt;mMaxPlayers);</div><div class=\"line\">  assert(<span class=\"number\">1</span> == test_dungeon-&gt;mMaxRooms);</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == test_dungeon-&gt;mPlayers.empty());</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == test_dungeon-&gt;mRooms.empty());</div><div class=\"line\">  <span class=\"comment\">// - A dungeon without monsters is considered complete</span></div><div class=\"line\">  assert(<span class=\"literal\">true</span> == test_dungeon-&gt;isComplete());</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon addPlayer test</span></div><div class=\"line\">  <span class=\"comment\">// - Successful addition of a new player should display the following</span></div><div class=\"line\">  <span class=\"comment\">//the\"The player named newPlayer-&gt;getName() entered the Dungeon\"</span></div><div class=\"line\">  Player* newbie = <span class=\"keyword\">new</span> Player(<span class=\"string\">\"Noob\"</span>);</div><div class=\"line\">  <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">response</span><span class=\"params\">(<span class=\"string\">\"The player named Noob entered the Dungeon\"</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(response == test_dungeon-&gt;addPlayer(newbie));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == test_dungeon-&gt;mPlayers.empty());</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon addRoom test</span></div><div class=\"line\">  <span class=\"comment\">// - \"The room: newRoom-&gt;mName was added\" will be displayed</span></div><div class=\"line\">  <span class=\"comment\">//beif the addition was successful</span></div><div class=\"line\">  Room* main_room = <span class=\"keyword\">new</span> Room(<span class=\"string\">\"Main hall\"</span>, <span class=\"string\">\"The main hall\"</span>);</div><div class=\"line\">  response = <span class=\"string\">\"The room: Main hall was added\"</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(response == test_dungeon-&gt;addRoom(main_room));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == test_dungeon-&gt;mRooms.empty());</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon removePlayer test</span></div><div class=\"line\">  response = <span class=\"string\">\"Noob has left the dungeon\"</span>;</div><div class=\"line\">  assert(response == test_dungeon-&gt;removePlayer(newbie-&gt;getName()));</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon generatePlayerStats test</span></div><div class=\"line\">  <span class=\"comment\">// -Sets the players max hp to 10, strength and defence to 2</span></div><div class=\"line\">  test_dungeon-&gt;generatePlayerStats(newbie);</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"number\">10</span> == newbie-&gt;getHp());</div><div class=\"line\">  assert(<span class=\"number\">2</span> == newbie-&gt;getStrength());</div><div class=\"line\">  assert(<span class=\"number\">2</span> == newbie-&gt;getDefence());</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon combatLoop test</span></div><div class=\"line\">  <span class=\"comment\">// - If the hero is stronger than the monster then the monster  //theshould die else the hero should die</span></div><div class=\"line\">  Dungeon* combat_test = <span class=\"keyword\">new</span> Dungeon(<span class=\"number\">1</span>, <span class=\"number\">1</span>);</div><div class=\"line\">  Room* combat_room = <span class=\"keyword\">new</span> Room(<span class=\"string\">\"Battle\"</span>, <span class=\"string\">\"Fight here\"</span>);</div><div class=\"line\">  Item* longsword = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"longsword\"</span>, Item::WEAPON, <span class=\"number\">100</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">  Player* brawler = <span class=\"keyword\">new</span> Player(<span class=\"string\">\"brawler\"</span>, combat_room);</div><div class=\"line\">  Monster* ogre = <span class=\"keyword\">new</span> Monster(<span class=\"string\">\"ogre\"</span>, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);  Monster* superogre = <span class=\"keyword\">new</span> Monster(<span class=\"string\">\"superogre\"</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>);  combat_room-&gt;setItem(longsword);</div><div class=\"line\">  combat_room-&gt;addMonster(ogre);</div><div class=\"line\">  combat_room-&gt;addMonster(superogre);</div><div class=\"line\">  combat_test-&gt;addRoom(combat_room);</div><div class=\"line\">  combat_test-&gt;addPlayer(brawler);</div><div class=\"line\">  combat_test-&gt;generatePlayerStats(brawler);</div><div class=\"line\">  brawler-&gt;mLocation = combat_room;</div><div class=\"line\">  brawler-&gt;equip(<span class=\"string\">\"longsword\"</span>);</div><div class=\"line\"></div><div class=\"line\">  combat_test-&gt;combatLoop(*brawler, *ogre);</div><div class=\"line\">  assert(combat_room-&gt;mMonsters.empty() == <span class=\"literal\">false</span>);</div><div class=\"line\">  assert(combat_test-&gt;isComplete() == <span class=\"literal\">false</span>);</div><div class=\"line\"></div><div class=\"line\">  Item* badsword = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"badsword\"</span>, Item::WEAPON, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">  combat_room-&gt;setItem(badsword);</div><div class=\"line\">  brawler-&gt;equip(<span class=\"string\">\"badsword\"</span>);</div><div class=\"line\"></div><div class=\"line\">  combat_test-&gt;combatLoop(*brawler, *superogre);</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == brawler-&gt;death());</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dungeon playerStatus test</span></div><div class=\"line\">  Dungeon* status_test = <span class=\"keyword\">new</span> Dungeon(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</div><div class=\"line\">  Room* start_room = <span class=\"keyword\">new</span> Room(<span class=\"string\">\"Starting room\"</span>, <span class=\"string\">\"Start here\"</span>);</div><div class=\"line\">  Room* end_room = <span class=\"keyword\">new</span> Room(<span class=\"string\">\"Ending room\"</span>, <span class=\"string\">\"End here\"</span>);</div><div class=\"line\">  Player* stats_hero = <span class=\"keyword\">new</span> Player(<span class=\"string\">\"Mike\"</span>, start_room);</div><div class=\"line\">  Item* weapon_x = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"weaponx\"</span>, Item::WEAPON, <span class=\"number\">20</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</div><div class=\"line\">  Item* armor_x = <span class=\"keyword\">new</span> Item(<span class=\"string\">\"armorx\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">20</span>, <span class=\"number\">10</span>);</div><div class=\"line\"></div><div class=\"line\">  start_room-&gt;link(<span class=\"string\">'e'</span>, *end_room);</div><div class=\"line\">  end_room-&gt;link(<span class=\"string\">'w'</span>, *start_room);</div><div class=\"line\">  start_room-&gt;setItem(weapon_x);</div><div class=\"line\">  end_room-&gt;setItem(armor_x);</div><div class=\"line\">  status_test-&gt;addRoom(start_room);</div><div class=\"line\">  status_test-&gt;addRoom(end_room);</div><div class=\"line\">  status_test-&gt;addPlayer(stats_hero);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// The stats reported are the following</span></div><div class=\"line\">  <span class=\"comment\">/*</div><div class=\"line\">     1. Hp</div><div class=\"line\">     2. Strength</div><div class=\"line\">     3. Defence</div><div class=\"line\">     4. Location</div><div class=\"line\">     5. Name</div><div class=\"line\">     6. Weapon</div><div class=\"line\">     7. Armor</div><div class=\"line\">   */</span></div><div class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> stat_total = <span class=\"number\">7</span>;</div><div class=\"line\">  <span class=\"built_in\">string</span>* status_before_weapon = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[stat_total];</div><div class=\"line\">  <span class=\"built_in\">string</span>* status_with_weapon = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[stat_total];</div><div class=\"line\">  <span class=\"built_in\">string</span>* status_with_armor = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[stat_total];</div><div class=\"line\"></div><div class=\"line\">  status_before_weapon[<span class=\"number\">0</span>] = <span class=\"string\">\"Current HP: 10 out of 10\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">1</span>] = <span class=\"string\">\"Current Strength: 2\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">2</span>] = <span class=\"string\">\"Current Defence: 2\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">3</span>] = <span class=\"string\">\"Current Location: Starting room\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">4</span>] = <span class=\"string\">\"Current Name: Mike\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">5</span>] = <span class=\"string\">\"Current Weapon: none equipped\"</span>;</div><div class=\"line\">  status_before_weapon[<span class=\"number\">6</span>] = <span class=\"string\">\"Current Armor: none equipped\"</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(status_before_weapon = status_test-&gt;playerStatus(*stats_hero));</div><div class=\"line\"></div><div class=\"line\">  stats_hero-&gt;equip(<span class=\"string\">\"weaponx\"</span>);</div><div class=\"line\"></div><div class=\"line\">  status_with_weapon[<span class=\"number\">0</span>] = <span class=\"string\">\"Current HP: 10 out of 10\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">1</span>] = <span class=\"string\">\"Current Strength: 20\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">2</span>] = <span class=\"string\">\"Current Defence: 2\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">3</span>] = <span class=\"string\">\"Current Location: Starting room\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">4</span>] = <span class=\"string\">\"Current Name: Mike\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">5</span>] = <span class=\"string\">\"Current Weapon: weaponx\"</span>;</div><div class=\"line\">  status_with_weapon[<span class=\"number\">6</span>] = <span class=\"string\">\"Current Armor: none equipped\"</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(status_with_weapon = status_test-&gt;playerStatus(*stats_hero));</div><div class=\"line\"></div><div class=\"line\">  stats_hero-&gt;move(<span class=\"string\">'e'</span>);</div><div class=\"line\">  stats_hero-&gt;equip(<span class=\"string\">\"armorx\"</span>);</div><div class=\"line\"></div><div class=\"line\">  status_with_armor[<span class=\"number\">0</span>] = <span class=\"string\">\"Current HP: 10 out of 20\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">1</span>] = <span class=\"string\">\"Current Strength: 20\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">2</span>] = <span class=\"string\">\"Current Defence: 20\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">3</span>] = <span class=\"string\">\"Current Location: Ending room\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">4</span>] = <span class=\"string\">\"Current Name: Mike\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">5</span>] = <span class=\"string\">\"Current Weapon: weaponx\"</span>;</div><div class=\"line\">  status_with_armor[<span class=\"number\">6</span>] = <span class=\"string\">\"Current Armor: armorx\"</span>;</div><div class=\"line\"></div><div class=\"line\">  assert(status_with_armor = status_test-&gt;playerStatus(*stats_hero));</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Now we can write out the methods for the dungeon class itself. Go open up the file “database.cpp” and add the lines below to the file, remember to start at the line of code indicated in the margins.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div></pre></td><td class=\"code\"><pre><div class=\"line\">Dungeon::Dungeon( <span class=\"keyword\">int</span> maxPlayers, <span class=\"keyword\">int</span> maxRooms )  : mMaxPlayers(maxPlayers), mMaxRooms(maxRooms)</div><div class=\"line\">&#123;</div><div class=\"line\">  mRooms.reserve( maxRooms ) ;</div><div class=\"line\">  mPlayers.reserve( maxPlayers ) ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">bool</span> Dungeon::isComplete( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">bool</span> flag = <span class=\"literal\">true</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; mRooms.size() ; ++i )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( mRooms[i]-&gt;mMonsters.empty() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">continue</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      flag = <span class=\"literal\">false</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> flag ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Dungeon::addPlayer( Player *newPlayer )</div><div class=\"line\">&#123;</div><div class=\"line\">  mPlayers.push_back( newPlayer ) ;</div><div class=\"line\">  <span class=\"built_in\">string</span> response = <span class=\"string\">\"The player named \"</span> + newPlayer-&gt;getName() + <span class=\"string\">\" entered the Dungeon\"</span> ;</div><div class=\"line\"></div><div class=\"line\">  generatePlayerStats( newPlayer ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Dungeon::generatePlayerStats( Player* newPlayer )</div><div class=\"line\">&#123;</div><div class=\"line\">  newPlayer-&gt;mMaxHp = <span class=\"number\">10</span> ;</div><div class=\"line\">  newPlayer-&gt;setHp( newPlayer-&gt;mMaxHp ) ;</div><div class=\"line\">  newPlayer-&gt;setStrength( <span class=\"number\">2</span> ) ;</div><div class=\"line\">  newPlayer-&gt;setDefence( <span class=\"number\">2</span> ) ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Dungeon::addRoom( Room *newRoom )</div><div class=\"line\">&#123;</div><div class=\"line\">  mRooms.push_back( newRoom ) ;</div><div class=\"line\">  <span class=\"built_in\">string</span> response = <span class=\"string\">\"The room: \"</span> + newRoom-&gt;mName + <span class=\"string\">\" was added\"</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Dungeon::removePlayer( <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> playerName )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">string</span> response = playerName + <span class=\"string\">\" has left the dungeon\"</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; mPlayers.size() ; ++i )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( playerName == mPlayers[i]-&gt;getName() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      mPlayers.erase( mPlayers.begin() + i ) ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">//Should change this to have the monstersName as an argument</span></div><div class=\"line\"><span class=\"keyword\">void</span> Dungeon::combatLoop( Player&amp; hero, Monster&amp; villain )</div><div class=\"line\">&#123;</div><div class=\"line\">  villain.inCombat = <span class=\"literal\">true</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">while</span>( <span class=\"literal\">true</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; hero.attack( villain.getName() ) &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">    <span class=\"keyword\">if</span>( villain.getHp() &lt;= <span class=\"number\">0</span> )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; villain.getName() + <span class=\"string\">\" was slain by the valiant \"</span> &lt;&lt; hero.getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">      hero.mLocation-&gt;killMonster( villain.getName() ) ;</div><div class=\"line\">      <span class=\"keyword\">return</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">int</span> damage = <span class=\"number\">0</span> ;</div><div class=\"line\">      damage = villain.getStrength() - hero.getDefence() ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>( damage &gt; <span class=\"number\">0</span> )</div><div class=\"line\">      &#123;</div><div class=\"line\">        hero.setHp( hero.getHp() - damage ) ;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; hero.getName() + <span class=\"string\">\" was dealt \"</span> &lt;&lt; damage &lt;&lt; <span class=\"string\">\" damage\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">else</span></div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; hero.getName() + <span class=\"string\">\" dodged the attack\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>( hero.death() )</div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; hero.getName() + <span class=\"string\">\" was slain by the horrible \"</span> + villain.getName() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span>* Dungeon::playerStatus( Player&amp; player )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">stringstream</span> ss ;</div><div class=\"line\">  <span class=\"built_in\">string</span> temp ;</div><div class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> statusCount = <span class=\"number\">7</span> ;</div><div class=\"line\">  <span class=\"built_in\">string</span>* response = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[statusCount] ;</div><div class=\"line\"></div><div class=\"line\">  ss &lt;&lt; player.getHp() ;</div><div class=\"line\">  ss &gt;&gt; temp ;</div><div class=\"line\">  response[<span class=\"number\">0</span>] = <span class=\"string\">\"Current HP: \"</span> + temp ;</div><div class=\"line\">  ss.clear() ;</div><div class=\"line\">  temp.clear() ;</div><div class=\"line\">  ss &lt;&lt; player.mMaxHp ;</div><div class=\"line\">  ss &gt;&gt; temp ;</div><div class=\"line\">  response[<span class=\"number\">0</span>] = response[<span class=\"number\">0</span>] + <span class=\"string\">\" out of \"</span> + temp ;</div><div class=\"line\">  temp.clear() ;</div><div class=\"line\">  ss.clear() ;</div><div class=\"line\"></div><div class=\"line\">  ss &lt;&lt; player.getStrength() ;</div><div class=\"line\">  ss &gt;&gt; temp ;</div><div class=\"line\">  response[<span class=\"number\">1</span>] = <span class=\"string\">\"Current Strength: \"</span> + temp ;</div><div class=\"line\">  ss.clear() ;</div><div class=\"line\">  temp.clear() ;</div><div class=\"line\"></div><div class=\"line\">  ss &lt;&lt; player.getDefence() ;</div><div class=\"line\">  ss &gt;&gt; temp ;</div><div class=\"line\">  response[<span class=\"number\">2</span>] = <span class=\"string\">\"Current Defence: \"</span> + temp ;</div><div class=\"line\">  ss.clear() ;</div><div class=\"line\">  temp.clear() ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == player.mLocation )</div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">3</span>] = <span class=\"string\">\"Error: BAD LOCATION\"</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">3</span>] = <span class=\"string\">\"Current Location: \"</span> + player.getLocation() ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  response[<span class=\"number\">4</span>] = <span class=\"string\">\"Current Name: \"</span> + player.getName() ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == player.mWeapon )</div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">5</span>] = <span class=\"string\">\"Current Weapon: none equipped\"</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">5</span>] = <span class=\"string\">\"Current Weapon: \"</span> + player.mWeapon-&gt;getName() ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"literal\">NULL</span> == player.mArmor )</div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">6</span>] = <span class=\"string\">\"Current Armor: none equipped\"</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    response[<span class=\"number\">6</span>] = <span class=\"string\">\"Current Armor: \"</span> + player.mArmor-&gt;getName() ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> response ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> Dungeon::displayHelp( <span class=\"keyword\">void</span> )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"////////////////\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Help menu\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"////////////////\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Attack a monster type -&gt; a:monster_name_here\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Move to a new location type -&gt; mv:location_name_here\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Look for items type -&gt; find:\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Search the room for exits and monsters type -&gt; loc:\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Equip new items type -&gt; eq:weapon_or_armor_name\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"See your current status type -&gt; you:\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next class we have to test is the filter class, if you recall from previous parts, the filter class’ job is to validate user input to check if it is safe to “dispatch” to the database. You can think of the filter as a sanitizer for bad commands just like you can image a filter swearing words on message boards. Now go open up “test.h” and add the following line.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_filter_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div></pre></td></tr></table></figure>\n<p>You know the drill, create the test methods within the file “test.cpp” for the filter class(don’t worry this class is short).</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_filter_class(<span class=\"keyword\">void</span>)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Filter chat test</span></div><div class=\"line\">  <span class=\"comment\">// string Filter::chat() just truncates the command from the  //fromchat message if it was t:message  Filter filter;</span></div><div class=\"line\">  <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">input</span><span class=\"params\">(<span class=\"string\">\"t:Hello world\"</span>)</span></span>;</div><div class=\"line\">  <span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">response</span><span class=\"params\">(<span class=\"string\">\"Hello world\"</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\">  assert(response == filter.chat(input));</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Filter validateMessage test</span></div><div class=\"line\">  <span class=\"comment\">/*</div><div class=\"line\">     The valid commands are the following</div><div class=\"line\">    a:</div><div class=\"line\">    mv:</div><div class=\"line\">    find:</div><div class=\"line\">    loc:</div><div class=\"line\">    eq:</div><div class=\"line\">    you:</div><div class=\"line\">    help:</div><div class=\"line\">   */</span></div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"mv:n\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"a:goblin\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"find:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"loc:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"eq:weapon\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"you:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">true</span> == filter.validateMessage(<span class=\"string\">\"help:\"</span>));</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"move:north\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"move:south\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"move:east\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"move:west\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"attack:goblin\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"fid:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"location:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"eqip:weapon\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"me:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"zelpeafaf:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"gg:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"Pi:affg\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"Eqip:weapon\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"Ye:\"</span>));</div><div class=\"line\">  assert(<span class=\"literal\">false</span> == filter.validateMessage(<span class=\"string\">\"no command input\"</span>));</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>There are only two methods for the filter class, chat and validate message. As you can probably guess, chat just sends out the text following the chat command “t:”. However validate message a bit more involved. Validate message works by running three distinct test, the “keywordtest” the “commandtest” and the movecommandtest”. Keyword just makes sure that the user entered a keyword such as “a:” for attack, “you:” for player status or any of the others. The “commandtest” just checks after the keyword has been validated that the fullname of the command matches the possible command inputs. Lastly the “movecommandtest” ensures that the direction of travel for the move command is north, south, east or west. So go open up “database.cpp” and add the lines below paying attention to which line the code begins on as shown in the margin.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div></pre></td><td class=\"code\"><pre><div class=\"line\">Filter::valid Filter::validateMessage( <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> message )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">//Necessary for the std::tolower() method</span></div><div class=\"line\">  locale loc ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; message.length() ; ++i )</div><div class=\"line\">  &#123;</div><div class=\"line\">    message [ i ] = <span class=\"built_in\">tolower</span>( message[ i ], loc ) ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">bool</span> keywordTest = <span class=\"literal\">false</span> ;  <span class=\"keyword\">bool</span> commandTest = <span class=\"literal\">false</span> ;  <span class=\"keyword\">bool</span> moveCommandTest = <span class=\"literal\">true</span> ; <span class=\"comment\">// Checks for a valid direction</span></div><div class=\"line\">  <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> inputIndex = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">switch</span>( message[ <span class=\"number\">0</span> ] )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'a'</span>: <span class=\"comment\">//Attack  case 'm': //Move</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'f'</span>: <span class=\"comment\">//Find</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'l'</span>: <span class=\"comment\">//Location</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'e'</span>: <span class=\"comment\">//Equip</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'y'</span>: <span class=\"comment\">//You</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'t'</span>: <span class=\"comment\">//Talk</span></div><div class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'h'</span>: <span class=\"comment\">//Help Menu</span></div><div class=\"line\">      keywordTest = <span class=\"literal\">true</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;<span class=\"keyword\">break</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">default</span>:</div><div class=\"line\">        keywordTest = <span class=\"literal\">false</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"literal\">false</span> == keywordTest )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">string</span> subMessage ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span>( <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; message.size() ; ++i )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>( message[ i ] == <span class=\"string\">':'</span> )</div><div class=\"line\">    &#123;</div><div class=\"line\">      inputIndex = i;</div><div class=\"line\">      subMessage += message[ i ] ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      subMessage += message[ i ] ;</div><div class=\"line\">      <span class=\"keyword\">continue</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( subMessage == <span class=\"string\">\"a:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"mv:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"find:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"loc:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"eq:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"you:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"t:\"</span> ||</div><div class=\"line\">      subMessage == <span class=\"string\">\"help:\"</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    commandTest = <span class=\"literal\">true</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( subMessage == <span class=\"string\">\"mv:\"</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"comment\">//Checks if a direction was entered by the player,</span></div><div class=\"line\">    <span class=\"comment\">// accomplishes this by seeing if the mv: command</span></div><div class=\"line\">    <span class=\"comment\">// is followed by at most a single character representing</span></div><div class=\"line\">    <span class=\"comment\">// the directions 'n' or 'e' or 'w' or 's'</span></div><div class=\"line\">    <span class=\"keyword\">if</span>( inputIndex + <span class=\"number\">1</span> == message.size() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      moveCommandTest = <span class=\"literal\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span>( inputIndex &lt; message.size() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">if</span>( <span class=\"literal\">false</span> == moveCommandTest )</div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>(message[ inputIndex ] == <span class=\"string\">' '</span>)</div><div class=\"line\">      &#123;</div><div class=\"line\">        moveCommandTest = <span class=\"literal\">false</span>;</div><div class=\"line\">        <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      ++inputIndex ;</div><div class=\"line\">    &#125;inputIndex</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"literal\">true</span> == commandTest &amp;&amp; <span class=\"literal\">true</span> == keywordTest &amp;&amp; <span class=\"literal\">true</span> == moveCommandTest )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">else</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> ;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Filter::chat( <span class=\"built_in\">string</span> message )</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">return</span> message.substr( <span class=\"number\">2</span>, message.length() ) ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The dispatch class is the last class we need for thesingle player version of the game. Being the dispatchits sole purpose is to separate the value and command fromthe filtered user input and “dispatch” it to the database.Now lets open up “test.h” and add the line below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">test_dispatch_class</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div></pre></td></tr></table></figure></p>\n<p>Next we’ll write out the test for the dispatch class within “test.cpp”, so go open that file and insert the code below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Test::test_dispatch_class()</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">// Dispatch extractCommand test</span></div><div class=\"line\">  <span class=\"comment\">//a Attack  //m Move</span></div><div class=\"line\">  <span class=\"comment\">//f Find</span></div><div class=\"line\">  <span class=\"comment\">//l Location</span></div><div class=\"line\">  <span class=\"comment\">//e Equip</span></div><div class=\"line\">  <span class=\"comment\">//y You</span></div><div class=\"line\">  <span class=\"comment\">//t Talk</span></div><div class=\"line\">  <span class=\"comment\">//h Help Menu</span></div><div class=\"line\">  Dispatch dispatch;</div><div class=\"line\"></div><div class=\"line\">  assert(<span class=\"string\">'a'</span> == dispatch.extractCommand(<span class=\"string\">\"a:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'m'</span> == dispatch.extractCommand(<span class=\"string\">\"mv:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'f'</span> == dispatch.extractCommand(<span class=\"string\">\"find:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'l'</span> == dispatch.extractCommand(<span class=\"string\">\"loc:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'e'</span> == dispatch.extractCommand(<span class=\"string\">\"eq:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'y'</span> == dispatch.extractCommand(<span class=\"string\">\"you:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'t'</span> == dispatch.extractCommand(<span class=\"string\">\"t:\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">'h'</span> == dispatch.extractCommand(<span class=\"string\">\"help:\"</span>));</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// Dispatch extractValue test</span></div><div class=\"line\">  <span class=\"comment\">/*</div><div class=\"line\">     The only commands that take values.</div><div class=\"line\"></div><div class=\"line\">     attack  move  equip</div><div class=\"line\">     talk  */</span></div><div class=\"line\">  assert(<span class=\"string\">\"goblin\"</span> == dispatch.extractValue(<span class=\"string\">\"a:goblin\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">\"north\"</span> == dispatch.extractValue(<span class=\"string\">\"mv:north\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">\"armor\"</span> == dispatch.extractValue(<span class=\"string\">\"eq:armor\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">\"hello world\"</span> == dispatch.extractValue(<span class=\"string\">\"t:hello world\"</span>));</div><div class=\"line\">  assert(<span class=\"string\">\"  s p a c  e  s  \"</span> == dispatch.extractValue(</div><div class=\"line\">        <span class=\"string\">\"t:  s p a c  e  s  \"</span>));</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now we can add the methods for the dispatch class to our “database.cpp”file. Open up the file “database.cpp” and add the lines below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">char</span> Dispatch::extractCommand(<span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> fromFilter)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">//a Attack  //m Move</span></div><div class=\"line\">  <span class=\"comment\">//f Find</span></div><div class=\"line\">  <span class=\"comment\">//l Location</span></div><div class=\"line\">  <span class=\"comment\">//e Equip</span></div><div class=\"line\">  <span class=\"comment\">//y You</span></div><div class=\"line\">  <span class=\"comment\">//t Talk</span></div><div class=\"line\">  <span class=\"comment\">//h Help Menu</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> fromFilter[ <span class=\"number\">0</span> ] ;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">string</span> Dispatch::extractValue(<span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> fromFilter)</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">/*</div><div class=\"line\">     The value of the string from the filter is all of the text</div><div class=\"line\">     that follows the command.</div><div class=\"line\"></div><div class=\"line\">     -Example-</div><div class=\"line\">a:goblin</div><div class=\"line\"></div><div class=\"line\">The command is a:</div><div class=\"line\">The value is goblin</div><div class=\"line\">   */</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">// For single character commands such as t:</span></div><div class=\"line\">  <span class=\"keyword\">if</span>( fromFilter[ <span class=\"number\">1</span> ] == <span class=\"string\">':'</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> fromFilter.substr( <span class=\"number\">2</span>, fromFilter.length() ) ;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> fromFilter.substr( <span class=\"number\">3</span>, fromFilter.length() ) ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The last thing we have to do before we can call our single player version of the game complete is to make sure all the test pass with flying colors. Beingthat we only implemented unit test, you will be notified when a test failsby the console giving you a “assertion failed at line:XYZ” where XYZ is the line number. So open up “main.cpp” and make sure it looks like the code below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Filename main.cpp</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Database.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">\"Test.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">run_test</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Ignore the combat printouts from the\\n\"</span>;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"test_dungeon_class() method\\n\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"></div><div class=\"line\">  Test::get_instance()-&gt;test_item_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_monster_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_room_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_player_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_dungeon_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_filter_class();</div><div class=\"line\">  Test::get_instance()-&gt;test_dispatch_class();</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">run_sample_game</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">  run_test();</div><div class=\"line\">  <span class=\"comment\">//run_sample_game();</span></div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">run_sample_game</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">  <span class=\"comment\">//Construct Dungeon</span></div><div class=\"line\">  <span class=\"function\">Dungeon <span class=\"title\">caves</span><span class=\"params\">( <span class=\"number\">2</span>, <span class=\"number\">21</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Items power vitality health</span></div><div class=\"line\">  Item* herb_a = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_b = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_c = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_d = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_e = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_f = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* herb_g = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  Item* woodsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"woodsword\"</span>, Item::WEAPON, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* steelblade = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"steelblade\"</span>, Item::WEAPON, <span class=\"number\">20</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* crystalsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"crystalsword\"</span>, Item::WEAPON, <span class=\"number\">35</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* genjiblade = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"genjiblade\"</span>, Item::WEAPON, <span class=\"number\">60</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* angelicsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"angelicsword\"</span>, Item::WEAPON, <span class=\"number\">80</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Item* finalweapon = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"dragonslayer\"</span>, Item::WEAPON, <span class=\"number\">2000</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  Item* woodarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"woodarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">5</span>, <span class=\"number\">15</span> ) ;</div><div class=\"line\">  Item* steelarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"steelarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">7</span>, <span class=\"number\">20</span> ) ;</div><div class=\"line\">  Item* diamondarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"diamondarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">12</span>, <span class=\"number\">30</span> ) ;</div><div class=\"line\">  Item* crystalarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"crystalarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">15</span>, <span class=\"number\">35</span> ) ;</div><div class=\"line\">  Item* dragonarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"dragonarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">20</span>, <span class=\"number\">100</span> ) ;</div><div class=\"line\">  Item* ultimatearmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"ultimatearmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">1000</span>, <span class=\"number\">1000</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Monsters hp str def</span></div><div class=\"line\">  Monster* bear = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"bear\"</span>, <span class=\"number\">15</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span> ) ;</div><div class=\"line\">  Monster* goblin = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"goblin\"</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">  Monster* imp = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"imp\"</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span>, <span class=\"number\">2</span> ) ;</div><div class=\"line\">  Monster* redgoblin = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"redgoblin\"</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span> ) ;</div><div class=\"line\">  Monster* demon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"demon\"</span>, <span class=\"number\">6</span>, <span class=\"number\">3</span>, <span class=\"number\">7</span> ) ;</div><div class=\"line\">  Monster* zergling = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"zergling\"</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">9</span> ) ;</div><div class=\"line\">  Monster* bats = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"bats\"</span>, <span class=\"number\">20</span>, <span class=\"number\">15</span>, <span class=\"number\">3</span> ) ;</div><div class=\"line\">  Monster* morebats = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"morebats\"</span>, <span class=\"number\">25</span>, <span class=\"number\">20</span>, <span class=\"number\">15</span> ) ;</div><div class=\"line\">  Monster* golem = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"golem\"</span>, <span class=\"number\">50</span>, <span class=\"number\">21</span>, <span class=\"number\">9</span> ) ;</div><div class=\"line\">  Monster* goatdemon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"goatdemon\"</span>, <span class=\"number\">100</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span> ) ;</div><div class=\"line\">  Monster* cyclops = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"cyclops\"</span>, <span class=\"number\">150</span>, <span class=\"number\">90</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">  Monster* behemoth = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"behemoth\"</span>, <span class=\"number\">250</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span> ) ;</div><div class=\"line\">  Monster* alien = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"alien\"</span>, <span class=\"number\">50</span>, <span class=\"number\">21</span>, <span class=\"number\">4</span> ) ;</div><div class=\"line\">  Monster* giantrat = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"giantrat\"</span>, <span class=\"number\">55</span>, <span class=\"number\">40</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">  Monster* fallenangel = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"fallenangel\"</span>, <span class=\"number\">300</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span> ) ;</div><div class=\"line\">  Monster* greatdragon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"greatdragon\"</span>, <span class=\"number\">500</span>, <span class=\"number\">300</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">  Monster* invincibledragon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"invincibledragon\"</span>, <span class=\"number\">999</span>, <span class=\"number\">999</span>, <span class=\"number\">999</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Rooms name description item</span></div><div class=\"line\">  Room* mainHall = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The main cavern\"</span>, <span class=\"string\">\"A murkey swamp cavern\"</span>, woodsword ) ;</div><div class=\"line\">  Room* river = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The black river\"</span>, <span class=\"string\">\"A river with dark water\"</span>, woodarmor ) ;</div><div class=\"line\">  Room* greencave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The greencave\"</span>, <span class=\"string\">\"A moss covered cave\"</span>, herb_a ) ;</div><div class=\"line\">  Room* bluecave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The bluecave\"</span>, <span class=\"string\">\"A frosty cave\"</span>, steelblade ) ;</div><div class=\"line\">  Room* darkpit = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The darkpit\"</span>, <span class=\"string\">\"An endless hole lies before you\"</span>, steelarmor ) ;</div><div class=\"line\">  Room* morbidfield = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The morbidfield\"</span>, <span class=\"string\">\"Pitch black grass surrounds you\"</span>, herb_b ) ;</div><div class=\"line\">  Room* graveyard = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The graveyard\"</span>, <span class=\"string\">\"Tombstones abound\"</span>, diamondarmor ) ;</div><div class=\"line\">  Room* crypt = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The crypt\"</span>, <span class=\"string\">\"A nasty rotten crypt\"</span>, crystalsword ) ;</div><div class=\"line\">  Room* evilpassage = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The evil passage\"</span>, <span class=\"string\">\"An evil pasage\"</span>, crystalarmor ) ;</div><div class=\"line\">  Room* darklair = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dark lair\"</span>, <span class=\"string\">\"A dark lair\"</span>, herb_c ) ;</div><div class=\"line\">  Room* firepit = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The firey pits\"</span>, <span class=\"string\">\"Fire is every where\"</span>, herb_d ) ;</div><div class=\"line\">  Room* greenpasture = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The greenpastures\"</span>, <span class=\"string\">\"A meadow is before you\"</span>, genjiblade ) ;</div><div class=\"line\">  Room* icecave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The icy caves\"</span>, <span class=\"string\">\"Ice everywhere you look\"</span>, herb_e ) ;</div><div class=\"line\">  Room* livingroom = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The living room\"</span>, <span class=\"string\">\"The room is alive\"</span>, dragonarmor ) ;</div><div class=\"line\">  Room* cellar = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The cellar\"</span>, <span class=\"string\">\"A dirty cellar filled with rats\"</span>, angelicsword ) ;</div><div class=\"line\">  Room* lifespring = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The lifespring\"</span>, <span class=\"string\">\"A beautiful fountain stands\"</span>, herb_f ) ;</div><div class=\"line\">  Room* waterfall = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The waterfall\"</span>, <span class=\"string\">\"Clear blue water falls\"</span>, herb_g ) ;</div><div class=\"line\">  Room* hellsgate = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The gates of hell\"</span>, <span class=\"string\">\"Large rusty doors lead to hell\"</span>, ultimatearmor ) ;</div><div class=\"line\">  Room* dragoncave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dragon's cave\"</span>, <span class=\"string\">\"An ancient cave...\"</span> ) ;</div><div class=\"line\">  Room* dragonsden = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dragon's den\"</span>, <span class=\"string\">\"A powerful monster awaits\"</span> ) ;</div><div class=\"line\">  Room* lostforest = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The secret forest\"</span>, <span class=\"string\">\"The strongest sword lies hidden here\"</span>, finalweapon ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Link Rooms</span></div><div class=\"line\">  mainHall-&gt;link( <span class=\"string\">'e'</span>, *river ) ;</div><div class=\"line\">  river-&gt;link( <span class=\"string\">'s'</span>, *greencave ) ;</div><div class=\"line\">  river-&gt;link( <span class=\"string\">'e'</span>, *bluecave ) ;</div><div class=\"line\">  river-&gt;link( <span class=\"string\">'w'</span>, *mainHall ) ;</div><div class=\"line\">  greencave-&gt;link( <span class=\"string\">'n'</span>, *river ) ;</div><div class=\"line\">  bluecave-&gt;link( <span class=\"string\">'w'</span>, *river ) ;</div><div class=\"line\">  bluecave-&gt;link( <span class=\"string\">'n'</span>, *darkpit ) ;</div><div class=\"line\">  darkpit-&gt;link( <span class=\"string\">'s'</span>, *bluecave ) ;</div><div class=\"line\">  darkpit-&gt;link( <span class=\"string\">'n'</span>, *morbidfield ) ;</div><div class=\"line\">  morbidfield-&gt;link( <span class=\"string\">'s'</span>, *darkpit ) ;</div><div class=\"line\">  morbidfield-&gt;link( <span class=\"string\">'e'</span>, *graveyard ) ;</div><div class=\"line\">  graveyard-&gt;link( <span class=\"string\">'w'</span>, *morbidfield ) ;</div><div class=\"line\">  graveyard-&gt;link( <span class=\"string\">'n'</span>, *crypt ) ;</div><div class=\"line\">  graveyard-&gt;link( <span class=\"string\">'e'</span>, *evilpassage ) ;</div><div class=\"line\">  crypt-&gt;link( <span class=\"string\">'s'</span>, *graveyard ) ;</div><div class=\"line\">  evilpassage-&gt;link( <span class=\"string\">'w'</span>, *graveyard ) ;</div><div class=\"line\">  evilpassage-&gt;link( <span class=\"string\">'s'</span>, *darklair ) ;</div><div class=\"line\">  darklair-&gt;link( <span class=\"string\">'n'</span>, *evilpassage ) ;</div><div class=\"line\">  darklair-&gt;link( <span class=\"string\">'s'</span>, *firepit ) ;</div><div class=\"line\">  firepit-&gt;link( <span class=\"string\">'n'</span>, *darklair ) ;</div><div class=\"line\">  firepit-&gt;link( <span class=\"string\">'e'</span>, *greenpasture ) ;</div><div class=\"line\">  greenpasture-&gt;link( <span class=\"string\">'w'</span>, *firepit ) ;</div><div class=\"line\">  greenpasture-&gt;link( <span class=\"string\">'s'</span>, *icecave ) ;</div><div class=\"line\">  greenpasture-&gt;link( <span class=\"string\">'e'</span>, *livingroom ) ;</div><div class=\"line\">  icecave-&gt;link( <span class=\"string\">'n'</span>, *greenpasture ) ;</div><div class=\"line\">  livingroom-&gt;link( <span class=\"string\">'w'</span>, *greenpasture ) ;</div><div class=\"line\">  livingroom-&gt;link( <span class=\"string\">'e'</span>, *cellar ) ;</div><div class=\"line\">  cellar-&gt;link( <span class=\"string\">'w'</span>, *livingroom ) ;</div><div class=\"line\">  cellar-&gt;link( <span class=\"string\">'n'</span>, *lifespring ) ;</div><div class=\"line\">  cellar-&gt;link( <span class=\"string\">'e'</span>, *hellsgate ) ;</div><div class=\"line\">  lifespring-&gt;link( <span class=\"string\">'s'</span>, *cellar ) ;</div><div class=\"line\">  lifespring-&gt;link( <span class=\"string\">'n'</span>, *waterfall ) ;</div><div class=\"line\">  waterfall-&gt;link( <span class=\"string\">'s'</span>, *lifespring ) ;</div><div class=\"line\">  hellsgate-&gt;link( <span class=\"string\">'w'</span>, *cellar ) ;</div><div class=\"line\">  hellsgate-&gt;link( <span class=\"string\">'e'</span>, *dragoncave ) ;</div><div class=\"line\">  dragoncave-&gt;link( <span class=\"string\">'w'</span>, *hellsgate ) ;</div><div class=\"line\">  dragoncave-&gt;link( <span class=\"string\">'e'</span>, *dragonsden ) ;</div><div class=\"line\">  dragonsden-&gt;link( <span class=\"string\">'w'</span>, *dragoncave ) ;</div><div class=\"line\">  dragonsden-&gt;link( <span class=\"string\">'e'</span>, *lostforest ) ;</div><div class=\"line\">  lostforest-&gt;link( <span class=\"string\">'w'</span>, *dragonsden ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Add monsters to rooms</span></div><div class=\"line\">  mainHall-&gt;addMonster( goblin ) ;</div><div class=\"line\">  mainHall-&gt;addMonster( imp ) ;</div><div class=\"line\">  river-&gt;addMonster( bear ) ;</div><div class=\"line\">  river-&gt;addMonster( redgoblin ) ;</div><div class=\"line\">  bluecave-&gt;addMonster( demon ) ;</div><div class=\"line\">  bluecave-&gt;addMonster( zergling ) ;</div><div class=\"line\">  morbidfield-&gt;addMonster( bats ) ;</div><div class=\"line\">  morbidfield-&gt;addMonster( morebats ) ;</div><div class=\"line\">  graveyard-&gt;addMonster( golem ) ;</div><div class=\"line\">  evilpassage-&gt;addMonster( goatdemon ) ;</div><div class=\"line\">  firepit-&gt;addMonster( cyclops ) ;</div><div class=\"line\">  greenpasture-&gt;addMonster( behemoth ) ;</div><div class=\"line\">  livingroom-&gt;addMonster( alien ) ;</div><div class=\"line\">  cellar-&gt;addMonster( giantrat ) ;</div><div class=\"line\">  hellsgate-&gt;addMonster( fallenangel ) ;</div><div class=\"line\">  dragoncave-&gt;addMonster( greatdragon ) ;</div><div class=\"line\">  dragonsden-&gt;addMonster( invincibledragon ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Add the rooms to the dungeon</span></div><div class=\"line\">  caves.addRoom( mainHall ) ;</div><div class=\"line\">  caves.addRoom( river ) ;</div><div class=\"line\">  caves.addRoom( greencave ) ;</div><div class=\"line\">  caves.addRoom( bluecave ) ;</div><div class=\"line\">  caves.addRoom( darkpit ) ;</div><div class=\"line\">  caves.addRoom( morbidfield ) ;</div><div class=\"line\">  caves.addRoom( graveyard ) ;</div><div class=\"line\">  caves.addRoom( crypt ) ;</div><div class=\"line\">  caves.addRoom( evilpassage ) ;</div><div class=\"line\">  caves.addRoom( darklair ) ;</div><div class=\"line\">  caves.addRoom( firepit ) ;</div><div class=\"line\">  caves.addRoom( greenpasture ) ;</div><div class=\"line\">  caves.addRoom( icecave ) ;</div><div class=\"line\">  caves.addRoom( livingroom ) ;</div><div class=\"line\">  caves.addRoom( cellar ) ;</div><div class=\"line\">  caves.addRoom( lifespring ) ;</div><div class=\"line\">  caves.addRoom( waterfall ) ;</div><div class=\"line\">  caves.addRoom( hellsgate ) ;</div><div class=\"line\">  caves.addRoom( dragoncave ) ;</div><div class=\"line\">  caves.addRoom( dragonsden ) ;</div><div class=\"line\">  caves.addRoom( lostforest ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Create a filter  Filter filter ;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Create a dispatch object with a command char and a value string</span></div><div class=\"line\">  Dispatch dispatch ;</div><div class=\"line\">  <span class=\"keyword\">char</span> command ;</div><div class=\"line\">  <span class=\"built_in\">string</span> value ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Simulate a new game</span></div><div class=\"line\">  <span class=\"comment\">//Create a new player and add to the dungeon</span></div><div class=\"line\">  <span class=\"built_in\">string</span> input ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Welcome to the game\\nEnter in a new name: \"</span> ;</div><div class=\"line\">  getline(<span class=\"built_in\">cin</span>, input, <span class=\"string\">'\\n'</span>);</div><div class=\"line\"></div><div class=\"line\">  Player* one = <span class=\"keyword\">new</span> Player( input, mainHall ) ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; caves.addPlayer( one ) &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Display needed info for the players</span></div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"The objective is to clear the dungeon of all monsters. Good Luck\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Enter in a new command to start, to display help type the following command\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"help:\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"To quit simply enter \\\"quit\\\" without the quotes as a new command\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"New Command\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">  getline(<span class=\"built_in\">cin</span>, input, <span class=\"string\">'\\n'</span>);</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Start the game loop</span></div><div class=\"line\">  <span class=\"keyword\">while</span>( input != <span class=\"string\">\"quit\"</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"comment\">//Pass the users message through the filter</span></div><div class=\"line\">    <span class=\"keyword\">if</span>( filter.validateMessage( input ) )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//Split the users message into a command and value pair</span></div><div class=\"line\">      command = dispatch.extractCommand( input ) ;</div><div class=\"line\">      value = dispatch.extractValue( input ) ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Match the command and forward the value</span></div><div class=\"line\">      <span class=\"keyword\">switch</span>( command )</div><div class=\"line\">      &#123;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'a'</span>: <span class=\"comment\">//Attack</span></div><div class=\"line\">          <span class=\"comment\">//If the monster does not exist or the name was mispelled</span></div><div class=\"line\">          <span class=\"keyword\">if</span>( &amp;(one-&gt;mLocation-&gt;getMonsterRef( value )) == <span class=\"literal\">NULL</span> )</div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"There is no \"</span> + value + <span class=\"string\">\" at this location\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">            <span class=\"keyword\">break</span> ;</div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"comment\">//If the monster is there but in combat the player cannot fight it</span></div><div class=\"line\">          <span class=\"keyword\">if</span>( one-&gt;mLocation-&gt;getMonsterRef( value ).inCombat == <span class=\"literal\">true</span> )</div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"The \"</span> + value + <span class=\"string\">\" is currently fighting\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">            <span class=\"keyword\">break</span> ;</div><div class=\"line\">          &#125;</div><div class=\"line\"></div><div class=\"line\">          caves.combatLoop( *one, one-&gt;mLocation-&gt;getMonsterRef( value ) ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'m'</span>: <span class=\"comment\">//Move</span></div><div class=\"line\">          <span class=\"built_in\">cout</span> &lt;&lt; one-&gt;move( value[ <span class=\"number\">0</span> ] ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'f'</span>: <span class=\"comment\">//Find</span></div><div class=\"line\">          <span class=\"built_in\">cout</span> &lt;&lt; one-&gt;search() ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'l'</span>: <span class=\"comment\">//Location</span></div><div class=\"line\">          <span class=\"built_in\">cout</span> &lt;&lt; one-&gt;getLocation() ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'e'</span>: <span class=\"comment\">//Equip</span></div><div class=\"line\">          <span class=\"built_in\">cout</span> &lt;&lt; one-&gt;equip( value ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'y'</span>: <span class=\"comment\">//You</span></div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"built_in\">string</span>* playerStats = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span> ;</div><div class=\"line\">            playerStats = caves.playerStatus( *one ) ;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">for</span>( <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; <span class=\"number\">7</span> ; ++i )</div><div class=\"line\">            &#123;</div><div class=\"line\">              <span class=\"built_in\">cout</span> &lt;&lt; playerStats[i] &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">            &#125;<span class=\"built_in\">endl</span></div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">          <span class=\"comment\">//case 't': //Talk</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'h'</span>: <span class=\"comment\">//Help Menu</span></div><div class=\"line\">          caves.displayHelp();</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Invalid command please refer to the help menu.\\nhelp:\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Or type \\\"quit\\\" to quit the game\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( caves.isComplete() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Dungeon Cleared, YOU WIN!\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( one-&gt;death() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; one-&gt;getName() + <span class=\"string\">\" was slain by the \"</span> + one-&gt;mLocation-&gt;getMonsterRef( value ).getName() &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      one-&gt;mLocation-&gt;getMonsterRef( value ).inCombat = <span class=\"literal\">false</span> ;</div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"*Hint* Secret rooms hidden abound; find them and victory shall be yours\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      input = <span class=\"string\">\"quit\"</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//Get the next command</span></div><div class=\"line\">      <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"\\n\\nNew Command\"</span> &lt;&lt; <span class=\"built_in\">endl</span> ;</div><div class=\"line\">      getline(<span class=\"built_in\">cin</span>, input, <span class=\"string\">'\\n'</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  caves.removePlayer( one-&gt;getName() ) ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>For reference here are all the files for the project below.If none of the dropbox links are working then mention it in the comments section and I’ll re-upload the files. </p>\n<p><br><a  href=\"http://dl.dropbox.com/u/22280460/database.cpp\">http://dl.dropbox.com/u/22280460/database.cpp</a><br><br /><br><a href=\"http://dl.dropbox.com/u/22280460/database.h\">http://dl.dropbox.com/u/22280460/database.h</a><br><br /><br><a href=\"http://dl.dropbox.com/u/22280460/main.cpp\">http://dl.dropbox.com/u/22280460/main.cpp</a><br><br /><br><a href=\"http://dl.dropbox.com/u/22280460/Test.cpp\">http://dl.dropbox.com/u/22280460/Test.cpp</a><br><br /><br><a href=\"http://dl.dropbox.com/u/22280460/Test.h\">http://dl.dropbox.com/u/22280460/Test.h</a><br></p>\n\n<p><a href=\"/2011/06/16/textbasedrpgpart6.html\">Click here for part 6</a><br><a href=\"/2011/06/16/textbasedrpgpart6\">Click here for part VI</a></p>\n"},{"title":"Build A Text Based Multiplayer RPG Part VI","date":"2011-06-16T07:00:00.000Z","_content":"[Click here for part V][link_part_5]\n[Click here for part VII][link_part_7]\n\n# Intro\nIn part six of the tutorial we build the client side code for the multiplayer game which will connect to the server. After completion of this part you can run the client code by itself to simulate a single player version of the game.\n\nIn this tutorial we are going to build the client code which will be used by players to access the server where the game is hosted. However for this part of the tutorial we're going to transition over from <a href=\"http://en.wikipedia.org/wiki/C%2B%2B\">pure C++</a> to <a href=\"http://en.wikipedia.org/wiki/C%2B%2B/CLI\">C++/CLI</a> for access to the <a href=\"http://msdn.microsoft.com/en-us/library/system.net.aspx\">.Net framework's networking libraries</a>. If you haven't been following this tutorial using Windows don't feel left out because you can still take the basic ideas of networking shown here and apply them to <a href=\"http://en.wikipedia.org/wiki/BSD_sockets\">BSD sockets</a> which are used on Unix(includes Mac OS X) operating systems. Or if you are skillful enough with <a href=\"http://en.wikipedia.org/wiki/Java_Native_Interface\">Java native interfacing</a> you can port this whole program over to Java and use <a href=\"http://download.oracle.com/javase/tutorial/networking/sockets/\">Java's networking packages</a>, and run our little game on any machine with the JRE installed.\n\nAnyways I'll assume that for this part of the tutorial you are either running a copy of Visual Studio 2008, Visual Studio 2010 or the express edition of Visual Studio 2010. I'm personally running the professional version of Visual Studio 2010 but you can get the express version of Visual Studio 2010 here.\n\n<a href=\"http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express\">Get the express version of Visual Studio 2010.</a>\n\nInstall Visual Studio 2010 if you haven't and once that is done follow the instructions below to create a new C++/CLI project.\n\n1) File -&gt; New -&gt; Project\n2) From the project menu find Visual C++\n3) Under Visual C++ you'll see some listings, click the one titled CLR\n4) Then create a new CLR Console Application by giving it a proper name\n5) For CLR applications you need to keep the default files while adding your own source and headers so make sure your project appears similar to the picture below.\n\nThis require that you create a new \"main.cpp\" file, so do that now and add it to the sources folder of your application. Now open up the \"main.cpp\" file as all of the following code snippets will reference the that file.\n\nThe first thing we want to do is to reference the .Net libraries for networking, threading, text manipulation and console output. To do so, add the following lines of code.\n\n```c\n#include \"stdafx.h\"\n\nusing namespace System;\nusing namespace System::IO;\nusing namespace System::Net;\nusing namespace System::Net::Sockets;\nusing namespace System::Text;\nusing namespace System::Threading;\n```\nAs our game's client program all it needs to do is simply connect to the server and be able to both send and receive request from it. Lets call the function connect() and have it take a single string argument which will be the servers ip address.\n```c\nvoid connect( String^ server )\n{\n```\nNext we need to capture two types of network exceptions, being that we will be creating a socket to stream byte code to our server they will be the ArgumentNullException and the SocketException. You can probably guess which types of errors they catch by their names so lets focus on connecting to our server. Like all exception handled code in C++/CLI we have to wrap the code responsible for throwing exceptions within a try{} block.\n```c\n    try\n    {\n```\nFor any <a href=\"http://en.wikipedia.org/wiki/Transmission_Control_Protocol\">tcp client</a> the basic premise is to connect to a remote server via specific port. Our game will use port 13000 and the server ip will be the argument passed to the function as a string.\n```c\n        // Create a TcpClient.\n        // Note, for this client to work you need to have a TcpServer \n        // connected to the same address as specified by the server, port\n        // combination.\n        Int32 port = 13000;\n        TcpClient^ client = gcnew TcpClient( server, port );\n```\nNow that our client is setup and knows the location of our server we now need to be able to send and receive messages on our port by setting up a network stream object. The network stream object will allow us to read and write messages(as encoded bytes) to and from the server.\n\n```c\n        // Get a client stream for reading and writing.\n        NetworkStream^ stream = client->GetStream();\n\n        //Prepare a Byte array to store the servers response\n        array<Byte>^ responseData = gcnew array<Byte>(256);\n```\nIn addition since byte code in its raw form is practically useless to humans we'll create a string to hold the decoded messages as ascii text.\n```c\n        //The repsonse text string\n        String^ response = String::Empty ;\n```\n\nIn our client server model once the client connects to the server the server will acknowledege the connect and send out an initial message. Since all communication between the client and server takes place over the network stream we have to decode the network stream into our byte array and then decode the raw bytes into ascii so we can read the result.\n\n```c\n        // Read the TcpServer's response and store it as bytes.\n        Int32 bytes = stream->Read( responseData, 0, responseData->Length );\n        response = Text::Encoding::ASCII->GetString( responseData, 0, bytes );\n        Console::WriteLine( response );\n```\nMuch like the single player stand alone test version, we'll still enter new commands into a console but this time the commands will get encoded and streamed over to the server.\n```c\n        //Enter a new command as raw text \n        String^ command ;\n        Console::WriteLine( \"Type a new command\\n\" ) ;\n        command = Console::ReadLine() ;\n```\n\nRecall how we read data from the server, we loaded the stream into our byte array, we encoded the byte array to ascii and then we output the message to our screen. So to send messages back to the server we just reverse this process. We load a byte array with the text typed into the console.\n\n```c\n        // Translate the passed command into ASCII and store it as a Byte array.\n        array<Byte>^ commandData = Text::Encoding::ASCII->GetBytes( command );\n```\nLastly we're going to re-implement the game loop, if you remember, our game will run until the user types \"quit\" into the command console. The game will just repeat the same process we outlined above for reading and writing across the network stream but this time within a loop.\n```c\n        while( command != \"quit\" )\n        {\n          // Send the command to the connected TcpServer\n          stream->Write( commandData, 0, commandData->Length );\n          Console::WriteLine( \"Sent: {0}\", command );\n\n          //Store the server's response\n          response = String::Empty ;\n\n          //If there is a message from the server capture and display it\n          responseData->Clear( responseData, 0, 256 ) ;\n\n          bytes = stream->Read( responseData, 0, responseData->Length );\n\n          //While there is a message available from the server read it\n          while( bytes > 0 )\n          {\n            response = Text::Encoding::ASCII->GetString( responseData, 0, bytes );\n            Console::WriteLine( \"Received: {0}\", response );\n\n            bytes = 0 ;\n            responseData->Clear( responseData, 0, 256 ) ;\n            if( stream->DataAvailable )\n            {\n              bytes = stream->Read( responseData, 0, responseData->Length );\n            }\n          }\n\n          //Enter a new command as raw text \n          Console::WriteLine( \"Type a new command\\n\" ) ;\n          command = Console::ReadLine() ;\n\n          commandData = Text::Encoding::ASCII->GetBytes( command );\n          stream->Write( commandData, 0, commandData->Length );\n\n        }\n      // Close everything.\n      client->Close();\n\n    }\n```\nRemember the exceptions we have to catch? Just add them to the end of the try block.\n```c\n    catch( ArgumentNullException^ e ) \n    {\n      Console::WriteLine( \"ArgumentNullException: {0}\", e );\n    }\n  catch( SocketException^ e ) \n  {\n    Console::WriteLine( \"SocketException: {0}\", e );\n  }\n}\n```\nNow finish the client code by adding the main() method, we'll be setting up our server on localhost so just pass 127.0.0.1 to the argument of the connect function.\n```c\nint main(array<System::String ^> ^args)\n{\n  connect( \"127.0.0.1\" ) ;\n\n  return 0;\n}\n```\nHere is a full copy of the file \"main.cpp\"\n```c\n#include \"stdafx.h\"\n\nusing namespace System;\nusing namespace System::IO;\nusing namespace System::Net;\nusing namespace System::Net::Sockets;\nusing namespace System::Text;\nusing namespace System::Threading;\n\nvoid connect( String^ server )\n{\n  try\n  {\n    // Create a TcpClient.\n    // Note, for this client to work you need to have a TcpServer \n    // connected to the same address as specified by the server, port\n    // combination.\n    Int32 port = 13000;\n    TcpClient^ client = gcnew TcpClient( server, port );\n\n    // Get a client stream for reading and writing.\n    NetworkStream^ stream = client->GetStream();\n\n    //Prepare a Byte array to store the servers response\n    array<Byte>^ responseData = gcnew array<Byte>(256);\n\n    //The repsonse text string\n    String^ response = String::Empty ;\n\n    // Read the TcpServer's response and store it as bytes.\n    Int32 bytes = stream->Read( responseData, 0, responseData->Length );\n    response = Text::Encoding::ASCII->GetString( responseData, 0, bytes );\n    Console::WriteLine( response );\n\n    //Enter a new command as raw text \n    String^ command ;\n    Console::WriteLine( \"Type a new command\\n\" ) ;\n    command = Console::ReadLine() ;\n\n    // Translate the passed command into ASCII and store it as a Byte array.\n    array<Byte>^ commandData = Text::Encoding::ASCII->GetBytes( command );\n\n    while( command != \"quit\" )\n    {\n      // Send the command to the connected TcpServer\n      stream->Write( commandData, 0, commandData->Length );\n      Console::WriteLine( \"Sent: {0}\", command );\n\n      //Store the server's response\n      response = String::Empty ;\n\n      //If there is a message from the server capture and display it\n      responseData->Clear( responseData, 0, 256 ) ;\n\n      bytes = stream->Read( responseData, 0, responseData->Length );\n\n      //While there is a message available from the server read it\n      while( bytes > 0 )\n      {\n        response = Text::Encoding::ASCII->GetString( responseData, 0, bytes );\n        Console::WriteLine( \"Received: {0}\", response );\n\n        bytes = 0 ;\n        responseData->Clear( responseData, 0, 256 ) ;\n        if( stream->DataAvailable )\n        {\n          bytes = stream->Read( responseData, 0, responseData->Length );\n        }\n      }\n\n      //Enter a new command as raw text \n      Console::WriteLine( \"Type a new command\\n\" ) ;\n      command = Console::ReadLine() ;\n\n      commandData = Text::Encoding::ASCII->GetBytes( command );\n      stream->Write( commandData, 0, commandData->Length );\n\n    }\n    // Close everything.\n    client->Close();\n\n  }\n  catch( ArgumentNullException^ e ) \n  {\n    Console::WriteLine( \"ArgumentNullException: {0}\", e );\n  }\n  catch( SocketException^ e ) \n  {\n    Console::WriteLine( \"SocketException: {0}\", e );\n  }\n}\n\nint main(array<System::String ^> ^args)\n{\n  connect( \"127.0.0.1\" ) ;\n\n  return 0;\n}\n```\n<a href=\"http://dl.dropbox.com/u/22280460/Simple_C%2B%2B_Client.rar\">Click here to download the client code for Visual Studio 2010</a>\n\nThe file is hosted on my dropbox account so let me know if you can't access it and I'll re-upload it again.\n\n[Click here for part VII][link_part_7]\n\n[link_part_5]: /2011/06/15/textbasedrpgpart5\n[link_part_7]: /2011/06/17/textbasedrpgpart7\n","source":"_posts/textbasedrpgpart6.md","raw":"---\ntitle: Build A Text Based Multiplayer RPG Part VI\ndate: 2011-06-16\ncategories: [tutorial]\ntags: [cpp]\n---\n[Click here for part V][link_part_5]\n[Click here for part VII][link_part_7]\n\n# Intro\nIn part six of the tutorial we build the client side code for the multiplayer game which will connect to the server. After completion of this part you can run the client code by itself to simulate a single player version of the game.\n\nIn this tutorial we are going to build the client code which will be used by players to access the server where the game is hosted. However for this part of the tutorial we're going to transition over from <a href=\"http://en.wikipedia.org/wiki/C%2B%2B\">pure C++</a> to <a href=\"http://en.wikipedia.org/wiki/C%2B%2B/CLI\">C++/CLI</a> for access to the <a href=\"http://msdn.microsoft.com/en-us/library/system.net.aspx\">.Net framework's networking libraries</a>. If you haven't been following this tutorial using Windows don't feel left out because you can still take the basic ideas of networking shown here and apply them to <a href=\"http://en.wikipedia.org/wiki/BSD_sockets\">BSD sockets</a> which are used on Unix(includes Mac OS X) operating systems. Or if you are skillful enough with <a href=\"http://en.wikipedia.org/wiki/Java_Native_Interface\">Java native interfacing</a> you can port this whole program over to Java and use <a href=\"http://download.oracle.com/javase/tutorial/networking/sockets/\">Java's networking packages</a>, and run our little game on any machine with the JRE installed.\n\nAnyways I'll assume that for this part of the tutorial you are either running a copy of Visual Studio 2008, Visual Studio 2010 or the express edition of Visual Studio 2010. I'm personally running the professional version of Visual Studio 2010 but you can get the express version of Visual Studio 2010 here.\n\n<a href=\"http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express\">Get the express version of Visual Studio 2010.</a>\n\nInstall Visual Studio 2010 if you haven't and once that is done follow the instructions below to create a new C++/CLI project.\n\n1) File -&gt; New -&gt; Project\n2) From the project menu find Visual C++\n3) Under Visual C++ you'll see some listings, click the one titled CLR\n4) Then create a new CLR Console Application by giving it a proper name\n5) For CLR applications you need to keep the default files while adding your own source and headers so make sure your project appears similar to the picture below.\n\nThis require that you create a new \"main.cpp\" file, so do that now and add it to the sources folder of your application. Now open up the \"main.cpp\" file as all of the following code snippets will reference the that file.\n\nThe first thing we want to do is to reference the .Net libraries for networking, threading, text manipulation and console output. To do so, add the following lines of code.\n\n```c\n#include \"stdafx.h\"\n\nusing namespace System;\nusing namespace System::IO;\nusing namespace System::Net;\nusing namespace System::Net::Sockets;\nusing namespace System::Text;\nusing namespace System::Threading;\n```\nAs our game's client program all it needs to do is simply connect to the server and be able to both send and receive request from it. Lets call the function connect() and have it take a single string argument which will be the servers ip address.\n```c\nvoid connect( String^ server )\n{\n```\nNext we need to capture two types of network exceptions, being that we will be creating a socket to stream byte code to our server they will be the ArgumentNullException and the SocketException. You can probably guess which types of errors they catch by their names so lets focus on connecting to our server. Like all exception handled code in C++/CLI we have to wrap the code responsible for throwing exceptions within a try{} block.\n```c\n    try\n    {\n```\nFor any <a href=\"http://en.wikipedia.org/wiki/Transmission_Control_Protocol\">tcp client</a> the basic premise is to connect to a remote server via specific port. Our game will use port 13000 and the server ip will be the argument passed to the function as a string.\n```c\n        // Create a TcpClient.\n        // Note, for this client to work you need to have a TcpServer \n        // connected to the same address as specified by the server, port\n        // combination.\n        Int32 port = 13000;\n        TcpClient^ client = gcnew TcpClient( server, port );\n```\nNow that our client is setup and knows the location of our server we now need to be able to send and receive messages on our port by setting up a network stream object. The network stream object will allow us to read and write messages(as encoded bytes) to and from the server.\n\n```c\n        // Get a client stream for reading and writing.\n        NetworkStream^ stream = client->GetStream();\n\n        //Prepare a Byte array to store the servers response\n        array<Byte>^ responseData = gcnew array<Byte>(256);\n```\nIn addition since byte code in its raw form is practically useless to humans we'll create a string to hold the decoded messages as ascii text.\n```c\n        //The repsonse text string\n        String^ response = String::Empty ;\n```\n\nIn our client server model once the client connects to the server the server will acknowledege the connect and send out an initial message. Since all communication between the client and server takes place over the network stream we have to decode the network stream into our byte array and then decode the raw bytes into ascii so we can read the result.\n\n```c\n        // Read the TcpServer's response and store it as bytes.\n        Int32 bytes = stream->Read( responseData, 0, responseData->Length );\n        response = Text::Encoding::ASCII->GetString( responseData, 0, bytes );\n        Console::WriteLine( response );\n```\nMuch like the single player stand alone test version, we'll still enter new commands into a console but this time the commands will get encoded and streamed over to the server.\n```c\n        //Enter a new command as raw text \n        String^ command ;\n        Console::WriteLine( \"Type a new command\\n\" ) ;\n        command = Console::ReadLine() ;\n```\n\nRecall how we read data from the server, we loaded the stream into our byte array, we encoded the byte array to ascii and then we output the message to our screen. So to send messages back to the server we just reverse this process. We load a byte array with the text typed into the console.\n\n```c\n        // Translate the passed command into ASCII and store it as a Byte array.\n        array<Byte>^ commandData = Text::Encoding::ASCII->GetBytes( command );\n```\nLastly we're going to re-implement the game loop, if you remember, our game will run until the user types \"quit\" into the command console. The game will just repeat the same process we outlined above for reading and writing across the network stream but this time within a loop.\n```c\n        while( command != \"quit\" )\n        {\n          // Send the command to the connected TcpServer\n          stream->Write( commandData, 0, commandData->Length );\n          Console::WriteLine( \"Sent: {0}\", command );\n\n          //Store the server's response\n          response = String::Empty ;\n\n          //If there is a message from the server capture and display it\n          responseData->Clear( responseData, 0, 256 ) ;\n\n          bytes = stream->Read( responseData, 0, responseData->Length );\n\n          //While there is a message available from the server read it\n          while( bytes > 0 )\n          {\n            response = Text::Encoding::ASCII->GetString( responseData, 0, bytes );\n            Console::WriteLine( \"Received: {0}\", response );\n\n            bytes = 0 ;\n            responseData->Clear( responseData, 0, 256 ) ;\n            if( stream->DataAvailable )\n            {\n              bytes = stream->Read( responseData, 0, responseData->Length );\n            }\n          }\n\n          //Enter a new command as raw text \n          Console::WriteLine( \"Type a new command\\n\" ) ;\n          command = Console::ReadLine() ;\n\n          commandData = Text::Encoding::ASCII->GetBytes( command );\n          stream->Write( commandData, 0, commandData->Length );\n\n        }\n      // Close everything.\n      client->Close();\n\n    }\n```\nRemember the exceptions we have to catch? Just add them to the end of the try block.\n```c\n    catch( ArgumentNullException^ e ) \n    {\n      Console::WriteLine( \"ArgumentNullException: {0}\", e );\n    }\n  catch( SocketException^ e ) \n  {\n    Console::WriteLine( \"SocketException: {0}\", e );\n  }\n}\n```\nNow finish the client code by adding the main() method, we'll be setting up our server on localhost so just pass 127.0.0.1 to the argument of the connect function.\n```c\nint main(array<System::String ^> ^args)\n{\n  connect( \"127.0.0.1\" ) ;\n\n  return 0;\n}\n```\nHere is a full copy of the file \"main.cpp\"\n```c\n#include \"stdafx.h\"\n\nusing namespace System;\nusing namespace System::IO;\nusing namespace System::Net;\nusing namespace System::Net::Sockets;\nusing namespace System::Text;\nusing namespace System::Threading;\n\nvoid connect( String^ server )\n{\n  try\n  {\n    // Create a TcpClient.\n    // Note, for this client to work you need to have a TcpServer \n    // connected to the same address as specified by the server, port\n    // combination.\n    Int32 port = 13000;\n    TcpClient^ client = gcnew TcpClient( server, port );\n\n    // Get a client stream for reading and writing.\n    NetworkStream^ stream = client->GetStream();\n\n    //Prepare a Byte array to store the servers response\n    array<Byte>^ responseData = gcnew array<Byte>(256);\n\n    //The repsonse text string\n    String^ response = String::Empty ;\n\n    // Read the TcpServer's response and store it as bytes.\n    Int32 bytes = stream->Read( responseData, 0, responseData->Length );\n    response = Text::Encoding::ASCII->GetString( responseData, 0, bytes );\n    Console::WriteLine( response );\n\n    //Enter a new command as raw text \n    String^ command ;\n    Console::WriteLine( \"Type a new command\\n\" ) ;\n    command = Console::ReadLine() ;\n\n    // Translate the passed command into ASCII and store it as a Byte array.\n    array<Byte>^ commandData = Text::Encoding::ASCII->GetBytes( command );\n\n    while( command != \"quit\" )\n    {\n      // Send the command to the connected TcpServer\n      stream->Write( commandData, 0, commandData->Length );\n      Console::WriteLine( \"Sent: {0}\", command );\n\n      //Store the server's response\n      response = String::Empty ;\n\n      //If there is a message from the server capture and display it\n      responseData->Clear( responseData, 0, 256 ) ;\n\n      bytes = stream->Read( responseData, 0, responseData->Length );\n\n      //While there is a message available from the server read it\n      while( bytes > 0 )\n      {\n        response = Text::Encoding::ASCII->GetString( responseData, 0, bytes );\n        Console::WriteLine( \"Received: {0}\", response );\n\n        bytes = 0 ;\n        responseData->Clear( responseData, 0, 256 ) ;\n        if( stream->DataAvailable )\n        {\n          bytes = stream->Read( responseData, 0, responseData->Length );\n        }\n      }\n\n      //Enter a new command as raw text \n      Console::WriteLine( \"Type a new command\\n\" ) ;\n      command = Console::ReadLine() ;\n\n      commandData = Text::Encoding::ASCII->GetBytes( command );\n      stream->Write( commandData, 0, commandData->Length );\n\n    }\n    // Close everything.\n    client->Close();\n\n  }\n  catch( ArgumentNullException^ e ) \n  {\n    Console::WriteLine( \"ArgumentNullException: {0}\", e );\n  }\n  catch( SocketException^ e ) \n  {\n    Console::WriteLine( \"SocketException: {0}\", e );\n  }\n}\n\nint main(array<System::String ^> ^args)\n{\n  connect( \"127.0.0.1\" ) ;\n\n  return 0;\n}\n```\n<a href=\"http://dl.dropbox.com/u/22280460/Simple_C%2B%2B_Client.rar\">Click here to download the client code for Visual Studio 2010</a>\n\nThe file is hosted on my dropbox account so let me know if you can't access it and I'll re-upload it again.\n\n[Click here for part VII][link_part_7]\n\n[link_part_5]: /2011/06/15/textbasedrpgpart5\n[link_part_7]: /2011/06/17/textbasedrpgpart7\n","slug":"textbasedrpgpart6","published":1,"updated":"2017-04-14T06:00:43.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr2s00159uwvqzupq3rt","content":"<p><a href=\"/2011/06/15/textbasedrpgpart5\">Click here for part V</a><br><a href=\"/2011/06/17/textbasedrpgpart7\">Click here for part VII</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>In part six of the tutorial we build the client side code for the multiplayer game which will connect to the server. After completion of this part you can run the client code by itself to simulate a single player version of the game.</p>\n<p>In this tutorial we are going to build the client code which will be used by players to access the server where the game is hosted. However for this part of the tutorial we’re going to transition over from <a href=\"http://en.wikipedia.org/wiki/C%2B%2B\" target=\"_blank\" rel=\"external\">pure C++</a> to <a href=\"http://en.wikipedia.org/wiki/C%2B%2B/CLI\" target=\"_blank\" rel=\"external\">C++/CLI</a> for access to the <a href=\"http://msdn.microsoft.com/en-us/library/system.net.aspx\" target=\"_blank\" rel=\"external\">.Net framework’s networking libraries</a>. If you haven’t been following this tutorial using Windows don’t feel left out because you can still take the basic ideas of networking shown here and apply them to <a href=\"http://en.wikipedia.org/wiki/BSD_sockets\" target=\"_blank\" rel=\"external\">BSD sockets</a> which are used on Unix(includes Mac OS X) operating systems. Or if you are skillful enough with <a href=\"http://en.wikipedia.org/wiki/Java_Native_Interface\" target=\"_blank\" rel=\"external\">Java native interfacing</a> you can port this whole program over to Java and use <a href=\"http://download.oracle.com/javase/tutorial/networking/sockets/\" target=\"_blank\" rel=\"external\">Java’s networking packages</a>, and run our little game on any machine with the JRE installed.</p>\n<p>Anyways I’ll assume that for this part of the tutorial you are either running a copy of Visual Studio 2008, Visual Studio 2010 or the express edition of Visual Studio 2010. I’m personally running the professional version of Visual Studio 2010 but you can get the express version of Visual Studio 2010 here.</p>\n<p><a href=\"http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express\" target=\"_blank\" rel=\"external\">Get the express version of Visual Studio 2010.</a></p>\n<p>Install Visual Studio 2010 if you haven’t and once that is done follow the instructions below to create a new C++/CLI project.</p>\n<p>1) File -&gt; New -&gt; Project<br>2) From the project menu find Visual C++<br>3) Under Visual C++ you’ll see some listings, click the one titled CLR<br>4) Then create a new CLR Console Application by giving it a proper name<br>5) For CLR applications you need to keep the default files while adding your own source and headers so make sure your project appears similar to the picture below.</p>\n<p>This require that you create a new “main.cpp” file, so do that now and add it to the sources folder of your application. Now open up the “main.cpp” file as all of the following code snippets will reference the that file.</p>\n<p>The first thing we want to do is to reference the .Net libraries for networking, threading, text manipulation and console output. To do so, add the following lines of code.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::IO;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net::Sockets;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Text;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Threading;</div></pre></td></tr></table></figure>\n<p>As our game’s client program all it needs to do is simply connect to the server and be able to both send and receive request from it. Lets call the function connect() and have it take a single string argument which will be the servers ip address.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">connect</span><span class=\"params\">( String^ server )</span></span></div><div class=\"line\">&#123;</div></pre></td></tr></table></figure></p>\n<p>Next we need to capture two types of network exceptions, being that we will be creating a socket to stream byte code to our server they will be the ArgumentNullException and the SocketException. You can probably guess which types of errors they catch by their names so lets focus on connecting to our server. Like all exception handled code in C++/CLI we have to wrap the code responsible for throwing exceptions within a try{} block.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">try</span></div><div class=\"line\">&#123;</div></pre></td></tr></table></figure></p>\n<p>For any <a href=\"http://en.wikipedia.org/wiki/Transmission_Control_Protocol\" target=\"_blank\" rel=\"external\">tcp client</a> the basic premise is to connect to a remote server via specific port. Our game will use port 13000 and the server ip will be the argument passed to the function as a string.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Create a TcpClient.</span></div><div class=\"line\"><span class=\"comment\">// Note, for this client to work you need to have a TcpServer </span></div><div class=\"line\"><span class=\"comment\">// connected to the same address as specified by the server, port</span></div><div class=\"line\"><span class=\"comment\">// combination.</span></div><div class=\"line\">Int32 port = <span class=\"number\">13000</span>;</div><div class=\"line\">TcpClient^ client = gcnew TcpClient( server, port );</div></pre></td></tr></table></figure></p>\n<p>Now that our client is setup and knows the location of our server we now need to be able to send and receive messages on our port by setting up a network stream object. The network stream object will allow us to read and write messages(as encoded bytes) to and from the server.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Get a client stream for reading and writing.</span></div><div class=\"line\">NetworkStream^ stream = client-&gt;GetStream();</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">//Prepare a Byte array to store the servers response</span></div><div class=\"line\"><span class=\"built_in\">array</span>&lt;Byte&gt;^ responseData = gcnew <span class=\"built_in\">array</span>&lt;Byte&gt;(<span class=\"number\">256</span>);</div></pre></td></tr></table></figure>\n<p>In addition since byte code in its raw form is practically useless to humans we’ll create a string to hold the decoded messages as ascii text.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//The repsonse text string</span></div><div class=\"line\">String^ response = String::Empty ;</div></pre></td></tr></table></figure></p>\n<p>In our client server model once the client connects to the server the server will acknowledege the connect and send out an initial message. Since all communication between the client and server takes place over the network stream we have to decode the network stream into our byte array and then decode the raw bytes into ascii so we can read the result.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Read the TcpServer's response and store it as bytes.</span></div><div class=\"line\">Int32 bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\">response = Text::Encoding::ASCII-&gt;GetString( responseData, <span class=\"number\">0</span>, bytes );</div><div class=\"line\">Console::WriteLine( response );</div></pre></td></tr></table></figure>\n<p>Much like the single player stand alone test version, we’ll still enter new commands into a console but this time the commands will get encoded and streamed over to the server.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Enter a new command as raw text </span></div><div class=\"line\">String^ command ;</div><div class=\"line\">Console::WriteLine( <span class=\"string\">\"Type a new command\\n\"</span> ) ;</div><div class=\"line\">command = Console::ReadLine() ;</div></pre></td></tr></table></figure></p>\n<p>Recall how we read data from the server, we loaded the stream into our byte array, we encoded the byte array to ascii and then we output the message to our screen. So to send messages back to the server we just reverse this process. We load a byte array with the text typed into the console.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Translate the passed command into ASCII and store it as a Byte array.</span></div><div class=\"line\"><span class=\"built_in\">array</span>&lt;Byte&gt;^ commandData = Text::Encoding::ASCII-&gt;GetBytes( command );</div></pre></td></tr></table></figure>\n<p>Lastly we’re going to re-implement the game loop, if you remember, our game will run until the user types “quit” into the command console. The game will just repeat the same process we outlined above for reading and writing across the network stream but this time within a loop.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"keyword\">while</span>( command != <span class=\"string\">\"quit\"</span> )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">// Send the command to the connected TcpServer</span></div><div class=\"line\">      stream-&gt;Write( commandData, <span class=\"number\">0</span>, commandData-&gt;Length );</div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"Sent: &#123;0&#125;\"</span>, command );</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Store the server's response</span></div><div class=\"line\">      response = String::Empty ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//If there is a message from the server capture and display it</span></div><div class=\"line\">      responseData-&gt;Clear( responseData, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\"></div><div class=\"line\">      bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//While there is a message available from the server read it</span></div><div class=\"line\">      <span class=\"keyword\">while</span>( bytes &gt; <span class=\"number\">0</span> )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = Text::Encoding::ASCII-&gt;GetString( responseData, <span class=\"number\">0</span>, bytes );</div><div class=\"line\">        Console::WriteLine( <span class=\"string\">\"Received: &#123;0&#125;\"</span>, response );</div><div class=\"line\"></div><div class=\"line\">        bytes = <span class=\"number\">0</span> ;</div><div class=\"line\">        responseData-&gt;Clear( responseData, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\">        <span class=\"keyword\">if</span>( stream-&gt;DataAvailable )</div><div class=\"line\">        &#123;</div><div class=\"line\">          bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Enter a new command as raw text </span></div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"Type a new command\\n\"</span> ) ;</div><div class=\"line\">      command = Console::ReadLine() ;</div><div class=\"line\"></div><div class=\"line\">      commandData = Text::Encoding::ASCII-&gt;GetBytes( command );</div><div class=\"line\">      stream-&gt;Write( commandData, <span class=\"number\">0</span>, commandData-&gt;Length );</div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\">  <span class=\"comment\">// Close everything.</span></div><div class=\"line\">  client-&gt;Close();</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Remember the exceptions we have to catch? Just add them to the end of the try block.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"keyword\">catch</span>( ArgumentNullException^ e ) </div><div class=\"line\">    &#123;</div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"ArgumentNullException: &#123;0&#125;\"</span>, e );</div><div class=\"line\">    &#125;</div><div class=\"line\">  <span class=\"keyword\">catch</span>( SocketException^ e ) </div><div class=\"line\">  &#123;</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"SocketException: &#123;0&#125;\"</span>, e );</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now finish the client code by adding the main() method, we’ll be setting up our server on localhost so just pass 127.0.0.1 to the argument of the connect function.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"built_in\">array</span>&lt;System::String ^&gt; ^args)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">  connect( <span class=\"string\">\"127.0.0.1\"</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Here is a full copy of the file “main.cpp”<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::IO;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net::Sockets;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Text;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Threading;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">connect</span><span class=\"params\">( String^ server )</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">try</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"comment\">// Create a TcpClient.</span></div><div class=\"line\">    <span class=\"comment\">// Note, for this client to work you need to have a TcpServer </span></div><div class=\"line\">    <span class=\"comment\">// connected to the same address as specified by the server, port</span></div><div class=\"line\">    <span class=\"comment\">// combination.</span></div><div class=\"line\">    Int32 port = <span class=\"number\">13000</span>;</div><div class=\"line\">    TcpClient^ client = gcnew TcpClient( server, port );</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Get a client stream for reading and writing.</span></div><div class=\"line\">    NetworkStream^ stream = client-&gt;GetStream();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//Prepare a Byte array to store the servers response</span></div><div class=\"line\">    <span class=\"built_in\">array</span>&lt;Byte&gt;^ responseData = gcnew <span class=\"built_in\">array</span>&lt;Byte&gt;(<span class=\"number\">256</span>);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//The repsonse text string</span></div><div class=\"line\">    String^ response = String::Empty ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Read the TcpServer's response and store it as bytes.</span></div><div class=\"line\">    Int32 bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\">    response = Text::Encoding::ASCII-&gt;GetString( responseData, <span class=\"number\">0</span>, bytes );</div><div class=\"line\">    Console::WriteLine( response );</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//Enter a new command as raw text </span></div><div class=\"line\">    String^ command ;</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"Type a new command\\n\"</span> ) ;</div><div class=\"line\">    command = Console::ReadLine() ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Translate the passed command into ASCII and store it as a Byte array.</span></div><div class=\"line\">    <span class=\"built_in\">array</span>&lt;Byte&gt;^ commandData = Text::Encoding::ASCII-&gt;GetBytes( command );</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span>( command != <span class=\"string\">\"quit\"</span> )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">// Send the command to the connected TcpServer</span></div><div class=\"line\">      stream-&gt;Write( commandData, <span class=\"number\">0</span>, commandData-&gt;Length );</div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"Sent: &#123;0&#125;\"</span>, command );</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Store the server's response</span></div><div class=\"line\">      response = String::Empty ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//If there is a message from the server capture and display it</span></div><div class=\"line\">      responseData-&gt;Clear( responseData, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\"></div><div class=\"line\">      bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//While there is a message available from the server read it</span></div><div class=\"line\">      <span class=\"keyword\">while</span>( bytes &gt; <span class=\"number\">0</span> )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = Text::Encoding::ASCII-&gt;GetString( responseData, <span class=\"number\">0</span>, bytes );</div><div class=\"line\">        Console::WriteLine( <span class=\"string\">\"Received: &#123;0&#125;\"</span>, response );</div><div class=\"line\"></div><div class=\"line\">        bytes = <span class=\"number\">0</span> ;</div><div class=\"line\">        responseData-&gt;Clear( responseData, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\">        <span class=\"keyword\">if</span>( stream-&gt;DataAvailable )</div><div class=\"line\">        &#123;</div><div class=\"line\">          bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Enter a new command as raw text </span></div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"Type a new command\\n\"</span> ) ;</div><div class=\"line\">      command = Console::ReadLine() ;</div><div class=\"line\"></div><div class=\"line\">      commandData = Text::Encoding::ASCII-&gt;GetBytes( command );</div><div class=\"line\">      stream-&gt;Write( commandData, <span class=\"number\">0</span>, commandData-&gt;Length );</div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// Close everything.</span></div><div class=\"line\">    client-&gt;Close();</div><div class=\"line\"></div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">catch</span>( ArgumentNullException^ e ) </div><div class=\"line\">  &#123;</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"ArgumentNullException: &#123;0&#125;\"</span>, e );</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">catch</span>( SocketException^ e ) </div><div class=\"line\">  &#123;</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"SocketException: &#123;0&#125;\"</span>, e );</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"built_in\">array</span>&lt;System::String ^&gt; ^args)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">  connect( <span class=\"string\">\"127.0.0.1\"</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><a href=\"http://dl.dropbox.com/u/22280460/Simple_C%2B%2B_Client.rar\" target=\"_blank\" rel=\"external\">Click here to download the client code for Visual Studio 2010</a></p>\n<p>The file is hosted on my dropbox account so let me know if you can’t access it and I’ll re-upload it again.</p>\n<p><a href=\"/2011/06/17/textbasedrpgpart7\">Click here for part VII</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"/2011/06/15/textbasedrpgpart5\">Click here for part V</a><br><a href=\"/2011/06/17/textbasedrpgpart7\">Click here for part VII</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>In part six of the tutorial we build the client side code for the multiplayer game which will connect to the server. After completion of this part you can run the client code by itself to simulate a single player version of the game.</p>\n<p>In this tutorial we are going to build the client code which will be used by players to access the server where the game is hosted. However for this part of the tutorial we’re going to transition over from <a href=\"http://en.wikipedia.org/wiki/C%2B%2B\">pure C++</a> to <a href=\"http://en.wikipedia.org/wiki/C%2B%2B/CLI\">C++/CLI</a> for access to the <a href=\"http://msdn.microsoft.com/en-us/library/system.net.aspx\">.Net framework’s networking libraries</a>. If you haven’t been following this tutorial using Windows don’t feel left out because you can still take the basic ideas of networking shown here and apply them to <a href=\"http://en.wikipedia.org/wiki/BSD_sockets\">BSD sockets</a> which are used on Unix(includes Mac OS X) operating systems. Or if you are skillful enough with <a href=\"http://en.wikipedia.org/wiki/Java_Native_Interface\">Java native interfacing</a> you can port this whole program over to Java and use <a href=\"http://download.oracle.com/javase/tutorial/networking/sockets/\">Java’s networking packages</a>, and run our little game on any machine with the JRE installed.</p>\n<p>Anyways I’ll assume that for this part of the tutorial you are either running a copy of Visual Studio 2008, Visual Studio 2010 or the express edition of Visual Studio 2010. I’m personally running the professional version of Visual Studio 2010 but you can get the express version of Visual Studio 2010 here.</p>\n<p><a href=\"http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express\">Get the express version of Visual Studio 2010.</a></p>\n<p>Install Visual Studio 2010 if you haven’t and once that is done follow the instructions below to create a new C++/CLI project.</p>\n<p>1) File -&gt; New -&gt; Project<br>2) From the project menu find Visual C++<br>3) Under Visual C++ you’ll see some listings, click the one titled CLR<br>4) Then create a new CLR Console Application by giving it a proper name<br>5) For CLR applications you need to keep the default files while adding your own source and headers so make sure your project appears similar to the picture below.</p>\n<p>This require that you create a new “main.cpp” file, so do that now and add it to the sources folder of your application. Now open up the “main.cpp” file as all of the following code snippets will reference the that file.</p>\n<p>The first thing we want to do is to reference the .Net libraries for networking, threading, text manipulation and console output. To do so, add the following lines of code.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::IO;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net::Sockets;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Text;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Threading;</div></pre></td></tr></table></figure>\n<p>As our game’s client program all it needs to do is simply connect to the server and be able to both send and receive request from it. Lets call the function connect() and have it take a single string argument which will be the servers ip address.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">connect</span><span class=\"params\">( String^ server )</span></div><div class=\"line\"></span>&#123;</div></pre></td></tr></table></figure></p>\n<p>Next we need to capture two types of network exceptions, being that we will be creating a socket to stream byte code to our server they will be the ArgumentNullException and the SocketException. You can probably guess which types of errors they catch by their names so lets focus on connecting to our server. Like all exception handled code in C++/CLI we have to wrap the code responsible for throwing exceptions within a try{} block.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">try</span></div><div class=\"line\">&#123;</div></pre></td></tr></table></figure></p>\n<p>For any <a href=\"http://en.wikipedia.org/wiki/Transmission_Control_Protocol\">tcp client</a> the basic premise is to connect to a remote server via specific port. Our game will use port 13000 and the server ip will be the argument passed to the function as a string.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Create a TcpClient.</span></div><div class=\"line\"><span class=\"comment\">// Note, for this client to work you need to have a TcpServer </span></div><div class=\"line\"><span class=\"comment\">// connected to the same address as specified by the server, port</span></div><div class=\"line\"><span class=\"comment\">// combination.</span></div><div class=\"line\">Int32 port = <span class=\"number\">13000</span>;</div><div class=\"line\">TcpClient^ client = gcnew TcpClient( server, port );</div></pre></td></tr></table></figure></p>\n<p>Now that our client is setup and knows the location of our server we now need to be able to send and receive messages on our port by setting up a network stream object. The network stream object will allow us to read and write messages(as encoded bytes) to and from the server.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Get a client stream for reading and writing.</span></div><div class=\"line\">NetworkStream^ stream = client-&gt;GetStream();</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">//Prepare a Byte array to store the servers response</span></div><div class=\"line\"><span class=\"built_in\">array</span>&lt;Byte&gt;^ responseData = gcnew <span class=\"built_in\">array</span>&lt;Byte&gt;(<span class=\"number\">256</span>);</div></pre></td></tr></table></figure>\n<p>In addition since byte code in its raw form is practically useless to humans we’ll create a string to hold the decoded messages as ascii text.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//The repsonse text string</span></div><div class=\"line\">String^ response = String::Empty ;</div></pre></td></tr></table></figure></p>\n<p>In our client server model once the client connects to the server the server will acknowledege the connect and send out an initial message. Since all communication between the client and server takes place over the network stream we have to decode the network stream into our byte array and then decode the raw bytes into ascii so we can read the result.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Read the TcpServer's response and store it as bytes.</span></div><div class=\"line\">Int32 bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\">response = Text::Encoding::ASCII-&gt;GetString( responseData, <span class=\"number\">0</span>, bytes );</div><div class=\"line\">Console::WriteLine( response );</div></pre></td></tr></table></figure>\n<p>Much like the single player stand alone test version, we’ll still enter new commands into a console but this time the commands will get encoded and streamed over to the server.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//Enter a new command as raw text </span></div><div class=\"line\">String^ command ;</div><div class=\"line\">Console::WriteLine( <span class=\"string\">\"Type a new command\\n\"</span> ) ;</div><div class=\"line\">command = Console::ReadLine() ;</div></pre></td></tr></table></figure></p>\n<p>Recall how we read data from the server, we loaded the stream into our byte array, we encoded the byte array to ascii and then we output the message to our screen. So to send messages back to the server we just reverse this process. We load a byte array with the text typed into the console.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// Translate the passed command into ASCII and store it as a Byte array.</span></div><div class=\"line\"><span class=\"built_in\">array</span>&lt;Byte&gt;^ commandData = Text::Encoding::ASCII-&gt;GetBytes( command );</div></pre></td></tr></table></figure>\n<p>Lastly we’re going to re-implement the game loop, if you remember, our game will run until the user types “quit” into the command console. The game will just repeat the same process we outlined above for reading and writing across the network stream but this time within a loop.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"keyword\">while</span>( command != <span class=\"string\">\"quit\"</span> )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">// Send the command to the connected TcpServer</span></div><div class=\"line\">      stream-&gt;Write( commandData, <span class=\"number\">0</span>, commandData-&gt;Length );</div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"Sent: &#123;0&#125;\"</span>, command );</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Store the server's response</span></div><div class=\"line\">      response = String::Empty ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//If there is a message from the server capture and display it</span></div><div class=\"line\">      responseData-&gt;Clear( responseData, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\"></div><div class=\"line\">      bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//While there is a message available from the server read it</span></div><div class=\"line\">      <span class=\"keyword\">while</span>( bytes &gt; <span class=\"number\">0</span> )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = Text::Encoding::ASCII-&gt;GetString( responseData, <span class=\"number\">0</span>, bytes );</div><div class=\"line\">        Console::WriteLine( <span class=\"string\">\"Received: &#123;0&#125;\"</span>, response );</div><div class=\"line\"></div><div class=\"line\">        bytes = <span class=\"number\">0</span> ;</div><div class=\"line\">        responseData-&gt;Clear( responseData, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\">        <span class=\"keyword\">if</span>( stream-&gt;DataAvailable )</div><div class=\"line\">        &#123;</div><div class=\"line\">          bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Enter a new command as raw text </span></div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"Type a new command\\n\"</span> ) ;</div><div class=\"line\">      command = Console::ReadLine() ;</div><div class=\"line\"></div><div class=\"line\">      commandData = Text::Encoding::ASCII-&gt;GetBytes( command );</div><div class=\"line\">      stream-&gt;Write( commandData, <span class=\"number\">0</span>, commandData-&gt;Length );</div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\">  <span class=\"comment\">// Close everything.</span></div><div class=\"line\">  client-&gt;Close();</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Remember the exceptions we have to catch? Just add them to the end of the try block.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"keyword\">catch</span>( ArgumentNullException^ e ) </div><div class=\"line\">    &#123;</div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"ArgumentNullException: &#123;0&#125;\"</span>, e );</div><div class=\"line\">    &#125;</div><div class=\"line\">  <span class=\"keyword\">catch</span>( SocketException^ e ) </div><div class=\"line\">  &#123;</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"SocketException: &#123;0&#125;\"</span>, e );</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now finish the client code by adding the main() method, we’ll be setting up our server on localhost so just pass 127.0.0.1 to the argument of the connect function.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"built_in\">array</span>&lt;System::String ^&gt; ^args)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">  connect( <span class=\"string\">\"127.0.0.1\"</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Here is a full copy of the file “main.cpp”<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::IO;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net::Sockets;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Text;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Threading;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">connect</span><span class=\"params\">( String^ server )</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">try</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"comment\">// Create a TcpClient.</span></div><div class=\"line\">    <span class=\"comment\">// Note, for this client to work you need to have a TcpServer </span></div><div class=\"line\">    <span class=\"comment\">// connected to the same address as specified by the server, port</span></div><div class=\"line\">    <span class=\"comment\">// combination.</span></div><div class=\"line\">    Int32 port = <span class=\"number\">13000</span>;</div><div class=\"line\">    TcpClient^ client = gcnew TcpClient( server, port );</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Get a client stream for reading and writing.</span></div><div class=\"line\">    NetworkStream^ stream = client-&gt;GetStream();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//Prepare a Byte array to store the servers response</span></div><div class=\"line\">    <span class=\"built_in\">array</span>&lt;Byte&gt;^ responseData = gcnew <span class=\"built_in\">array</span>&lt;Byte&gt;(<span class=\"number\">256</span>);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//The repsonse text string</span></div><div class=\"line\">    String^ response = String::Empty ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Read the TcpServer's response and store it as bytes.</span></div><div class=\"line\">    Int32 bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\">    response = Text::Encoding::ASCII-&gt;GetString( responseData, <span class=\"number\">0</span>, bytes );</div><div class=\"line\">    Console::WriteLine( response );</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//Enter a new command as raw text </span></div><div class=\"line\">    String^ command ;</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"Type a new command\\n\"</span> ) ;</div><div class=\"line\">    command = Console::ReadLine() ;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// Translate the passed command into ASCII and store it as a Byte array.</span></div><div class=\"line\">    <span class=\"built_in\">array</span>&lt;Byte&gt;^ commandData = Text::Encoding::ASCII-&gt;GetBytes( command );</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span>( command != <span class=\"string\">\"quit\"</span> )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">// Send the command to the connected TcpServer</span></div><div class=\"line\">      stream-&gt;Write( commandData, <span class=\"number\">0</span>, commandData-&gt;Length );</div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"Sent: &#123;0&#125;\"</span>, command );</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Store the server's response</span></div><div class=\"line\">      response = String::Empty ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//If there is a message from the server capture and display it</span></div><div class=\"line\">      responseData-&gt;Clear( responseData, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\"></div><div class=\"line\">      bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//While there is a message available from the server read it</span></div><div class=\"line\">      <span class=\"keyword\">while</span>( bytes &gt; <span class=\"number\">0</span> )</div><div class=\"line\">      &#123;</div><div class=\"line\">        response = Text::Encoding::ASCII-&gt;GetString( responseData, <span class=\"number\">0</span>, bytes );</div><div class=\"line\">        Console::WriteLine( <span class=\"string\">\"Received: &#123;0&#125;\"</span>, response );</div><div class=\"line\"></div><div class=\"line\">        bytes = <span class=\"number\">0</span> ;</div><div class=\"line\">        responseData-&gt;Clear( responseData, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\">        <span class=\"keyword\">if</span>( stream-&gt;DataAvailable )</div><div class=\"line\">        &#123;</div><div class=\"line\">          bytes = stream-&gt;Read( responseData, <span class=\"number\">0</span>, responseData-&gt;Length );</div><div class=\"line\">        &#125;</div><div class=\"line\">      &#125;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Enter a new command as raw text </span></div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"Type a new command\\n\"</span> ) ;</div><div class=\"line\">      command = Console::ReadLine() ;</div><div class=\"line\"></div><div class=\"line\">      commandData = Text::Encoding::ASCII-&gt;GetBytes( command );</div><div class=\"line\">      stream-&gt;Write( commandData, <span class=\"number\">0</span>, commandData-&gt;Length );</div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// Close everything.</span></div><div class=\"line\">    client-&gt;Close();</div><div class=\"line\"></div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">catch</span>( ArgumentNullException^ e ) </div><div class=\"line\">  &#123;</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"ArgumentNullException: &#123;0&#125;\"</span>, e );</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">catch</span>( SocketException^ e ) </div><div class=\"line\">  &#123;</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"SocketException: &#123;0&#125;\"</span>, e );</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"built_in\">array</span>&lt;System::String ^&gt; ^args)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">  connect( <span class=\"string\">\"127.0.0.1\"</span> ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><a href=\"http://dl.dropbox.com/u/22280460/Simple_C%2B%2B_Client.rar\">Click here to download the client code for Visual Studio 2010</a></p>\n<p>The file is hosted on my dropbox account so let me know if you can’t access it and I’ll re-upload it again.</p>\n<p><a href=\"/2011/06/17/textbasedrpgpart7\">Click here for part VII</a></p>\n"},{"title":"Build A Text Based Multiplayer RPG Part VII","date":"2011-06-17T07:00:00.000Z","_content":"[Click here for part VI][link_part_6]\n\n# Intro\nThe Final part of our tutorial, after completing this tutorial you will have successfully created a multiplayer text based rpg. Read on to learn how to design the game server that will connect to the client code written in part six.\n\nIn the last part of this series we're going to develop the server logic to host our game and end with a short demonstration of how it works in action. Just as you performed it in part 6, create a new Visual C++ CLR project within Visual Studio and add the following files leaving them empty for now; \"Common.h\", \"database.h\", \"server.h\", \"database.cpp\", \"main.cpp\" and \"server.cpp\". \n\nThe first file we'll write is the \"Common.h\" file. All \"Common.h\" does is declare the namespaces and set the constant values we'll be using for the server application. If you recall from part six when we set the client to access the server via port 13000, you can now see why we did so because by setting the same port on the server the server will know which port to set the listening socket to.\n\n```c\n#pragma once\n\n/// namespaces\nusing namespace System;\nusing namespace System::IO;\nusing namespace System::Net;\nusing namespace System::Net::Sockets;\nusing namespace System::Text;\nusing namespace System::Threading;\nusing namespace System::Collections;\n\nnamespace NetGame\n{\n  /// Constants\n  const unsigned PORT        =  13000;\n  const unsigned MAX_PLAYERS =  2;\n}\n```\n\nNext we move to the \"database.h\" file. If you remember way back in part 1 where we outlined the code for our game I told you there was a reason why we titled the header file for the game database instead of dungeon or something. The reason as you can see now is because our game will serve like a virtual database where we'll pull out data on monsters, items and locations for players to interact with and update them whenever actions occur to propagate changes to the game world out to all players. Now go ahead and add \"database.h\" from the test project over to this project. Then copy the files for \"database.cpp\" over to this new project as well from the test. However CLR applications need to reference \"stdafx.h\" within \"database.cpp\", so add the line below.\n\n```c\n#include \"stdafx.h\"\n```\nFor the server we'll start with declaring its classes and methods within \"server.h\" so go open that file. Within \"server.h\" add the following pre-processor directives.\n```c\n#pragma once\n\n#include \"stdafx.h\"\n#include \"Common.h\"\n#include \"database.h\"\n```\nNext we'll be adding two classes, one for the server and one for managing the client connections. In C++/CLI we need to have our classes managed as well so for the server class add the declarations below.\n```c\nnamespace NetGame\n{\n  public ref class Server\n  {\n    public:\n      Server();\n      static void MsgToAll( String^ from, String^ message );\n      static void ServerMsgToAll(String^ serverMessage );\n      static void MsgToPlayer( String^ serverMessage, System::String^ playername );\n\n      TcpListener^                           gameServer;\n      static System::Collections::Hashtable^ playerNames;\n      static System::Collections::Hashtable^ playersByConnection;\n  };\n```\nThen for the client relay which is responsible for starting and stopping a thread for each new player on the server add the code below.\n```c\n    public ref class TcpRelayClient\n    {\n      public:\n        TcpRelayClient( TcpClient^ playerConnection );\n        TcpClient^     client;\n        StreamReader^  reader;\n        StreamWriter^  writer;\n        String^        player;\n\n      private: \n        void startRelay();\n        void run();\n    };\n```\nThe last two methods of the server class are specific for backwards compatibility between managed and native C++.\n```c\n    // See the link below\n    //msdn.microsoft.com/en-us/library/1b4az623(v=VS.90).aspx \n    //How to: Convert System::String to Standard String\n    void MarshalString ( String^ s, std::string& os ) ;\n  String^ toSysString( std::string ) ;\n}\n```\n<div>\nThe point of string marshaling is to allow use to translate between C++/CLI String^ and native std::string* pointers. Now we're ready to tackle the meat of the application, the definitions of the servers methods; open up \"server.cpp\" for editing and first add the pre-processor directives.\n</div>\n```c\n#pragma once\n\n#include \"stdafx.h\"\n#include \"server.h\"\n#include \"database.h\" \n\nusing namespace MUD ;\n```\nFor this game since we're not using an actual database lets declare all of our game objects first before accepting any connections from remote clients.\n```c\n//BEGIN creation of the game objects\nDungeon caves( 2, 21 ) ;\n\nItem* herb_a = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_b = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_c = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_d = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_e = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_f = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_g = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n\nItem* woodsword = new Item( \"woodsword\", Item::WEAPON, 10, 0, 0 ) ;\nItem* steelblade = new Item( \"steelblade\", Item::WEAPON, 20, 0, 0 ) ;\nItem* crystalsword = new Item( \"crystalsword\", Item::WEAPON, 35, 0, 0 ) ;\nItem* genjiblade = new Item( \"genjiblade\", Item::WEAPON, 60, 0, 0 ) ;\nItem* angelicsword = new Item( \"angelicsword\", Item::WEAPON, 80, 0, 0 ) ;\nItem* finalweapon = new Item( \"dragonslayer\", Item::WEAPON, 2000, 0, 0 ) ;\n\nItem* woodarmor = new Item( \"woodarmor\", Item::ARMOR, 0, 5, 15 ) ;\nItem* steelarmor = new Item( \"steelarmor\", Item::ARMOR, 0, 7, 20 ) ;\nItem* diamondarmor = new Item( \"diamondarmor\", Item::ARMOR, 0, 12, 30 ) ;\nItem* crystalarmor = new Item( \"crystalarmor\", Item::ARMOR, 0, 15, 35 ) ;\nItem* dragonarmor = new Item( \"dragonarmor\", Item::ARMOR, 0, 20, 100 ) ;\nItem* ultimatearmor = new Item( \"ultimatearmor\", Item::ARMOR, 0, 1000, 1000 ) ;\n\nMonster* bear = new Monster( \"bear\", 15, 2, 3 ) ;\nMonster* goblin = new Monster( \"goblin\", 5, 3, 1 ) ;\nMonster* imp = new Monster( \"imp\", 5, 5, 2 ) ;\nMonster* redgoblin = new Monster( \"redgoblin\", 5, 5, 5 ) ;\nMonster* demon = new Monster( \"demon\", 6, 3, 7 ) ;\nMonster* zergling = new Monster( \"zergling\", 10, 10, 9 ) ;\nMonster* bats = new Monster( \"bats\", 20, 15, 3 ) ;\nMonster* morebats = new Monster( \"morebats\", 25, 20, 15 ) ;\nMonster* golem = new Monster( \"golem\", 50, 21, 9 ) ;\nMonster* goatdemon = new Monster( \"goatdemon\", 100, 10, 10 ) ;\nMonster* cyclops = new Monster( \"cyclops\", 150, 90, 0 ) ;\nMonster* behemoth = new Monster( \"behemoth\", 250, 30, 40 ) ;\nMonster* alien = new Monster( \"alien\", 50, 21, 4 ) ;\nMonster* giantrat = new Monster( \"giantrat\", 55, 40, 1 ) ;\nMonster* fallenangel = new Monster( \"fallenangel\", 300, 100, 100 ) ;\nMonster* greatdragon = new Monster( \"greatdragon\", 500, 300, 1 ) ;\nMonster* invincibledragon = new Monster( \"invincibledragon\", 999, 999, 999 ) ;\n\nRoom* mainHall = new Room( \"The main cavern\", \"A murkey swamp cavern\", woodsword ) ;\nRoom* river = new Room( \"The black river\", \"A river with dark water\", woodarmor ) ;\nRoom* greencave = new Room( \"The greencave\", \"A moss covered cave\", herb_a ) ;\nRoom* bluecave = new Room( \"The bluecave\", \"A frosty cave\", steelblade ) ;\nRoom* darkpit = new Room( \"The darkpit\", \"An endless hole lies before you\", steelarmor ) ;\nRoom* morbidfield = new Room( \"The morbidfield\", \"Pitch black grass surrounds you\", herb_b ) ;\nRoom* graveyard = new Room( \"The graveyard\", \"Tombstones abound\", diamondarmor ) ;\nRoom* crypt = new Room( \"The crypt\", \"A nasty rotten crypt\", crystalsword ) ;\nRoom* evilpassage = new Room( \"The evil passage\", \"An evil pasage\", crystalarmor ) ;\nRoom* darklair = new Room( \"The dark lair\", \"A dark lair\", herb_c ) ;\nRoom* firepit = new Room( \"The firey pits\", \"Fire is every where\", herb_d ) ;\nRoom* greenpasture = new Room( \"The greenpastures\", \"A meadow is before you\", genjiblade ) ;\nRoom* icecave = new Room( \"The icy caves\", \"Ice everywhere you look\", herb_e ) ;\nRoom* livingroom = new Room( \"The living room\", \"The room is alive\", dragonarmor ) ;\nRoom* cellar = new Room( \"The cellar\", \"A dirty cellar filled with rats\", angelicsword ) ;\nRoom* lifespring = new Room( \"The lifespring\", \"A beautiful fountain stands\", herb_f ) ;\nRoom* waterfall = new Room( \"The waterfall\", \"Clear blue water falls\", herb_g ) ;\nRoom* hellsgate = new Room( \"The gates of hell\", \"Large rusty doors lead to hell\", ultimatearmor ) ;\nRoom* dragoncave = new Room( \"The dragon's cave\", \"An ancient cave...\" ) ;\nRoom* dragonsden = new Room( \"The dragon's den\", \"A powerful monster awaits\" ) ;\nRoom* lostforest = new Room( \"The secret forest\", \"The strongest sword lies hidden here\", finalweapon ) ;\n\nFilter filter ;\n\nDispatch dispatch ;\nchar command ;\nstring value ;\n//END creation of the game objects\n```\n\nIn a professional game setting it would be here where you would instantiate a connection to your MySQL or whatever database your using and not load the server code until the database connection has been verified; but for this simple game this will be good enough. Now that our game objects have been created, we'll start by defining the Server constructor. Within the Server constructor we want to initialize the dynamic content of the game, i.e game content which will change state throughout the execution of our game.\n\n```c\nnamespace NetGame\n{\n  Server::Server()\n  {  \n    //BEGIN linking game objects\n    mainHall->link( 'e', *river ) ;\n    river->link( 's', *greencave ) ;\n    river->link( 'e', *bluecave ) ;\n    river->link( 'w', *mainHall ) ;\n    greencave->link( 'n', *river ) ;\n    bluecave->link( 'w', *river ) ;\n    bluecave->link( 'n', *darkpit ) ;\n    darkpit->link( 's', *bluecave ) ;\n    darkpit->link( 'n', *morbidfield ) ;\n    morbidfield->link( 's', *darkpit ) ;\n    morbidfield->link( 'e', *graveyard ) ;\n    graveyard->link( 'w', *morbidfield ) ;\n    graveyard->link( 'n', *crypt ) ;\n    graveyard->link( 'e', *evilpassage ) ;\n    crypt->link( 's', *graveyard ) ;\n    evilpassage->link( 'w', *graveyard ) ;\n    evilpassage->link( 's', *darklair ) ;\n    darklair->link( 'n', *evilpassage ) ;\n    darklair->link( 's', *firepit ) ;\n    firepit->link( 'n', *darklair ) ;\n    firepit->link( 'e', *greenpasture ) ;\n    greenpasture->link( 'w', *firepit ) ;\n    greenpasture->link( 's', *icecave ) ;\n    greenpasture->link( 'e', *livingroom ) ;\n    icecave->link( 'n', *greenpasture ) ;\n    livingroom->link( 'w', *greenpasture ) ;\n    livingroom->link( 'e', *cellar ) ;\n    cellar->link( 'w', *livingroom ) ;\n    cellar->link( 'n', *lifespring ) ;\n    cellar->link( 'e', *hellsgate ) ;\n    lifespring->link( 's', *cellar ) ;\n    lifespring->link( 'n', *waterfall ) ;\n    waterfall->link( 's', *lifespring ) ;\n    hellsgate->link( 'w', *cellar ) ;\n    hellsgate->link( 'e', *dragoncave ) ;\n    dragoncave->link( 'w', *hellsgate ) ;\n    dragoncave->link( 'e', *dragonsden ) ;\n    dragonsden->link( 'w', *dragoncave ) ;\n    dragonsden->link( 'e', *lostforest ) ;\n    lostforest->link( 'w', *dragonsden ) ;\n\n    mainHall->addMonster( goblin ) ;\n    mainHall->addMonster( imp ) ;\n    river->addMonster( bear ) ;\n    river->addMonster( redgoblin ) ;\n    bluecave->addMonster( demon ) ;\n    bluecave->addMonster( zergling ) ;\n    morbidfield->addMonster( bats ) ;\n    morbidfield->addMonster( morebats ) ;\n    graveyard->addMonster( golem ) ;\n    evilpassage->addMonster( goatdemon ) ;\n    firepit->addMonster( cyclops ) ;\n    greenpasture->addMonster( behemoth ) ;\n    livingroom->addMonster( alien ) ;\n    cellar->addMonster( giantrat ) ;\n    hellsgate->addMonster( fallenangel ) ;\n    dragoncave->addMonster( greatdragon ) ;\n    dragonsden->addMonster( invincibledragon ) ;\n\n    caves.addRoom( mainHall ) ;\n    caves.addRoom( river ) ;\n    caves.addRoom( greencave ) ;\n    caves.addRoom( bluecave ) ;\n    caves.addRoom( darkpit ) ;\n    caves.addRoom( morbidfield ) ;\n    caves.addRoom( graveyard ) ;\n    caves.addRoom( crypt ) ;\n    caves.addRoom( evilpassage ) ;\n    caves.addRoom( darklair ) ;\n    caves.addRoom( firepit ) ;\n    caves.addRoom( greenpasture ) ;\n    caves.addRoom( icecave ) ;\n    caves.addRoom( livingroom ) ;\n    caves.addRoom( cellar ) ;\n    caves.addRoom( lifespring ) ;\n    caves.addRoom( waterfall ) ;\n    caves.addRoom( hellsgate ) ;\n    caves.addRoom( dragoncave ) ;\n    caves.addRoom( dragonsden ) ;\n    caves.addRoom( lostforest ) ;\n    //END linking game objects\n```\nNext we'll set the options for the game, open up the server on our desired port and begin accepting player connections.\n```c\n    // MAX_PLAYERS and PORT can be set in Common.h\n    bool running            =  true;\n    playerNames             =  gcnew Hashtable( MAX_PLAYERS );\n    playersByConnection     =  gcnew Hashtable( MAX_PLAYERS );\n\n    gameServer              =  gcnew TcpListener( PORT );\n    gameServer->Start();\n```\nNow that the server is started you want to run the servers connection loop to keep it in a pending state for new players\n```c\n      // Server loop is infinite since we have to close the program\n      // manually when we want the server to stop.\n      while ( true )\n      {\n        if ( gameServer->Pending() )\n      }\n    TcpClient^ playerConnection = gameServer->AcceptTcpClient();\n    Console::WriteLine( \"SERVER: New player now connected! \"  ); \n    gcnew TcpRelayClient( playerConnection );\n  }\n}\n}\n```\nThe next method to define is the global messaging method which can send messages from the server to all players. This is a key feature for our game because we can easily alert players of events such as when a new player connects and or other things.\nThe code might look confusing at first but all we're doing is gathering up all the open player connections into a array of Sockets and iterating through each socket and pushing a copy of the message out. Oh and we also catch the exception if the socket connection failed, then we just remove it from the server's list(remember the playersconnections HashTable from server.h).\n```c\nvoid Server::MsgToAll( String^ from, String^ message )\n{\n  StreamWriter^ serverwriter;\n  ArrayList^ toRemove = gcnew ArrayList( 0 );\n\n  array<Sockets::TcpClient^>^  tcpClients =  gcnew array<Sockets::TcpClient^>( playerNames->Count );\n\n  Server::playerNames->Values->CopyTo(tcpClients, 0); \n  for ( int count = 0; count < tcpClients->Length; ++count )\n  {\n    try\n    {\n      if (message->Trim() == \"\" || tcpClients[count] == nullptr )  \n        continue;  \n      serverwriter =  gcnew StreamWriter(tcpClients[ count ]->GetStream());  \n      //write our message to the window  \n      serverwriter->WriteLine(from + \": \" + message);  \n      //make sure all bytes are written  \n      serverwriter->Flush();  \n      //dispose of the writer object until needed again  \n      serverwriter = nullptr;  \n\n    }\n    catch ( Exception^ error_44 )\n    {\n      error_44 = error_44;\n      String^ name = (String^)playersByConnection[tcpClients[count]];  \n      //send the message that the user has left  \n      Server::ServerMsgToAll(\"** \" + name + \" ** Has Left The Room.\");  \n      //remove the name from playernames list\n      Server::playerNames->Remove( name );\n      //remove that index of the array, thus freeing it up  \n      //for another user  \n      Server::playersByConnection->Remove(tcpClients[count]);  \n    }\n  }\n}\n```\n\nNext we'll write the code for the ServerMsgToAll, the thing about this method is that its only used to report back to the server admin the messages sent via MsgToAll when an exception occurred. The logic behind the method is similar to MsgToAll so enter the code below.\n\n```c\nvoid Server::ServerMsgToAll(String^ serverMessage )\n{\n  StreamWriter^ serverwriter;\n\n  array<Sockets::TcpClient^>^  tcpClients =  gcnew array<Sockets::TcpClient^>( playerNames->Count );\n\n  Server::playerNames->Values->CopyTo(tcpClients, 0); \n\n  for ( int count = 0; count < tcpClients->Length; ++count )\n  {\n    try\n    {\n      if (serverMessage->Trim() == \"\" || tcpClients[count] == nullptr )  \n        continue;  \n      serverwriter =  gcnew StreamWriter(tcpClients[ count ]->GetStream());  \n      //write our message to the window  \n      serverwriter->WriteLine( serverMessage );  \n      //make sure all bytes are written  \n      serverwriter->Flush();  \n      //dispose of the writer object until needed again  \n      serverwriter = nullptr;  \n      Console::WriteLine( \"SERVER SENT:\" + \" has joined the game\" );\n\n    }\n    catch ( Exception^ error_44 )\n    {\n      error_44 = error_44;\n      String^ name = (String^)playersByConnection[tcpClients[count]];  \n\n      Server::playerNames->Remove( name );\n      //remove that index of the array, thus freeing it up  \n      //for another user  \n      Server::playersByConnection->Remove(tcpClients[count]);  \n    }\n  } \n}\n```\n\nMsgToPlayer is similar again to the previous two methods except that the MsgToPlayer accepts an additional parameter for the player name of who you wish to direct the message at. The player name is reference by looking up the playerNames hash table using the player name as the key.\n\n```c\nvoid Server::MsgToPlayer(String^ serverMessage, System::String^ playername)\n{\n  StreamWriter^ serverwriter;\n\n  array<Sockets::TcpClient^>^ tcpClients = gcnew array<Sockets::TcpClient^>( playerNames->Count );\n\n  Server::playerNames->Values->CopyTo(tcpClients, 0); \n\n  for ( int count = 0; count < tcpClients->Length; ++count )\n  {\n    try\n    {\n      if (serverMessage->Trim() == \"\" || tcpClients[count] == nullptr )  \n        continue;  \n\n      if( playerNames->ContainsKey( playername ) )\n      {\n        serverwriter =  gcnew StreamWriter(tcpClients[ count ]->GetStream());  \n        //write our message to the window  \n        serverwriter->WriteLine( serverMessage );  \n        //make sure all bytes are written  \n        serverwriter->Flush();  \n        //dispose of the writer object until needed again  \n        serverwriter = nullptr;  \n        Console::WriteLine( \"SERVER SENT: \" + serverMessage + \" to \" + playername );\n      }\n    }\n    catch ( Exception^ error_44 )\n    {\n      error_44 = error_44;\n      String^ name = (String^)playersByConnection[tcpClients[count]];  \n\n      Server::playerNames->Remove( name );\n      //remove that index of the array, thus freeing it up  \n      //for another user  \n      Server::playersByConnection->Remove(tcpClients[count]);  \n    }\n  } \n}\n```\nThe next method just handles the case when a new player connection has been made.\n```c\n// When a new player connects to the server spawn a thread that will\n// run the game loop.\nTcpRelayClient::TcpRelayClient( TcpClient^ playerConnection )\n{\n  client =  playerConnection;\n  Thread^   playerRelayThread   = gcnew Thread( \n      gcnew ThreadStart( this, & NetGame::TcpRelayClient::startRelay ) );\n\n  playerRelayThread->Start();\n}\n```\nIf you look at the last method you'll notice that for each player connection we spawn a new thread on the server with the startRelay() method. The startRelay() method was chosen because its the method which runs all the logic for interacting with our game database. For the most part the startRelay() method consist of the same game loop from the test version of the game, you'll notice it soon but before that the initialization for the game loop is where the new code is. To start we setup both a stream writer and stream reader to send and receive messages from the player on the thread.\n```c\n// When we start a new thread for a player who just connected,\n// this is the method the thread runs.\n// In short this is the game loop the player interacts with.\nvoid TcpRelayClient::startRelay( )\n{  \n  reader = gcnew StreamReader( client->GetStream() );\n  // Writer sends messages out to the client whos connection\n  // is running on this thread.\n  writer = gcnew StreamWriter( client->GetStream() );\n\n  NetworkStream^ netReader = client->GetStream();\n```\nJust before we actually let the player begin sending new commands we have to store the player's name within our players hashtable. Please note that for this simple game we don't double check that two players will have the exact same name because we aren't building this game to support thousands of players, so our collision prone hashtables are good enough. Ok so lets get the players name, store it within the player hashtables and then let them play.\n```c\n  writer->WriteLine( \"New Game \" );\n  Console::WriteLine( \"SERVER: Getting the new users Name \" );\n  writer->WriteLine( \"Enter a new name for your charecter\" );\n  writer->Flush();\n  Console::WriteLine( \"SERVER SENT: Enter a new name for your character\" );\n\n  // Read the player's response\n  array<Byte, 1>^  bytesFromClient = gcnew array<Byte, 1>(256);\n  String^ strFromClient = String::Empty ;\n  Int32 bytes = 0 ;\n  bytes = netReader->Read( bytesFromClient, 0, bytesFromClient->Length ) ;\n  strFromClient = Text::Encoding::ASCII->GetString( bytesFromClient, 0, bytes );\n  player = strFromClient ;\n\n  // Add the player to the hash tables as a new key value pair\n  Console::WriteLine( player + \" has joined the game\" );\n  Server::playerNames->Add( player, client ); \n  Server::playersByConnection->Add( client, player );\n  String^ message ;\n\n  Thread^ playerConnect = gcnew Thread( \n      gcnew ThreadStart( this, & NetGame::TcpRelayClient::run ) );\n\n  playerConnect->Start();\n```\nFinally we can insert the code for the game loop which is directly extracted from the test game but with some slight additions to how the strings are processed. If you can recall from \"server.h\" there were two methods, MarshalString and toSysString. Marshal string converts a given managed string or a System::String to native std::string, while toSysString does exactly what it says it does.\n\n```c\n  //ALL THE CODE BELOW IS THE ACTUAL GAME LOOP\n  //Create a new player and add to the Dungeon \n  string output ;\n  string input ;\n  String^ tempStr = nullptr ;\n\n  string playerName ;\n  // MarshalString converts a managed String^ to a native string\n  MarshalString( player, playerName ) ; \n  Player* thePlayer = new Player( playerName, mainHall ) ;\n  output = caves.addPlayer( thePlayer ) ;\n\n  //Let all players know of the new player\n  message = toSysString( output ) ;\n\n  //Display needed info for the players\n  output = \"\\nDefeat all monsters\" ;\n  output += \"\\nEnter a new command to start, for help menu enter\" ;\n  output += \"\\nhelp:\" ;\n  output += \"\\nTo quit enter \\\"quit\\\"\" ;\n  message += toSysString( output ) ;\n  Server::MsgToPlayer( message, player ) ;\n\n  //Get client command\n  bytesFromClient->Clear( bytesFromClient, 0, 256 ) ;\n  bytes = netReader->Read( bytesFromClient, 0, bytesFromClient->Length ) ;\n  strFromClient = Text::Encoding::ASCII->GetString( bytesFromClient, 0, bytes ); \n  MarshalString( strFromClient, input ) ;\n\n  //Start the game loop\n  while( input != \"quit\" )\n  {\n    //Pass the users message through the filter\n    if( filter.validateMessage( input ) )\n    {\n      //Split the users message into a command and value pair\n      command = dispatch.extractCommand( input ) ;\n      value = dispatch.extractValue( input ) ;\n\n      //Match the command and forward the value\n      switch( command )\n      {\n        case 'a': //Attack \n          //If the monster does not exist or the name was mispelled\n          if( &(thePlayer->mLocation->getMonsterRef( value )) == NULL )\n          {\n            //cout << \"There is no \" + value + \" at this location\" << endl ;\n            output = \"There is no \" + value + \" at this location\" ;\n            message = toSysString( output ) ;\n            Server::MsgToPlayer( message, player ) ;\n            break ;\n          }\n          //If the monster is there but in combat the player cannot fight it\n          if( thePlayer->mLocation->getMonsterRef( value ).inCombat == true )\n          {\n            //cout << \"The \" + value + \" is currently fighting\" << endl ;\n            output = \"The \" + value + \" is currently fighting\" ;\n            message = toSysString( output ) ;\n            Server::MsgToPlayer( message, player ) ;\n            break ;\n          }\n          caves.combatLoop( *thePlayer, thePlayer->mLocation->getMonsterRef( value ) ) ;\n          output = \"combat has finished\" ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n\n        case 'm': //Move\n          //cout << thePlayer->move( value[0] ) ;\n          output = thePlayer->move( value[0] ) ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n\n        case 'f': //Find\n          //cout << thePlayer->search() ;\n          output = thePlayer->search() ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n\n        case 'l': //Location\n          //cout << thePlayer->getLocation() ;\n          output = thePlayer->getLocation() ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n\n        case 'e': //Equip\n          //cout << thePlayer->equip( value ) ;\n          output = thePlayer->equip( value ) ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n\n        case 'y': //You\n          {\n            string* playerStats = new string ;\n            playerStats = caves.playerStatus( *thePlayer ) ;\n\n            for( int i = 0 ; i < 7 ; ++i )\n            {\n              //cout << playerStats[i] << endl ;\n              output = playerStats[i] ;\n              message = toSysString( output ) ;\n              Server::MsgToPlayer( message, player ) ;\n            }\n\n            playerStats = NULL ;\n            delete playerStats ;\n          }\n          break ;\n\n        case 't': //Talk\n          output = value ;\n          message = toSysString( output ) ;\n          Server::MsgToAll( player, message ) ;\n          break ;\n\n        case 'h': //Help Menu\n          //cout << \"a: mv: find: loc: eq: you: t: help:\" << endl ;\n          output = \"a: mv: find: loc: eq: you: t: help:\" ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n      }\n    }\n    else\n    {\n      //cout << \"Invalid command\" << endl ;\n      output = \"Invalid command\" ;\n      message = toSysString( output ) ;\n      Server::MsgToPlayer( message, player ) ;\n    }\n\n    if( caves.isComplete() )\n    {\n      //cout << \"Dungeon Cleared, YOU WIN!\" << endl ;\n      output = \"Dungeon Cleared, YOU WIN!\" ;\n      message = toSysString( output ) ;\n      Server::MsgToAll( player, message ) ;\n      break ;\n    }\n\n    if( thePlayer->death() )\n    {\n      //cout << thePlayer->getName() + \" was slain by the \" + thePlayer->mLocation->getMonsterRef( value ).getName() << endl ;\n      //output = thePlayer->getName() + \" was slain by the \" + thePlayer->mLocation->getMonsterRef( value ).getName() ;\n      output = \"slain type quit to continue\" ;\n      message = toSysString( output ) ;\n      Server::MsgToPlayer( message, player ) ;\n      thePlayer->mLocation->getMonsterRef( value ).inCombat = false ;\n      break ;\n    }\n    else\n    {\n      //Get the next command\n      //cout << \"\\n\\nNew Command\" << endl ;\n      //cin >> input ;\n      //bytes = 0 ;\n      bytesFromClient->Clear( bytesFromClient, 0, 256 ) ;\n      bytes = netReader->Read( bytesFromClient, 0, bytesFromClient->Length ) ;\n      strFromClient = Text::Encoding::ASCII->GetString( bytesFromClient, 0, bytes ); \n      MarshalString( strFromClient, input ) ;\n    }\n  }\n  //End of game loop\n}\n```\nBefore we demo our fully functional multiplayer game we have to add the last utility methods for string processing and for logging of the games actions to the server's console.\n```c\n// When running is set to true during initialization of the server\n// which happens when the server constructor is called, this will\n// begin the loop which just displays all game info to the \n// server admin. Think of it as a log of all the players actions.\nvoid  TcpRelayClient::run()\n{\n  bool running = true;\n\n  try\n  {\n    String^ line = \"\";\n    while ( running )\n    {\n      if ( client->Connected )\n      {\n        line = reader->ReadLine();\n        Server::MsgToAll( player,  line );\n      }\n      else\n      {\n        running = false;            \n      }\n    }\n  }\n  catch ( Exception^ eRun )\n  {\n    Console::WriteLine( \"EXCEPTION\" +  eRun->Message + \"\\nThe player named: \" + player + \" has disconnected, the server continues\" );\n  }\n}\n\n// Converts a managed string to a native string \nvoid MarshalString ( String ^ s, string& os ) \n{\n  using namespace Runtime::InteropServices;\n  const char* chars = (const char*)(Marshal::StringToHGlobalAnsi(s)).ToPointer();\n  os = chars;\n  Marshal::FreeHGlobal(IntPtr((void*)chars));\n}\n\n// Converts a native string to a managed one\nString^ toSysString( std::string output )\n{\n  String^ tempStr = gcnew String( output.c_str() ) ;\n\n  return tempStr ;\n}\n}\n```\nNow open up the file \"main.cpp\" and run the server, we run the server via the constructor method so as soon as you create the server it will pend for request on 127.0.0.1 port 13000 for new players.\n\nFor the demo what you'll need to do is to open up three instances of Visual Studio. One instance will run the server, so open up the server project on the first one while the second and third instances will each run clients; so open up the client project on the other two. Once you have all three open the first step is to start the server.\n\nThen launch the second client and give this new player a name.\n\nNow switch back to the first client enter the following commands, \"eq:woodsword\" and then \"a:imp\" this will have the effect of equipping the woodsword item from the Main Hall and killing the imp monster. Finally switch back over to the second client and enter the following command \"find:\", you will notice that both the woodsword and the imp have cannot be found as they were both taken care of by the first player. You have just finished writing a simple text based multiplayer RPG.\n\nOnce again the two files below, the one for the server and the one for the client are hosted on my dropbox account, so if at any time they aren't accessible(I often move files around and don't clean up dead links) and put a request into the comments section.\n\n<a href=\"http://dl.dropbox.com/u/22280460/Simple_RPG_Client.rar\">Click here to download the client application</a>\n<a href=\"http://dl.dropbox.com/u/22280460/Simple_RPG_Server.rar\">Click here to download the server application</a>\n\n[Click here for part VI][link_part_6]\n\n[link_part_6]: /2011/06/16/textbasedrpgpart6\n","source":"_posts/textbasedrpgpart7.md","raw":"---\ntitle: Build A Text Based Multiplayer RPG Part VII\ndate: 2011-06-17\ncategories: [tutorial]\ntags: [cpp]\n---\n[Click here for part VI][link_part_6]\n\n# Intro\nThe Final part of our tutorial, after completing this tutorial you will have successfully created a multiplayer text based rpg. Read on to learn how to design the game server that will connect to the client code written in part six.\n\nIn the last part of this series we're going to develop the server logic to host our game and end with a short demonstration of how it works in action. Just as you performed it in part 6, create a new Visual C++ CLR project within Visual Studio and add the following files leaving them empty for now; \"Common.h\", \"database.h\", \"server.h\", \"database.cpp\", \"main.cpp\" and \"server.cpp\". \n\nThe first file we'll write is the \"Common.h\" file. All \"Common.h\" does is declare the namespaces and set the constant values we'll be using for the server application. If you recall from part six when we set the client to access the server via port 13000, you can now see why we did so because by setting the same port on the server the server will know which port to set the listening socket to.\n\n```c\n#pragma once\n\n/// namespaces\nusing namespace System;\nusing namespace System::IO;\nusing namespace System::Net;\nusing namespace System::Net::Sockets;\nusing namespace System::Text;\nusing namespace System::Threading;\nusing namespace System::Collections;\n\nnamespace NetGame\n{\n  /// Constants\n  const unsigned PORT        =  13000;\n  const unsigned MAX_PLAYERS =  2;\n}\n```\n\nNext we move to the \"database.h\" file. If you remember way back in part 1 where we outlined the code for our game I told you there was a reason why we titled the header file for the game database instead of dungeon or something. The reason as you can see now is because our game will serve like a virtual database where we'll pull out data on monsters, items and locations for players to interact with and update them whenever actions occur to propagate changes to the game world out to all players. Now go ahead and add \"database.h\" from the test project over to this project. Then copy the files for \"database.cpp\" over to this new project as well from the test. However CLR applications need to reference \"stdafx.h\" within \"database.cpp\", so add the line below.\n\n```c\n#include \"stdafx.h\"\n```\nFor the server we'll start with declaring its classes and methods within \"server.h\" so go open that file. Within \"server.h\" add the following pre-processor directives.\n```c\n#pragma once\n\n#include \"stdafx.h\"\n#include \"Common.h\"\n#include \"database.h\"\n```\nNext we'll be adding two classes, one for the server and one for managing the client connections. In C++/CLI we need to have our classes managed as well so for the server class add the declarations below.\n```c\nnamespace NetGame\n{\n  public ref class Server\n  {\n    public:\n      Server();\n      static void MsgToAll( String^ from, String^ message );\n      static void ServerMsgToAll(String^ serverMessage );\n      static void MsgToPlayer( String^ serverMessage, System::String^ playername );\n\n      TcpListener^                           gameServer;\n      static System::Collections::Hashtable^ playerNames;\n      static System::Collections::Hashtable^ playersByConnection;\n  };\n```\nThen for the client relay which is responsible for starting and stopping a thread for each new player on the server add the code below.\n```c\n    public ref class TcpRelayClient\n    {\n      public:\n        TcpRelayClient( TcpClient^ playerConnection );\n        TcpClient^     client;\n        StreamReader^  reader;\n        StreamWriter^  writer;\n        String^        player;\n\n      private: \n        void startRelay();\n        void run();\n    };\n```\nThe last two methods of the server class are specific for backwards compatibility between managed and native C++.\n```c\n    // See the link below\n    //msdn.microsoft.com/en-us/library/1b4az623(v=VS.90).aspx \n    //How to: Convert System::String to Standard String\n    void MarshalString ( String^ s, std::string& os ) ;\n  String^ toSysString( std::string ) ;\n}\n```\n<div>\nThe point of string marshaling is to allow use to translate between C++/CLI String^ and native std::string* pointers. Now we're ready to tackle the meat of the application, the definitions of the servers methods; open up \"server.cpp\" for editing and first add the pre-processor directives.\n</div>\n```c\n#pragma once\n\n#include \"stdafx.h\"\n#include \"server.h\"\n#include \"database.h\" \n\nusing namespace MUD ;\n```\nFor this game since we're not using an actual database lets declare all of our game objects first before accepting any connections from remote clients.\n```c\n//BEGIN creation of the game objects\nDungeon caves( 2, 21 ) ;\n\nItem* herb_a = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_b = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_c = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_d = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_e = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_f = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\nItem* herb_g = new Item( \"herb\", Item::HEALTH, 0, 0, 0 ) ;\n\nItem* woodsword = new Item( \"woodsword\", Item::WEAPON, 10, 0, 0 ) ;\nItem* steelblade = new Item( \"steelblade\", Item::WEAPON, 20, 0, 0 ) ;\nItem* crystalsword = new Item( \"crystalsword\", Item::WEAPON, 35, 0, 0 ) ;\nItem* genjiblade = new Item( \"genjiblade\", Item::WEAPON, 60, 0, 0 ) ;\nItem* angelicsword = new Item( \"angelicsword\", Item::WEAPON, 80, 0, 0 ) ;\nItem* finalweapon = new Item( \"dragonslayer\", Item::WEAPON, 2000, 0, 0 ) ;\n\nItem* woodarmor = new Item( \"woodarmor\", Item::ARMOR, 0, 5, 15 ) ;\nItem* steelarmor = new Item( \"steelarmor\", Item::ARMOR, 0, 7, 20 ) ;\nItem* diamondarmor = new Item( \"diamondarmor\", Item::ARMOR, 0, 12, 30 ) ;\nItem* crystalarmor = new Item( \"crystalarmor\", Item::ARMOR, 0, 15, 35 ) ;\nItem* dragonarmor = new Item( \"dragonarmor\", Item::ARMOR, 0, 20, 100 ) ;\nItem* ultimatearmor = new Item( \"ultimatearmor\", Item::ARMOR, 0, 1000, 1000 ) ;\n\nMonster* bear = new Monster( \"bear\", 15, 2, 3 ) ;\nMonster* goblin = new Monster( \"goblin\", 5, 3, 1 ) ;\nMonster* imp = new Monster( \"imp\", 5, 5, 2 ) ;\nMonster* redgoblin = new Monster( \"redgoblin\", 5, 5, 5 ) ;\nMonster* demon = new Monster( \"demon\", 6, 3, 7 ) ;\nMonster* zergling = new Monster( \"zergling\", 10, 10, 9 ) ;\nMonster* bats = new Monster( \"bats\", 20, 15, 3 ) ;\nMonster* morebats = new Monster( \"morebats\", 25, 20, 15 ) ;\nMonster* golem = new Monster( \"golem\", 50, 21, 9 ) ;\nMonster* goatdemon = new Monster( \"goatdemon\", 100, 10, 10 ) ;\nMonster* cyclops = new Monster( \"cyclops\", 150, 90, 0 ) ;\nMonster* behemoth = new Monster( \"behemoth\", 250, 30, 40 ) ;\nMonster* alien = new Monster( \"alien\", 50, 21, 4 ) ;\nMonster* giantrat = new Monster( \"giantrat\", 55, 40, 1 ) ;\nMonster* fallenangel = new Monster( \"fallenangel\", 300, 100, 100 ) ;\nMonster* greatdragon = new Monster( \"greatdragon\", 500, 300, 1 ) ;\nMonster* invincibledragon = new Monster( \"invincibledragon\", 999, 999, 999 ) ;\n\nRoom* mainHall = new Room( \"The main cavern\", \"A murkey swamp cavern\", woodsword ) ;\nRoom* river = new Room( \"The black river\", \"A river with dark water\", woodarmor ) ;\nRoom* greencave = new Room( \"The greencave\", \"A moss covered cave\", herb_a ) ;\nRoom* bluecave = new Room( \"The bluecave\", \"A frosty cave\", steelblade ) ;\nRoom* darkpit = new Room( \"The darkpit\", \"An endless hole lies before you\", steelarmor ) ;\nRoom* morbidfield = new Room( \"The morbidfield\", \"Pitch black grass surrounds you\", herb_b ) ;\nRoom* graveyard = new Room( \"The graveyard\", \"Tombstones abound\", diamondarmor ) ;\nRoom* crypt = new Room( \"The crypt\", \"A nasty rotten crypt\", crystalsword ) ;\nRoom* evilpassage = new Room( \"The evil passage\", \"An evil pasage\", crystalarmor ) ;\nRoom* darklair = new Room( \"The dark lair\", \"A dark lair\", herb_c ) ;\nRoom* firepit = new Room( \"The firey pits\", \"Fire is every where\", herb_d ) ;\nRoom* greenpasture = new Room( \"The greenpastures\", \"A meadow is before you\", genjiblade ) ;\nRoom* icecave = new Room( \"The icy caves\", \"Ice everywhere you look\", herb_e ) ;\nRoom* livingroom = new Room( \"The living room\", \"The room is alive\", dragonarmor ) ;\nRoom* cellar = new Room( \"The cellar\", \"A dirty cellar filled with rats\", angelicsword ) ;\nRoom* lifespring = new Room( \"The lifespring\", \"A beautiful fountain stands\", herb_f ) ;\nRoom* waterfall = new Room( \"The waterfall\", \"Clear blue water falls\", herb_g ) ;\nRoom* hellsgate = new Room( \"The gates of hell\", \"Large rusty doors lead to hell\", ultimatearmor ) ;\nRoom* dragoncave = new Room( \"The dragon's cave\", \"An ancient cave...\" ) ;\nRoom* dragonsden = new Room( \"The dragon's den\", \"A powerful monster awaits\" ) ;\nRoom* lostforest = new Room( \"The secret forest\", \"The strongest sword lies hidden here\", finalweapon ) ;\n\nFilter filter ;\n\nDispatch dispatch ;\nchar command ;\nstring value ;\n//END creation of the game objects\n```\n\nIn a professional game setting it would be here where you would instantiate a connection to your MySQL or whatever database your using and not load the server code until the database connection has been verified; but for this simple game this will be good enough. Now that our game objects have been created, we'll start by defining the Server constructor. Within the Server constructor we want to initialize the dynamic content of the game, i.e game content which will change state throughout the execution of our game.\n\n```c\nnamespace NetGame\n{\n  Server::Server()\n  {  \n    //BEGIN linking game objects\n    mainHall->link( 'e', *river ) ;\n    river->link( 's', *greencave ) ;\n    river->link( 'e', *bluecave ) ;\n    river->link( 'w', *mainHall ) ;\n    greencave->link( 'n', *river ) ;\n    bluecave->link( 'w', *river ) ;\n    bluecave->link( 'n', *darkpit ) ;\n    darkpit->link( 's', *bluecave ) ;\n    darkpit->link( 'n', *morbidfield ) ;\n    morbidfield->link( 's', *darkpit ) ;\n    morbidfield->link( 'e', *graveyard ) ;\n    graveyard->link( 'w', *morbidfield ) ;\n    graveyard->link( 'n', *crypt ) ;\n    graveyard->link( 'e', *evilpassage ) ;\n    crypt->link( 's', *graveyard ) ;\n    evilpassage->link( 'w', *graveyard ) ;\n    evilpassage->link( 's', *darklair ) ;\n    darklair->link( 'n', *evilpassage ) ;\n    darklair->link( 's', *firepit ) ;\n    firepit->link( 'n', *darklair ) ;\n    firepit->link( 'e', *greenpasture ) ;\n    greenpasture->link( 'w', *firepit ) ;\n    greenpasture->link( 's', *icecave ) ;\n    greenpasture->link( 'e', *livingroom ) ;\n    icecave->link( 'n', *greenpasture ) ;\n    livingroom->link( 'w', *greenpasture ) ;\n    livingroom->link( 'e', *cellar ) ;\n    cellar->link( 'w', *livingroom ) ;\n    cellar->link( 'n', *lifespring ) ;\n    cellar->link( 'e', *hellsgate ) ;\n    lifespring->link( 's', *cellar ) ;\n    lifespring->link( 'n', *waterfall ) ;\n    waterfall->link( 's', *lifespring ) ;\n    hellsgate->link( 'w', *cellar ) ;\n    hellsgate->link( 'e', *dragoncave ) ;\n    dragoncave->link( 'w', *hellsgate ) ;\n    dragoncave->link( 'e', *dragonsden ) ;\n    dragonsden->link( 'w', *dragoncave ) ;\n    dragonsden->link( 'e', *lostforest ) ;\n    lostforest->link( 'w', *dragonsden ) ;\n\n    mainHall->addMonster( goblin ) ;\n    mainHall->addMonster( imp ) ;\n    river->addMonster( bear ) ;\n    river->addMonster( redgoblin ) ;\n    bluecave->addMonster( demon ) ;\n    bluecave->addMonster( zergling ) ;\n    morbidfield->addMonster( bats ) ;\n    morbidfield->addMonster( morebats ) ;\n    graveyard->addMonster( golem ) ;\n    evilpassage->addMonster( goatdemon ) ;\n    firepit->addMonster( cyclops ) ;\n    greenpasture->addMonster( behemoth ) ;\n    livingroom->addMonster( alien ) ;\n    cellar->addMonster( giantrat ) ;\n    hellsgate->addMonster( fallenangel ) ;\n    dragoncave->addMonster( greatdragon ) ;\n    dragonsden->addMonster( invincibledragon ) ;\n\n    caves.addRoom( mainHall ) ;\n    caves.addRoom( river ) ;\n    caves.addRoom( greencave ) ;\n    caves.addRoom( bluecave ) ;\n    caves.addRoom( darkpit ) ;\n    caves.addRoom( morbidfield ) ;\n    caves.addRoom( graveyard ) ;\n    caves.addRoom( crypt ) ;\n    caves.addRoom( evilpassage ) ;\n    caves.addRoom( darklair ) ;\n    caves.addRoom( firepit ) ;\n    caves.addRoom( greenpasture ) ;\n    caves.addRoom( icecave ) ;\n    caves.addRoom( livingroom ) ;\n    caves.addRoom( cellar ) ;\n    caves.addRoom( lifespring ) ;\n    caves.addRoom( waterfall ) ;\n    caves.addRoom( hellsgate ) ;\n    caves.addRoom( dragoncave ) ;\n    caves.addRoom( dragonsden ) ;\n    caves.addRoom( lostforest ) ;\n    //END linking game objects\n```\nNext we'll set the options for the game, open up the server on our desired port and begin accepting player connections.\n```c\n    // MAX_PLAYERS and PORT can be set in Common.h\n    bool running            =  true;\n    playerNames             =  gcnew Hashtable( MAX_PLAYERS );\n    playersByConnection     =  gcnew Hashtable( MAX_PLAYERS );\n\n    gameServer              =  gcnew TcpListener( PORT );\n    gameServer->Start();\n```\nNow that the server is started you want to run the servers connection loop to keep it in a pending state for new players\n```c\n      // Server loop is infinite since we have to close the program\n      // manually when we want the server to stop.\n      while ( true )\n      {\n        if ( gameServer->Pending() )\n      }\n    TcpClient^ playerConnection = gameServer->AcceptTcpClient();\n    Console::WriteLine( \"SERVER: New player now connected! \"  ); \n    gcnew TcpRelayClient( playerConnection );\n  }\n}\n}\n```\nThe next method to define is the global messaging method which can send messages from the server to all players. This is a key feature for our game because we can easily alert players of events such as when a new player connects and or other things.\nThe code might look confusing at first but all we're doing is gathering up all the open player connections into a array of Sockets and iterating through each socket and pushing a copy of the message out. Oh and we also catch the exception if the socket connection failed, then we just remove it from the server's list(remember the playersconnections HashTable from server.h).\n```c\nvoid Server::MsgToAll( String^ from, String^ message )\n{\n  StreamWriter^ serverwriter;\n  ArrayList^ toRemove = gcnew ArrayList( 0 );\n\n  array<Sockets::TcpClient^>^  tcpClients =  gcnew array<Sockets::TcpClient^>( playerNames->Count );\n\n  Server::playerNames->Values->CopyTo(tcpClients, 0); \n  for ( int count = 0; count < tcpClients->Length; ++count )\n  {\n    try\n    {\n      if (message->Trim() == \"\" || tcpClients[count] == nullptr )  \n        continue;  \n      serverwriter =  gcnew StreamWriter(tcpClients[ count ]->GetStream());  \n      //write our message to the window  \n      serverwriter->WriteLine(from + \": \" + message);  \n      //make sure all bytes are written  \n      serverwriter->Flush();  \n      //dispose of the writer object until needed again  \n      serverwriter = nullptr;  \n\n    }\n    catch ( Exception^ error_44 )\n    {\n      error_44 = error_44;\n      String^ name = (String^)playersByConnection[tcpClients[count]];  \n      //send the message that the user has left  \n      Server::ServerMsgToAll(\"** \" + name + \" ** Has Left The Room.\");  \n      //remove the name from playernames list\n      Server::playerNames->Remove( name );\n      //remove that index of the array, thus freeing it up  \n      //for another user  \n      Server::playersByConnection->Remove(tcpClients[count]);  \n    }\n  }\n}\n```\n\nNext we'll write the code for the ServerMsgToAll, the thing about this method is that its only used to report back to the server admin the messages sent via MsgToAll when an exception occurred. The logic behind the method is similar to MsgToAll so enter the code below.\n\n```c\nvoid Server::ServerMsgToAll(String^ serverMessage )\n{\n  StreamWriter^ serverwriter;\n\n  array<Sockets::TcpClient^>^  tcpClients =  gcnew array<Sockets::TcpClient^>( playerNames->Count );\n\n  Server::playerNames->Values->CopyTo(tcpClients, 0); \n\n  for ( int count = 0; count < tcpClients->Length; ++count )\n  {\n    try\n    {\n      if (serverMessage->Trim() == \"\" || tcpClients[count] == nullptr )  \n        continue;  \n      serverwriter =  gcnew StreamWriter(tcpClients[ count ]->GetStream());  \n      //write our message to the window  \n      serverwriter->WriteLine( serverMessage );  \n      //make sure all bytes are written  \n      serverwriter->Flush();  \n      //dispose of the writer object until needed again  \n      serverwriter = nullptr;  \n      Console::WriteLine( \"SERVER SENT:\" + \" has joined the game\" );\n\n    }\n    catch ( Exception^ error_44 )\n    {\n      error_44 = error_44;\n      String^ name = (String^)playersByConnection[tcpClients[count]];  \n\n      Server::playerNames->Remove( name );\n      //remove that index of the array, thus freeing it up  \n      //for another user  \n      Server::playersByConnection->Remove(tcpClients[count]);  \n    }\n  } \n}\n```\n\nMsgToPlayer is similar again to the previous two methods except that the MsgToPlayer accepts an additional parameter for the player name of who you wish to direct the message at. The player name is reference by looking up the playerNames hash table using the player name as the key.\n\n```c\nvoid Server::MsgToPlayer(String^ serverMessage, System::String^ playername)\n{\n  StreamWriter^ serverwriter;\n\n  array<Sockets::TcpClient^>^ tcpClients = gcnew array<Sockets::TcpClient^>( playerNames->Count );\n\n  Server::playerNames->Values->CopyTo(tcpClients, 0); \n\n  for ( int count = 0; count < tcpClients->Length; ++count )\n  {\n    try\n    {\n      if (serverMessage->Trim() == \"\" || tcpClients[count] == nullptr )  \n        continue;  \n\n      if( playerNames->ContainsKey( playername ) )\n      {\n        serverwriter =  gcnew StreamWriter(tcpClients[ count ]->GetStream());  \n        //write our message to the window  \n        serverwriter->WriteLine( serverMessage );  \n        //make sure all bytes are written  \n        serverwriter->Flush();  \n        //dispose of the writer object until needed again  \n        serverwriter = nullptr;  \n        Console::WriteLine( \"SERVER SENT: \" + serverMessage + \" to \" + playername );\n      }\n    }\n    catch ( Exception^ error_44 )\n    {\n      error_44 = error_44;\n      String^ name = (String^)playersByConnection[tcpClients[count]];  \n\n      Server::playerNames->Remove( name );\n      //remove that index of the array, thus freeing it up  \n      //for another user  \n      Server::playersByConnection->Remove(tcpClients[count]);  \n    }\n  } \n}\n```\nThe next method just handles the case when a new player connection has been made.\n```c\n// When a new player connects to the server spawn a thread that will\n// run the game loop.\nTcpRelayClient::TcpRelayClient( TcpClient^ playerConnection )\n{\n  client =  playerConnection;\n  Thread^   playerRelayThread   = gcnew Thread( \n      gcnew ThreadStart( this, & NetGame::TcpRelayClient::startRelay ) );\n\n  playerRelayThread->Start();\n}\n```\nIf you look at the last method you'll notice that for each player connection we spawn a new thread on the server with the startRelay() method. The startRelay() method was chosen because its the method which runs all the logic for interacting with our game database. For the most part the startRelay() method consist of the same game loop from the test version of the game, you'll notice it soon but before that the initialization for the game loop is where the new code is. To start we setup both a stream writer and stream reader to send and receive messages from the player on the thread.\n```c\n// When we start a new thread for a player who just connected,\n// this is the method the thread runs.\n// In short this is the game loop the player interacts with.\nvoid TcpRelayClient::startRelay( )\n{  \n  reader = gcnew StreamReader( client->GetStream() );\n  // Writer sends messages out to the client whos connection\n  // is running on this thread.\n  writer = gcnew StreamWriter( client->GetStream() );\n\n  NetworkStream^ netReader = client->GetStream();\n```\nJust before we actually let the player begin sending new commands we have to store the player's name within our players hashtable. Please note that for this simple game we don't double check that two players will have the exact same name because we aren't building this game to support thousands of players, so our collision prone hashtables are good enough. Ok so lets get the players name, store it within the player hashtables and then let them play.\n```c\n  writer->WriteLine( \"New Game \" );\n  Console::WriteLine( \"SERVER: Getting the new users Name \" );\n  writer->WriteLine( \"Enter a new name for your charecter\" );\n  writer->Flush();\n  Console::WriteLine( \"SERVER SENT: Enter a new name for your character\" );\n\n  // Read the player's response\n  array<Byte, 1>^  bytesFromClient = gcnew array<Byte, 1>(256);\n  String^ strFromClient = String::Empty ;\n  Int32 bytes = 0 ;\n  bytes = netReader->Read( bytesFromClient, 0, bytesFromClient->Length ) ;\n  strFromClient = Text::Encoding::ASCII->GetString( bytesFromClient, 0, bytes );\n  player = strFromClient ;\n\n  // Add the player to the hash tables as a new key value pair\n  Console::WriteLine( player + \" has joined the game\" );\n  Server::playerNames->Add( player, client ); \n  Server::playersByConnection->Add( client, player );\n  String^ message ;\n\n  Thread^ playerConnect = gcnew Thread( \n      gcnew ThreadStart( this, & NetGame::TcpRelayClient::run ) );\n\n  playerConnect->Start();\n```\nFinally we can insert the code for the game loop which is directly extracted from the test game but with some slight additions to how the strings are processed. If you can recall from \"server.h\" there were two methods, MarshalString and toSysString. Marshal string converts a given managed string or a System::String to native std::string, while toSysString does exactly what it says it does.\n\n```c\n  //ALL THE CODE BELOW IS THE ACTUAL GAME LOOP\n  //Create a new player and add to the Dungeon \n  string output ;\n  string input ;\n  String^ tempStr = nullptr ;\n\n  string playerName ;\n  // MarshalString converts a managed String^ to a native string\n  MarshalString( player, playerName ) ; \n  Player* thePlayer = new Player( playerName, mainHall ) ;\n  output = caves.addPlayer( thePlayer ) ;\n\n  //Let all players know of the new player\n  message = toSysString( output ) ;\n\n  //Display needed info for the players\n  output = \"\\nDefeat all monsters\" ;\n  output += \"\\nEnter a new command to start, for help menu enter\" ;\n  output += \"\\nhelp:\" ;\n  output += \"\\nTo quit enter \\\"quit\\\"\" ;\n  message += toSysString( output ) ;\n  Server::MsgToPlayer( message, player ) ;\n\n  //Get client command\n  bytesFromClient->Clear( bytesFromClient, 0, 256 ) ;\n  bytes = netReader->Read( bytesFromClient, 0, bytesFromClient->Length ) ;\n  strFromClient = Text::Encoding::ASCII->GetString( bytesFromClient, 0, bytes ); \n  MarshalString( strFromClient, input ) ;\n\n  //Start the game loop\n  while( input != \"quit\" )\n  {\n    //Pass the users message through the filter\n    if( filter.validateMessage( input ) )\n    {\n      //Split the users message into a command and value pair\n      command = dispatch.extractCommand( input ) ;\n      value = dispatch.extractValue( input ) ;\n\n      //Match the command and forward the value\n      switch( command )\n      {\n        case 'a': //Attack \n          //If the monster does not exist or the name was mispelled\n          if( &(thePlayer->mLocation->getMonsterRef( value )) == NULL )\n          {\n            //cout << \"There is no \" + value + \" at this location\" << endl ;\n            output = \"There is no \" + value + \" at this location\" ;\n            message = toSysString( output ) ;\n            Server::MsgToPlayer( message, player ) ;\n            break ;\n          }\n          //If the monster is there but in combat the player cannot fight it\n          if( thePlayer->mLocation->getMonsterRef( value ).inCombat == true )\n          {\n            //cout << \"The \" + value + \" is currently fighting\" << endl ;\n            output = \"The \" + value + \" is currently fighting\" ;\n            message = toSysString( output ) ;\n            Server::MsgToPlayer( message, player ) ;\n            break ;\n          }\n          caves.combatLoop( *thePlayer, thePlayer->mLocation->getMonsterRef( value ) ) ;\n          output = \"combat has finished\" ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n\n        case 'm': //Move\n          //cout << thePlayer->move( value[0] ) ;\n          output = thePlayer->move( value[0] ) ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n\n        case 'f': //Find\n          //cout << thePlayer->search() ;\n          output = thePlayer->search() ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n\n        case 'l': //Location\n          //cout << thePlayer->getLocation() ;\n          output = thePlayer->getLocation() ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n\n        case 'e': //Equip\n          //cout << thePlayer->equip( value ) ;\n          output = thePlayer->equip( value ) ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n\n        case 'y': //You\n          {\n            string* playerStats = new string ;\n            playerStats = caves.playerStatus( *thePlayer ) ;\n\n            for( int i = 0 ; i < 7 ; ++i )\n            {\n              //cout << playerStats[i] << endl ;\n              output = playerStats[i] ;\n              message = toSysString( output ) ;\n              Server::MsgToPlayer( message, player ) ;\n            }\n\n            playerStats = NULL ;\n            delete playerStats ;\n          }\n          break ;\n\n        case 't': //Talk\n          output = value ;\n          message = toSysString( output ) ;\n          Server::MsgToAll( player, message ) ;\n          break ;\n\n        case 'h': //Help Menu\n          //cout << \"a: mv: find: loc: eq: you: t: help:\" << endl ;\n          output = \"a: mv: find: loc: eq: you: t: help:\" ;\n          message = toSysString( output ) ;\n          Server::MsgToPlayer( message, player ) ;\n          break ;\n      }\n    }\n    else\n    {\n      //cout << \"Invalid command\" << endl ;\n      output = \"Invalid command\" ;\n      message = toSysString( output ) ;\n      Server::MsgToPlayer( message, player ) ;\n    }\n\n    if( caves.isComplete() )\n    {\n      //cout << \"Dungeon Cleared, YOU WIN!\" << endl ;\n      output = \"Dungeon Cleared, YOU WIN!\" ;\n      message = toSysString( output ) ;\n      Server::MsgToAll( player, message ) ;\n      break ;\n    }\n\n    if( thePlayer->death() )\n    {\n      //cout << thePlayer->getName() + \" was slain by the \" + thePlayer->mLocation->getMonsterRef( value ).getName() << endl ;\n      //output = thePlayer->getName() + \" was slain by the \" + thePlayer->mLocation->getMonsterRef( value ).getName() ;\n      output = \"slain type quit to continue\" ;\n      message = toSysString( output ) ;\n      Server::MsgToPlayer( message, player ) ;\n      thePlayer->mLocation->getMonsterRef( value ).inCombat = false ;\n      break ;\n    }\n    else\n    {\n      //Get the next command\n      //cout << \"\\n\\nNew Command\" << endl ;\n      //cin >> input ;\n      //bytes = 0 ;\n      bytesFromClient->Clear( bytesFromClient, 0, 256 ) ;\n      bytes = netReader->Read( bytesFromClient, 0, bytesFromClient->Length ) ;\n      strFromClient = Text::Encoding::ASCII->GetString( bytesFromClient, 0, bytes ); \n      MarshalString( strFromClient, input ) ;\n    }\n  }\n  //End of game loop\n}\n```\nBefore we demo our fully functional multiplayer game we have to add the last utility methods for string processing and for logging of the games actions to the server's console.\n```c\n// When running is set to true during initialization of the server\n// which happens when the server constructor is called, this will\n// begin the loop which just displays all game info to the \n// server admin. Think of it as a log of all the players actions.\nvoid  TcpRelayClient::run()\n{\n  bool running = true;\n\n  try\n  {\n    String^ line = \"\";\n    while ( running )\n    {\n      if ( client->Connected )\n      {\n        line = reader->ReadLine();\n        Server::MsgToAll( player,  line );\n      }\n      else\n      {\n        running = false;            \n      }\n    }\n  }\n  catch ( Exception^ eRun )\n  {\n    Console::WriteLine( \"EXCEPTION\" +  eRun->Message + \"\\nThe player named: \" + player + \" has disconnected, the server continues\" );\n  }\n}\n\n// Converts a managed string to a native string \nvoid MarshalString ( String ^ s, string& os ) \n{\n  using namespace Runtime::InteropServices;\n  const char* chars = (const char*)(Marshal::StringToHGlobalAnsi(s)).ToPointer();\n  os = chars;\n  Marshal::FreeHGlobal(IntPtr((void*)chars));\n}\n\n// Converts a native string to a managed one\nString^ toSysString( std::string output )\n{\n  String^ tempStr = gcnew String( output.c_str() ) ;\n\n  return tempStr ;\n}\n}\n```\nNow open up the file \"main.cpp\" and run the server, we run the server via the constructor method so as soon as you create the server it will pend for request on 127.0.0.1 port 13000 for new players.\n\nFor the demo what you'll need to do is to open up three instances of Visual Studio. One instance will run the server, so open up the server project on the first one while the second and third instances will each run clients; so open up the client project on the other two. Once you have all three open the first step is to start the server.\n\nThen launch the second client and give this new player a name.\n\nNow switch back to the first client enter the following commands, \"eq:woodsword\" and then \"a:imp\" this will have the effect of equipping the woodsword item from the Main Hall and killing the imp monster. Finally switch back over to the second client and enter the following command \"find:\", you will notice that both the woodsword and the imp have cannot be found as they were both taken care of by the first player. You have just finished writing a simple text based multiplayer RPG.\n\nOnce again the two files below, the one for the server and the one for the client are hosted on my dropbox account, so if at any time they aren't accessible(I often move files around and don't clean up dead links) and put a request into the comments section.\n\n<a href=\"http://dl.dropbox.com/u/22280460/Simple_RPG_Client.rar\">Click here to download the client application</a>\n<a href=\"http://dl.dropbox.com/u/22280460/Simple_RPG_Server.rar\">Click here to download the server application</a>\n\n[Click here for part VI][link_part_6]\n\n[link_part_6]: /2011/06/16/textbasedrpgpart6\n","slug":"textbasedrpgpart7","published":1,"updated":"2017-04-14T06:16:52.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1jsmr2v00179uwvk5bm2uol","content":"<p><a href=\"/2011/06/16/textbasedrpgpart6\">Click here for part VI</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>The Final part of our tutorial, after completing this tutorial you will have successfully created a multiplayer text based rpg. Read on to learn how to design the game server that will connect to the client code written in part six.</p>\n<p>In the last part of this series we’re going to develop the server logic to host our game and end with a short demonstration of how it works in action. Just as you performed it in part 6, create a new Visual C++ CLR project within Visual Studio and add the following files leaving them empty for now; “Common.h”, “database.h”, “server.h”, “database.cpp”, “main.cpp” and “server.cpp”. </p>\n<p>The first file we’ll write is the “Common.h” file. All “Common.h” does is declare the namespaces and set the constant values we’ll be using for the server application. If you recall from part six when we set the client to access the server via port 13000, you can now see why we did so because by setting the same port on the server the server will know which port to set the listening socket to.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/// namespaces</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::IO;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net::Sockets;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Text;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Threading;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Collections;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">namespace</span> NetGame</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">/// Constants</span></div><div class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">unsigned</span> PORT        =  <span class=\"number\">13000</span>;</div><div class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">unsigned</span> MAX_PLAYERS =  <span class=\"number\">2</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Next we move to the “database.h” file. If you remember way back in part 1 where we outlined the code for our game I told you there was a reason why we titled the header file for the game database instead of dungeon or something. The reason as you can see now is because our game will serve like a virtual database where we’ll pull out data on monsters, items and locations for players to interact with and update them whenever actions occur to propagate changes to the game world out to all players. Now go ahead and add “database.h” from the test project over to this project. Then copy the files for “database.cpp” over to this new project as well from the test. However CLR applications need to reference “stdafx.h” within “database.cpp”, so add the line below.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></div></pre></td></tr></table></figure>\n<p>For the server we’ll start with declaring its classes and methods within “server.h” so go open that file. Within “server.h” add the following pre-processor directives.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Common.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"database.h\"</span></span></div></pre></td></tr></table></figure></p>\n<p>Next we’ll be adding two classes, one for the server and one for managing the client connections. In C++/CLI we need to have our classes managed as well so for the server class add the declarations below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">namespace</span> NetGame</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span> ref <span class=\"keyword\">class</span> Server</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      Server();</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">MsgToAll</span><span class=\"params\">( String^ from, String^ message )</span></span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">ServerMsgToAll</span><span class=\"params\">(String^ serverMessage )</span></span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">MsgToPlayer</span><span class=\"params\">( String^ serverMessage, System::String^ playername )</span></span>;</div><div class=\"line\"></div><div class=\"line\">      TcpListener^                           gameServer;</div><div class=\"line\">      <span class=\"keyword\">static</span> System::Collections::Hashtable^ playerNames;</div><div class=\"line\">      <span class=\"keyword\">static</span> System::Collections::Hashtable^ playersByConnection;</div><div class=\"line\">  &#125;;</div></pre></td></tr></table></figure></p>\n<p>Then for the client relay which is responsible for starting and stopping a thread for each new player on the server add the code below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> ref <span class=\"keyword\">class</span> TcpRelayClient</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    TcpRelayClient( TcpClient^ playerConnection );</div><div class=\"line\">    TcpClient^     client;</div><div class=\"line\">    StreamReader^  reader;</div><div class=\"line\">    StreamWriter^  writer;</div><div class=\"line\">    String^        player;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span>: </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">startRelay</span><span class=\"params\">()</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure></p>\n<p>The last two methods of the server class are specific for backwards compatibility between managed and native C++.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"comment\">// See the link below</span></div><div class=\"line\">    <span class=\"comment\">//msdn.microsoft.com/en-us/library/1b4az623(v=VS.90).aspx </span></div><div class=\"line\">    <span class=\"comment\">//How to: Convert System::String to Standard String</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MarshalString</span> <span class=\"params\">( String^ s, <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span>&amp; os )</span> </span>;</div><div class=\"line\">  String^ toSysString( <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> ) ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><div><br>The point of string marshaling is to allow use to translate between C++/CLI String^ and native std::string* pointers. Now we’re ready to tackle the meat of the application, the definitions of the servers methods; open up “server.cpp” for editing and first add the pre-processor directives.<br></div><br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"server.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"database.h\"</span> </span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD ;</div></pre></td></tr></table></figure></p>\n<p>For this game since we’re not using an actual database lets declare all of our game objects first before accepting any connections from remote clients.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//BEGIN creation of the game objects</span></div><div class=\"line\"><span class=\"function\">Dungeon <span class=\"title\">caves</span><span class=\"params\">( <span class=\"number\">2</span>, <span class=\"number\">21</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">Item* herb_a = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_b = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_c = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_d = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_e = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_f = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_g = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\"></div><div class=\"line\">Item* woodsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"woodsword\"</span>, Item::WEAPON, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* steelblade = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"steelblade\"</span>, Item::WEAPON, <span class=\"number\">20</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* crystalsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"crystalsword\"</span>, Item::WEAPON, <span class=\"number\">35</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* genjiblade = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"genjiblade\"</span>, Item::WEAPON, <span class=\"number\">60</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* angelicsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"angelicsword\"</span>, Item::WEAPON, <span class=\"number\">80</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* finalweapon = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"dragonslayer\"</span>, Item::WEAPON, <span class=\"number\">2000</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\"></div><div class=\"line\">Item* woodarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"woodarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">5</span>, <span class=\"number\">15</span> ) ;</div><div class=\"line\">Item* steelarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"steelarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">7</span>, <span class=\"number\">20</span> ) ;</div><div class=\"line\">Item* diamondarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"diamondarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">12</span>, <span class=\"number\">30</span> ) ;</div><div class=\"line\">Item* crystalarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"crystalarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">15</span>, <span class=\"number\">35</span> ) ;</div><div class=\"line\">Item* dragonarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"dragonarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">20</span>, <span class=\"number\">100</span> ) ;</div><div class=\"line\">Item* ultimatearmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"ultimatearmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">1000</span>, <span class=\"number\">1000</span> ) ;</div><div class=\"line\"></div><div class=\"line\">Monster* bear = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"bear\"</span>, <span class=\"number\">15</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span> ) ;</div><div class=\"line\">Monster* goblin = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"goblin\"</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">Monster* imp = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"imp\"</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span>, <span class=\"number\">2</span> ) ;</div><div class=\"line\">Monster* redgoblin = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"redgoblin\"</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span> ) ;</div><div class=\"line\">Monster* demon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"demon\"</span>, <span class=\"number\">6</span>, <span class=\"number\">3</span>, <span class=\"number\">7</span> ) ;</div><div class=\"line\">Monster* zergling = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"zergling\"</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">9</span> ) ;</div><div class=\"line\">Monster* bats = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"bats\"</span>, <span class=\"number\">20</span>, <span class=\"number\">15</span>, <span class=\"number\">3</span> ) ;</div><div class=\"line\">Monster* morebats = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"morebats\"</span>, <span class=\"number\">25</span>, <span class=\"number\">20</span>, <span class=\"number\">15</span> ) ;</div><div class=\"line\">Monster* golem = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"golem\"</span>, <span class=\"number\">50</span>, <span class=\"number\">21</span>, <span class=\"number\">9</span> ) ;</div><div class=\"line\">Monster* goatdemon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"goatdemon\"</span>, <span class=\"number\">100</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span> ) ;</div><div class=\"line\">Monster* cyclops = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"cyclops\"</span>, <span class=\"number\">150</span>, <span class=\"number\">90</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Monster* behemoth = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"behemoth\"</span>, <span class=\"number\">250</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span> ) ;</div><div class=\"line\">Monster* alien = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"alien\"</span>, <span class=\"number\">50</span>, <span class=\"number\">21</span>, <span class=\"number\">4</span> ) ;</div><div class=\"line\">Monster* giantrat = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"giantrat\"</span>, <span class=\"number\">55</span>, <span class=\"number\">40</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">Monster* fallenangel = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"fallenangel\"</span>, <span class=\"number\">300</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span> ) ;</div><div class=\"line\">Monster* greatdragon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"greatdragon\"</span>, <span class=\"number\">500</span>, <span class=\"number\">300</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">Monster* invincibledragon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"invincibledragon\"</span>, <span class=\"number\">999</span>, <span class=\"number\">999</span>, <span class=\"number\">999</span> ) ;</div><div class=\"line\"></div><div class=\"line\">Room* mainHall = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The main cavern\"</span>, <span class=\"string\">\"A murkey swamp cavern\"</span>, woodsword ) ;</div><div class=\"line\">Room* river = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The black river\"</span>, <span class=\"string\">\"A river with dark water\"</span>, woodarmor ) ;</div><div class=\"line\">Room* greencave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The greencave\"</span>, <span class=\"string\">\"A moss covered cave\"</span>, herb_a ) ;</div><div class=\"line\">Room* bluecave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The bluecave\"</span>, <span class=\"string\">\"A frosty cave\"</span>, steelblade ) ;</div><div class=\"line\">Room* darkpit = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The darkpit\"</span>, <span class=\"string\">\"An endless hole lies before you\"</span>, steelarmor ) ;</div><div class=\"line\">Room* morbidfield = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The morbidfield\"</span>, <span class=\"string\">\"Pitch black grass surrounds you\"</span>, herb_b ) ;</div><div class=\"line\">Room* graveyard = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The graveyard\"</span>, <span class=\"string\">\"Tombstones abound\"</span>, diamondarmor ) ;</div><div class=\"line\">Room* crypt = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The crypt\"</span>, <span class=\"string\">\"A nasty rotten crypt\"</span>, crystalsword ) ;</div><div class=\"line\">Room* evilpassage = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The evil passage\"</span>, <span class=\"string\">\"An evil pasage\"</span>, crystalarmor ) ;</div><div class=\"line\">Room* darklair = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dark lair\"</span>, <span class=\"string\">\"A dark lair\"</span>, herb_c ) ;</div><div class=\"line\">Room* firepit = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The firey pits\"</span>, <span class=\"string\">\"Fire is every where\"</span>, herb_d ) ;</div><div class=\"line\">Room* greenpasture = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The greenpastures\"</span>, <span class=\"string\">\"A meadow is before you\"</span>, genjiblade ) ;</div><div class=\"line\">Room* icecave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The icy caves\"</span>, <span class=\"string\">\"Ice everywhere you look\"</span>, herb_e ) ;</div><div class=\"line\">Room* livingroom = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The living room\"</span>, <span class=\"string\">\"The room is alive\"</span>, dragonarmor ) ;</div><div class=\"line\">Room* cellar = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The cellar\"</span>, <span class=\"string\">\"A dirty cellar filled with rats\"</span>, angelicsword ) ;</div><div class=\"line\">Room* lifespring = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The lifespring\"</span>, <span class=\"string\">\"A beautiful fountain stands\"</span>, herb_f ) ;</div><div class=\"line\">Room* waterfall = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The waterfall\"</span>, <span class=\"string\">\"Clear blue water falls\"</span>, herb_g ) ;</div><div class=\"line\">Room* hellsgate = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The gates of hell\"</span>, <span class=\"string\">\"Large rusty doors lead to hell\"</span>, ultimatearmor ) ;</div><div class=\"line\">Room* dragoncave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dragon's cave\"</span>, <span class=\"string\">\"An ancient cave...\"</span> ) ;</div><div class=\"line\">Room* dragonsden = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dragon's den\"</span>, <span class=\"string\">\"A powerful monster awaits\"</span> ) ;</div><div class=\"line\">Room* lostforest = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The secret forest\"</span>, <span class=\"string\">\"The strongest sword lies hidden here\"</span>, finalweapon ) ;</div><div class=\"line\"></div><div class=\"line\">Filter filter ;</div><div class=\"line\"></div><div class=\"line\">Dispatch dispatch ;</div><div class=\"line\"><span class=\"keyword\">char</span> command ;</div><div class=\"line\"><span class=\"built_in\">string</span> value ;</div><div class=\"line\"><span class=\"comment\">//END creation of the game objects</span></div></pre></td></tr></table></figure></p>\n<p>In a professional game setting it would be here where you would instantiate a connection to your MySQL or whatever database your using and not load the server code until the database connection has been verified; but for this simple game this will be good enough. Now that our game objects have been created, we’ll start by defining the Server constructor. Within the Server constructor we want to initialize the dynamic content of the game, i.e game content which will change state throughout the execution of our game.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">namespace</span> NetGame</div><div class=\"line\">&#123;</div><div class=\"line\">  Server::Server()</div><div class=\"line\">  &#123;  </div><div class=\"line\">    <span class=\"comment\">//BEGIN linking game objects</span></div><div class=\"line\">    mainHall-&gt;link( <span class=\"string\">'e'</span>, *river ) ;</div><div class=\"line\">    river-&gt;link( <span class=\"string\">'s'</span>, *greencave ) ;</div><div class=\"line\">    river-&gt;link( <span class=\"string\">'e'</span>, *bluecave ) ;</div><div class=\"line\">    river-&gt;link( <span class=\"string\">'w'</span>, *mainHall ) ;</div><div class=\"line\">    greencave-&gt;link( <span class=\"string\">'n'</span>, *river ) ;</div><div class=\"line\">    bluecave-&gt;link( <span class=\"string\">'w'</span>, *river ) ;</div><div class=\"line\">    bluecave-&gt;link( <span class=\"string\">'n'</span>, *darkpit ) ;</div><div class=\"line\">    darkpit-&gt;link( <span class=\"string\">'s'</span>, *bluecave ) ;</div><div class=\"line\">    darkpit-&gt;link( <span class=\"string\">'n'</span>, *morbidfield ) ;</div><div class=\"line\">    morbidfield-&gt;link( <span class=\"string\">'s'</span>, *darkpit ) ;</div><div class=\"line\">    morbidfield-&gt;link( <span class=\"string\">'e'</span>, *graveyard ) ;</div><div class=\"line\">    graveyard-&gt;link( <span class=\"string\">'w'</span>, *morbidfield ) ;</div><div class=\"line\">    graveyard-&gt;link( <span class=\"string\">'n'</span>, *crypt ) ;</div><div class=\"line\">    graveyard-&gt;link( <span class=\"string\">'e'</span>, *evilpassage ) ;</div><div class=\"line\">    crypt-&gt;link( <span class=\"string\">'s'</span>, *graveyard ) ;</div><div class=\"line\">    evilpassage-&gt;link( <span class=\"string\">'w'</span>, *graveyard ) ;</div><div class=\"line\">    evilpassage-&gt;link( <span class=\"string\">'s'</span>, *darklair ) ;</div><div class=\"line\">    darklair-&gt;link( <span class=\"string\">'n'</span>, *evilpassage ) ;</div><div class=\"line\">    darklair-&gt;link( <span class=\"string\">'s'</span>, *firepit ) ;</div><div class=\"line\">    firepit-&gt;link( <span class=\"string\">'n'</span>, *darklair ) ;</div><div class=\"line\">    firepit-&gt;link( <span class=\"string\">'e'</span>, *greenpasture ) ;</div><div class=\"line\">    greenpasture-&gt;link( <span class=\"string\">'w'</span>, *firepit ) ;</div><div class=\"line\">    greenpasture-&gt;link( <span class=\"string\">'s'</span>, *icecave ) ;</div><div class=\"line\">    greenpasture-&gt;link( <span class=\"string\">'e'</span>, *livingroom ) ;</div><div class=\"line\">    icecave-&gt;link( <span class=\"string\">'n'</span>, *greenpasture ) ;</div><div class=\"line\">    livingroom-&gt;link( <span class=\"string\">'w'</span>, *greenpasture ) ;</div><div class=\"line\">    livingroom-&gt;link( <span class=\"string\">'e'</span>, *cellar ) ;</div><div class=\"line\">    cellar-&gt;link( <span class=\"string\">'w'</span>, *livingroom ) ;</div><div class=\"line\">    cellar-&gt;link( <span class=\"string\">'n'</span>, *lifespring ) ;</div><div class=\"line\">    cellar-&gt;link( <span class=\"string\">'e'</span>, *hellsgate ) ;</div><div class=\"line\">    lifespring-&gt;link( <span class=\"string\">'s'</span>, *cellar ) ;</div><div class=\"line\">    lifespring-&gt;link( <span class=\"string\">'n'</span>, *waterfall ) ;</div><div class=\"line\">    waterfall-&gt;link( <span class=\"string\">'s'</span>, *lifespring ) ;</div><div class=\"line\">    hellsgate-&gt;link( <span class=\"string\">'w'</span>, *cellar ) ;</div><div class=\"line\">    hellsgate-&gt;link( <span class=\"string\">'e'</span>, *dragoncave ) ;</div><div class=\"line\">    dragoncave-&gt;link( <span class=\"string\">'w'</span>, *hellsgate ) ;</div><div class=\"line\">    dragoncave-&gt;link( <span class=\"string\">'e'</span>, *dragonsden ) ;</div><div class=\"line\">    dragonsden-&gt;link( <span class=\"string\">'w'</span>, *dragoncave ) ;</div><div class=\"line\">    dragonsden-&gt;link( <span class=\"string\">'e'</span>, *lostforest ) ;</div><div class=\"line\">    lostforest-&gt;link( <span class=\"string\">'w'</span>, *dragonsden ) ;</div><div class=\"line\"></div><div class=\"line\">    mainHall-&gt;addMonster( goblin ) ;</div><div class=\"line\">    mainHall-&gt;addMonster( imp ) ;</div><div class=\"line\">    river-&gt;addMonster( bear ) ;</div><div class=\"line\">    river-&gt;addMonster( redgoblin ) ;</div><div class=\"line\">    bluecave-&gt;addMonster( demon ) ;</div><div class=\"line\">    bluecave-&gt;addMonster( zergling ) ;</div><div class=\"line\">    morbidfield-&gt;addMonster( bats ) ;</div><div class=\"line\">    morbidfield-&gt;addMonster( morebats ) ;</div><div class=\"line\">    graveyard-&gt;addMonster( golem ) ;</div><div class=\"line\">    evilpassage-&gt;addMonster( goatdemon ) ;</div><div class=\"line\">    firepit-&gt;addMonster( cyclops ) ;</div><div class=\"line\">    greenpasture-&gt;addMonster( behemoth ) ;</div><div class=\"line\">    livingroom-&gt;addMonster( alien ) ;</div><div class=\"line\">    cellar-&gt;addMonster( giantrat ) ;</div><div class=\"line\">    hellsgate-&gt;addMonster( fallenangel ) ;</div><div class=\"line\">    dragoncave-&gt;addMonster( greatdragon ) ;</div><div class=\"line\">    dragonsden-&gt;addMonster( invincibledragon ) ;</div><div class=\"line\"></div><div class=\"line\">    caves.addRoom( mainHall ) ;</div><div class=\"line\">    caves.addRoom( river ) ;</div><div class=\"line\">    caves.addRoom( greencave ) ;</div><div class=\"line\">    caves.addRoom( bluecave ) ;</div><div class=\"line\">    caves.addRoom( darkpit ) ;</div><div class=\"line\">    caves.addRoom( morbidfield ) ;</div><div class=\"line\">    caves.addRoom( graveyard ) ;</div><div class=\"line\">    caves.addRoom( crypt ) ;</div><div class=\"line\">    caves.addRoom( evilpassage ) ;</div><div class=\"line\">    caves.addRoom( darklair ) ;</div><div class=\"line\">    caves.addRoom( firepit ) ;</div><div class=\"line\">    caves.addRoom( greenpasture ) ;</div><div class=\"line\">    caves.addRoom( icecave ) ;</div><div class=\"line\">    caves.addRoom( livingroom ) ;</div><div class=\"line\">    caves.addRoom( cellar ) ;</div><div class=\"line\">    caves.addRoom( lifespring ) ;</div><div class=\"line\">    caves.addRoom( waterfall ) ;</div><div class=\"line\">    caves.addRoom( hellsgate ) ;</div><div class=\"line\">    caves.addRoom( dragoncave ) ;</div><div class=\"line\">    caves.addRoom( dragonsden ) ;</div><div class=\"line\">    caves.addRoom( lostforest ) ;</div><div class=\"line\">    <span class=\"comment\">//END linking game objects</span></div></pre></td></tr></table></figure>\n<p>Next we’ll set the options for the game, open up the server on our desired port and begin accepting player connections.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// MAX_PLAYERS and PORT can be set in Common.h</span></div><div class=\"line\"><span class=\"keyword\">bool</span> running            =  <span class=\"literal\">true</span>;</div><div class=\"line\">playerNames             =  gcnew Hashtable( MAX_PLAYERS );</div><div class=\"line\">playersByConnection     =  gcnew Hashtable( MAX_PLAYERS );</div><div class=\"line\"></div><div class=\"line\">gameServer              =  gcnew TcpListener( PORT );</div><div class=\"line\">gameServer-&gt;Start();</div></pre></td></tr></table></figure></p>\n<p>Now that the server is started you want to run the servers connection loop to keep it in a pending state for new players<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">      <span class=\"comment\">// Server loop is infinite since we have to close the program</span></div><div class=\"line\">      <span class=\"comment\">// manually when we want the server to stop.</span></div><div class=\"line\">      <span class=\"keyword\">while</span> ( <span class=\"literal\">true</span> )</div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> ( gameServer-&gt;Pending() )</div><div class=\"line\">      &#125;</div><div class=\"line\">    TcpClient^ playerConnection = gameServer-&gt;AcceptTcpClient();</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"SERVER: New player now connected! \"</span>  ); </div><div class=\"line\">    <span class=\"function\">gcnew <span class=\"title\">TcpRelayClient</span><span class=\"params\">( playerConnection )</span></span>;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The next method to define is the global messaging method which can send messages from the server to all players. This is a key feature for our game because we can easily alert players of events such as when a new player connects and or other things.<br>The code might look confusing at first but all we’re doing is gathering up all the open player connections into a array of Sockets and iterating through each socket and pushing a copy of the message out. Oh and we also catch the exception if the socket connection failed, then we just remove it from the server’s list(remember the playersconnections HashTable from server.h).<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Server::MsgToAll( String^ from, String^ message )</div><div class=\"line\">&#123;</div><div class=\"line\">  StreamWriter^ serverwriter;</div><div class=\"line\">  ArrayList^ toRemove = gcnew ArrayList( <span class=\"number\">0</span> );</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;^  tcpClients =  gcnew <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;( playerNames-&gt;Count );</div><div class=\"line\"></div><div class=\"line\">  Server::playerNames-&gt;Values-&gt;CopyTo(tcpClients, <span class=\"number\">0</span>); </div><div class=\"line\">  <span class=\"keyword\">for</span> ( <span class=\"keyword\">int</span> count = <span class=\"number\">0</span>; count &lt; tcpClients-&gt;Length; ++count )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">try</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> (message-&gt;Trim() == <span class=\"string\">\"\"</span> || tcpClients[count] == <span class=\"literal\">nullptr</span> )  </div><div class=\"line\">        <span class=\"keyword\">continue</span>;  </div><div class=\"line\">      serverwriter =  gcnew StreamWriter(tcpClients[ count ]-&gt;GetStream());  </div><div class=\"line\">      <span class=\"comment\">//write our message to the window  </span></div><div class=\"line\">      serverwriter-&gt;WriteLine(from + <span class=\"string\">\": \"</span> + message);  </div><div class=\"line\">      <span class=\"comment\">//make sure all bytes are written  </span></div><div class=\"line\">      serverwriter-&gt;Flush();  </div><div class=\"line\">      <span class=\"comment\">//dispose of the writer object until needed again  </span></div><div class=\"line\">      serverwriter = <span class=\"literal\">nullptr</span>;  </div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">catch</span> ( Exception^ error_44 )</div><div class=\"line\">    &#123;</div><div class=\"line\">      error_44 = error_44;</div><div class=\"line\">      String^ name = (String^)playersByConnection[tcpClients[count]];  </div><div class=\"line\">      <span class=\"comment\">//send the message that the user has left  </span></div><div class=\"line\">      Server::ServerMsgToAll(<span class=\"string\">\"** \"</span> + name + <span class=\"string\">\" ** Has Left The Room.\"</span>);  </div><div class=\"line\">      <span class=\"comment\">//remove the name from playernames list</span></div><div class=\"line\">      Server::playerNames-&gt;Remove( name );</div><div class=\"line\">      <span class=\"comment\">//remove that index of the array, thus freeing it up  </span></div><div class=\"line\">      <span class=\"comment\">//for another user  </span></div><div class=\"line\">      Server::playersByConnection-&gt;Remove(tcpClients[count]);  </div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Next we’ll write the code for the ServerMsgToAll, the thing about this method is that its only used to report back to the server admin the messages sent via MsgToAll when an exception occurred. The logic behind the method is similar to MsgToAll so enter the code below.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Server::ServerMsgToAll(String^ serverMessage )</div><div class=\"line\">&#123;</div><div class=\"line\">  StreamWriter^ serverwriter;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;^  tcpClients =  gcnew <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;( playerNames-&gt;Count );</div><div class=\"line\"></div><div class=\"line\">  Server::playerNames-&gt;Values-&gt;CopyTo(tcpClients, <span class=\"number\">0</span>); </div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span> ( <span class=\"keyword\">int</span> count = <span class=\"number\">0</span>; count &lt; tcpClients-&gt;Length; ++count )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">try</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> (serverMessage-&gt;Trim() == <span class=\"string\">\"\"</span> || tcpClients[count] == <span class=\"literal\">nullptr</span> )  </div><div class=\"line\">        <span class=\"keyword\">continue</span>;  </div><div class=\"line\">      serverwriter =  gcnew StreamWriter(tcpClients[ count ]-&gt;GetStream());  </div><div class=\"line\">      <span class=\"comment\">//write our message to the window  </span></div><div class=\"line\">      serverwriter-&gt;WriteLine( serverMessage );  </div><div class=\"line\">      <span class=\"comment\">//make sure all bytes are written  </span></div><div class=\"line\">      serverwriter-&gt;Flush();  </div><div class=\"line\">      <span class=\"comment\">//dispose of the writer object until needed again  </span></div><div class=\"line\">      serverwriter = <span class=\"literal\">nullptr</span>;  </div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"SERVER SENT:\"</span> + <span class=\"string\">\" has joined the game\"</span> );</div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">catch</span> ( Exception^ error_44 )</div><div class=\"line\">    &#123;</div><div class=\"line\">      error_44 = error_44;</div><div class=\"line\">      String^ name = (String^)playersByConnection[tcpClients[count]];  </div><div class=\"line\"></div><div class=\"line\">      Server::playerNames-&gt;Remove( name );</div><div class=\"line\">      <span class=\"comment\">//remove that index of the array, thus freeing it up  </span></div><div class=\"line\">      <span class=\"comment\">//for another user  </span></div><div class=\"line\">      Server::playersByConnection-&gt;Remove(tcpClients[count]);  </div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>MsgToPlayer is similar again to the previous two methods except that the MsgToPlayer accepts an additional parameter for the player name of who you wish to direct the message at. The player name is reference by looking up the playerNames hash table using the player name as the key.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Server::MsgToPlayer(String^ serverMessage, System::String^ playername)</div><div class=\"line\">&#123;</div><div class=\"line\">  StreamWriter^ serverwriter;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;^ tcpClients = gcnew <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;( playerNames-&gt;Count );</div><div class=\"line\"></div><div class=\"line\">  Server::playerNames-&gt;Values-&gt;CopyTo(tcpClients, <span class=\"number\">0</span>); </div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span> ( <span class=\"keyword\">int</span> count = <span class=\"number\">0</span>; count &lt; tcpClients-&gt;Length; ++count )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">try</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> (serverMessage-&gt;Trim() == <span class=\"string\">\"\"</span> || tcpClients[count] == <span class=\"literal\">nullptr</span> )  </div><div class=\"line\">        <span class=\"keyword\">continue</span>;  </div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>( playerNames-&gt;ContainsKey( playername ) )</div><div class=\"line\">      &#123;</div><div class=\"line\">        serverwriter =  gcnew StreamWriter(tcpClients[ count ]-&gt;GetStream());  </div><div class=\"line\">        <span class=\"comment\">//write our message to the window  </span></div><div class=\"line\">        serverwriter-&gt;WriteLine( serverMessage );  </div><div class=\"line\">        <span class=\"comment\">//make sure all bytes are written  </span></div><div class=\"line\">        serverwriter-&gt;Flush();  </div><div class=\"line\">        <span class=\"comment\">//dispose of the writer object until needed again  </span></div><div class=\"line\">        serverwriter = <span class=\"literal\">nullptr</span>;  </div><div class=\"line\">        Console::WriteLine( <span class=\"string\">\"SERVER SENT: \"</span> + serverMessage + <span class=\"string\">\" to \"</span> + playername );</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">catch</span> ( Exception^ error_44 )</div><div class=\"line\">    &#123;</div><div class=\"line\">      error_44 = error_44;</div><div class=\"line\">      String^ name = (String^)playersByConnection[tcpClients[count]];  </div><div class=\"line\"></div><div class=\"line\">      Server::playerNames-&gt;Remove( name );</div><div class=\"line\">      <span class=\"comment\">//remove that index of the array, thus freeing it up  </span></div><div class=\"line\">      <span class=\"comment\">//for another user  </span></div><div class=\"line\">      Server::playersByConnection-&gt;Remove(tcpClients[count]);  </div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next method just handles the case when a new player connection has been made.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// When a new player connects to the server spawn a thread that will</span></div><div class=\"line\"><span class=\"comment\">// run the game loop.</span></div><div class=\"line\">TcpRelayClient::TcpRelayClient( TcpClient^ playerConnection )</div><div class=\"line\">&#123;</div><div class=\"line\">  client =  playerConnection;</div><div class=\"line\">  Thread^   playerRelayThread   = gcnew Thread( </div><div class=\"line\">      gcnew ThreadStart( <span class=\"keyword\">this</span>, &amp; NetGame::TcpRelayClient::startRelay ) );</div><div class=\"line\"></div><div class=\"line\">  playerRelayThread-&gt;Start();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>If you look at the last method you’ll notice that for each player connection we spawn a new thread on the server with the startRelay() method. The startRelay() method was chosen because its the method which runs all the logic for interacting with our game database. For the most part the startRelay() method consist of the same game loop from the test version of the game, you’ll notice it soon but before that the initialization for the game loop is where the new code is. To start we setup both a stream writer and stream reader to send and receive messages from the player on the thread.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// When we start a new thread for a player who just connected,</span></div><div class=\"line\"><span class=\"comment\">// this is the method the thread runs.</span></div><div class=\"line\"><span class=\"comment\">// In short this is the game loop the player interacts with.</span></div><div class=\"line\"><span class=\"keyword\">void</span> TcpRelayClient::startRelay( )</div><div class=\"line\">&#123;  </div><div class=\"line\">  reader = gcnew StreamReader( client-&gt;GetStream() );</div><div class=\"line\">  <span class=\"comment\">// Writer sends messages out to the client whos connection</span></div><div class=\"line\">  <span class=\"comment\">// is running on this thread.</span></div><div class=\"line\">  writer = gcnew StreamWriter( client-&gt;GetStream() );</div><div class=\"line\"></div><div class=\"line\">  NetworkStream^ netReader = client-&gt;GetStream();</div></pre></td></tr></table></figure></p>\n<p>Just before we actually let the player begin sending new commands we have to store the player’s name within our players hashtable. Please note that for this simple game we don’t double check that two players will have the exact same name because we aren’t building this game to support thousands of players, so our collision prone hashtables are good enough. Ok so lets get the players name, store it within the player hashtables and then let them play.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div></pre></td><td class=\"code\"><pre><div class=\"line\">writer-&gt;WriteLine( <span class=\"string\">\"New Game \"</span> );</div><div class=\"line\">Console::WriteLine( <span class=\"string\">\"SERVER: Getting the new users Name \"</span> );</div><div class=\"line\">writer-&gt;WriteLine( <span class=\"string\">\"Enter a new name for your charecter\"</span> );</div><div class=\"line\">writer-&gt;Flush();</div><div class=\"line\">Console::WriteLine( <span class=\"string\">\"SERVER SENT: Enter a new name for your character\"</span> );</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Read the player's response</span></div><div class=\"line\"><span class=\"built_in\">array</span>&lt;Byte, 1&gt;^  bytesFromClient = gcnew <span class=\"built_in\">array</span>&lt;Byte, <span class=\"number\">1</span>&gt;(<span class=\"number\">256</span>);</div><div class=\"line\">String^ strFromClient = String::Empty ;</div><div class=\"line\">Int32 bytes = <span class=\"number\">0</span> ;</div><div class=\"line\">bytes = netReader-&gt;Read( bytesFromClient, <span class=\"number\">0</span>, bytesFromClient-&gt;Length ) ;</div><div class=\"line\">strFromClient = Text::Encoding::ASCII-&gt;GetString( bytesFromClient, <span class=\"number\">0</span>, bytes );</div><div class=\"line\">player = strFromClient ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Add the player to the hash tables as a new key value pair</span></div><div class=\"line\">Console::WriteLine( player + <span class=\"string\">\" has joined the game\"</span> );</div><div class=\"line\">Server::playerNames-&gt;Add( player, client ); </div><div class=\"line\">Server::playersByConnection-&gt;Add( client, player );</div><div class=\"line\">String^ message ;</div><div class=\"line\"></div><div class=\"line\">Thread^ playerConnect = gcnew Thread( </div><div class=\"line\">    gcnew ThreadStart( <span class=\"keyword\">this</span>, &amp; NetGame::TcpRelayClient::run ) );</div><div class=\"line\"></div><div class=\"line\">playerConnect-&gt;Start();</div></pre></td></tr></table></figure></p>\n<p>Finally we can insert the code for the game loop which is directly extracted from the test game but with some slight additions to how the strings are processed. If you can recall from “server.h” there were two methods, MarshalString and toSysString. Marshal string converts a given managed string or a System::String to native std::string, while toSysString does exactly what it says it does.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">//ALL THE CODE BELOW IS THE ACTUAL GAME LOOP</span></div><div class=\"line\">  <span class=\"comment\">//Create a new player and add to the Dungeon </span></div><div class=\"line\">  <span class=\"built_in\">string</span> output ;</div><div class=\"line\">  <span class=\"built_in\">string</span> input ;</div><div class=\"line\">  String^ tempStr = <span class=\"literal\">nullptr</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">string</span> playerName ;</div><div class=\"line\">  <span class=\"comment\">// MarshalString converts a managed String^ to a native string</span></div><div class=\"line\">  MarshalString( player, playerName ) ; </div><div class=\"line\">  Player* thePlayer = <span class=\"keyword\">new</span> Player( playerName, mainHall ) ;</div><div class=\"line\">  output = caves.addPlayer( thePlayer ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Let all players know of the new player</span></div><div class=\"line\">  message = toSysString( output ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Display needed info for the players</span></div><div class=\"line\">  output = <span class=\"string\">\"\\nDefeat all monsters\"</span> ;</div><div class=\"line\">  output += <span class=\"string\">\"\\nEnter a new command to start, for help menu enter\"</span> ;</div><div class=\"line\">  output += <span class=\"string\">\"\\nhelp:\"</span> ;</div><div class=\"line\">  output += <span class=\"string\">\"\\nTo quit enter \\\"quit\\\"\"</span> ;</div><div class=\"line\">  message += toSysString( output ) ;</div><div class=\"line\">  Server::MsgToPlayer( message, player ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Get client command</span></div><div class=\"line\">  bytesFromClient-&gt;Clear( bytesFromClient, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\">  bytes = netReader-&gt;Read( bytesFromClient, <span class=\"number\">0</span>, bytesFromClient-&gt;Length ) ;</div><div class=\"line\">  strFromClient = Text::Encoding::ASCII-&gt;GetString( bytesFromClient, <span class=\"number\">0</span>, bytes ); </div><div class=\"line\">  MarshalString( strFromClient, input ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Start the game loop</span></div><div class=\"line\">  <span class=\"keyword\">while</span>( input != <span class=\"string\">\"quit\"</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"comment\">//Pass the users message through the filter</span></div><div class=\"line\">    <span class=\"keyword\">if</span>( filter.validateMessage( input ) )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//Split the users message into a command and value pair</span></div><div class=\"line\">      command = dispatch.extractCommand( input ) ;</div><div class=\"line\">      value = dispatch.extractValue( input ) ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Match the command and forward the value</span></div><div class=\"line\">      <span class=\"keyword\">switch</span>( command )</div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'a'</span>: <span class=\"comment\">//Attack </span></div><div class=\"line\">          <span class=\"comment\">//If the monster does not exist or the name was mispelled</span></div><div class=\"line\">          <span class=\"keyword\">if</span>( &amp;(thePlayer-&gt;mLocation-&gt;getMonsterRef( value )) == <span class=\"literal\">NULL</span> )</div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"comment\">//cout &lt;&lt; \"There is no \" + value + \" at this location\" &lt;&lt; endl ;</span></div><div class=\"line\">            output = <span class=\"string\">\"There is no \"</span> + value + <span class=\"string\">\" at this location\"</span> ;</div><div class=\"line\">            message = toSysString( output ) ;</div><div class=\"line\">            Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">            <span class=\"keyword\">break</span> ;</div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"comment\">//If the monster is there but in combat the player cannot fight it</span></div><div class=\"line\">          <span class=\"keyword\">if</span>( thePlayer-&gt;mLocation-&gt;getMonsterRef( value ).inCombat == <span class=\"literal\">true</span> )</div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"comment\">//cout &lt;&lt; \"The \" + value + \" is currently fighting\" &lt;&lt; endl ;</span></div><div class=\"line\">            output = <span class=\"string\">\"The \"</span> + value + <span class=\"string\">\" is currently fighting\"</span> ;</div><div class=\"line\">            message = toSysString( output ) ;</div><div class=\"line\">            Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">            <span class=\"keyword\">break</span> ;</div><div class=\"line\">          &#125;</div><div class=\"line\">          caves.combatLoop( *thePlayer, thePlayer-&gt;mLocation-&gt;getMonsterRef( value ) ) ;</div><div class=\"line\">          output = <span class=\"string\">\"combat has finished\"</span> ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'m'</span>: <span class=\"comment\">//Move</span></div><div class=\"line\">          <span class=\"comment\">//cout &lt;&lt; thePlayer-&gt;move( value[0] ) ;</span></div><div class=\"line\">          output = thePlayer-&gt;move( value[<span class=\"number\">0</span>] ) ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'f'</span>: <span class=\"comment\">//Find</span></div><div class=\"line\">          <span class=\"comment\">//cout &lt;&lt; thePlayer-&gt;search() ;</span></div><div class=\"line\">          output = thePlayer-&gt;search() ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'l'</span>: <span class=\"comment\">//Location</span></div><div class=\"line\">          <span class=\"comment\">//cout &lt;&lt; thePlayer-&gt;getLocation() ;</span></div><div class=\"line\">          output = thePlayer-&gt;getLocation() ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'e'</span>: <span class=\"comment\">//Equip</span></div><div class=\"line\">          <span class=\"comment\">//cout &lt;&lt; thePlayer-&gt;equip( value ) ;</span></div><div class=\"line\">          output = thePlayer-&gt;equip( value ) ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'y'</span>: <span class=\"comment\">//You</span></div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"built_in\">string</span>* playerStats = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span> ;</div><div class=\"line\">            playerStats = caves.playerStatus( *thePlayer ) ;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">for</span>( <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; <span class=\"number\">7</span> ; ++i )</div><div class=\"line\">            &#123;</div><div class=\"line\">              <span class=\"comment\">//cout &lt;&lt; playerStats[i] &lt;&lt; endl ;</span></div><div class=\"line\">              output = playerStats[i] ;</div><div class=\"line\">              message = toSysString( output ) ;</div><div class=\"line\">              Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            playerStats = <span class=\"literal\">NULL</span> ;</div><div class=\"line\">            <span class=\"keyword\">delete</span> playerStats ;</div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'t'</span>: <span class=\"comment\">//Talk</span></div><div class=\"line\">          output = value ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToAll( player, message ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'h'</span>: <span class=\"comment\">//Help Menu</span></div><div class=\"line\">          <span class=\"comment\">//cout &lt;&lt; \"a: mv: find: loc: eq: you: t: help:\" &lt;&lt; endl ;</span></div><div class=\"line\">          output = <span class=\"string\">\"a: mv: find: loc: eq: you: t: help:\"</span> ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//cout &lt;&lt; \"Invalid command\" &lt;&lt; endl ;</span></div><div class=\"line\">      output = <span class=\"string\">\"Invalid command\"</span> ;</div><div class=\"line\">      message = toSysString( output ) ;</div><div class=\"line\">      Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( caves.isComplete() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//cout &lt;&lt; \"Dungeon Cleared, YOU WIN!\" &lt;&lt; endl ;</span></div><div class=\"line\">      output = <span class=\"string\">\"Dungeon Cleared, YOU WIN!\"</span> ;</div><div class=\"line\">      message = toSysString( output ) ;</div><div class=\"line\">      Server::MsgToAll( player, message ) ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( thePlayer-&gt;death() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//cout &lt;&lt; thePlayer-&gt;getName() + \" was slain by the \" + thePlayer-&gt;mLocation-&gt;getMonsterRef( value ).getName() &lt;&lt; endl ;</span></div><div class=\"line\">      <span class=\"comment\">//output = thePlayer-&gt;getName() + \" was slain by the \" + thePlayer-&gt;mLocation-&gt;getMonsterRef( value ).getName() ;</span></div><div class=\"line\">      output = <span class=\"string\">\"slain type quit to continue\"</span> ;</div><div class=\"line\">      message = toSysString( output ) ;</div><div class=\"line\">      Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">      thePlayer-&gt;mLocation-&gt;getMonsterRef( value ).inCombat = <span class=\"literal\">false</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//Get the next command</span></div><div class=\"line\">      <span class=\"comment\">//cout &lt;&lt; \"\\n\\nNew Command\" &lt;&lt; endl ;</span></div><div class=\"line\">      <span class=\"comment\">//cin &gt;&gt; input ;</span></div><div class=\"line\">      <span class=\"comment\">//bytes = 0 ;</span></div><div class=\"line\">      bytesFromClient-&gt;Clear( bytesFromClient, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\">      bytes = netReader-&gt;Read( bytesFromClient, <span class=\"number\">0</span>, bytesFromClient-&gt;Length ) ;</div><div class=\"line\">      strFromClient = Text::Encoding::ASCII-&gt;GetString( bytesFromClient, <span class=\"number\">0</span>, bytes ); </div><div class=\"line\">      MarshalString( strFromClient, input ) ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"comment\">//End of game loop</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Before we demo our fully functional multiplayer game we have to add the last utility methods for string processing and for logging of the games actions to the server’s console.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// When running is set to true during initialization of the server</span></div><div class=\"line\"><span class=\"comment\">// which happens when the server constructor is called, this will</span></div><div class=\"line\"><span class=\"comment\">// begin the loop which just displays all game info to the </span></div><div class=\"line\"><span class=\"comment\">// server admin. Think of it as a log of all the players actions.</span></div><div class=\"line\"><span class=\"keyword\">void</span>  TcpRelayClient::run()</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">bool</span> running = <span class=\"literal\">true</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">try</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    String^ line = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">while</span> ( running )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> ( client-&gt;Connected )</div><div class=\"line\">      &#123;</div><div class=\"line\">        line = reader-&gt;ReadLine();</div><div class=\"line\">        Server::MsgToAll( player,  line );</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">else</span></div><div class=\"line\">      &#123;</div><div class=\"line\">        running = <span class=\"literal\">false</span>;            </div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">catch</span> ( Exception^ eRun )</div><div class=\"line\">  &#123;</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"EXCEPTION\"</span> +  eRun-&gt;Message + <span class=\"string\">\"\\nThe player named: \"</span> + player + <span class=\"string\">\" has disconnected, the server continues\"</span> );</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Converts a managed string to a native string </span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MarshalString</span> <span class=\"params\">( String ^ s, <span class=\"built_in\">string</span>&amp; os )</span> </span></div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> Runtime::InteropServices;</div><div class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* chars = (<span class=\"keyword\">const</span> <span class=\"keyword\">char</span>*)(Marshal::StringToHGlobalAnsi(s)).ToPointer();</div><div class=\"line\">  os = chars;</div><div class=\"line\">  Marshal::FreeHGlobal(IntPtr((<span class=\"keyword\">void</span>*)chars));</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Converts a native string to a managed one</span></div><div class=\"line\">String^ toSysString( <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> output )</div><div class=\"line\">&#123;</div><div class=\"line\">  String^ tempStr = gcnew String( output.c_str() ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> tempStr ;</div><div class=\"line\">&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now open up the file “main.cpp” and run the server, we run the server via the constructor method so as soon as you create the server it will pend for request on 127.0.0.1 port 13000 for new players.</p>\n<p>For the demo what you’ll need to do is to open up three instances of Visual Studio. One instance will run the server, so open up the server project on the first one while the second and third instances will each run clients; so open up the client project on the other two. Once you have all three open the first step is to start the server.</p>\n<p>Then launch the second client and give this new player a name.</p>\n<p>Now switch back to the first client enter the following commands, “eq:woodsword” and then “a:imp” this will have the effect of equipping the woodsword item from the Main Hall and killing the imp monster. Finally switch back over to the second client and enter the following command “find:”, you will notice that both the woodsword and the imp have cannot be found as they were both taken care of by the first player. You have just finished writing a simple text based multiplayer RPG.</p>\n<p>Once again the two files below, the one for the server and the one for the client are hosted on my dropbox account, so if at any time they aren’t accessible(I often move files around and don’t clean up dead links) and put a request into the comments section.</p>\n<p><a href=\"http://dl.dropbox.com/u/22280460/Simple_RPG_Client.rar\" target=\"_blank\" rel=\"external\">Click here to download the client application</a><br><a href=\"http://dl.dropbox.com/u/22280460/Simple_RPG_Server.rar\" target=\"_blank\" rel=\"external\">Click here to download the server application</a></p>\n<p><a href=\"/2011/06/16/textbasedrpgpart6\">Click here for part VI</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"/2011/06/16/textbasedrpgpart6\">Click here for part VI</a></p>\n<h1 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h1><p>The Final part of our tutorial, after completing this tutorial you will have successfully created a multiplayer text based rpg. Read on to learn how to design the game server that will connect to the client code written in part six.</p>\n<p>In the last part of this series we’re going to develop the server logic to host our game and end with a short demonstration of how it works in action. Just as you performed it in part 6, create a new Visual C++ CLR project within Visual Studio and add the following files leaving them empty for now; “Common.h”, “database.h”, “server.h”, “database.cpp”, “main.cpp” and “server.cpp”. </p>\n<p>The first file we’ll write is the “Common.h” file. All “Common.h” does is declare the namespaces and set the constant values we’ll be using for the server application. If you recall from part six when we set the client to access the server via port 13000, you can now see why we did so because by setting the same port on the server the server will know which port to set the listening socket to.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/// namespaces</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::IO;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Net::Sockets;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Text;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Threading;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> System::Collections;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">namespace</span> NetGame</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"comment\">/// Constants</span></div><div class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">unsigned</span> PORT        =  <span class=\"number\">13000</span>;</div><div class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">unsigned</span> MAX_PLAYERS =  <span class=\"number\">2</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Next we move to the “database.h” file. If you remember way back in part 1 where we outlined the code for our game I told you there was a reason why we titled the header file for the game database instead of dungeon or something. The reason as you can see now is because our game will serve like a virtual database where we’ll pull out data on monsters, items and locations for players to interact with and update them whenever actions occur to propagate changes to the game world out to all players. Now go ahead and add “database.h” from the test project over to this project. Then copy the files for “database.cpp” over to this new project as well from the test. However CLR applications need to reference “stdafx.h” within “database.cpp”, so add the line below.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></div></pre></td></tr></table></figure>\n<p>For the server we’ll start with declaring its classes and methods within “server.h” so go open that file. Within “server.h” add the following pre-processor directives.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"Common.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"database.h\"</span></span></div></pre></td></tr></table></figure></p>\n<p>Next we’ll be adding two classes, one for the server and one for managing the client connections. In C++/CLI we need to have our classes managed as well so for the server class add the declarations below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">namespace</span> NetGame</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span> ref <span class=\"keyword\">class</span> Server</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">public</span>:</div><div class=\"line\">      Server();</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">MsgToAll</span><span class=\"params\">( String^ from, String^ message )</span></span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">ServerMsgToAll</span><span class=\"params\">(String^ serverMessage )</span></span>;</div><div class=\"line\">      <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">MsgToPlayer</span><span class=\"params\">( String^ serverMessage, System::String^ playername )</span></span>;</div><div class=\"line\"></div><div class=\"line\">      TcpListener^                           gameServer;</div><div class=\"line\">      <span class=\"keyword\">static</span> System::Collections::Hashtable^ playerNames;</div><div class=\"line\">      <span class=\"keyword\">static</span> System::Collections::Hashtable^ playersByConnection;</div><div class=\"line\">  &#125;;</div></pre></td></tr></table></figure></p>\n<p>Then for the client relay which is responsible for starting and stopping a thread for each new player on the server add the code below.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> ref <span class=\"keyword\">class</span> TcpRelayClient</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">public</span>:</div><div class=\"line\">    TcpRelayClient( TcpClient^ playerConnection );</div><div class=\"line\">    TcpClient^     client;</div><div class=\"line\">    StreamReader^  reader;</div><div class=\"line\">    StreamWriter^  writer;</div><div class=\"line\">    String^        player;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">private</span>: </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">startRelay</span><span class=\"params\">()</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>;</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure></p>\n<p>The last two methods of the server class are specific for backwards compatibility between managed and native C++.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"comment\">// See the link below</span></div><div class=\"line\">    <span class=\"comment\">//msdn.microsoft.com/en-us/library/1b4az623(v=VS.90).aspx </span></div><div class=\"line\">    <span class=\"comment\">//How to: Convert System::String to Standard String</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MarshalString</span> <span class=\"params\">( String^ s, <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span>&amp; os )</span> </span>;</div><div class=\"line\">  String^ toSysString( <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> ) ;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><div><br>The point of string marshaling is to allow use to translate between C++/CLI String^ and native std::string* pointers. Now we’re ready to tackle the meat of the application, the definitions of the servers methods; open up “server.cpp” for editing and first add the pre-processor directives.<br></div><br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> once</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"stdafx.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"server.h\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"database.h\"</span> </span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> MUD ;</div></pre></td></tr></table></figure></p>\n<p>For this game since we’re not using an actual database lets declare all of our game objects first before accepting any connections from remote clients.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//BEGIN creation of the game objects</span></div><div class=\"line\"><span class=\"function\">Dungeon <span class=\"title\">caves</span><span class=\"params\">( <span class=\"number\">2</span>, <span class=\"number\">21</span> )</span> </span>;</div><div class=\"line\"></div><div class=\"line\">Item* herb_a = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_b = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_c = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_d = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_e = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_f = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* herb_g = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"herb\"</span>, Item::HEALTH, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\"></div><div class=\"line\">Item* woodsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"woodsword\"</span>, Item::WEAPON, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* steelblade = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"steelblade\"</span>, Item::WEAPON, <span class=\"number\">20</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* crystalsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"crystalsword\"</span>, Item::WEAPON, <span class=\"number\">35</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* genjiblade = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"genjiblade\"</span>, Item::WEAPON, <span class=\"number\">60</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* angelicsword = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"angelicsword\"</span>, Item::WEAPON, <span class=\"number\">80</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Item* finalweapon = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"dragonslayer\"</span>, Item::WEAPON, <span class=\"number\">2000</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\"></div><div class=\"line\">Item* woodarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"woodarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">5</span>, <span class=\"number\">15</span> ) ;</div><div class=\"line\">Item* steelarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"steelarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">7</span>, <span class=\"number\">20</span> ) ;</div><div class=\"line\">Item* diamondarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"diamondarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">12</span>, <span class=\"number\">30</span> ) ;</div><div class=\"line\">Item* crystalarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"crystalarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">15</span>, <span class=\"number\">35</span> ) ;</div><div class=\"line\">Item* dragonarmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"dragonarmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">20</span>, <span class=\"number\">100</span> ) ;</div><div class=\"line\">Item* ultimatearmor = <span class=\"keyword\">new</span> Item( <span class=\"string\">\"ultimatearmor\"</span>, Item::ARMOR, <span class=\"number\">0</span>, <span class=\"number\">1000</span>, <span class=\"number\">1000</span> ) ;</div><div class=\"line\"></div><div class=\"line\">Monster* bear = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"bear\"</span>, <span class=\"number\">15</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span> ) ;</div><div class=\"line\">Monster* goblin = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"goblin\"</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">Monster* imp = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"imp\"</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span>, <span class=\"number\">2</span> ) ;</div><div class=\"line\">Monster* redgoblin = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"redgoblin\"</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span>, <span class=\"number\">5</span> ) ;</div><div class=\"line\">Monster* demon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"demon\"</span>, <span class=\"number\">6</span>, <span class=\"number\">3</span>, <span class=\"number\">7</span> ) ;</div><div class=\"line\">Monster* zergling = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"zergling\"</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">9</span> ) ;</div><div class=\"line\">Monster* bats = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"bats\"</span>, <span class=\"number\">20</span>, <span class=\"number\">15</span>, <span class=\"number\">3</span> ) ;</div><div class=\"line\">Monster* morebats = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"morebats\"</span>, <span class=\"number\">25</span>, <span class=\"number\">20</span>, <span class=\"number\">15</span> ) ;</div><div class=\"line\">Monster* golem = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"golem\"</span>, <span class=\"number\">50</span>, <span class=\"number\">21</span>, <span class=\"number\">9</span> ) ;</div><div class=\"line\">Monster* goatdemon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"goatdemon\"</span>, <span class=\"number\">100</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span> ) ;</div><div class=\"line\">Monster* cyclops = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"cyclops\"</span>, <span class=\"number\">150</span>, <span class=\"number\">90</span>, <span class=\"number\">0</span> ) ;</div><div class=\"line\">Monster* behemoth = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"behemoth\"</span>, <span class=\"number\">250</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span> ) ;</div><div class=\"line\">Monster* alien = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"alien\"</span>, <span class=\"number\">50</span>, <span class=\"number\">21</span>, <span class=\"number\">4</span> ) ;</div><div class=\"line\">Monster* giantrat = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"giantrat\"</span>, <span class=\"number\">55</span>, <span class=\"number\">40</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">Monster* fallenangel = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"fallenangel\"</span>, <span class=\"number\">300</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span> ) ;</div><div class=\"line\">Monster* greatdragon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"greatdragon\"</span>, <span class=\"number\">500</span>, <span class=\"number\">300</span>, <span class=\"number\">1</span> ) ;</div><div class=\"line\">Monster* invincibledragon = <span class=\"keyword\">new</span> Monster( <span class=\"string\">\"invincibledragon\"</span>, <span class=\"number\">999</span>, <span class=\"number\">999</span>, <span class=\"number\">999</span> ) ;</div><div class=\"line\"></div><div class=\"line\">Room* mainHall = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The main cavern\"</span>, <span class=\"string\">\"A murkey swamp cavern\"</span>, woodsword ) ;</div><div class=\"line\">Room* river = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The black river\"</span>, <span class=\"string\">\"A river with dark water\"</span>, woodarmor ) ;</div><div class=\"line\">Room* greencave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The greencave\"</span>, <span class=\"string\">\"A moss covered cave\"</span>, herb_a ) ;</div><div class=\"line\">Room* bluecave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The bluecave\"</span>, <span class=\"string\">\"A frosty cave\"</span>, steelblade ) ;</div><div class=\"line\">Room* darkpit = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The darkpit\"</span>, <span class=\"string\">\"An endless hole lies before you\"</span>, steelarmor ) ;</div><div class=\"line\">Room* morbidfield = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The morbidfield\"</span>, <span class=\"string\">\"Pitch black grass surrounds you\"</span>, herb_b ) ;</div><div class=\"line\">Room* graveyard = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The graveyard\"</span>, <span class=\"string\">\"Tombstones abound\"</span>, diamondarmor ) ;</div><div class=\"line\">Room* crypt = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The crypt\"</span>, <span class=\"string\">\"A nasty rotten crypt\"</span>, crystalsword ) ;</div><div class=\"line\">Room* evilpassage = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The evil passage\"</span>, <span class=\"string\">\"An evil pasage\"</span>, crystalarmor ) ;</div><div class=\"line\">Room* darklair = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dark lair\"</span>, <span class=\"string\">\"A dark lair\"</span>, herb_c ) ;</div><div class=\"line\">Room* firepit = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The firey pits\"</span>, <span class=\"string\">\"Fire is every where\"</span>, herb_d ) ;</div><div class=\"line\">Room* greenpasture = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The greenpastures\"</span>, <span class=\"string\">\"A meadow is before you\"</span>, genjiblade ) ;</div><div class=\"line\">Room* icecave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The icy caves\"</span>, <span class=\"string\">\"Ice everywhere you look\"</span>, herb_e ) ;</div><div class=\"line\">Room* livingroom = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The living room\"</span>, <span class=\"string\">\"The room is alive\"</span>, dragonarmor ) ;</div><div class=\"line\">Room* cellar = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The cellar\"</span>, <span class=\"string\">\"A dirty cellar filled with rats\"</span>, angelicsword ) ;</div><div class=\"line\">Room* lifespring = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The lifespring\"</span>, <span class=\"string\">\"A beautiful fountain stands\"</span>, herb_f ) ;</div><div class=\"line\">Room* waterfall = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The waterfall\"</span>, <span class=\"string\">\"Clear blue water falls\"</span>, herb_g ) ;</div><div class=\"line\">Room* hellsgate = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The gates of hell\"</span>, <span class=\"string\">\"Large rusty doors lead to hell\"</span>, ultimatearmor ) ;</div><div class=\"line\">Room* dragoncave = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dragon's cave\"</span>, <span class=\"string\">\"An ancient cave...\"</span> ) ;</div><div class=\"line\">Room* dragonsden = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The dragon's den\"</span>, <span class=\"string\">\"A powerful monster awaits\"</span> ) ;</div><div class=\"line\">Room* lostforest = <span class=\"keyword\">new</span> Room( <span class=\"string\">\"The secret forest\"</span>, <span class=\"string\">\"The strongest sword lies hidden here\"</span>, finalweapon ) ;</div><div class=\"line\"></div><div class=\"line\">Filter filter ;</div><div class=\"line\"></div><div class=\"line\">Dispatch dispatch ;</div><div class=\"line\"><span class=\"keyword\">char</span> command ;</div><div class=\"line\"><span class=\"built_in\">string</span> value ;</div><div class=\"line\"><span class=\"comment\">//END creation of the game objects</span></div></pre></td></tr></table></figure></p>\n<p>In a professional game setting it would be here where you would instantiate a connection to your MySQL or whatever database your using and not load the server code until the database connection has been verified; but for this simple game this will be good enough. Now that our game objects have been created, we’ll start by defining the Server constructor. Within the Server constructor we want to initialize the dynamic content of the game, i.e game content which will change state throughout the execution of our game.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">namespace</span> NetGame</div><div class=\"line\">&#123;</div><div class=\"line\">  Server::Server()</div><div class=\"line\">  &#123;  </div><div class=\"line\">    <span class=\"comment\">//BEGIN linking game objects</span></div><div class=\"line\">    mainHall-&gt;link( <span class=\"string\">'e'</span>, *river ) ;</div><div class=\"line\">    river-&gt;link( <span class=\"string\">'s'</span>, *greencave ) ;</div><div class=\"line\">    river-&gt;link( <span class=\"string\">'e'</span>, *bluecave ) ;</div><div class=\"line\">    river-&gt;link( <span class=\"string\">'w'</span>, *mainHall ) ;</div><div class=\"line\">    greencave-&gt;link( <span class=\"string\">'n'</span>, *river ) ;</div><div class=\"line\">    bluecave-&gt;link( <span class=\"string\">'w'</span>, *river ) ;</div><div class=\"line\">    bluecave-&gt;link( <span class=\"string\">'n'</span>, *darkpit ) ;</div><div class=\"line\">    darkpit-&gt;link( <span class=\"string\">'s'</span>, *bluecave ) ;</div><div class=\"line\">    darkpit-&gt;link( <span class=\"string\">'n'</span>, *morbidfield ) ;</div><div class=\"line\">    morbidfield-&gt;link( <span class=\"string\">'s'</span>, *darkpit ) ;</div><div class=\"line\">    morbidfield-&gt;link( <span class=\"string\">'e'</span>, *graveyard ) ;</div><div class=\"line\">    graveyard-&gt;link( <span class=\"string\">'w'</span>, *morbidfield ) ;</div><div class=\"line\">    graveyard-&gt;link( <span class=\"string\">'n'</span>, *crypt ) ;</div><div class=\"line\">    graveyard-&gt;link( <span class=\"string\">'e'</span>, *evilpassage ) ;</div><div class=\"line\">    crypt-&gt;link( <span class=\"string\">'s'</span>, *graveyard ) ;</div><div class=\"line\">    evilpassage-&gt;link( <span class=\"string\">'w'</span>, *graveyard ) ;</div><div class=\"line\">    evilpassage-&gt;link( <span class=\"string\">'s'</span>, *darklair ) ;</div><div class=\"line\">    darklair-&gt;link( <span class=\"string\">'n'</span>, *evilpassage ) ;</div><div class=\"line\">    darklair-&gt;link( <span class=\"string\">'s'</span>, *firepit ) ;</div><div class=\"line\">    firepit-&gt;link( <span class=\"string\">'n'</span>, *darklair ) ;</div><div class=\"line\">    firepit-&gt;link( <span class=\"string\">'e'</span>, *greenpasture ) ;</div><div class=\"line\">    greenpasture-&gt;link( <span class=\"string\">'w'</span>, *firepit ) ;</div><div class=\"line\">    greenpasture-&gt;link( <span class=\"string\">'s'</span>, *icecave ) ;</div><div class=\"line\">    greenpasture-&gt;link( <span class=\"string\">'e'</span>, *livingroom ) ;</div><div class=\"line\">    icecave-&gt;link( <span class=\"string\">'n'</span>, *greenpasture ) ;</div><div class=\"line\">    livingroom-&gt;link( <span class=\"string\">'w'</span>, *greenpasture ) ;</div><div class=\"line\">    livingroom-&gt;link( <span class=\"string\">'e'</span>, *cellar ) ;</div><div class=\"line\">    cellar-&gt;link( <span class=\"string\">'w'</span>, *livingroom ) ;</div><div class=\"line\">    cellar-&gt;link( <span class=\"string\">'n'</span>, *lifespring ) ;</div><div class=\"line\">    cellar-&gt;link( <span class=\"string\">'e'</span>, *hellsgate ) ;</div><div class=\"line\">    lifespring-&gt;link( <span class=\"string\">'s'</span>, *cellar ) ;</div><div class=\"line\">    lifespring-&gt;link( <span class=\"string\">'n'</span>, *waterfall ) ;</div><div class=\"line\">    waterfall-&gt;link( <span class=\"string\">'s'</span>, *lifespring ) ;</div><div class=\"line\">    hellsgate-&gt;link( <span class=\"string\">'w'</span>, *cellar ) ;</div><div class=\"line\">    hellsgate-&gt;link( <span class=\"string\">'e'</span>, *dragoncave ) ;</div><div class=\"line\">    dragoncave-&gt;link( <span class=\"string\">'w'</span>, *hellsgate ) ;</div><div class=\"line\">    dragoncave-&gt;link( <span class=\"string\">'e'</span>, *dragonsden ) ;</div><div class=\"line\">    dragonsden-&gt;link( <span class=\"string\">'w'</span>, *dragoncave ) ;</div><div class=\"line\">    dragonsden-&gt;link( <span class=\"string\">'e'</span>, *lostforest ) ;</div><div class=\"line\">    lostforest-&gt;link( <span class=\"string\">'w'</span>, *dragonsden ) ;</div><div class=\"line\"></div><div class=\"line\">    mainHall-&gt;addMonster( goblin ) ;</div><div class=\"line\">    mainHall-&gt;addMonster( imp ) ;</div><div class=\"line\">    river-&gt;addMonster( bear ) ;</div><div class=\"line\">    river-&gt;addMonster( redgoblin ) ;</div><div class=\"line\">    bluecave-&gt;addMonster( demon ) ;</div><div class=\"line\">    bluecave-&gt;addMonster( zergling ) ;</div><div class=\"line\">    morbidfield-&gt;addMonster( bats ) ;</div><div class=\"line\">    morbidfield-&gt;addMonster( morebats ) ;</div><div class=\"line\">    graveyard-&gt;addMonster( golem ) ;</div><div class=\"line\">    evilpassage-&gt;addMonster( goatdemon ) ;</div><div class=\"line\">    firepit-&gt;addMonster( cyclops ) ;</div><div class=\"line\">    greenpasture-&gt;addMonster( behemoth ) ;</div><div class=\"line\">    livingroom-&gt;addMonster( alien ) ;</div><div class=\"line\">    cellar-&gt;addMonster( giantrat ) ;</div><div class=\"line\">    hellsgate-&gt;addMonster( fallenangel ) ;</div><div class=\"line\">    dragoncave-&gt;addMonster( greatdragon ) ;</div><div class=\"line\">    dragonsden-&gt;addMonster( invincibledragon ) ;</div><div class=\"line\"></div><div class=\"line\">    caves.addRoom( mainHall ) ;</div><div class=\"line\">    caves.addRoom( river ) ;</div><div class=\"line\">    caves.addRoom( greencave ) ;</div><div class=\"line\">    caves.addRoom( bluecave ) ;</div><div class=\"line\">    caves.addRoom( darkpit ) ;</div><div class=\"line\">    caves.addRoom( morbidfield ) ;</div><div class=\"line\">    caves.addRoom( graveyard ) ;</div><div class=\"line\">    caves.addRoom( crypt ) ;</div><div class=\"line\">    caves.addRoom( evilpassage ) ;</div><div class=\"line\">    caves.addRoom( darklair ) ;</div><div class=\"line\">    caves.addRoom( firepit ) ;</div><div class=\"line\">    caves.addRoom( greenpasture ) ;</div><div class=\"line\">    caves.addRoom( icecave ) ;</div><div class=\"line\">    caves.addRoom( livingroom ) ;</div><div class=\"line\">    caves.addRoom( cellar ) ;</div><div class=\"line\">    caves.addRoom( lifespring ) ;</div><div class=\"line\">    caves.addRoom( waterfall ) ;</div><div class=\"line\">    caves.addRoom( hellsgate ) ;</div><div class=\"line\">    caves.addRoom( dragoncave ) ;</div><div class=\"line\">    caves.addRoom( dragonsden ) ;</div><div class=\"line\">    caves.addRoom( lostforest ) ;</div><div class=\"line\">    <span class=\"comment\">//END linking game objects</span></div></pre></td></tr></table></figure>\n<p>Next we’ll set the options for the game, open up the server on our desired port and begin accepting player connections.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// MAX_PLAYERS and PORT can be set in Common.h</span></div><div class=\"line\"><span class=\"keyword\">bool</span> running            =  <span class=\"literal\">true</span>;</div><div class=\"line\">playerNames             =  gcnew Hashtable( MAX_PLAYERS );</div><div class=\"line\">playersByConnection     =  gcnew Hashtable( MAX_PLAYERS );</div><div class=\"line\"></div><div class=\"line\">gameServer              =  gcnew TcpListener( PORT );</div><div class=\"line\">gameServer-&gt;Start();</div></pre></td></tr></table></figure></p>\n<p>Now that the server is started you want to run the servers connection loop to keep it in a pending state for new players<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">      <span class=\"comment\">// Server loop is infinite since we have to close the program</span></div><div class=\"line\">      <span class=\"comment\">// manually when we want the server to stop.</span></div><div class=\"line\">      <span class=\"keyword\">while</span> ( <span class=\"literal\">true</span> )</div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> ( gameServer-&gt;Pending() )</div><div class=\"line\">      &#125;</div><div class=\"line\">    TcpClient^ playerConnection = gameServer-&gt;AcceptTcpClient();</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"SERVER: New player now connected! \"</span>  ); </div><div class=\"line\">    <span class=\"function\">gcnew <span class=\"title\">TcpRelayClient</span><span class=\"params\">( playerConnection )</span></span>;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>The next method to define is the global messaging method which can send messages from the server to all players. This is a key feature for our game because we can easily alert players of events such as when a new player connects and or other things.<br>The code might look confusing at first but all we’re doing is gathering up all the open player connections into a array of Sockets and iterating through each socket and pushing a copy of the message out. Oh and we also catch the exception if the socket connection failed, then we just remove it from the server’s list(remember the playersconnections HashTable from server.h).<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Server::MsgToAll( String^ from, String^ message )</div><div class=\"line\">&#123;</div><div class=\"line\">  StreamWriter^ serverwriter;</div><div class=\"line\">  ArrayList^ toRemove = gcnew ArrayList( <span class=\"number\">0</span> );</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;^  tcpClients =  gcnew <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;( playerNames-&gt;Count );</div><div class=\"line\"></div><div class=\"line\">  Server::playerNames-&gt;Values-&gt;CopyTo(tcpClients, <span class=\"number\">0</span>); </div><div class=\"line\">  <span class=\"keyword\">for</span> ( <span class=\"keyword\">int</span> count = <span class=\"number\">0</span>; count &lt; tcpClients-&gt;Length; ++count )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">try</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> (message-&gt;Trim() == <span class=\"string\">\"\"</span> || tcpClients[count] == <span class=\"literal\">nullptr</span> )  </div><div class=\"line\">        <span class=\"keyword\">continue</span>;  </div><div class=\"line\">      serverwriter =  gcnew StreamWriter(tcpClients[ count ]-&gt;GetStream());  </div><div class=\"line\">      <span class=\"comment\">//write our message to the window  </span></div><div class=\"line\">      serverwriter-&gt;WriteLine(from + <span class=\"string\">\": \"</span> + message);  </div><div class=\"line\">      <span class=\"comment\">//make sure all bytes are written  </span></div><div class=\"line\">      serverwriter-&gt;Flush();  </div><div class=\"line\">      <span class=\"comment\">//dispose of the writer object until needed again  </span></div><div class=\"line\">      serverwriter = <span class=\"literal\">nullptr</span>;  </div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">catch</span> ( Exception^ error_44 )</div><div class=\"line\">    &#123;</div><div class=\"line\">      error_44 = error_44;</div><div class=\"line\">      String^ name = (String^)playersByConnection[tcpClients[count]];  </div><div class=\"line\">      <span class=\"comment\">//send the message that the user has left  </span></div><div class=\"line\">      Server::ServerMsgToAll(<span class=\"string\">\"** \"</span> + name + <span class=\"string\">\" ** Has Left The Room.\"</span>);  </div><div class=\"line\">      <span class=\"comment\">//remove the name from playernames list</span></div><div class=\"line\">      Server::playerNames-&gt;Remove( name );</div><div class=\"line\">      <span class=\"comment\">//remove that index of the array, thus freeing it up  </span></div><div class=\"line\">      <span class=\"comment\">//for another user  </span></div><div class=\"line\">      Server::playersByConnection-&gt;Remove(tcpClients[count]);  </div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Next we’ll write the code for the ServerMsgToAll, the thing about this method is that its only used to report back to the server admin the messages sent via MsgToAll when an exception occurred. The logic behind the method is similar to MsgToAll so enter the code below.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Server::ServerMsgToAll(String^ serverMessage )</div><div class=\"line\">&#123;</div><div class=\"line\">  StreamWriter^ serverwriter;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;^  tcpClients =  gcnew <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;( playerNames-&gt;Count );</div><div class=\"line\"></div><div class=\"line\">  Server::playerNames-&gt;Values-&gt;CopyTo(tcpClients, <span class=\"number\">0</span>); </div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span> ( <span class=\"keyword\">int</span> count = <span class=\"number\">0</span>; count &lt; tcpClients-&gt;Length; ++count )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">try</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> (serverMessage-&gt;Trim() == <span class=\"string\">\"\"</span> || tcpClients[count] == <span class=\"literal\">nullptr</span> )  </div><div class=\"line\">        <span class=\"keyword\">continue</span>;  </div><div class=\"line\">      serverwriter =  gcnew StreamWriter(tcpClients[ count ]-&gt;GetStream());  </div><div class=\"line\">      <span class=\"comment\">//write our message to the window  </span></div><div class=\"line\">      serverwriter-&gt;WriteLine( serverMessage );  </div><div class=\"line\">      <span class=\"comment\">//make sure all bytes are written  </span></div><div class=\"line\">      serverwriter-&gt;Flush();  </div><div class=\"line\">      <span class=\"comment\">//dispose of the writer object until needed again  </span></div><div class=\"line\">      serverwriter = <span class=\"literal\">nullptr</span>;  </div><div class=\"line\">      Console::WriteLine( <span class=\"string\">\"SERVER SENT:\"</span> + <span class=\"string\">\" has joined the game\"</span> );</div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">catch</span> ( Exception^ error_44 )</div><div class=\"line\">    &#123;</div><div class=\"line\">      error_44 = error_44;</div><div class=\"line\">      String^ name = (String^)playersByConnection[tcpClients[count]];  </div><div class=\"line\"></div><div class=\"line\">      Server::playerNames-&gt;Remove( name );</div><div class=\"line\">      <span class=\"comment\">//remove that index of the array, thus freeing it up  </span></div><div class=\"line\">      <span class=\"comment\">//for another user  </span></div><div class=\"line\">      Server::playersByConnection-&gt;Remove(tcpClients[count]);  </div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>MsgToPlayer is similar again to the previous two methods except that the MsgToPlayer accepts an additional parameter for the player name of who you wish to direct the message at. The player name is reference by looking up the playerNames hash table using the player name as the key.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> Server::MsgToPlayer(String^ serverMessage, System::String^ playername)</div><div class=\"line\">&#123;</div><div class=\"line\">  StreamWriter^ serverwriter;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;^ tcpClients = gcnew <span class=\"built_in\">array</span>&lt;Sockets::TcpClient^&gt;( playerNames-&gt;Count );</div><div class=\"line\"></div><div class=\"line\">  Server::playerNames-&gt;Values-&gt;CopyTo(tcpClients, <span class=\"number\">0</span>); </div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">for</span> ( <span class=\"keyword\">int</span> count = <span class=\"number\">0</span>; count &lt; tcpClients-&gt;Length; ++count )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"keyword\">try</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> (serverMessage-&gt;Trim() == <span class=\"string\">\"\"</span> || tcpClients[count] == <span class=\"literal\">nullptr</span> )  </div><div class=\"line\">        <span class=\"keyword\">continue</span>;  </div><div class=\"line\"></div><div class=\"line\">      <span class=\"keyword\">if</span>( playerNames-&gt;ContainsKey( playername ) )</div><div class=\"line\">      &#123;</div><div class=\"line\">        serverwriter =  gcnew StreamWriter(tcpClients[ count ]-&gt;GetStream());  </div><div class=\"line\">        <span class=\"comment\">//write our message to the window  </span></div><div class=\"line\">        serverwriter-&gt;WriteLine( serverMessage );  </div><div class=\"line\">        <span class=\"comment\">//make sure all bytes are written  </span></div><div class=\"line\">        serverwriter-&gt;Flush();  </div><div class=\"line\">        <span class=\"comment\">//dispose of the writer object until needed again  </span></div><div class=\"line\">        serverwriter = <span class=\"literal\">nullptr</span>;  </div><div class=\"line\">        Console::WriteLine( <span class=\"string\">\"SERVER SENT: \"</span> + serverMessage + <span class=\"string\">\" to \"</span> + playername );</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">catch</span> ( Exception^ error_44 )</div><div class=\"line\">    &#123;</div><div class=\"line\">      error_44 = error_44;</div><div class=\"line\">      String^ name = (String^)playersByConnection[tcpClients[count]];  </div><div class=\"line\"></div><div class=\"line\">      Server::playerNames-&gt;Remove( name );</div><div class=\"line\">      <span class=\"comment\">//remove that index of the array, thus freeing it up  </span></div><div class=\"line\">      <span class=\"comment\">//for another user  </span></div><div class=\"line\">      Server::playersByConnection-&gt;Remove(tcpClients[count]);  </div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>The next method just handles the case when a new player connection has been made.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// When a new player connects to the server spawn a thread that will</span></div><div class=\"line\"><span class=\"comment\">// run the game loop.</span></div><div class=\"line\">TcpRelayClient::TcpRelayClient( TcpClient^ playerConnection )</div><div class=\"line\">&#123;</div><div class=\"line\">  client =  playerConnection;</div><div class=\"line\">  Thread^   playerRelayThread   = gcnew Thread( </div><div class=\"line\">      gcnew ThreadStart( <span class=\"keyword\">this</span>, &amp; NetGame::TcpRelayClient::startRelay ) );</div><div class=\"line\"></div><div class=\"line\">  playerRelayThread-&gt;Start();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>If you look at the last method you’ll notice that for each player connection we spawn a new thread on the server with the startRelay() method. The startRelay() method was chosen because its the method which runs all the logic for interacting with our game database. For the most part the startRelay() method consist of the same game loop from the test version of the game, you’ll notice it soon but before that the initialization for the game loop is where the new code is. To start we setup both a stream writer and stream reader to send and receive messages from the player on the thread.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// When we start a new thread for a player who just connected,</span></div><div class=\"line\"><span class=\"comment\">// this is the method the thread runs.</span></div><div class=\"line\"><span class=\"comment\">// In short this is the game loop the player interacts with.</span></div><div class=\"line\"><span class=\"keyword\">void</span> TcpRelayClient::startRelay( )</div><div class=\"line\">&#123;  </div><div class=\"line\">  reader = gcnew StreamReader( client-&gt;GetStream() );</div><div class=\"line\">  <span class=\"comment\">// Writer sends messages out to the client whos connection</span></div><div class=\"line\">  <span class=\"comment\">// is running on this thread.</span></div><div class=\"line\">  writer = gcnew StreamWriter( client-&gt;GetStream() );</div><div class=\"line\"></div><div class=\"line\">  NetworkStream^ netReader = client-&gt;GetStream();</div></pre></td></tr></table></figure></p>\n<p>Just before we actually let the player begin sending new commands we have to store the player’s name within our players hashtable. Please note that for this simple game we don’t double check that two players will have the exact same name because we aren’t building this game to support thousands of players, so our collision prone hashtables are good enough. Ok so lets get the players name, store it within the player hashtables and then let them play.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div></pre></td><td class=\"code\"><pre><div class=\"line\">writer-&gt;WriteLine( <span class=\"string\">\"New Game \"</span> );</div><div class=\"line\">Console::WriteLine( <span class=\"string\">\"SERVER: Getting the new users Name \"</span> );</div><div class=\"line\">writer-&gt;WriteLine( <span class=\"string\">\"Enter a new name for your charecter\"</span> );</div><div class=\"line\">writer-&gt;Flush();</div><div class=\"line\">Console::WriteLine( <span class=\"string\">\"SERVER SENT: Enter a new name for your character\"</span> );</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Read the player's response</span></div><div class=\"line\"><span class=\"built_in\">array</span>&lt;Byte, 1&gt;^  bytesFromClient = gcnew <span class=\"built_in\">array</span>&lt;Byte, <span class=\"number\">1</span>&gt;(<span class=\"number\">256</span>);</div><div class=\"line\">String^ strFromClient = String::Empty ;</div><div class=\"line\">Int32 bytes = <span class=\"number\">0</span> ;</div><div class=\"line\">bytes = netReader-&gt;Read( bytesFromClient, <span class=\"number\">0</span>, bytesFromClient-&gt;Length ) ;</div><div class=\"line\">strFromClient = Text::Encoding::ASCII-&gt;GetString( bytesFromClient, <span class=\"number\">0</span>, bytes );</div><div class=\"line\">player = strFromClient ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Add the player to the hash tables as a new key value pair</span></div><div class=\"line\">Console::WriteLine( player + <span class=\"string\">\" has joined the game\"</span> );</div><div class=\"line\">Server::playerNames-&gt;Add( player, client ); </div><div class=\"line\">Server::playersByConnection-&gt;Add( client, player );</div><div class=\"line\">String^ message ;</div><div class=\"line\"></div><div class=\"line\">Thread^ playerConnect = gcnew Thread( </div><div class=\"line\">    gcnew ThreadStart( <span class=\"keyword\">this</span>, &amp; NetGame::TcpRelayClient::run ) );</div><div class=\"line\"></div><div class=\"line\">playerConnect-&gt;Start();</div></pre></td></tr></table></figure></p>\n<p>Finally we can insert the code for the game loop which is directly extracted from the test game but with some slight additions to how the strings are processed. If you can recall from “server.h” there were two methods, MarshalString and toSysString. Marshal string converts a given managed string or a System::String to native std::string, while toSysString does exactly what it says it does.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">//ALL THE CODE BELOW IS THE ACTUAL GAME LOOP</span></div><div class=\"line\">  <span class=\"comment\">//Create a new player and add to the Dungeon </span></div><div class=\"line\">  <span class=\"built_in\">string</span> output ;</div><div class=\"line\">  <span class=\"built_in\">string</span> input ;</div><div class=\"line\">  String^ tempStr = <span class=\"literal\">nullptr</span> ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">string</span> playerName ;</div><div class=\"line\">  <span class=\"comment\">// MarshalString converts a managed String^ to a native string</span></div><div class=\"line\">  MarshalString( player, playerName ) ; </div><div class=\"line\">  Player* thePlayer = <span class=\"keyword\">new</span> Player( playerName, mainHall ) ;</div><div class=\"line\">  output = caves.addPlayer( thePlayer ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Let all players know of the new player</span></div><div class=\"line\">  message = toSysString( output ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Display needed info for the players</span></div><div class=\"line\">  output = <span class=\"string\">\"\\nDefeat all monsters\"</span> ;</div><div class=\"line\">  output += <span class=\"string\">\"\\nEnter a new command to start, for help menu enter\"</span> ;</div><div class=\"line\">  output += <span class=\"string\">\"\\nhelp:\"</span> ;</div><div class=\"line\">  output += <span class=\"string\">\"\\nTo quit enter \\\"quit\\\"\"</span> ;</div><div class=\"line\">  message += toSysString( output ) ;</div><div class=\"line\">  Server::MsgToPlayer( message, player ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Get client command</span></div><div class=\"line\">  bytesFromClient-&gt;Clear( bytesFromClient, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\">  bytes = netReader-&gt;Read( bytesFromClient, <span class=\"number\">0</span>, bytesFromClient-&gt;Length ) ;</div><div class=\"line\">  strFromClient = Text::Encoding::ASCII-&gt;GetString( bytesFromClient, <span class=\"number\">0</span>, bytes ); </div><div class=\"line\">  MarshalString( strFromClient, input ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">//Start the game loop</span></div><div class=\"line\">  <span class=\"keyword\">while</span>( input != <span class=\"string\">\"quit\"</span> )</div><div class=\"line\">  &#123;</div><div class=\"line\">    <span class=\"comment\">//Pass the users message through the filter</span></div><div class=\"line\">    <span class=\"keyword\">if</span>( filter.validateMessage( input ) )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//Split the users message into a command and value pair</span></div><div class=\"line\">      command = dispatch.extractCommand( input ) ;</div><div class=\"line\">      value = dispatch.extractValue( input ) ;</div><div class=\"line\"></div><div class=\"line\">      <span class=\"comment\">//Match the command and forward the value</span></div><div class=\"line\">      <span class=\"keyword\">switch</span>( command )</div><div class=\"line\">      &#123;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'a'</span>: <span class=\"comment\">//Attack </span></div><div class=\"line\">          <span class=\"comment\">//If the monster does not exist or the name was mispelled</span></div><div class=\"line\">          <span class=\"keyword\">if</span>( &amp;(thePlayer-&gt;mLocation-&gt;getMonsterRef( value )) == <span class=\"literal\">NULL</span> )</div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"comment\">//cout &lt;&lt; \"There is no \" + value + \" at this location\" &lt;&lt; endl ;</span></div><div class=\"line\">            output = <span class=\"string\">\"There is no \"</span> + value + <span class=\"string\">\" at this location\"</span> ;</div><div class=\"line\">            message = toSysString( output ) ;</div><div class=\"line\">            Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">            <span class=\"keyword\">break</span> ;</div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"comment\">//If the monster is there but in combat the player cannot fight it</span></div><div class=\"line\">          <span class=\"keyword\">if</span>( thePlayer-&gt;mLocation-&gt;getMonsterRef( value ).inCombat == <span class=\"literal\">true</span> )</div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"comment\">//cout &lt;&lt; \"The \" + value + \" is currently fighting\" &lt;&lt; endl ;</span></div><div class=\"line\">            output = <span class=\"string\">\"The \"</span> + value + <span class=\"string\">\" is currently fighting\"</span> ;</div><div class=\"line\">            message = toSysString( output ) ;</div><div class=\"line\">            Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">            <span class=\"keyword\">break</span> ;</div><div class=\"line\">          &#125;</div><div class=\"line\">          caves.combatLoop( *thePlayer, thePlayer-&gt;mLocation-&gt;getMonsterRef( value ) ) ;</div><div class=\"line\">          output = <span class=\"string\">\"combat has finished\"</span> ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'m'</span>: <span class=\"comment\">//Move</span></div><div class=\"line\">          <span class=\"comment\">//cout &lt;&lt; thePlayer-&gt;move( value[0] ) ;</span></div><div class=\"line\">          output = thePlayer-&gt;move( value[<span class=\"number\">0</span>] ) ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'f'</span>: <span class=\"comment\">//Find</span></div><div class=\"line\">          <span class=\"comment\">//cout &lt;&lt; thePlayer-&gt;search() ;</span></div><div class=\"line\">          output = thePlayer-&gt;search() ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'l'</span>: <span class=\"comment\">//Location</span></div><div class=\"line\">          <span class=\"comment\">//cout &lt;&lt; thePlayer-&gt;getLocation() ;</span></div><div class=\"line\">          output = thePlayer-&gt;getLocation() ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'e'</span>: <span class=\"comment\">//Equip</span></div><div class=\"line\">          <span class=\"comment\">//cout &lt;&lt; thePlayer-&gt;equip( value ) ;</span></div><div class=\"line\">          output = thePlayer-&gt;equip( value ) ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'y'</span>: <span class=\"comment\">//You</span></div><div class=\"line\">          &#123;</div><div class=\"line\">            <span class=\"built_in\">string</span>* playerStats = <span class=\"keyword\">new</span> <span class=\"built_in\">string</span> ;</div><div class=\"line\">            playerStats = caves.playerStatus( *thePlayer ) ;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">for</span>( <span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; <span class=\"number\">7</span> ; ++i )</div><div class=\"line\">            &#123;</div><div class=\"line\">              <span class=\"comment\">//cout &lt;&lt; playerStats[i] &lt;&lt; endl ;</span></div><div class=\"line\">              output = playerStats[i] ;</div><div class=\"line\">              message = toSysString( output ) ;</div><div class=\"line\">              Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            playerStats = <span class=\"literal\">NULL</span> ;</div><div class=\"line\">            <span class=\"keyword\">delete</span> playerStats ;</div><div class=\"line\">          &#125;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'t'</span>: <span class=\"comment\">//Talk</span></div><div class=\"line\">          output = value ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToAll( player, message ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'h'</span>: <span class=\"comment\">//Help Menu</span></div><div class=\"line\">          <span class=\"comment\">//cout &lt;&lt; \"a: mv: find: loc: eq: you: t: help:\" &lt;&lt; endl ;</span></div><div class=\"line\">          output = <span class=\"string\">\"a: mv: find: loc: eq: you: t: help:\"</span> ;</div><div class=\"line\">          message = toSysString( output ) ;</div><div class=\"line\">          Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">          <span class=\"keyword\">break</span> ;</div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//cout &lt;&lt; \"Invalid command\" &lt;&lt; endl ;</span></div><div class=\"line\">      output = <span class=\"string\">\"Invalid command\"</span> ;</div><div class=\"line\">      message = toSysString( output ) ;</div><div class=\"line\">      Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( caves.isComplete() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//cout &lt;&lt; \"Dungeon Cleared, YOU WIN!\" &lt;&lt; endl ;</span></div><div class=\"line\">      output = <span class=\"string\">\"Dungeon Cleared, YOU WIN!\"</span> ;</div><div class=\"line\">      message = toSysString( output ) ;</div><div class=\"line\">      Server::MsgToAll( player, message ) ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span>( thePlayer-&gt;death() )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//cout &lt;&lt; thePlayer-&gt;getName() + \" was slain by the \" + thePlayer-&gt;mLocation-&gt;getMonsterRef( value ).getName() &lt;&lt; endl ;</span></div><div class=\"line\">      <span class=\"comment\">//output = thePlayer-&gt;getName() + \" was slain by the \" + thePlayer-&gt;mLocation-&gt;getMonsterRef( value ).getName() ;</span></div><div class=\"line\">      output = <span class=\"string\">\"slain type quit to continue\"</span> ;</div><div class=\"line\">      message = toSysString( output ) ;</div><div class=\"line\">      Server::MsgToPlayer( message, player ) ;</div><div class=\"line\">      thePlayer-&gt;mLocation-&gt;getMonsterRef( value ).inCombat = <span class=\"literal\">false</span> ;</div><div class=\"line\">      <span class=\"keyword\">break</span> ;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"comment\">//Get the next command</span></div><div class=\"line\">      <span class=\"comment\">//cout &lt;&lt; \"\\n\\nNew Command\" &lt;&lt; endl ;</span></div><div class=\"line\">      <span class=\"comment\">//cin &gt;&gt; input ;</span></div><div class=\"line\">      <span class=\"comment\">//bytes = 0 ;</span></div><div class=\"line\">      bytesFromClient-&gt;Clear( bytesFromClient, <span class=\"number\">0</span>, <span class=\"number\">256</span> ) ;</div><div class=\"line\">      bytes = netReader-&gt;Read( bytesFromClient, <span class=\"number\">0</span>, bytesFromClient-&gt;Length ) ;</div><div class=\"line\">      strFromClient = Text::Encoding::ASCII-&gt;GetString( bytesFromClient, <span class=\"number\">0</span>, bytes ); </div><div class=\"line\">      MarshalString( strFromClient, input ) ;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"comment\">//End of game loop</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Before we demo our fully functional multiplayer game we have to add the last utility methods for string processing and for logging of the games actions to the server’s console.<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// When running is set to true during initialization of the server</span></div><div class=\"line\"><span class=\"comment\">// which happens when the server constructor is called, this will</span></div><div class=\"line\"><span class=\"comment\">// begin the loop which just displays all game info to the </span></div><div class=\"line\"><span class=\"comment\">// server admin. Think of it as a log of all the players actions.</span></div><div class=\"line\"><span class=\"keyword\">void</span>  TcpRelayClient::run()</div><div class=\"line\">&#123;</div><div class=\"line\">  <span class=\"keyword\">bool</span> running = <span class=\"literal\">true</span>;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">try</span></div><div class=\"line\">  &#123;</div><div class=\"line\">    String^ line = <span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">while</span> ( running )</div><div class=\"line\">    &#123;</div><div class=\"line\">      <span class=\"keyword\">if</span> ( client-&gt;Connected )</div><div class=\"line\">      &#123;</div><div class=\"line\">        line = reader-&gt;ReadLine();</div><div class=\"line\">        Server::MsgToAll( player,  line );</div><div class=\"line\">      &#125;</div><div class=\"line\">      <span class=\"keyword\">else</span></div><div class=\"line\">      &#123;</div><div class=\"line\">        running = <span class=\"literal\">false</span>;            </div><div class=\"line\">      &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">  <span class=\"keyword\">catch</span> ( Exception^ eRun )</div><div class=\"line\">  &#123;</div><div class=\"line\">    Console::WriteLine( <span class=\"string\">\"EXCEPTION\"</span> +  eRun-&gt;Message + <span class=\"string\">\"\\nThe player named: \"</span> + player + <span class=\"string\">\" has disconnected, the server continues\"</span> );</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Converts a managed string to a native string </span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MarshalString</span> <span class=\"params\">( String ^ s, <span class=\"built_in\">string</span>&amp; os )</span> </div><div class=\"line\"></span>&#123;</div><div class=\"line\">  <span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> Runtime::InteropServices;</div><div class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* chars = (<span class=\"keyword\">const</span> <span class=\"keyword\">char</span>*)(Marshal::StringToHGlobalAnsi(s)).ToPointer();</div><div class=\"line\">  os = chars;</div><div class=\"line\">  Marshal::FreeHGlobal(IntPtr((<span class=\"keyword\">void</span>*)chars));</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// Converts a native string to a managed one</span></div><div class=\"line\">String^ toSysString( <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> output )</div><div class=\"line\">&#123;</div><div class=\"line\">  String^ tempStr = gcnew String( output.c_str() ) ;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"keyword\">return</span> tempStr ;</div><div class=\"line\">&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Now open up the file “main.cpp” and run the server, we run the server via the constructor method so as soon as you create the server it will pend for request on 127.0.0.1 port 13000 for new players.</p>\n<p>For the demo what you’ll need to do is to open up three instances of Visual Studio. One instance will run the server, so open up the server project on the first one while the second and third instances will each run clients; so open up the client project on the other two. Once you have all three open the first step is to start the server.</p>\n<p>Then launch the second client and give this new player a name.</p>\n<p>Now switch back to the first client enter the following commands, “eq:woodsword” and then “a:imp” this will have the effect of equipping the woodsword item from the Main Hall and killing the imp monster. Finally switch back over to the second client and enter the following command “find:”, you will notice that both the woodsword and the imp have cannot be found as they were both taken care of by the first player. You have just finished writing a simple text based multiplayer RPG.</p>\n<p>Once again the two files below, the one for the server and the one for the client are hosted on my dropbox account, so if at any time they aren’t accessible(I often move files around and don’t clean up dead links) and put a request into the comments section.</p>\n<p><a href=\"http://dl.dropbox.com/u/22280460/Simple_RPG_Client.rar\">Click here to download the client application</a><br><a href=\"http://dl.dropbox.com/u/22280460/Simple_RPG_Server.rar\">Click here to download the server application</a></p>\n<p><a href=\"/2011/06/16/textbasedrpgpart6\">Click here for part VI</a></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cj1jsmr1l000h9uwvehno0jqt","category_id":"cj1jsmr1p000j9uwvzscr59tq","_id":"cj1jsmr21000r9uwvr6dbk20g"},{"post_id":"cj1jsmr1z000q9uwvfaaxks3u","category_id":"cj1jsmr1p000j9uwvzscr59tq","_id":"cj1jsmr27000x9uwvutx3iv9g"},{"post_id":"cj1jsmr1q000k9uwv0lqsesjd","category_id":"cj1jsmr1p000j9uwvzscr59tq","_id":"cj1jsmr2n00109uwv8byieohn"},{"post_id":"cj1jsmr22000s9uwvqkyttnbj","category_id":"cj1jsmr1p000j9uwvzscr59tq","_id":"cj1jsmr2r00149uwvh2ck8v4m"},{"post_id":"cj1jsmr25000v9uwvlqfmtp2n","category_id":"cj1jsmr1p000j9uwvzscr59tq","_id":"cj1jsmr2v00169uwv81v54zxf"},{"post_id":"cj1jsmr1s000m9uwvgv5yjhho","category_id":"cj1jsmr23000t9uwv8aqln5zn","_id":"cj1jsmr2x00199uwv11etn9ai"},{"post_id":"cj1jsmr27000y9uwv6iujkpoc","category_id":"cj1jsmr1p000j9uwvzscr59tq","_id":"cj1jsmr2x001b9uwvlcgmoako"},{"post_id":"cj1jsmr2n00129uwvz1gvhmr1","category_id":"cj1jsmr1p000j9uwvzscr59tq","_id":"cj1jsmr2y001e9uwviv5ui4yx"},{"post_id":"cj1jsmr2s00159uwvqzupq3rt","category_id":"cj1jsmr1p000j9uwvzscr59tq","_id":"cj1jsmr2z001f9uwvbtytaz70"},{"post_id":"cj1jsmr2v00179uwvk5bm2uol","category_id":"cj1jsmr1p000j9uwvzscr59tq","_id":"cj1jsmr30001h9uwvcqozekvb"}],"PostTag":[{"post_id":"cj1jsmr0y000e9uwvgwxgl6lm","tag_id":"cj1jsmr14000g9uwv3v8qdw7x","_id":"cj1jsmr26000w9uwvggrt0cb5"},{"post_id":"cj1jsmr0y000e9uwvgwxgl6lm","tag_id":"cj1jsmr1r000l9uwvtwx9khxc","_id":"cj1jsmr2m000z9uwvd98hbrrz"},{"post_id":"cj1jsmr0y000e9uwvgwxgl6lm","tag_id":"cj1jsmr1y000p9uwvyrv42yzs","_id":"cj1jsmr2r00139uwv74ccwsnx"},{"post_id":"cj1jsmr11000f9uwv18lvy1s5","tag_id":"cj1jsmr24000u9uwvix374ew4","_id":"cj1jsmr2x001a9uwvsnhkcoeg"},{"post_id":"cj1jsmr11000f9uwv18lvy1s5","tag_id":"cj1jsmr2n00119uwvuzsdobr3","_id":"cj1jsmr2y001c9uwv9p72tcin"},{"post_id":"cj1jsmr1l000h9uwvehno0jqt","tag_id":"cj1jsmr14000g9uwv3v8qdw7x","_id":"cj1jsmr31001j9uwveyk0dowv"},{"post_id":"cj1jsmr1l000h9uwvehno0jqt","tag_id":"cj1jsmr1r000l9uwvtwx9khxc","_id":"cj1jsmr31001k9uwvcws7enc9"},{"post_id":"cj1jsmr1l000h9uwvehno0jqt","tag_id":"cj1jsmr1y000p9uwvyrv42yzs","_id":"cj1jsmr32001m9uwvnas3wcdi"},{"post_id":"cj1jsmr1n000i9uwvdyav0i3x","tag_id":"cj1jsmr24000u9uwvix374ew4","_id":"cj1jsmr33001o9uwvmn2bh8bz"},{"post_id":"cj1jsmr1n000i9uwvdyav0i3x","tag_id":"cj1jsmr32001l9uwvpaczrhw6","_id":"cj1jsmr33001p9uwv5gx78ily"},{"post_id":"cj1jsmr1q000k9uwv0lqsesjd","tag_id":"cj1jsmr14000g9uwv3v8qdw7x","_id":"cj1jsmr35001r9uwv6wom45qj"},{"post_id":"cj1jsmr1q000k9uwv0lqsesjd","tag_id":"cj1jsmr1r000l9uwvtwx9khxc","_id":"cj1jsmr36001s9uwvr8ecg03k"},{"post_id":"cj1jsmr1s000m9uwvgv5yjhho","tag_id":"cj1jsmr32001l9uwvpaczrhw6","_id":"cj1jsmr38001v9uwvs1wmrjnc"},{"post_id":"cj1jsmr1s000m9uwvgv5yjhho","tag_id":"cj1jsmr24000u9uwvix374ew4","_id":"cj1jsmr3a001w9uwvpx6cv978"},{"post_id":"cj1jsmr1u000n9uwvn217gqj1","tag_id":"cj1jsmr37001u9uwv5udnsdw7","_id":"cj1jsmr3c001z9uwvpgxw7vul"},{"post_id":"cj1jsmr1u000n9uwvn217gqj1","tag_id":"cj1jsmr24000u9uwvix374ew4","_id":"cj1jsmr3c00209uwvceik2fx6"},{"post_id":"cj1jsmr1z000q9uwvfaaxks3u","tag_id":"cj1jsmr3b001y9uwvfuhbwh5x","_id":"cj1jsmr3d00229uwv2mdqzqe6"},{"post_id":"cj1jsmr22000s9uwvqkyttnbj","tag_id":"cj1jsmr3b001y9uwvfuhbwh5x","_id":"cj1jsmr3f00249uwvkpaxg2nb"},{"post_id":"cj1jsmr25000v9uwvlqfmtp2n","tag_id":"cj1jsmr3b001y9uwvfuhbwh5x","_id":"cj1jsmr3g00269uwv5wc06aw0"},{"post_id":"cj1jsmr27000y9uwv6iujkpoc","tag_id":"cj1jsmr3b001y9uwvfuhbwh5x","_id":"cj1jsmr3h00289uwvyq93v61f"},{"post_id":"cj1jsmr2n00129uwvz1gvhmr1","tag_id":"cj1jsmr3b001y9uwvfuhbwh5x","_id":"cj1jsmr3i002a9uwvucep0dyb"},{"post_id":"cj1jsmr2s00159uwvqzupq3rt","tag_id":"cj1jsmr3b001y9uwvfuhbwh5x","_id":"cj1jsmr3j002c9uwvbwifn9f8"},{"post_id":"cj1jsmr2v00179uwvk5bm2uol","tag_id":"cj1jsmr3b001y9uwvfuhbwh5x","_id":"cj1jsmr3k002d9uwv8e4xy4fw"}],"Tag":[{"name":"java","_id":"cj1jsmr14000g9uwv3v8qdw7x"},{"name":"android","_id":"cj1jsmr1r000l9uwvtwx9khxc"},{"name":"mobile","_id":"cj1jsmr1y000p9uwvyrv42yzs"},{"name":"javascript","_id":"cj1jsmr24000u9uwvix374ew4"},{"name":"nodejs","_id":"cj1jsmr2n00119uwvuzsdobr3"},{"name":"ruby","_id":"cj1jsmr32001l9uwvpaczrhw6"},{"name":"php","_id":"cj1jsmr37001u9uwv5udnsdw7"},{"name":"cpp","_id":"cj1jsmr3b001y9uwvfuhbwh5x"}]}}